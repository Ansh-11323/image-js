var _StringfromCharCode=String.fromCharCode,_Mathsign=Math.sign,_NumberNEGATIVE_INFINITY=Number.NEGATIVE_INFINITY,_NumberPOSITIVE_INFINITY=Number.POSITIVE_INFINITY,_Mathcos=Math.cos,_NumberEPSILON=Number.EPSILON,_NumberMAX_VALUE=Number.MAX_VALUE,_NumberMIN_VALUE=Number.MIN_VALUE,_Mathlog=Math.log,_Mathpow=Math.pow,_Mathabs=Math.abs,_Mathmin=Math.min,_Mathmax=Math.max,_NumberisFinite=Number.isFinite,_NumberisInteger=Number.isInteger,_Mathround=Math.round,_Mathexp=Math.exp,_Mathsqrt=Math.sqrt,_Mathsin=Math.sin,_MathPI=Math.PI,_Mathfloor=Math.floor,_Mathceil=Math.ceil;(function(_,S){'object'==typeof exports&&'undefined'!=typeof module?module.exports=S():'function'==typeof define&&define.amd?define(S):_.IJS=S()})(this,function(){'use strict';function _(Fb){return Nr[Fb]}function S(Fb){var Ub=Fb.channels*Fb.size;return 1===Fb.bitDepth&&(Ub=_Mathceil(Ub/8)),Ub}function I(Fb){var Ub=Fb.channels*Fb.size,qb;switch(Fb.bitDepth){case 1:qb=new Uint8Array(_Mathceil(Ub/8));break;case 8:qb=new Uint8ClampedArray(Ub);break;case 16:qb=new Uint16Array(Ub);break;case 32:qb=new Float32Array(Ub);break;default:throw new Error('Cannot create pixel array for bit depth '+Fb.bitDepth);}if(Fb.alpha)for(var Xb=Fb.components;Xb<qb.length;Xb+=Fb.channels)qb[Xb]=Fb.maxValue;return qb}function P(Fb){try{var Ub=new URL(Fb);return Ub.origin!==Zr}catch(qb){return!1}}function R(Fb,Ub){var qb=self.document.createElement('canvas');return qb.width=Fb,qb.height=Ub,qb}function L(Fb,{withCredentials:Ub=!1}={}){return new Promise(function(qb,Xb){var Ob=new self.XMLHttpRequest;Ob.open('GET',Fb,!0),Ob.responseType='arraybuffer',Ob.withCredentials=Ub,Ob.onload=function(Nb){200===this.status?qb(this.response):Xb(Nb)},Ob.onerror=Xb,Ob.send()})}function E(){throw new Error('createWriteStream does not exist in the browser')}function T(){throw new Error('writeFile does not exist in the browser')}function O(){if(this.checkProcessable('invert',{bitDepth:[1,8,16]}),1===this.bitDepth)for(var Fb=this.data,Ub=0;Ub<Fb.length;Ub++)Fb[Ub]=~Fb[Ub];else for(var qb=0;qb<this.width;qb++)for(var Xb=0;Xb<this.height;Xb++)for(var Ob=0,Nb;Ob<this.components;Ob++)Nb=this.getValueXY(qb,Xb,Ob),this.setValueXY(qb,Xb,Ob,this.maxValue-Nb)}function G(){if(this.checkProcessable('invert',{bitDepth:[1,8,16]}),1===this.bitDepth)for(var Fb=this.data,Ub=0;Ub<Fb.length;Ub++)Fb[Ub]=~Fb[Ub];else for(var qb of this.pixels())for(var Xb=qb.index,Ob=qb.pixel,Nb=0;Nb<this.components;Nb++)this.setValue(Xb,Nb,this.maxValue-Ob[Nb])}function W(){this.checkProcessable('invertOneLoop',{bitDepth:[8,16]});for(var Fb=this.data,Ub=0;Ub<Fb.length;Ub+=this.channels)for(var qb=0;qb<this.components;qb++)Fb[Ub+qb]=this.maxValue-Fb[Ub+qb]}function Z(){this.checkProcessable('invertPixel',{bitDepth:[8,16]});for(var Fb=0;Fb<this.width;Fb++)for(var Ub=0,qb;Ub<this.height;Ub++){qb=this.getPixelXY(Fb,Ub);for(var Xb=0;Xb<this.components;Xb++)qb[Xb]=this.maxValue-qb[Xb];this.setPixelXY(Fb,Ub,qb)}}function Q(){if(1===this.bitDepth)for(var Fb=this.data,Ub=0;Ub<Fb.length;Ub++)Fb[Ub]=~Fb[Ub];else this.checkProcessable('invertApply',{bitDepth:[8,16]}),this.apply(function(qb){for(var Xb=0;Xb<this.components;Xb++)this.data[qb+Xb]=this.maxValue-this.data[qb+Xb]})}function J(){this.checkProcessable('invertBinaryLoop',{bitDepth:[1]});for(var Fb=0;Fb<this.size;Fb++)this.toggleBit(Fb)}function $(Fb,Ub={}){var qb=Ub.channels,Xb=Ub.allowAlpha,Ob=Ub.defaultAlpha;return'boolean'!=typeof Xb&&(Xb=!0),'undefined'==typeof qb?ee(Fb,Ob):te(Fb,qb,Xb)}function ee(Fb,Ub){for(var qb=Ub?Fb.channels:Fb.components,Xb=Array(qb),Ob=0;Ob<qb;Ob++)Xb[Ob]=Ob;return Xb}function te(Fb,Ub,qb){Array.isArray(Ub)||(Ub=[Ub]);for(var Xb=0;Xb<Ub.length;Xb++)Ub[Xb]=ae(Fb,Ub[Xb],qb);return Ub}function ae(Fb,Ub,qb=!0){if(void 0===Ub)throw new RangeError('validateChannel : the channel has to be >=0 and <'+Fb.channels);if('string'==typeof Ub){switch(Fb.colorModel){case Or:break;case Yr:'rgb'.includes(Ub)&&('r'===Ub?Ub=0:'g'===Ub?Ub=1:'b'===Ub?Ub=2:void 0);break;case Fr:'hsl'.includes(Ub)&&('h'===Ub?Ub=0:'s'===Ub?Ub=1:'l'===Ub?Ub=2:void 0);break;case Ur:'hsv'.includes(Ub)&&('h'===Ub?Ub=0:'s'===Ub?Ub=1:'v'===Ub?Ub=2:void 0);break;case Xr:'cmyk'.includes(Ub)&&('c'===Ub?Ub=0:'m'===Ub?Ub=1:'y'===Ub?Ub=2:'k'===Ub?Ub=3:void 0);break;default:throw new Error(`Unexpected color model: ${Fb.colorModel}`);}if('a'===Ub){if(!Fb.alpha)throw new Error('validateChannel : the image does not contain alpha channel');Ub=Fb.components}if('string'==typeof Ub)throw new Error('validateChannel : undefined channel: '+Ub)}if(Ub>=Fb.channels)throw new RangeError('validateChannel : the channel has to be >=0 and <'+Fb.channels);if(!qb&&Ub>=Fb.components)throw new RangeError('validateChannel : alpha channel may not be selected');return Ub}function ie(Fb={}){var Ub=Fb.channels;if(this.checkProcessable('invertOneLoop',{bitDepth:[1,8,16]}),1===this.bitDepth)for(var qb=this.data,Xb=0;Xb<qb.length;Xb++)qb[Xb]=~qb[Xb];else{Ub=$(this,{channels:Ub});for(var Ob=0,Nb;Ob<Ub.length;Ob++){Nb=Ub[Ob];for(var Gb=Nb;Gb<this.data.length;Gb+=this.channels)this.data[Gb]=this.maxValue-this.data[Gb]}}return this}function ne(){this.checkProcessable('flipX',{bitDepth:[8,16]});for(var Fb=0,Ub;Fb<this.height;Fb++){Ub=Fb*this.width*this.channels;for(var qb=0;qb<_Mathfloor(this.width/2);qb++)for(var Xb=qb*this.channels+Ub,Ob=(this.width-qb-1)*this.channels+Ub,Nb=0,Gb;Nb<this.channels;Nb++)Gb=this.data[Xb+Nb],this.data[Xb+Nb]=this.data[Ob+Nb],this.data[Ob+Nb]=Gb}return this}function oe(){this.checkProcessable('flipY',{bitDepth:[8,16]});for(var Fb=0;Fb<_Mathfloor(this.height/2);Fb++)for(var Ub=0;Ub<this.width;Ub++)for(var qb=Ub*this.channels+Fb*this.width*this.channels,Xb=Ub*this.channels+(this.height-1-Fb)*this.channels*this.width,Ob=0,Nb;Ob<this.channels;Ob++)Nb=this.data[qb+Ob],this.data[qb+Ob]=this.data[Xb+Ob],this.data[Xb+Ob]=Nb;return this}function se(Fb,Ub={}){return Ub=Object.assign({},Ub),Ub.algorithm='fft',this.convolution(Fb,Ub)}function le(Fb={}){var Ub=Fb.radius,qb=void 0===Ub?1:Ub;if(this.checkProcessable('meanFilter',{components:[1],bitDepth:[8,16]}),1>qb)throw new Error('Number of neighbors should be grater than 0');for(var Xb=2*qb+1,Nb=Array(Xb*Xb),Gb=0;Gb<Nb.length;Gb++)Nb[Gb]=1;return se.call(this,Nb)}function de(Fb){if('number'!=typeof Fb||Qr(Fb))throw new TypeError('Expected a number')}function he(Fb={}){var Ub=Fb.radius,qb=void 0===Ub?1:Ub,Xb=Fb.channels,Ob=Fb.border,Nb=void 0===Ob?'copy':Ob;if(this.checkProcessable('median',{bitDepth:[8,16]}),1>qb)throw new Error('Kernel radius should be greater than 0');Xb=$(this,Xb,!0);for(var Gb=qb,Hb=qb,Wb=Sb.createFrom(this),Zb=(2*Gb+1)*(2*Hb+1),Qb=_Mathfloor(Zb/2),Kb=Array(Zb),Jb=0,$b;Jb<Xb.length;Jb++){$b=Xb[Jb];for(var e_=Hb;e_<this.height-Hb;e_++)for(var t_=Gb,a_;t_<this.width-Gb;t_++){a_=0;for(var i_=-Hb;i_<=Hb;i_++)for(var n_=-Gb,o_;n_<=Gb;n_++)o_=((e_+i_)*this.width+t_+n_)*this.channels+$b,Kb[a_++]=this.data[o_];var s_=(e_*this.width+t_)*this.channels+$b,r_=Kb.sort(Kr)[Qb];Wb.data[s_]=r_}}if(this.alpha&&!Xb.includes(this.channels))for(var l_=this.components;l_<this.data.length;l_+=this.channels)Wb.data[l_]=this.data[l_];return Wb.setBorder({size:[Gb,Hb],algorithm:Nb}),Wb}function ce(){throw new Error('Dynamic requires are not currently supported by rollup-plugin-commonjs')}function ge(Fb,Ub){return Ub={exports:{}},Fb(Ub,Ub.exports),Ub.exports}function be(Fb){var Ub=Fb,qb,Xb;if('number'!=typeof Fb[0]){qb=Fb.length,Xb=Fb[0].length,Ub=Array(qb*Xb);for(var Ob=0;Ob<qb;Ob++)for(var Nb=0;Nb<Xb;Nb++)Ub[Ob*Xb+Nb]=Fb[Ob][Nb]}else{var Gb=_Mathsqrt(Fb.length);_NumberisInteger(Gb)&&(qb=Gb,Xb=Gb)}return{data:Ub,rows:qb,cols:Xb}}function _e(Fb){var Ub,qb;if(!Array.isArray(Fb))throw new Error('validateKernel: Invalid Kernel: '+Fb);else if(!Array.isArray(Fb[0])){var Xb=_Mathsqrt(Fb.length);if(ml(Xb))qb=Ub=_Mathfloor(_Mathsqrt(Fb.length)/2);else throw new RangeError('validateKernel: Kernel array should be a square');for(var Ob=Array(Xb),Nb=0;Nb<Xb;Nb++){Ob[Nb]=Array(Xb);for(var Gb=0;Gb<Xb;Gb++)Ob[Nb][Gb]=Fb[Nb*Xb+Gb]}Fb=Ob}else if(0==(1&Fb.length)||0==(1&Fb[0].length))throw new RangeError('validateKernel: Kernel rows and columns should be odd numbers');else Ub=_Mathfloor(Fb.length/2),qb=_Mathfloor(Fb[0].length/2);return{kernel:Fb,kWidth:qb,kHeight:Ub}}function we(Fb,Ub={}){var qb=Ub.channels,Xb=Ub.bitDepth,Ob=Ub.normalize,Nb=void 0!==Ob&&Ob,Gb=Ub.divisor,Hb=void 0===Gb?1:Gb,Wb=Ub.border,Zb=void 0===Wb?'copy':Wb,Qb=Ub.algorithm,Kb=void 0===Qb?'auto':Qb,Jb=Sb.createFrom(this,{bitDepth:Xb});qb=$(this,qb,!0);var $b=_e(Fb);Fb=$b.kernel,'auto'===Kb&&(9<Fb.length||9<Fb[0].length?Kb='fft':Kb='direct'),(4096<this.width||4096<this.height)&&(Kb='direct');var e_=_Mathfloor(Fb.length/2),t_=_Mathfloor(Fb[0].length/2),a_=Jb.isClamped,i_=Array(this.height*this.width),o_=void 0,s_=void 0,r_=void 0,n_,l_,d_;for(r_=0;r_<qb.length;r_++){for(l_=qb[r_],s_=0;s_<this.height;s_++)for(o_=0;o_<this.width;o_++)n_=s_*this.width+o_,i_[n_]=this.data[n_*this.channels+l_];for(d_='direct'===Kb?ll(i_,Fb,{rows:this.height,cols:this.width,normalize:Nb,divisor:Hb}):dl(i_,Fb,{rows:this.height,cols:this.width,normalize:Nb,divisor:Hb}),s_=0;s_<this.height;s_++)for(o_=0;o_<this.width;o_++)n_=s_*this.width+o_,Jb.data[n_*this.channels+l_]=a_?_Mathmin(_Mathmax(d_[n_],0),Jb.maxValue):d_[n_]}if(this.alpha&&!qb.includes(this.channels))for(o_=this.components;o_<this.data.length;o_+=this.channels)Jb.data[o_]=this.data[o_];return'periodic'!==Zb&&Jb.setBorder({size:[t_,e_],algorithm:Zb}),Jb}function xe(Fb={}){var Ub=Fb.radius,qb=void 0===Ub?1:Ub,Xb=Fb.sigma,Ob=Fb.channels,Nb=Fb.border,Gb=void 0===Nb?'copy':Nb,Hb=Fb.algorithm,Wb=void 0===Hb?'auto':Hb;this.checkProcessable('gaussian',{bitDepth:[8,16]});var Zb;return Xb?Zb=ke(Xb):(Xb=0.3*(qb-1)+0.8,Zb=ye(qb,Xb)),we.call(this,Zb,{border:Gb,channels:Ob,algorithm:Wb})}function ye(Fb,Ub){if(1>Fb)throw new RangeError('Radius should be grater than 0');for(var qb=2*Fb+1,Xb=Array(qb*qb),Ob=2*(Ub*Ub),Gb=0;Gb<=Fb;Gb++)for(var Hb=Gb,Wb;Hb<=Fb;Hb++)Wb=_Mathexp(-(Gb*Gb+Hb*Hb)/Ob)/(_MathPI*Ob),Xb[(Gb+Fb)*qb+(Hb+Fb)]=Wb,Xb[(Gb+Fb)*qb+(-Hb+Fb)]=Wb,Xb[(-Gb+Fb)*qb+(Hb+Fb)]=Wb,Xb[(-Gb+Fb)*qb+(-Hb+Fb)]=Wb,Xb[(Hb+Fb)*qb+(Gb+Fb)]=Wb,Xb[(Hb+Fb)*qb+(-Gb+Fb)]=Wb,Xb[(-Hb+Fb)*qb+(Gb+Fb)]=Wb,Xb[(-Hb+Fb)*qb+(-Gb+Fb)]=Wb;return Xb}function ke(Fb){if(0>=Fb)throw new RangeError('Sigma should be grater than 0');for(var Ub=2*(Fb*Fb),qb=_MathPI*Ub,Xb=1/qb,Ob=Xb,Nb=0;0.99>Ob;){Nb++,Xb=_Mathexp(-(Nb*Nb)/Ub)/qb,Ob+=4*Xb;for(var Gb=1;Gb<Nb;Gb++)Xb=_Mathexp(-(Gb*Gb+Nb*Nb)/Ub)/qb,Ob+=8*Xb;Xb=4*_Mathexp(-(2*Nb*Nb)/Ub)/qb,Ob+=Xb}if(1<Ob)throw new Error('unexpected sum over 1');return ye(Nb,Fb)}function ve(Fb={}){var Ub=Fb.kernelX,qb=void 0===Ub?ul:Ub,Xb=Fb.kernelY,Ob=void 0===Xb?pl:Xb,Nb=Fb.border,Gb=void 0===Nb?'copy':Nb,Hb=Fb.channels,Wb=Fb.bitDepth,Zb=void 0===Wb?this.bitDepth:Wb;this.checkProcessable('sobel',{bitDepth:[8,16]});var Qb=we.call(this,qb,{channels:Hb,border:Gb,bitDepth:32}),Kb=we.call(this,Ob,{channels:Hb,border:Gb,bitDepth:32});return Qb.hypotenuse(Kb,{bitDepth:Zb,channels:Hb})}function je(Fb={}){var Ub=Fb.algorithm,qb=void 0===Ub?'range':Ub,Xb=Fb.channels,Ob=Fb.min,Nb=void 0===Ob?this.min:Ob,Gb=Fb.max,Hb=void 0===Gb?this.max:Gb;switch(this.checkProcessable('level',{bitDepth:[8,16]}),Xb=$(this,{channels:Xb}),qb){case'range':0>Nb&&(Nb=0),Hb>this.maxValue&&(Hb=this.maxValue),Array.isArray(Nb)||(Nb=_l(Xb.length,Nb)),Array.isArray(Hb)||(Hb=_l(Xb.length,Hb)),Me(this,Nb,Hb,Xb);break;default:throw new Error('level: algorithm not implement: '+qb);}return this}function Me(Fb,Ub,qb,Xb){var Ob=1e-5,Nb=Array(Fb.channels);for(var Gb of Xb)Nb[Gb]=0===Ub[Gb]&&qb[Gb]===Fb.maxValue?0:qb[Gb]===Ub[Gb]?0:(Fb.maxValue+1-Ob)/(qb[Gb]-Ub[Gb]),Ub[Gb]+=(0.5-Ob/2)/Nb[Gb];for(var Hb=0,Wb;Hb<Xb.length;Hb++)if(Wb=Xb[Hb],0!==Nb[Wb])for(var Zb=0;Zb<Fb.data.length;Zb+=Fb.channels)Fb.data[Zb+Wb]=_Mathmin(_Mathmax(0,0|(Fb.data[Zb+Wb]-Ub[Wb])*Nb[Wb]+0.5),Fb.maxValue)}function Se(Fb){if(!isNaN(Fb)){if(0>=Fb)throw new Error('checkNumberArray: the value must be greater than 0');return Fb}if(Fb instanceof Sb)return Fb.data;if(!kl(Fb))throw new Error('checkNumberArray: the value should be either a number, array or Image');return Fb}function Ie(Fb,Ub={}){var qb=Ub.channels;if(this.checkProcessable('add',{bitDepth:[8,16]}),qb=$(this,{channels:qb}),Fb=Se(Fb),!isNaN(Fb))for(var Xb=0,Ob;Xb<qb.length;Xb++){Ob=qb[Xb];for(var Nb=0;Nb<this.data.length;Nb+=this.channels)this.data[Nb+Ob]=_Mathmin(this.maxValue,this.data[Nb+Ob]+Fb>>0)}else{if(this.data.length!==Fb.length)throw new Error('add: the data size is different');for(var Gb=0,Hb;Gb<qb.length;Gb++){Hb=qb[Gb];for(var Wb=0;Wb<this.data.length;Wb+=this.channels)this.data[Wb+Hb]=_Mathmax(0,_Mathmin(this.maxValue,this.data[Wb+Hb]+Fb[Wb+Hb]>>0))}}return this}function Pe(Fb,Ub={}){var qb=Ub.channels;if(this.checkProcessable('subtract',{bitDepth:[8,16]}),qb=$(this,{channels:qb}),Fb=Se(Fb),!isNaN(Fb))for(var Xb=0,Ob;Xb<qb.length;Xb++){Ob=qb[Xb];for(var Nb=0;Nb<this.data.length;Nb+=this.channels)this.data[Nb+Ob]=_Mathmax(0,this.data[Nb+Ob]-Fb>>0)}else{if(this.data.length!==Fb.length)throw new Error('substract: the data size is different');for(var Gb=0,Hb;Gb<qb.length;Gb++){Hb=qb[Gb];for(var Wb=0;Wb<this.data.length;Wb+=this.channels)this.data[Wb+Hb]=_Mathmax(0,_Mathmin(this.maxValue,this.data[Wb+Hb]-Fb[Wb+Hb]>>0))}}return this}function Ce(Fb,Ub={}){var qb=Ub.bitDepth,Xb=void 0===qb?this.bitDepth:qb,Ob=Ub.channels;if(this.checkProcessable('hypotenuse',{bitDepth:[8,16,32]}),this.width!==Fb.width||this.height!==Fb.height)throw new Error('hypotenuse: both images must have the same size');if(this.alpha!==Fb.alpha||this.bitDepth!==Fb.bitDepth)throw new Error('hypotenuse: both images must have the same alpha and bitDepth');if(this.channels!==Fb.channels)throw new Error('hypotenuse: both images must have the same number of channels');var Nb=Sb.createFrom(this,{bitDepth:Xb});Ob=$(this,{channels:Ob});for(var Gb=Nb.isClamped,Hb=0,Wb;Hb<Ob.length;Hb++){Wb=Ob[Hb];for(var Zb=Wb,Qb;Zb<this.data.length;Zb+=this.channels)Qb=Math.hypot(this.data[Zb],Fb.data[Zb]),Nb.data[Zb]=Gb?_Mathmin(_Mathmax(_Mathround(Qb),0),Nb.maxValue):Qb}return Nb}function Be(Fb,Ub={}){var qb=Ub.channels;if(this.checkProcessable('multiply',{bitDepth:[8,16]}),0>=Fb)throw new Error('multiply: the value must be greater than 0');if(qb=$(this,{channels:qb}),Fb=Se(Fb),!isNaN(Fb))for(var Xb=0,Ob;Xb<qb.length;Xb++){Ob=qb[Xb];for(var Nb=0;Nb<this.data.length;Nb+=this.channels)this.data[Nb+Ob]=_Mathmin(this.maxValue,this.data[Nb+Ob]*Fb>>0)}else{if(this.data.length!==Fb.length)throw new Error('multiply: the data size is different');for(var Gb=0,Hb;Gb<qb.length;Gb++){Hb=qb[Gb];for(var Wb=0;Wb<this.data.length;Wb+=this.channels)this.data[Wb+Hb]=_Mathmax(0,_Mathmin(this.maxValue,this.data[Wb+Hb]*Fb[Wb+Hb]>>0))}}return this}function Ae(Fb,Ub={}){var qb=Ub.channels;if(this.checkProcessable('divide',{bitDepth:[8,16]}),qb=$(this,{channels:qb}),Fb=Se(Fb),!isNaN(Fb))for(var Xb=0,Ob;Xb<qb.length;Xb++){Ob=qb[Xb];for(var Nb=0;Nb<this.data.length;Nb+=this.channels)this.data[Nb+Ob]=_Mathmin(this.maxValue,this.data[Nb+Ob]/Fb>>0)}else{if(this.data.length!==Fb.length)throw new Error('divide: the: the data size is different');for(var Gb=0,Hb;Gb<qb.length;Gb++){Hb=qb[Gb];for(var Wb=0;Wb<this.data.length;Wb+=this.channels)this.data[Wb+Hb]=_Mathmax(0,_Mathmin(this.maxValue,this.data[Wb+Hb]/Fb[Wb+Hb]>>0))}}return this}function Re(Fb){if(!(this instanceof Re))return new Re(Fb);Fb=$l.checkMatrix(Fb);var Ub=Fb.clone(),qb=Ub.rows,Xb=Ub.columns,Ob=Array(qb),Nb=1,Gb,Hb,Wb,Zb,Qb,Kb,Jb,$b,e_,t_;for(Gb=0;Gb<qb;Gb++)Ob[Gb]=Gb;for(e_=Array(qb),Hb=0;Hb<Xb;Hb++){for(Gb=0;Gb<qb;Gb++)e_[Gb]=Ub[Gb][Hb];for(Gb=0;Gb<qb;Gb++){for($b=Ub[Gb],t_=_Mathmin(Gb,Hb),Qb=0,Wb=0;Wb<t_;Wb++)Qb+=$b[Wb]*e_[Wb];$b[Hb]=e_[Gb]-=Qb}for(Zb=Hb,Gb=Hb+1;Gb<qb;Gb++)_Mathabs(e_[Gb])>_Mathabs(e_[Zb])&&(Zb=Gb);if(Zb!==Hb){for(Wb=0;Wb<Xb;Wb++)Kb=Ub[Zb][Wb],Ub[Zb][Wb]=Ub[Hb][Wb],Ub[Hb][Wb]=Kb;Jb=Ob[Zb],Ob[Zb]=Ob[Hb],Ob[Hb]=Jb,Nb=-Nb}if(Hb<qb&&0!==Ub[Hb][Hb])for(Gb=Hb+1;Gb<qb;Gb++)Ub[Gb][Hb]/=Ub[Hb][Hb]}this.LU=Ub,this.pivotVector=Ob,this.pivotSign=Nb}function ze(Fb,Ub){var qb;return _Mathabs(Fb)>_Mathabs(Ub)?(qb=Ub/Fb,_Mathabs(Fb)*_Mathsqrt(1+qb*qb)):0===Ub?0:(qb=Fb/Ub,_Mathabs(Ub)*_Mathsqrt(1+qb*qb))}function Le(Fb,Ub,qb){for(var Xb=Array(Fb),Ob=0;Ob<Fb;Ob++){Xb[Ob]=Array(Ub);for(var Nb=0;Nb<Ub;Nb++)Xb[Ob][Nb]=qb}return Xb}function Ee(Fb,Ub){if(!(this instanceof Ee))return new Ee(Fb,Ub);Fb=$l.checkMatrix(Fb),Ub=Ub||{};var qb=Fb.rows,Xb=Fb.columns,Ob=_Mathmin(qb,Xb),Nb=!0,Gb=!0;!1===Ub.computeLeftSingularVectors&&(Nb=!1),!1===Ub.computeRightSingularVectors&&(Gb=!1);var Hb=!0===Ub.autoTranspose,Wb=!1,Zb;if(!(qb<Xb))Zb=Fb.clone();else if(!Hb)Zb=Fb.clone(),console.warn('Computing SVD on a matrix with more columns than rows. Consider enabling autoTranspose');else{Zb=Fb.transpose(),qb=Zb.rows,Xb=Zb.columns,Wb=!0;var Qb=Nb;Nb=Gb,Gb=Qb}var Kb=Array(_Mathmin(qb+1,Xb)),Jb=Le(qb,Ob,0),$b=Le(Xb,Xb,0),e_=Array(Xb),t_=Array(qb),a_=_Mathmin(qb-1,Xb),i_=_Mathmax(0,_Mathmin(Xb-2,qb)),n_,o_,s_,r_,l_,d_,h_,m_,c_,g_,u_,p_,f_,b_,w_,x_,y_,k_,v_,D_,j_;for(s_=0,g_=_Mathmax(a_,i_);s_<g_;s_++){if(s_<a_){for(Kb[s_]=0,n_=s_;n_<qb;n_++)Kb[s_]=ze(Kb[s_],Zb[n_][s_]);if(0!==Kb[s_]){for(0>Zb[s_][s_]&&(Kb[s_]=-Kb[s_]),n_=s_;n_<qb;n_++)Zb[n_][s_]/=Kb[s_];Zb[s_][s_]+=1}Kb[s_]=-Kb[s_]}for(o_=s_+1;o_<Xb;o_++){if(s_<a_&&0!==Kb[s_]){for(l_=0,n_=s_;n_<qb;n_++)l_+=Zb[n_][s_]*Zb[n_][o_];for(l_=-l_/Zb[s_][s_],n_=s_;n_<qb;n_++)Zb[n_][o_]+=l_*Zb[n_][s_]}e_[o_]=Zb[s_][o_]}if(Nb&&s_<a_)for(n_=s_;n_<qb;n_++)Jb[n_][s_]=Zb[n_][s_];if(s_<i_){for(e_[s_]=0,n_=s_+1;n_<Xb;n_++)e_[s_]=ze(e_[s_],e_[n_]);if(0!==e_[s_]){for(0>e_[s_+1]&&(e_[s_]=0-e_[s_]),n_=s_+1;n_<Xb;n_++)e_[n_]/=e_[s_];e_[s_+1]+=1}if(e_[s_]=-e_[s_],s_+1<qb&&0!==e_[s_]){for(n_=s_+1;n_<qb;n_++)t_[n_]=0;for(o_=s_+1;o_<Xb;o_++)for(n_=s_+1;n_<qb;n_++)t_[n_]+=e_[o_]*Zb[n_][o_];for(o_=s_+1;o_<Xb;o_++)for(l_=-e_[o_]/e_[s_+1],n_=s_+1;n_<qb;n_++)Zb[n_][o_]+=l_*t_[n_]}if(Gb)for(n_=s_+1;n_<Xb;n_++)$b[n_][s_]=e_[n_]}}if(r_=_Mathmin(Xb,qb+1),a_<Xb&&(Kb[a_]=Zb[a_][a_]),qb<r_&&(Kb[r_-1]=0),i_+1<r_&&(e_[i_]=Zb[i_][r_-1]),e_[r_-1]=0,Nb){for(o_=a_;o_<Ob;o_++){for(n_=0;n_<qb;n_++)Jb[n_][o_]=0;Jb[o_][o_]=1}for(s_=a_-1;0<=s_;s_--)if(0!==Kb[s_]){for(o_=s_+1;o_<Ob;o_++){for(l_=0,n_=s_;n_<qb;n_++)l_+=Jb[n_][s_]*Jb[n_][o_];for(l_=-l_/Jb[s_][s_],n_=s_;n_<qb;n_++)Jb[n_][o_]+=l_*Jb[n_][s_]}for(n_=s_;n_<qb;n_++)Jb[n_][s_]=-Jb[n_][s_];for(Jb[s_][s_]=1+Jb[s_][s_],n_=0;n_<s_-1;n_++)Jb[n_][s_]=0}else{for(n_=0;n_<qb;n_++)Jb[n_][s_]=0;Jb[s_][s_]=1}}if(Gb)for(s_=Xb-1;0<=s_;s_--){if(s_<i_&&0!==e_[s_])for(o_=s_+1;o_<Xb;o_++){for(l_=0,n_=s_+1;n_<Xb;n_++)l_+=$b[n_][s_]*$b[n_][o_];for(l_=-l_/$b[s_+1][s_],n_=s_+1;n_<Xb;n_++)$b[n_][o_]+=l_*$b[n_][s_]}for(n_=0;n_<Xb;n_++)$b[n_][s_]=0;$b[s_][s_]=1}for(var M_=r_-1,S_=0,I_=2.220446049250313e-16;0<r_;){for(s_=r_-2;-1<=s_&&-1!==s_;s_--)if(_Mathabs(e_[s_])<=I_*(_Mathabs(Kb[s_])+_Mathabs(Kb[s_+1]))){e_[s_]=0;break}if(s_===r_-2)u_=4;else{for(d_=r_-1;d_>=s_&&d_!==s_;d_--)if(l_=(d_===r_?0:_Mathabs(e_[d_]))+(d_===s_+1?0:_Mathabs(e_[d_-1])),_Mathabs(Kb[d_])<=I_*l_){Kb[d_]=0;break}d_===s_?u_=3:d_===r_-1?u_=1:(u_=2,s_=d_)}switch(s_++,u_){case 1:{for(h_=e_[r_-2],e_[r_-2]=0,o_=r_-2;o_>=s_;o_--)if(l_=ze(Kb[o_],h_),m_=Kb[o_]/l_,c_=h_/l_,Kb[o_]=l_,o_!==s_&&(h_=-c_*e_[o_-1],e_[o_-1]=m_*e_[o_-1]),Gb)for(n_=0;n_<Xb;n_++)l_=m_*$b[n_][o_]+c_*$b[n_][r_-1],$b[n_][r_-1]=-c_*$b[n_][o_]+m_*$b[n_][r_-1],$b[n_][o_]=l_;break}case 2:{for(h_=e_[s_-1],e_[s_-1]=0,o_=s_;o_<r_;o_++)if(l_=ze(Kb[o_],h_),m_=Kb[o_]/l_,c_=h_/l_,Kb[o_]=l_,h_=-c_*e_[o_],e_[o_]=m_*e_[o_],Nb)for(n_=0;n_<qb;n_++)l_=m_*Jb[n_][o_]+c_*Jb[n_][s_-1],Jb[n_][s_-1]=-c_*Jb[n_][o_]+m_*Jb[n_][s_-1],Jb[n_][o_]=l_;break}case 3:{for(p_=_Mathmax(_Mathmax(_Mathmax(_Mathmax(_Mathabs(Kb[r_-1]),_Mathabs(Kb[r_-2])),_Mathabs(e_[r_-2])),_Mathabs(Kb[s_])),_Mathabs(e_[s_])),f_=Kb[r_-1]/p_,b_=Kb[r_-2]/p_,w_=e_[r_-2]/p_,x_=Kb[s_]/p_,y_=e_[s_]/p_,k_=((b_+f_)*(b_-f_)+w_*w_)/2,v_=f_*w_*(f_*w_),D_=0,(0!==k_||0!==v_)&&(D_=_Mathsqrt(k_*k_+v_),0>k_&&(D_=-D_),D_=v_/(k_+D_)),h_=(x_+f_)*(x_-f_)+D_,j_=x_*y_,o_=s_;o_<r_-1;o_++){if(l_=ze(h_,j_),m_=h_/l_,c_=j_/l_,o_!==s_&&(e_[o_-1]=l_),h_=m_*Kb[o_]+c_*e_[o_],e_[o_]=m_*e_[o_]-c_*Kb[o_],j_=c_*Kb[o_+1],Kb[o_+1]=m_*Kb[o_+1],Gb)for(n_=0;n_<Xb;n_++)l_=m_*$b[n_][o_]+c_*$b[n_][o_+1],$b[n_][o_+1]=-c_*$b[n_][o_]+m_*$b[n_][o_+1],$b[n_][o_]=l_;if(l_=ze(h_,j_),m_=h_/l_,c_=j_/l_,Kb[o_]=l_,h_=m_*e_[o_]+c_*Kb[o_+1],Kb[o_+1]=-c_*e_[o_]+m_*Kb[o_+1],j_=c_*e_[o_+1],e_[o_+1]=m_*e_[o_+1],Nb&&o_<qb-1)for(n_=0;n_<qb;n_++)l_=m_*Jb[n_][o_]+c_*Jb[n_][o_+1],Jb[n_][o_+1]=-c_*Jb[n_][o_]+m_*Jb[n_][o_+1],Jb[n_][o_]=l_}e_[r_-2]=h_,++S_;break}case 4:{if(0>=Kb[s_]&&(Kb[s_]=0>Kb[s_]?-Kb[s_]:0,Gb))for(n_=0;n_<=M_;n_++)$b[n_][s_]=-$b[n_][s_];for(;s_<M_&&!(Kb[s_]>=Kb[s_+1]);){if(l_=Kb[s_],Kb[s_]=Kb[s_+1],Kb[s_+1]=l_,Gb&&s_<Xb-1)for(n_=0;n_<Xb;n_++)l_=$b[n_][s_+1],$b[n_][s_+1]=$b[n_][s_],$b[n_][s_]=l_;if(Nb&&s_<qb-1)for(n_=0;n_<qb;n_++)l_=Jb[n_][s_+1],Jb[n_][s_+1]=Jb[n_][s_],Jb[n_][s_]=l_;s_++}S_=0,r_--;break}}}if(Wb){var P_=$b;$b=Jb,Jb=P_}this.m=qb,this.n=Xb,this.s=Kb,this.U=Jb,this.V=$b}function Fe(Fb){for(var Ub=Array(Fb[0].length),qb=0;qb<Ub.length;++qb)Ub[qb]=Array(Fb.length);for(qb=0;qb<Fb.length;++qb)for(var Xb=0;Xb<Fb[0].length;++Xb)Ub[Xb][qb]=Fb[qb][Xb];return Ub}function Ne(Fb,Ub,qb,Xb,Ob){function Nb(g_,u_,p_,f_){return(f_-u_)/(p_-g_)}var Gb=Fb.length,Hb=(Xb-qb)/(Ob-1),Zb=qb-Hb/2,Qb=Array(Ob),Kb=Fb[1]-Fb[0],Jb=Fb[Fb.length-1]-Fb[Fb.length-2],$b=Zb,e_=Zb+Hb,t_=_NumberMIN_VALUE,a_=0,i_=Fb[0]-Kb,n_=0,o_=0,s_=0,r_=0,l_=0,d_=0,h_=0,m_=0;main:for(;;){for(;0<=i_-e_;){var c_=He(0,e_-t_,s_,a_);if(d_=o_+c_,Qb[m_]=(d_-l_)/Hb,m_++,m_===Ob)break main;$b=e_,e_+=Hb,l_=d_}t_<=$b&&$b<=i_&&(c_=He(0,$b-t_,s_,a_),l_=o_+c_),o_+=He(t_,i_,s_,r_),t_=i_,a_=n_,h_<Gb?(i_=Fb[h_],n_=Ub[h_],h_++):h_===Gb&&(i_+=Jb,n_=0),s_=Nb(t_,a_,i_,n_),r_=-s_*t_+a_}return Qb}function Ge(Fb,Ub,qb,Xb,Ob){var Nb=Fb.length,Gb=(Xb-qb)/(Ob-1),Wb=Fb[Fb.length-1]-Fb[Fb.length-2],Zb=qb-Gb/2,Qb=Array(Ob),Kb=Zb,Jb=Zb+Gb,$b=-_NumberMAX_VALUE,e_=0,t_=Fb[0],a_=Ub[0],i_=0,n_=!0,o_=0,s_=0,r_=1,l_=0;main:for(;;){if($b>=t_)throw new Error('x must be an increasing serie');for(;0<$b-Jb;){if(n_&&(s_++,n_=!1),Qb[l_]=0>=s_?0:o_/s_,l_++,l_===Ob)break main;Kb=Jb,Jb+=Gb,o_=0,s_=0}$b>Kb&&(o_+=e_,s_++),($b==-_NumberMAX_VALUE||1<i_)&&s_--,$b=t_,e_=a_,r_<Nb?(t_=Fb[r_],a_=Ub[r_],r_++):(t_+=Wb,a_=0,i_++)}return Qb}function He(Fb,Ub,qb,Xb){return 0.5*qb*Ub*Ub+Xb*Ub-(0.5*qb*Fb*Fb+Xb*Fb)}function Ze(Fb,Ub,qb){var Xb=qb?Fb.rows:Fb.rows-1;if(0>Ub||Ub>Xb)throw new RangeError('Row index out of range')}function Qe(Fb,Ub,qb){var Xb=qb?Fb.columns:Fb.columns-1;if(0>Ub||Ub>Xb)throw new RangeError('Column index out of range')}function Ke(Fb,Ub){if(Ub.to1DArray&&(Ub=Ub.to1DArray()),Ub.length!==Fb.columns)throw new RangeError('vector size must be the same as the number of columns');return Ub}function Je(Fb,Ub){if(Ub.to1DArray&&(Ub=Ub.to1DArray()),Ub.length!==Fb.rows)throw new RangeError('vector size must be the same as the number of rows');return Ub}function $e(Fb,Ub,qb){var Xb=Ub.some((Nb)=>{return 0>Nb||Nb>=Fb.rows}),Ob=qb.some((Nb)=>{return 0>Nb||Nb>=Fb.columns});if(Xb||Ob)throw new RangeError('Indices are out of range');if('object'!=typeof Ub||'object'!=typeof qb)throw new TypeError('Unexpected type for row/column indices');return Array.isArray(Ub)||(Ub=Array.from(Ub)),Array.isArray(qb)||(Ub=Array.from(qb)),{row:Ub,column:qb}}function et(Fb,Ub,qb,Xb,Ob){if(5!==arguments.length)throw new TypeError('Invalid argument type');var Nb=Array.from(arguments).slice(1).some(function(Gb){return'number'!=typeof Gb});if(Nb)throw new TypeError('Invalid argument type');if(Ub>qb||Xb>Ob||0>Ub||Ub>=Fb.rows||0>qb||qb>=Fb.rows||0>Xb||Xb>=Fb.columns||0>Ob||Ob>=Fb.columns)throw new RangeError('Submatrix indices are out of range')}function at(Fb){for(var Ub=$l.zeros(Fb.rows,1),qb=0;qb<Fb.rows;++qb)for(var Xb=0;Xb<Fb.columns;++Xb)Ub.set(qb,0,Ub.get(qb,0)+Fb.get(qb,Xb));return Ub}function nt(Fb){for(var Ub=$l.zeros(1,Fb.columns),qb=0;qb<Fb.rows;++qb)for(var Xb=0;Xb<Fb.columns;++Xb)Ub.set(0,Xb,Ub.get(0,Xb)+Fb.get(qb,Xb));return Ub}function ot(Fb){for(var Ub=0,qb=0;qb<Fb.rows;qb++)for(var Xb=0;Xb<Fb.columns;Xb++)Ub+=Fb.get(qb,Xb);return Ub}function st(Fb){function Ub(j_,M_){return j_-M_}function qb(j_,M_){for(var S_ in M_)j_=j_.replace(new RegExp('%'+S_+'%','g'),M_[S_]);return j_}void 0===Fb&&(Fb=Object);class Xb extends Fb{static get[Symbol.species](){return this}static from1DArray(j_,M_,S_){if(j_*M_!==S_.length)throw new RangeError('Data length does not match given dimensions');for(var P_=new this(j_,M_),C_=0;C_<j_;C_++)for(var B_=0;B_<M_;B_++)P_.set(C_,B_,S_[C_*M_+B_]);return P_}static rowVector(j_){for(var M_=new this(1,j_.length),S_=0;S_<j_.length;S_++)M_.set(0,S_,j_[S_]);return M_}static columnVector(j_){for(var M_=new this(j_.length,1),S_=0;S_<j_.length;S_++)M_.set(S_,0,j_[S_]);return M_}static empty(j_,M_){return new this(j_,M_)}static zeros(j_,M_){return this.empty(j_,M_).fill(0)}static ones(j_,M_){return this.empty(j_,M_).fill(1)}static rand(j_,M_,S_){void 0===S_&&(S_=Math.random);for(var I_=this.empty(j_,M_),P_=0;P_<j_;P_++)for(var C_=0;C_<M_;C_++)I_.set(P_,C_,S_());return I_}static randInt(j_,M_,S_,I_){void 0===S_&&(S_=1e3),void 0===I_&&(I_=Math.random);for(var P_=this.empty(j_,M_),C_=0;C_<j_;C_++)for(var B_=0,A_;B_<M_;B_++)A_=_Mathfloor(I_()*S_),P_.set(C_,B_,A_);return P_}static eye(j_,M_,S_){void 0===M_&&(M_=j_),void 0===S_&&(S_=1);for(var I_=_Mathmin(j_,M_),P_=this.zeros(j_,M_),C_=0;C_<I_;C_++)P_.set(C_,C_,S_);return P_}static diag(j_,M_,S_){var I_=j_.length;void 0===M_&&(M_=I_),void 0===S_&&(S_=M_);for(var P_=_Mathmin(I_,M_,S_),C_=this.zeros(M_,S_),B_=0;B_<P_;B_++)C_.set(B_,B_,j_[B_]);return C_}static min(j_,M_){j_=this.checkMatrix(j_),M_=this.checkMatrix(M_);for(var S_=j_.rows,I_=j_.columns,P_=new this(S_,I_),C_=0;C_<S_;C_++)for(var B_=0;B_<I_;B_++)P_.set(C_,B_,_Mathmin(j_.get(C_,B_),M_.get(C_,B_)));return P_}static max(j_,M_){j_=this.checkMatrix(j_),M_=this.checkMatrix(M_);for(var S_=j_.rows,I_=j_.columns,P_=new this(S_,I_),C_=0;C_<S_;C_++)for(var B_=0;B_<I_;B_++)P_.set(C_,B_,_Mathmax(j_.get(C_,B_),M_.get(C_,B_)));return P_}static checkMatrix(j_){return Xb.isMatrix(j_)?j_:new this(j_)}static isMatrix(j_){return null!=j_&&'Matrix'===j_.klass}get size(){return this.rows*this.columns}apply(j_){if('function'!=typeof j_)throw new TypeError('callback must be a function');for(var M_=this.rows,S_=this.columns,I_=0;I_<M_;I_++)for(var P_=0;P_<S_;P_++)j_.call(this,I_,P_);return this}to1DArray(){for(var j_=Array(this.size),M_=0;M_<this.rows;M_++)for(var S_=0;S_<this.columns;S_++)j_[M_*this.columns+S_]=this.get(M_,S_);return j_}to2DArray(){for(var j_=Array(this.rows),M_=0;M_<this.rows;M_++){j_[M_]=Array(this.columns);for(var S_=0;S_<this.columns;S_++)j_[M_][S_]=this.get(M_,S_)}return j_}isRowVector(){return 1===this.rows}isColumnVector(){return 1===this.columns}isVector(){return 1===this.rows||1===this.columns}isSquare(){return this.rows===this.columns}isSymmetric(){if(this.isSquare()){for(var j_=0;j_<this.rows;j_++)for(var M_=0;M_<=j_;M_++)if(this.get(j_,M_)!==this.get(M_,j_))return!1;return!0}return!1}set(){throw new Error('set method is unimplemented')}get(){throw new Error('get method is unimplemented')}repeat(j_,M_){j_=j_||1,M_=M_||1;for(var S_=new this.constructor[Symbol.species](this.rows*j_,this.columns*M_),I_=0;I_<j_;I_++)for(var P_=0;P_<M_;P_++)S_.setSubMatrix(this,this.rows*I_,this.columns*P_);return S_}fill(j_){for(var M_=0;M_<this.rows;M_++)for(var S_=0;S_<this.columns;S_++)this.set(M_,S_,j_);return this}neg(){return this.mulS(-1)}getRow(j_){Ze(this,j_);for(var M_=Array(this.columns),S_=0;S_<this.columns;S_++)M_[S_]=this.get(j_,S_);return M_}getRowVector(j_){return this.constructor.rowVector(this.getRow(j_))}setRow(j_,M_){Ze(this,j_),M_=Ke(this,M_);for(var S_=0;S_<this.columns;S_++)this.set(j_,S_,M_[S_]);return this}swapRows(j_,M_){Ze(this,j_),Ze(this,M_);for(var S_=0,I_;S_<this.columns;S_++)I_=this.get(j_,S_),this.set(j_,S_,this.get(M_,S_)),this.set(M_,S_,I_);return this}getColumn(j_){Qe(this,j_);for(var M_=Array(this.rows),S_=0;S_<this.rows;S_++)M_[S_]=this.get(S_,j_);return M_}getColumnVector(j_){return this.constructor.columnVector(this.getColumn(j_))}setColumn(j_,M_){Qe(this,j_),M_=Je(this,M_);for(var S_=0;S_<this.rows;S_++)this.set(S_,j_,M_[S_]);return this}swapColumns(j_,M_){Qe(this,j_),Qe(this,M_);for(var S_=0,I_;S_<this.rows;S_++)I_=this.get(S_,j_),this.set(S_,j_,this.get(S_,M_)),this.set(S_,M_,I_);return this}addRowVector(j_){j_=Ke(this,j_);for(var M_=0;M_<this.rows;M_++)for(var S_=0;S_<this.columns;S_++)this.set(M_,S_,this.get(M_,S_)+j_[S_]);return this}subRowVector(j_){j_=Ke(this,j_);for(var M_=0;M_<this.rows;M_++)for(var S_=0;S_<this.columns;S_++)this.set(M_,S_,this.get(M_,S_)-j_[S_]);return this}mulRowVector(j_){j_=Ke(this,j_);for(var M_=0;M_<this.rows;M_++)for(var S_=0;S_<this.columns;S_++)this.set(M_,S_,this.get(M_,S_)*j_[S_]);return this}divRowVector(j_){j_=Ke(this,j_);for(var M_=0;M_<this.rows;M_++)for(var S_=0;S_<this.columns;S_++)this.set(M_,S_,this.get(M_,S_)/j_[S_]);return this}addColumnVector(j_){j_=Je(this,j_);for(var M_=0;M_<this.rows;M_++)for(var S_=0;S_<this.columns;S_++)this.set(M_,S_,this.get(M_,S_)+j_[M_]);return this}subColumnVector(j_){j_=Je(this,j_);for(var M_=0;M_<this.rows;M_++)for(var S_=0;S_<this.columns;S_++)this.set(M_,S_,this.get(M_,S_)-j_[M_]);return this}mulColumnVector(j_){j_=Je(this,j_);for(var M_=0;M_<this.rows;M_++)for(var S_=0;S_<this.columns;S_++)this.set(M_,S_,this.get(M_,S_)*j_[M_]);return this}divColumnVector(j_){j_=Je(this,j_);for(var M_=0;M_<this.rows;M_++)for(var S_=0;S_<this.columns;S_++)this.set(M_,S_,this.get(M_,S_)/j_[M_]);return this}mulRow(j_,M_){Ze(this,j_);for(var S_=0;S_<this.columns;S_++)this.set(j_,S_,this.get(j_,S_)*M_);return this}mulColumn(j_,M_){Qe(this,j_);for(var S_=0;S_<this.rows;S_++)this.set(S_,j_,this.get(S_,j_)*M_);return this}max(){for(var j_=this.get(0,0),M_=0;M_<this.rows;M_++)for(var S_=0;S_<this.columns;S_++)this.get(M_,S_)>j_&&(j_=this.get(M_,S_));return j_}maxIndex(){for(var j_=this.get(0,0),M_=[0,0],S_=0;S_<this.rows;S_++)for(var I_=0;I_<this.columns;I_++)this.get(S_,I_)>j_&&(j_=this.get(S_,I_),M_[0]=S_,M_[1]=I_);return M_}min(){for(var j_=this.get(0,0),M_=0;M_<this.rows;M_++)for(var S_=0;S_<this.columns;S_++)this.get(M_,S_)<j_&&(j_=this.get(M_,S_));return j_}minIndex(){for(var j_=this.get(0,0),M_=[0,0],S_=0;S_<this.rows;S_++)for(var I_=0;I_<this.columns;I_++)this.get(S_,I_)<j_&&(j_=this.get(S_,I_),M_[0]=S_,M_[1]=I_);return M_}maxRow(j_){Ze(this,j_);for(var M_=this.get(j_,0),S_=1;S_<this.columns;S_++)this.get(j_,S_)>M_&&(M_=this.get(j_,S_));return M_}maxRowIndex(j_){Ze(this,j_);for(var M_=this.get(j_,0),S_=[j_,0],I_=1;I_<this.columns;I_++)this.get(j_,I_)>M_&&(M_=this.get(j_,I_),S_[1]=I_);return S_}minRow(j_){Ze(this,j_);for(var M_=this.get(j_,0),S_=1;S_<this.columns;S_++)this.get(j_,S_)<M_&&(M_=this.get(j_,S_));return M_}minRowIndex(j_){Ze(this,j_);for(var M_=this.get(j_,0),S_=[j_,0],I_=1;I_<this.columns;I_++)this.get(j_,I_)<M_&&(M_=this.get(j_,I_),S_[1]=I_);return S_}maxColumn(j_){Qe(this,j_);for(var M_=this.get(0,j_),S_=1;S_<this.rows;S_++)this.get(S_,j_)>M_&&(M_=this.get(S_,j_));return M_}maxColumnIndex(j_){Qe(this,j_);for(var M_=this.get(0,j_),S_=[0,j_],I_=1;I_<this.rows;I_++)this.get(I_,j_)>M_&&(M_=this.get(I_,j_),S_[0]=I_);return S_}minColumn(j_){Qe(this,j_);for(var M_=this.get(0,j_),S_=1;S_<this.rows;S_++)this.get(S_,j_)<M_&&(M_=this.get(S_,j_));return M_}minColumnIndex(j_){Qe(this,j_);for(var M_=this.get(0,j_),S_=[0,j_],I_=1;I_<this.rows;I_++)this.get(I_,j_)<M_&&(M_=this.get(I_,j_),S_[0]=I_);return S_}diag(){for(var j_=_Mathmin(this.rows,this.columns),M_=Array(j_),S_=0;S_<j_;S_++)M_[S_]=this.get(S_,S_);return M_}sum(j_){return'row'===j_?at(this):'column'===j_?nt(this):ot(this)}mean(){return this.sum()/this.size}prod(){for(var j_=1,M_=0;M_<this.rows;M_++)for(var S_=0;S_<this.columns;S_++)j_*=this.get(M_,S_);return j_}cumulativeSum(){for(var j_=0,M_=0;M_<this.rows;M_++)for(var S_=0;S_<this.columns;S_++)j_+=this.get(M_,S_),this.set(M_,S_,j_);return this}dot(j_){Xb.isMatrix(j_)&&(j_=j_.to1DArray());var M_=this.to1DArray();if(M_.length!==j_.length)throw new RangeError('vectors do not have the same size');for(var S_=0,I_=0;I_<M_.length;I_++)S_+=M_[I_]*j_[I_];return S_}mmul(j_){j_=this.constructor.checkMatrix(j_),this.columns!==j_.rows&&console.warn('Number of columns of left matrix are not equal to number of rows of right matrix.');for(var M_=this.rows,S_=this.columns,I_=j_.columns,P_=new this.constructor[Symbol.species](M_,I_),C_=Array(S_),B_=0;B_<I_;B_++){for(var A_=0;A_<S_;A_++)C_[A_]=j_.get(A_,B_);for(var R_=0,z_;R_<M_;R_++){for(z_=0,A_=0;A_<S_;A_++)z_+=this.get(R_,A_)*C_[A_];P_.set(R_,B_,z_)}}return P_}strassen2x2(j_){var M_=new this.constructor[Symbol.species](2,2);const S_=this.get(0,0),I_=j_.get(0,0),P_=this.get(0,1),C_=j_.get(0,1),B_=this.get(1,0),A_=j_.get(1,0),R_=this.get(1,1),z_=j_.get(1,1),L_=(S_+R_)*(I_+z_),E_=(B_+R_)*I_,T_=S_*(C_-z_),V_=R_*(A_-I_),Y_=(S_+P_)*z_;return M_.set(0,0,L_+V_-Y_+(P_-R_)*(A_+z_)),M_.set(0,1,T_+Y_),M_.set(1,0,E_+V_),M_.set(1,1,L_-E_+T_+(B_-S_)*(I_+C_)),M_}strassen3x3(j_){var M_=new this.constructor[Symbol.species](3,3);const S_=this.get(0,0),I_=this.get(0,1),P_=this.get(0,2),C_=this.get(1,0),B_=this.get(1,1),A_=this.get(1,2),R_=this.get(2,0),z_=this.get(2,1),L_=this.get(2,2),E_=j_.get(0,0),T_=j_.get(0,1),V_=j_.get(0,2),Y_=j_.get(1,0),F_=j_.get(1,1),U_=j_.get(1,2),q_=j_.get(2,0),X_=j_.get(2,1),O_=j_.get(2,2),G_=(S_-C_)*(-T_+F_),W_=(-S_+C_+B_)*(E_-T_+F_),Z_=(C_+B_)*(-E_+T_),Q_=S_*E_,K_=(-S_+R_+z_)*(E_-V_+U_),J_=(-S_+R_)*(V_-U_),$_=(R_+z_)*(-E_+V_),aw=(-P_+z_+L_)*(F_+q_-X_),iw=(P_-L_)*(F_-X_),nw=P_*q_,ow=(z_+L_)*(-q_+X_),sw=(-P_+B_+A_)*(U_+q_-O_),rw=(P_-A_)*(U_-O_),lw=(B_+A_)*(-q_+O_);return M_.set(0,0,Q_+nw+I_*Y_),M_.set(0,1,(S_+I_+P_-C_-B_-z_-L_)*F_+W_+Z_+Q_+aw+nw+ow),M_.set(0,2,Q_+K_+$_+(S_+I_+P_-B_-A_-R_-z_)*U_+nw+sw+lw),M_.set(1,0,G_+B_*(-E_+T_+Y_-F_-U_-q_+O_)+W_+Q_+nw+sw+rw),M_.set(1,1,G_+W_+Z_+Q_+A_*X_),M_.set(1,2,nw+sw+rw+lw+C_*V_),M_.set(2,0,Q_+K_+J_+z_*(-E_+V_+Y_-F_-U_-q_+X_)+aw+iw+nw),M_.set(2,1,aw+iw+nw+ow+R_*T_),M_.set(2,2,Q_+K_+J_+$_+L_*O_),M_}mmulStrassen(j_){function M_(L_,E_,T_){var V_=L_.rows,Y_=L_.columns;if(V_===E_&&Y_===T_)return L_;var F_=Xb.zeros(E_,T_);return F_=F_.setSubMatrix(L_,0,0),F_}function S_(L_,E_,T_,V_){if(512>=T_||512>=V_)return L_.mmul(E_);1==T_%2&&1==V_%2?(L_=M_(L_,T_+1,V_+1),E_=M_(E_,T_+1,V_+1)):1==T_%2?(L_=M_(L_,T_+1,V_),E_=M_(E_,T_+1,V_)):1==V_%2&&(L_=M_(L_,T_,V_+1),E_=M_(E_,T_,V_+1));var Y_=parseInt(L_.rows/2),F_=parseInt(L_.columns/2),U_=L_.subMatrix(0,Y_-1,0,F_-1),q_=E_.subMatrix(0,Y_-1,0,F_-1),X_=L_.subMatrix(0,Y_-1,F_,L_.columns-1),O_=E_.subMatrix(0,Y_-1,F_,E_.columns-1),N_=L_.subMatrix(Y_,L_.rows-1,0,F_-1),G_=E_.subMatrix(Y_,E_.rows-1,0,F_-1),H_=L_.subMatrix(Y_,L_.rows-1,F_,L_.columns-1),W_=E_.subMatrix(Y_,E_.rows-1,F_,E_.columns-1),Z_=S_(Xb.add(U_,H_),Xb.add(q_,W_),Y_,F_),Q_=S_(Xb.add(N_,H_),q_,Y_,F_),K_=S_(U_,Xb.sub(O_,W_),Y_,F_),J_=S_(H_,Xb.sub(G_,q_),Y_,F_),$_=S_(Xb.add(U_,X_),W_,Y_,F_),ew=S_(Xb.sub(N_,U_),Xb.add(q_,O_),Y_,F_),tw=S_(Xb.sub(X_,H_),Xb.add(G_,W_),Y_,F_),aw=Xb.add(Z_,J_);aw.sub($_),aw.add(tw);var iw=Xb.add(K_,$_),nw=Xb.add(Q_,J_),ow=Xb.sub(Z_,Q_);ow.add(K_),ow.add(ew);var sw=Xb.zeros(2*aw.rows,2*aw.columns);return sw=sw.setSubMatrix(aw,0,0),sw=sw.setSubMatrix(iw,aw.rows,0),sw=sw.setSubMatrix(nw,0,aw.columns),sw=sw.setSubMatrix(ow,aw.rows,aw.columns),sw.subMatrix(0,T_-1,0,V_-1)}var I_=this.clone(),P_=I_.rows,C_=I_.columns,B_=j_.rows,A_=j_.columns;C_!==B_&&console.warn(`Multiplying ${P_} x ${C_} and ${B_} x ${A_} matrix: dimensions do not match.`);var R_=_Mathmax(P_,B_),z_=_Mathmax(C_,A_);return I_=M_(I_,R_,z_),j_=M_(j_,R_,z_),S_(I_,j_,R_,z_)}scaleRows(j_,M_){if(j_=void 0===j_?0:j_,M_=void 0===M_?1:M_,j_>=M_)throw new RangeError('min should be strictly smaller than max');for(var S_=this.constructor.empty(this.rows,this.columns),I_=0,P_;I_<this.rows;I_++)P_=Ol(this.getRow(I_),{min:j_,max:M_}),S_.setRow(I_,P_);return S_}scaleColumns(j_,M_){if(j_=void 0===j_?0:j_,M_=void 0===M_?1:M_,j_>=M_)throw new RangeError('min should be strictly smaller than max');for(var S_=this.constructor.empty(this.rows,this.columns),I_=0,P_;I_<this.columns;I_++)P_=Ol(this.getColumn(I_),{min:j_,max:M_}),S_.setColumn(I_,P_);return S_}kroneckerProduct(j_){j_=this.constructor.checkMatrix(j_);for(var M_=this.rows,S_=this.columns,I_=j_.rows,P_=j_.columns,C_=new this.constructor[Symbol.species](M_*I_,S_*P_),B_=0;B_<M_;B_++)for(var A_=0;A_<S_;A_++)for(var R_=0;R_<I_;R_++)for(var z_=0;z_<P_;z_++)C_[I_*B_+R_][P_*A_+z_]=this.get(B_,A_)*j_.get(R_,z_);return C_}transpose(){for(var j_=new this.constructor[Symbol.species](this.columns,this.rows),M_=0;M_<this.rows;M_++)for(var S_=0;S_<this.columns;S_++)j_.set(S_,M_,this.get(M_,S_));return j_}sortRows(j_){void 0===j_&&(j_=Ub);for(var M_=0;M_<this.rows;M_++)this.setRow(M_,this.getRow(M_).sort(j_));return this}sortColumns(j_){void 0===j_&&(j_=Ub);for(var M_=0;M_<this.columns;M_++)this.setColumn(M_,this.getColumn(M_).sort(j_));return this}subMatrix(j_,M_,S_,I_){et(this,j_,M_,S_,I_);for(var P_=new this.constructor[Symbol.species](M_-j_+1,I_-S_+1),C_=j_;C_<=M_;C_++)for(var B_=S_;B_<=I_;B_++)P_[C_-j_][B_-S_]=this.get(C_,B_);return P_}subMatrixRow(j_,M_,S_){if(void 0===M_&&(M_=0),void 0===S_&&(S_=this.columns-1),M_>S_||0>M_||M_>=this.columns||0>S_||S_>=this.columns)throw new RangeError('Argument out of range');for(var I_=new this.constructor[Symbol.species](j_.length,S_-M_+1),P_=0;P_<j_.length;P_++)for(var C_=M_;C_<=S_;C_++){if(0>j_[P_]||j_[P_]>=this.rows)throw new RangeError('Row index out of range: '+j_[P_]);I_.set(P_,C_-M_,this.get(j_[P_],C_))}return I_}subMatrixColumn(j_,M_,S_){if(void 0===M_&&(M_=0),void 0===S_&&(S_=this.rows-1),M_>S_||0>M_||M_>=this.rows||0>S_||S_>=this.rows)throw new RangeError('Argument out of range');for(var I_=new this.constructor[Symbol.species](S_-M_+1,j_.length),P_=0;P_<j_.length;P_++)for(var C_=M_;C_<=S_;C_++){if(0>j_[P_]||j_[P_]>=this.columns)throw new RangeError('Column index out of range: '+j_[P_]);I_.set(C_-M_,P_,this.get(C_,j_[P_]))}return I_}setSubMatrix(j_,M_,S_){j_=this.constructor.checkMatrix(j_);var I_=M_+j_.rows-1,P_=S_+j_.columns-1;et(this,M_,I_,S_,P_);for(var C_=0;C_<j_.rows;C_++)for(var B_=0;B_<j_.columns;B_++)this[M_+C_][S_+B_]=j_.get(C_,B_);return this}selection(j_,M_){for(var S_=$e(this,j_,M_),I_=new this.constructor[Symbol.species](j_.length,M_.length),P_=0,C_;P_<S_.row.length;P_++){C_=S_.row[P_];for(var B_=0,A_;B_<S_.column.length;B_++)A_=S_.column[B_],I_[P_][B_]=this.get(C_,A_)}return I_}trace(){for(var j_=_Mathmin(this.rows,this.columns),M_=0,S_=0;S_<j_;S_++)M_+=this.get(S_,S_);return M_}transposeView(){return new Gl(this)}rowView(j_){return Ze(this,j_),new Hl(this,j_)}columnView(j_){return Qe(this,j_),new Ql(this,j_)}flipRowView(){return new Kl(this)}flipColumnView(){return new Jl(this)}subMatrixView(j_,M_,S_,I_){return new Wl(this,j_,M_,S_,I_)}selectionView(j_,M_){return new Zl(this,j_,M_)}det(){if(this.isSquare()){var j_,M_,S_,I_;if(2===this.columns)return j_=this.get(0,0),M_=this.get(0,1),S_=this.get(1,0),I_=this.get(1,1),j_*I_-M_*S_;if(3===this.columns){var P_,C_,B_;return P_=this.selectionView([1,2],[1,2]),C_=this.selectionView([1,2],[0,2]),B_=this.selectionView([1,2],[0,1]),j_=this.get(0,0),M_=this.get(0,1),S_=this.get(0,2),j_*P_.det()-M_*C_.det()+S_*B_.det()}return new Re(this).determinant}throw Error('Determinant can only be calculated for a square matrix.')}pseudoInverse(j_){void 0===j_&&(j_=_NumberEPSILON);for(var M_=new Ee(this,{autoTranspose:!0}),S_=M_.leftSingularVectors,I_=M_.rightSingularVectors,P_=M_.diagonal,C_=0;C_<P_.length;C_++)P_[C_]=_Mathabs(P_[C_])>j_?1/P_[C_]:0;return P_=this.constructor[Symbol.species].diag(P_),I_.mmul(P_.mmul(S_.transposeView()))}}Xb.prototype.klass='Matrix',Xb.random=Xb.rand,Xb.diagonal=Xb.diag,Xb.prototype.diagonal=Xb.prototype.diag,Xb.identity=Xb.eye,Xb.prototype.negate=Xb.prototype.neg,Xb.prototype.tensorProduct=Xb.prototype.kroneckerProduct,Xb.prototype.determinant=Xb.prototype.det;var Ob=`
(function %name%(value) {
    if (typeof value === 'number') return this.%name%S(value);
    return this.%name%M(value);
})
`,Nb=`
(function %name%S(value) {
    for (var i = 0; i < this.rows; i++) {
        for (var j = 0; j < this.columns; j++) {
            this.set(i, j, this.get(i, j) %op% value);
        }
    }
    return this;
})
`,Gb=`
(function %name%M(matrix) {
    matrix = this.constructor.checkMatrix(matrix);
    if (this.rows !== matrix.rows ||
        this.columns !== matrix.columns) {
        throw new RangeError('Matrices dimensions must be equal');
    }
    for (var i = 0; i < this.rows; i++) {
        for (var j = 0; j < this.columns; j++) {
            this.set(i, j, this.get(i, j) %op% matrix.get(i, j));
        }
    }
    return this;
})
`,Hb=`
(function %name%(matrix, value) {
    var newMatrix = new this[Symbol.species](matrix);
    return newMatrix.%name%(value);
})
`,Wb=`
(function %name%() {
    for (var i = 0; i < this.rows; i++) {
        for (var j = 0; j < this.columns; j++) {
            this.set(i, j, %method%(this.get(i, j)));
        }
    }
    return this;
})
`,Zb=`
(function %name%(matrix) {
    var newMatrix = new this[Symbol.species](matrix);
    return newMatrix.%name%();
})
`,Qb=`
(function %name%(%args%) {
    for (var i = 0; i < this.rows; i++) {
        for (var j = 0; j < this.columns; j++) {
            this.set(i, j, %method%(this.get(i, j), %args%));
        }
    }
    return this;
})
`,Kb=`
(function %name%(matrix, %args%) {
    var newMatrix = new this[Symbol.species](matrix);
    return newMatrix.%name%(%args%);
})
`,Jb=`
(function %name%S(value) {
    for (var i = 0; i < this.rows; i++) {
        for (var j = 0; j < this.columns; j++) {
            this.set(i, j, %method%(this.get(i, j), value));
        }
    }
    return this;
})
`,$b=`
(function %name%M(matrix) {
    matrix = this.constructor.checkMatrix(matrix);
    if (this.rows !== matrix.rows ||
        this.columns !== matrix.columns) {
        throw new RangeError('Matrices dimensions must be equal');
    }
    for (var i = 0; i < this.rows; i++) {
        for (var j = 0; j < this.columns; j++) {
            this.set(i, j, %method%(this.get(i, j), matrix.get(i, j)));
        }
    }
    return this;
})
`,e_=`
(function %name%(value) {
    if (typeof value === 'number') return this.%name%S(value);
    return this.%name%M(value);
})
`,a_=[['+','add'],['-','sub','subtract'],['*','mul','multiply'],['/','div','divide'],['%','mod','modulus'],['&','and'],['|','or'],['^','xor'],['<<','leftShift'],['>>','signPropagatingRightShift'],['>>>','rightShift','zeroFillRightShift']],n_=eval,i_;for(var o_ of a_){var s_=n_(qb(Ob,{name:o_[1],op:o_[0]})),r_=n_(qb(Nb,{name:o_[1]+'S',op:o_[0]})),l_=n_(qb(Gb,{name:o_[1]+'M',op:o_[0]})),d_=n_(qb(Hb,{name:o_[1]}));for(i_=1;i_<o_.length;i_++)Xb.prototype[o_[i_]]=s_,Xb.prototype[o_[i_]+'S']=r_,Xb.prototype[o_[i_]+'M']=l_,Xb[o_[i_]]=d_}var h_=[['~','not']];['abs','acos','acosh','asin','asinh','atan','atanh','cbrt','ceil','clz32','cos','cosh','exp','expm1','floor','fround','log','log1p','log10','log2','round','sign','sin','sinh','sqrt','tan','tanh','trunc'].forEach(function(j_){h_.push(['Math.'+j_,j_])});for(var m_ of h_){var c_=n_(qb(Wb,{name:m_[1],method:m_[0]})),g_=n_(qb(Zb,{name:m_[1]}));for(i_=1;i_<m_.length;i_++)Xb.prototype[m_[i_]]=c_,Xb[m_[i_]]=g_}var u_=[['Math.pow',1,'pow']];for(var p_ of u_){var f_='arg0';for(i_=1;i_<p_[1];i_++)f_+=`, arg${i_}`;if(1!==p_[1]){var b_=n_(qb(Qb,{name:p_[2],method:p_[0],args:f_})),w_=n_(qb(Kb,{name:p_[2],args:f_}));for(i_=2;i_<p_.length;i_++)Xb.prototype[p_[i_]]=b_,Xb[p_[i_]]=w_}else{var x_={name:p_[2],args:f_,method:p_[0]},y_=n_(qb(e_,x_)),k_=n_(qb(Jb,x_)),v_=n_(qb($b,x_)),D_=n_(qb(Kb,x_));for(i_=2;i_<p_.length;i_++)Xb.prototype[p_[i_]]=y_,Xb.prototype[p_[i_]+'M']=v_,Xb.prototype[p_[i_]+'S']=k_,Xb[p_[i_]]=D_}}return Xb}function rt(Fb){if(!(this instanceof rt))return new rt(Fb);Fb=$l.checkMatrix(Fb);var Ub=Fb.clone(),qb=Fb.rows,Xb=Fb.columns,Ob=Array(Xb),Nb,Gb,Hb,Wb;for(Hb=0;Hb<Xb;Hb++){var Zb=0;for(Nb=Hb;Nb<qb;Nb++)Zb=ze(Zb,Ub[Nb][Hb]);if(0!==Zb){for(0>Ub[Hb][Hb]&&(Zb=-Zb),Nb=Hb;Nb<qb;Nb++)Ub[Nb][Hb]/=Zb;for(Ub[Hb][Hb]+=1,Gb=Hb+1;Gb<Xb;Gb++){for(Wb=0,Nb=Hb;Nb<qb;Nb++)Wb+=Ub[Nb][Hb]*Ub[Nb][Gb];for(Wb=-Wb/Ub[Hb][Hb],Nb=Hb;Nb<qb;Nb++)Ub[Nb][Gb]+=Wb*Ub[Nb][Hb]}}Ob[Hb]=-Zb}this.QR=Ub,this.Rdiag=Ob}function dt(Fb,Ub){return Fb=$l.checkMatrix(Fb),Ub=$l.checkMatrix(Ub),Fb.isSquare()?new Re(Fb).solve(Ub):new rt(Fb).solve(Ub)}function ht(Fb,Ub){if(Ub=Object.assign({},ed,Ub),!(this instanceof ht))return new ht(Fb,Ub);if(Fb=$l.checkMatrix(Fb),!Fb.isSquare())throw new Error('Matrix is not a square matrix');var qb=Fb.columns,Xb=Le(qb,qb,0),Ob=Array(qb),Nb=Array(qb),Gb=Fb,Zb=!1,Hb,Wb;if(Zb=!!Ub.assumeSymmetric||Fb.isSymmetric(),Zb){for(Hb=0;Hb<qb;Hb++)for(Wb=0;Wb<qb;Wb++)Xb[Hb][Wb]=Gb.get(Hb,Wb);mt(qb,Nb,Ob,Xb),ct(qb,Nb,Ob,Xb)}else{var Qb=Le(qb,qb,0),Kb=Array(qb);for(Wb=0;Wb<qb;Wb++)for(Hb=0;Hb<qb;Hb++)Qb[Hb][Wb]=Gb.get(Hb,Wb);gt(qb,Qb,Kb,Xb),ut(qb,Nb,Ob,Xb,Qb)}this.n=qb,this.e=Nb,this.d=Ob,this.V=Xb}function mt(Fb,Ub,qb,Xb){var Ob,Nb,Gb,Hb,Wb,Zb,Qb,Kb;for(Wb=0;Wb<Fb;Wb++)qb[Wb]=Xb[Fb-1][Wb];for(Hb=Fb-1;0<Hb;Hb--){for(Kb=0,Gb=0,Zb=0;Zb<Hb;Zb++)Kb+=_Mathabs(qb[Zb]);if(0===Kb)for(Ub[Hb]=qb[Hb-1],Wb=0;Wb<Hb;Wb++)qb[Wb]=Xb[Hb-1][Wb],Xb[Hb][Wb]=0,Xb[Wb][Hb]=0;else{for(Zb=0;Zb<Hb;Zb++)qb[Zb]/=Kb,Gb+=qb[Zb]*qb[Zb];for(Ob=qb[Hb-1],Nb=_Mathsqrt(Gb),0<Ob&&(Nb=-Nb),Ub[Hb]=Kb*Nb,Gb-=Ob*Nb,qb[Hb-1]=Ob-Nb,Wb=0;Wb<Hb;Wb++)Ub[Wb]=0;for(Wb=0;Wb<Hb;Wb++){for(Ob=qb[Wb],Xb[Wb][Hb]=Ob,Nb=Ub[Wb]+Xb[Wb][Wb]*Ob,Zb=Wb+1;Zb<=Hb-1;Zb++)Nb+=Xb[Zb][Wb]*qb[Zb],Ub[Zb]+=Xb[Zb][Wb]*Ob;Ub[Wb]=Nb}for(Ob=0,Wb=0;Wb<Hb;Wb++)Ub[Wb]/=Gb,Ob+=Ub[Wb]*qb[Wb];for(Qb=Ob/(Gb+Gb),Wb=0;Wb<Hb;Wb++)Ub[Wb]-=Qb*qb[Wb];for(Wb=0;Wb<Hb;Wb++){for(Ob=qb[Wb],Nb=Ub[Wb],Zb=Wb;Zb<=Hb-1;Zb++)Xb[Zb][Wb]-=Ob*Ub[Zb]+Nb*qb[Zb];qb[Wb]=Xb[Hb-1][Wb],Xb[Hb][Wb]=0}}qb[Hb]=Gb}for(Hb=0;Hb<Fb-1;Hb++){if(Xb[Fb-1][Hb]=Xb[Hb][Hb],Xb[Hb][Hb]=1,Gb=qb[Hb+1],0!==Gb){for(Zb=0;Zb<=Hb;Zb++)qb[Zb]=Xb[Zb][Hb+1]/Gb;for(Wb=0;Wb<=Hb;Wb++){for(Nb=0,Zb=0;Zb<=Hb;Zb++)Nb+=Xb[Zb][Hb+1]*Xb[Zb][Wb];for(Zb=0;Zb<=Hb;Zb++)Xb[Zb][Wb]-=Nb*qb[Zb]}}for(Zb=0;Zb<=Hb;Zb++)Xb[Zb][Hb+1]=0}for(Wb=0;Wb<Fb;Wb++)qb[Wb]=Xb[Fb-1][Wb],Xb[Fb-1][Wb]=0;Xb[Fb-1][Fb-1]=1,Ub[0]=0}function ct(Fb,Ub,qb,Xb){var Ob,Nb,Gb,Hb,Wb,Zb,Qb,Kb,Jb,$b,e_,t_,a_,i_,n_,o_,s_;for(Gb=1;Gb<Fb;Gb++)Ub[Gb-1]=Ub[Gb];Ub[Fb-1]=0;var r_=0,l_=0,d_=2.220446049250313e-16;for(Zb=0;Zb<Fb;Zb++){for(l_=_Mathmax(l_,_Mathabs(qb[Zb])+_Mathabs(Ub[Zb])),Qb=Zb;Qb<Fb&&!(_Mathabs(Ub[Qb])<=d_*l_);)Qb++;if(Qb>Zb){s_=0;do{for(++s_,Ob=qb[Zb],Kb=(qb[Zb+1]-Ob)/(2*Ub[Zb]),Jb=ze(Kb,1),0>Kb&&(Jb=-Jb),qb[Zb]=Ub[Zb]/(Kb+Jb),qb[Zb+1]=Ub[Zb]*(Kb+Jb),$b=qb[Zb+1],Nb=Ob-qb[Zb],Gb=Zb+2;Gb<Fb;Gb++)qb[Gb]-=Nb;for(r_+=Nb,Kb=qb[Qb],e_=1,t_=e_,a_=e_,i_=Ub[Zb+1],n_=0,o_=0,Gb=Qb-1;Gb>=Zb;Gb--)for(a_=t_,t_=e_,o_=n_,Ob=e_*Ub[Gb],Nb=e_*Kb,Jb=ze(Kb,Ub[Gb]),Ub[Gb+1]=n_*Jb,n_=Ub[Gb]/Jb,e_=Kb/Jb,Kb=e_*qb[Gb]-n_*Ob,qb[Gb+1]=Nb+n_*(e_*Ob+n_*qb[Gb]),Wb=0;Wb<Fb;Wb++)Nb=Xb[Wb][Gb+1],Xb[Wb][Gb+1]=n_*Xb[Wb][Gb]+e_*Nb,Xb[Wb][Gb]=e_*Xb[Wb][Gb]-n_*Nb;Kb=-n_*o_*a_*i_*Ub[Zb]/$b,Ub[Zb]=n_*Kb,qb[Zb]=e_*Kb}while(_Mathabs(Ub[Zb])>d_*l_)}qb[Zb]+=r_,Ub[Zb]=0}for(Gb=0;Gb<Fb-1;Gb++){for(Wb=Gb,Kb=qb[Gb],Hb=Gb+1;Hb<Fb;Hb++)qb[Hb]<Kb&&(Wb=Hb,Kb=qb[Hb]);if(Wb!==Gb)for(qb[Wb]=qb[Gb],qb[Gb]=Kb,Hb=0;Hb<Fb;Hb++)Kb=Xb[Hb][Gb],Xb[Hb][Gb]=Xb[Hb][Wb],Xb[Hb][Wb]=Kb}}function gt(Fb,Ub,qb,Xb){var Ob=0,Nb=Fb-1,Gb,Hb,Wb,Zb,Qb,Kb,Jb;for(Kb=Ob+1;Kb<=Nb-1;Kb++){for(Jb=0,Zb=Kb;Zb<=Nb;Zb++)Jb+=_Mathabs(Ub[Zb][Kb-1]);if(0!==Jb){for(Wb=0,Zb=Nb;Zb>=Kb;Zb--)qb[Zb]=Ub[Zb][Kb-1]/Jb,Wb+=qb[Zb]*qb[Zb];for(Hb=_Mathsqrt(Wb),0<qb[Kb]&&(Hb=-Hb),Wb-=qb[Kb]*Hb,qb[Kb]-=Hb,Qb=Kb;Qb<Fb;Qb++){for(Gb=0,Zb=Nb;Zb>=Kb;Zb--)Gb+=qb[Zb]*Ub[Zb][Qb];for(Gb/=Wb,Zb=Kb;Zb<=Nb;Zb++)Ub[Zb][Qb]-=Gb*qb[Zb]}for(Zb=0;Zb<=Nb;Zb++){for(Gb=0,Qb=Nb;Qb>=Kb;Qb--)Gb+=qb[Qb]*Ub[Zb][Qb];for(Gb/=Wb,Qb=Kb;Qb<=Nb;Qb++)Ub[Zb][Qb]-=Gb*qb[Qb]}qb[Kb]=Jb*qb[Kb],Ub[Kb][Kb-1]=Jb*Hb}}for(Zb=0;Zb<Fb;Zb++)for(Qb=0;Qb<Fb;Qb++)Xb[Zb][Qb]=Zb===Qb?1:0;for(Kb=Nb-1;Kb>=Ob+1;Kb--)if(0!==Ub[Kb][Kb-1]){for(Zb=Kb+1;Zb<=Nb;Zb++)qb[Zb]=Ub[Zb][Kb-1];for(Qb=Kb;Qb<=Nb;Qb++){for(Hb=0,Zb=Kb;Zb<=Nb;Zb++)Hb+=qb[Zb]*Xb[Zb][Qb];for(Hb=Hb/qb[Kb]/Ub[Kb][Kb-1],Zb=Kb;Zb<=Nb;Zb++)Xb[Zb][Qb]+=Hb*qb[Zb]}}}function ut(Fb,Ub,qb,Xb,Ob){var Nb=Fb-1,Gb=0,Hb=Fb-1,Wb=2.220446049250313e-16,Zb=0,Qb=0,Kb=0,Jb=0,$b=0,e_=0,t_=0,a_=0,i_,n_,o_,s_,r_,l_,d_,h_,m_,c_,g_,u_,p_,f_,b_;for(i_=0;i_<Fb;i_++)for((i_<Gb||i_>Hb)&&(qb[i_]=Ob[i_][i_],Ub[i_]=0),n_=_Mathmax(i_-1,0);n_<Fb;n_++)Qb+=_Mathabs(Ob[i_][n_]);for(;Nb>=Gb;){for(s_=Nb;s_>Gb&&(e_=_Mathabs(Ob[s_-1][s_-1])+_Mathabs(Ob[s_][s_]),0===e_&&(e_=Qb),!(_Mathabs(Ob[s_][s_-1])<Wb*e_));)s_--;if(s_===Nb)Ob[Nb][Nb]+=Zb,qb[Nb]=Ob[Nb][Nb],Ub[Nb]=0,Nb--,a_=0;else if(s_===Nb-1){if(d_=Ob[Nb][Nb-1]*Ob[Nb-1][Nb],Kb=(Ob[Nb-1][Nb-1]-Ob[Nb][Nb])/2,Jb=Kb*Kb+d_,t_=_Mathsqrt(_Mathabs(Jb)),Ob[Nb][Nb]+=Zb,Ob[Nb-1][Nb-1]=Ob[Nb-1][Nb-1]+Zb,h_=Ob[Nb][Nb],0<=Jb){for(t_=0<=Kb?Kb+t_:Kb-t_,qb[Nb-1]=h_+t_,qb[Nb]=qb[Nb-1],0!==t_&&(qb[Nb]=h_-d_/t_),Ub[Nb-1]=0,Ub[Nb]=0,h_=Ob[Nb][Nb-1],e_=_Mathabs(h_)+_Mathabs(t_),Kb=h_/e_,Jb=t_/e_,$b=_Mathsqrt(Kb*Kb+Jb*Jb),Kb/=$b,Jb/=$b,n_=Nb-1;n_<Fb;n_++)t_=Ob[Nb-1][n_],Ob[Nb-1][n_]=Jb*t_+Kb*Ob[Nb][n_],Ob[Nb][n_]=Jb*Ob[Nb][n_]-Kb*t_;for(i_=0;i_<=Nb;i_++)t_=Ob[i_][Nb-1],Ob[i_][Nb-1]=Jb*t_+Kb*Ob[i_][Nb],Ob[i_][Nb]=Jb*Ob[i_][Nb]-Kb*t_;for(i_=Gb;i_<=Hb;i_++)t_=Xb[i_][Nb-1],Xb[i_][Nb-1]=Jb*t_+Kb*Xb[i_][Nb],Xb[i_][Nb]=Jb*Xb[i_][Nb]-Kb*t_}else qb[Nb-1]=h_+Kb,qb[Nb]=h_+Kb,Ub[Nb-1]=t_,Ub[Nb]=-t_;Nb-=2,a_=0}else{if(h_=Ob[Nb][Nb],m_=0,d_=0,s_<Nb&&(m_=Ob[Nb-1][Nb-1],d_=Ob[Nb][Nb-1]*Ob[Nb-1][Nb]),10==a_){for(Zb+=h_,i_=Gb;i_<=Nb;i_++)Ob[i_][i_]-=h_;e_=_Mathabs(Ob[Nb][Nb-1])+_Mathabs(Ob[Nb-1][Nb-2]),h_=m_=0.75*e_,d_=-0.4375*e_*e_}if(30==a_&&(e_=(m_-h_)/2,e_=e_*e_+d_,0<e_)){for(e_=_Mathsqrt(e_),m_<h_&&(e_=-e_),e_=h_-d_/((m_-h_)/2+e_),i_=Gb;i_<=Nb;i_++)Ob[i_][i_]-=e_;Zb+=e_,h_=m_=d_=0.964}for(++a_,r_=Nb-2;r_>=s_&&(t_=Ob[r_][r_],$b=h_-t_,e_=m_-t_,Kb=($b*e_-d_)/Ob[r_+1][r_]+Ob[r_][r_+1],Jb=Ob[r_+1][r_+1]-t_-$b-e_,$b=Ob[r_+2][r_+1],e_=_Mathabs(Kb)+_Mathabs(Jb)+_Mathabs($b),Kb/=e_,Jb/=e_,$b/=e_,r_!==s_)&&!(_Mathabs(Ob[r_][r_-1])*(_Mathabs(Jb)+_Mathabs($b))<Wb*(_Mathabs(Kb)*(_Mathabs(Ob[r_-1][r_-1])+_Mathabs(t_)+_Mathabs(Ob[r_+1][r_+1]))));)r_--;for(i_=r_+2;i_<=Nb;i_++)Ob[i_][i_-2]=0,i_>r_+2&&(Ob[i_][i_-3]=0);for(o_=r_;o_<=Nb-1&&(f_=o_!==Nb-1,o_!==r_&&(Kb=Ob[o_][o_-1],Jb=Ob[o_+1][o_-1],$b=f_?Ob[o_+2][o_-1]:0,h_=_Mathabs(Kb)+_Mathabs(Jb)+_Mathabs($b),0!==h_&&(Kb/=h_,Jb/=h_,$b/=h_)),0!==h_);o_++)if(e_=_Mathsqrt(Kb*Kb+Jb*Jb+$b*$b),0>Kb&&(e_=-e_),0!==e_){for(o_===r_?s_!==r_&&(Ob[o_][o_-1]=-Ob[o_][o_-1]):Ob[o_][o_-1]=-e_*h_,Kb+=e_,h_=Kb/e_,m_=Jb/e_,t_=$b/e_,Jb/=Kb,$b/=Kb,n_=o_;n_<Fb;n_++)Kb=Ob[o_][n_]+Jb*Ob[o_+1][n_],f_&&(Kb+=$b*Ob[o_+2][n_],Ob[o_+2][n_]=Ob[o_+2][n_]-Kb*t_),Ob[o_][n_]-=Kb*h_,Ob[o_+1][n_]=Ob[o_+1][n_]-Kb*m_;for(i_=0;i_<=_Mathmin(Nb,o_+3);i_++)Kb=h_*Ob[i_][o_]+m_*Ob[i_][o_+1],f_&&(Kb+=t_*Ob[i_][o_+2],Ob[i_][o_+2]=Ob[i_][o_+2]-Kb*$b),Ob[i_][o_]-=Kb,Ob[i_][o_+1]=Ob[i_][o_+1]-Kb*Jb;for(i_=Gb;i_<=Hb;i_++)Kb=h_*Xb[i_][o_]+m_*Xb[i_][o_+1],f_&&(Kb+=t_*Xb[i_][o_+2],Xb[i_][o_+2]=Xb[i_][o_+2]-Kb*$b),Xb[i_][o_]-=Kb,Xb[i_][o_+1]=Xb[i_][o_+1]-Kb*Jb}}}if(0!==Qb){for(Nb=Fb-1;0<=Nb;Nb--)if(Kb=qb[Nb],Jb=Ub[Nb],0===Jb)for(s_=Nb,Ob[Nb][Nb]=1,i_=Nb-1;0<=i_;i_--){for(d_=Ob[i_][i_]-Kb,$b=0,n_=s_;n_<=Nb;n_++)$b+=Ob[i_][n_]*Ob[n_][Nb];if(0>Ub[i_])t_=d_,e_=$b;else if(s_=i_,0===Ub[i_]?Ob[i_][Nb]=0===d_?-$b/(Wb*Qb):-$b/d_:(h_=Ob[i_][i_+1],m_=Ob[i_+1][i_],Jb=(qb[i_]-Kb)*(qb[i_]-Kb)+Ub[i_]*Ub[i_],l_=(h_*e_-t_*$b)/Jb,Ob[i_][Nb]=l_,Ob[i_+1][Nb]=_Mathabs(h_)>_Mathabs(t_)?(-$b-d_*l_)/h_:(-e_-m_*l_)/t_),l_=_Mathabs(Ob[i_][Nb]),1<Wb*l_*l_)for(n_=i_;n_<=Nb;n_++)Ob[n_][Nb]/=l_}else if(0>Jb)for(s_=Nb-1,_Mathabs(Ob[Nb][Nb-1])>_Mathabs(Ob[Nb-1][Nb])?(Ob[Nb-1][Nb-1]=Jb/Ob[Nb][Nb-1],Ob[Nb-1][Nb]=-(Ob[Nb][Nb]-Kb)/Ob[Nb][Nb-1]):(b_=pt(0,-Ob[Nb-1][Nb],Ob[Nb-1][Nb-1]-Kb,Jb),Ob[Nb-1][Nb-1]=b_[0],Ob[Nb-1][Nb]=b_[1]),Ob[Nb][Nb-1]=0,Ob[Nb][Nb]=1,i_=Nb-2;0<=i_;i_--){for(c_=0,g_=0,n_=s_;n_<=Nb;n_++)c_+=Ob[i_][n_]*Ob[n_][Nb-1],g_+=Ob[i_][n_]*Ob[n_][Nb];if(d_=Ob[i_][i_]-Kb,0>Ub[i_])t_=d_,$b=c_,e_=g_;else if(s_=i_,0===Ub[i_]?(b_=pt(-c_,-g_,d_,Jb),Ob[i_][Nb-1]=b_[0],Ob[i_][Nb]=b_[1]):(h_=Ob[i_][i_+1],m_=Ob[i_+1][i_],u_=(qb[i_]-Kb)*(qb[i_]-Kb)+Ub[i_]*Ub[i_]-Jb*Jb,p_=2*(qb[i_]-Kb)*Jb,0===u_&&0===p_&&(u_=Wb*Qb*(_Mathabs(d_)+_Mathabs(Jb)+_Mathabs(h_)+_Mathabs(m_)+_Mathabs(t_))),b_=pt(h_*$b-t_*c_+Jb*g_,h_*e_-t_*g_-Jb*c_,u_,p_),Ob[i_][Nb-1]=b_[0],Ob[i_][Nb]=b_[1],_Mathabs(h_)>_Mathabs(t_)+_Mathabs(Jb)?(Ob[i_+1][Nb-1]=(-c_-d_*Ob[i_][Nb-1]+Jb*Ob[i_][Nb])/h_,Ob[i_+1][Nb]=(-g_-d_*Ob[i_][Nb]-Jb*Ob[i_][Nb-1])/h_):(b_=pt(-$b-m_*Ob[i_][Nb-1],-e_-m_*Ob[i_][Nb],t_,Jb),Ob[i_+1][Nb-1]=b_[0],Ob[i_+1][Nb]=b_[1])),l_=_Mathmax(_Mathabs(Ob[i_][Nb-1]),_Mathabs(Ob[i_][Nb])),1<Wb*l_*l_)for(n_=i_;n_<=Nb;n_++)Ob[n_][Nb-1]=Ob[n_][Nb-1]/l_,Ob[n_][Nb]/=l_}for(i_=0;i_<Fb;i_++)if(i_<Gb||i_>Hb)for(n_=i_;n_<Fb;n_++)Xb[i_][n_]=Ob[i_][n_];for(n_=Fb-1;n_>=Gb;n_--)for(i_=Gb;i_<=Hb;i_++){for(t_=0,o_=Gb;o_<=_Mathmin(n_,Hb);o_++)t_+=Xb[i_][o_]*Ob[o_][n_];Xb[i_][n_]=t_}}}function pt(Fb,Ub,qb,Xb){var Ob,Nb;return _Mathabs(qb)>_Mathabs(Xb)?(Ob=Xb/qb,Nb=qb+Ob*Xb,[(Fb+Ob*Ub)/Nb,(Ub-Ob*Fb)/Nb]):(Ob=qb/Xb,Nb=Xb+Ob*qb,[(Ob*Fb+Ub)/Nb,(Ob*Ub-Fb)/Nb])}function bt(Fb){if(!(this instanceof bt))return new bt(Fb);if(Fb=$l.checkMatrix(Fb),!Fb.isSymmetric())throw new Error('Matrix is not symmetric');var Ub=Fb,qb=Ub.rows,Xb=new $l(qb,qb),Ob=!0,Nb,Gb,Hb;for(Gb=0;Gb<qb;Gb++){var Wb=Xb[Gb],Zb=0;for(Hb=0;Hb<Gb;Hb++){var Qb=Xb[Hb],Kb=0;for(Nb=0;Nb<Hb;Nb++)Kb+=Qb[Nb]*Wb[Nb];Wb[Hb]=Kb=(Ub[Gb][Hb]-Kb)/Xb[Hb][Hb],Zb+=Kb*Kb}for(Zb=Ub[Gb][Gb]-Zb,Ob&=0<Zb,Xb[Gb][Gb]=_Mathsqrt(_Mathmax(Zb,0)),Hb=Gb+1;Hb<qb;Hb++)Xb[Gb][Hb]=0}if(!Ob)throw new Error('Matrix is not positive definite');this.L=Xb}function _t(Fb,Ub){for(var qb=0,Xb=0;Xb<Fb.length;Xb++)qb+=(Fb[Xb]-Ub[Xb])*(Fb[Xb]-Ub[Xb]);return qb}function wt(Fb,Ub){return _Mathsqrt(_t(Fb,Ub))}function xt(Fb,Ub){for(var qb=Fb.clone(),Xb=0;Xb<Fb.rows;++Xb)qb[Xb][0]=_Mathpow(qb[Xb][0],Ub);return qb}function yt(Fb,Ub){this[Fb][Ub]=_Mathabs(this[Fb][Ub])}function kt(Fb,Ub,qb){for(var Xb=new yh(Fb,Ub,qb),Ob=Array(this.size),Nb=0;Nb<this.width;Nb++)for(var Gb=0;Gb<this.height;Gb++)Ob[Gb*this.width+Nb]=[Nb,Gb];for(var Hb=Xb.predict(Ob),Wb=Sb.createFrom(this),Zb=0;Zb<this.size;Zb++)Wb.data[Zb]=_Mathmin(this.maxValue,_Mathmax(0,Hb[Zb][0]));return Wb}function vt(Fb={}){var Ub=Fb.x,qb=void 0===Ub?0:Ub,Xb=Fb.y,Ob=void 0===Xb?0:Xb,Nb=Fb.width,Gb=void 0===Nb?this.width-qb:Nb,Hb=Fb.height,Wb=void 0===Hb?this.height-Ob:Hb;if(this.checkProcessable('max',{bitDepth:[8,16]}),qb=_Mathround(qb),Ob=_Mathround(Ob),Gb=_Mathround(Gb),Wb=_Mathround(Wb),qb>this.width-1||Ob>this.height-1)throw new RangeError(`crop: origin (x:${qb}, y:${Ob}) out of range (${this.width-1}; ${this.height-1})`);if(0>=Gb||0>=Wb)throw new RangeError(`crop: width and height (width:${Gb}; height:${Wb}) must be positive numbers`);if(0>qb||0>Ob)throw new RangeError(`crop: x and y (x:${qb}, y:${Ob}) must be positive numbers`);if(Gb>this.width-qb||Wb>this.height-Ob)throw new RangeError(`crop: (x: ${qb}, y:${Ob}, width:${Gb}, height:${Wb}) size is out of range`);for(var Zb=Sb.createFrom(this,{width:Gb,height:Wb,position:[qb,Ob]}),Qb=Gb*this.channels,Kb=Ob+Wb,Jb=0,$b=qb*this.channels,e_=Ob;e_<Kb;e_++)for(var t_=e_*this.width*this.channels+$b,a_=t_+Qb;t_<a_;t_++)Zb.data[Jb++]=this.data[t_];return Zb}function Dt(Fb={}){this.checkProcessable('cropAlpha',{alpha:1});var Ub=Fb.threshold,qb=void 0===Ub?this.maxValue:Ub,Xb=jt(this,qb,this.components);if(-1===Xb)throw new Error('Could not find new dimensions. Threshold may be too high.');var Ob=Mt(this,qb,this.components,Xb),Nb=St(this,qb,this.components,Xb),Gb=It(this,qb,this.components,Xb,Ob,Nb);return this.crop({x:Xb,y:Ob,width:Gb-Xb+1,height:Nb-Ob+1})}function jt(Fb,Ub,qb){for(var Xb=0;Xb<Fb.width;Xb++)for(var Ob=0;Ob<Fb.height;Ob++)if(Fb.getValueXY(Xb,Ob,qb)>=Ub)return Xb;return-1}function Mt(Fb,Ub,qb,Xb){for(var Ob=0;Ob<Fb.height;Ob++)for(var Nb=Xb;Nb<Fb.width;Nb++)if(Fb.getValueXY(Nb,Ob,qb)>=Ub)return Ob;return-1}function St(Fb,Ub,qb,Xb){for(var Ob=Fb.height-1;0<=Ob;Ob--)for(var Nb=Xb;Nb<Fb.width;Nb++)if(Fb.getValueXY(Nb,Ob,qb)>=Ub)return Ob;return-1}function It(Fb,Ub,qb,Xb,Ob,Nb){for(var Gb=Fb.width-1;Gb>=Xb;Gb--)for(var Hb=Ob;Hb<=Nb;Hb++)if(Fb.getValueXY(Gb,Hb,qb)>=Ub)return Gb;return-1}function Pt(Fb,Ub,qb){var Xb=this.width/Ub,Ob=this.height/qb;if(1<this.bitDepth)for(var Nb=0,Gb;Nb<Ub;Nb++){Gb=_Mathfloor((Nb+0.5)*Xb);for(var Hb=0,Wb;Hb<qb;Hb++){Wb=_Mathfloor((Hb+0.5)*Ob);for(var Zb=0;Zb<this.channels;Zb++)Fb.setValueXY(Nb,Hb,Zb,this.getValueXY(Gb,Wb,Zb))}}else for(var Qb=0,Kb;Qb<Ub;Qb++){Kb=_Mathfloor((Qb+0.5)*Xb);for(var Jb=0,$b;Jb<qb;Jb++)$b=_Mathfloor((Jb+0.5)*Ob),this.getBitXY(Kb,$b)&&Fb.setBitXY(Qb,Jb)}}function Ct(Fb){if('string'==typeof Fb){var Ub=Fb[Fb.length-1];Fb=parseFloat(Fb),'%'===Ub&&(Fb/=100)}return Fb}function Bt(Fb,Ub){if(!Ub)throw Error('getThreshold : the maxValue should be specified');if('string'==typeof Fb){var qb=Fb[Fb.length-1];if('%'!==qb)throw Error('getThreshold : if the value is a string it must finish by %');return parseFloat(Fb)/100*Ub}if('number'==typeof Fb)return 1>Fb?Fb*Ub:Fb;throw Error('getThreshold : the value is not valid')}function At(Fb,Ub,qb){Fb=Ct(Fb);var Xb=_Mathround(Fb*Ub),Ob=_Mathround(Fb*qb);return 0>=Xb&&(Xb=1),0>=Ob&&(Ob=1),{width:Xb,height:Ob}}function Rt(Fb={}){var Ub=Fb.factor,qb=void 0===Ub?1:Ub,Xb=Fb.algorithm,Ob=void 0===Xb?'nearestNeighbor':Xb,Nb=Fb.preserveAspectRatio,Gb=void 0===Nb||Nb,Hb=Fb.width,Wb=Fb.height;Hb||(Wb&&Gb?Hb=_Mathround(Wb*(this.width/this.height)):Hb=this.width),Wb||(Gb?Wb=_Mathround(Hb*(this.height/this.width)):Wb=this.height);var Zb=At(qb,Hb,Wb);if(Hb=Zb.width,Wb=Zb.height,Hb===this.width&&Wb===this.height){var Qb=this.clone();return Qb.position=[0,0],Qb}var Kb=_Mathround((this.width-Hb)/2),Jb=_Mathround((this.height-Wb)/2),$b=Sb.createFrom(this,{width:Hb,height:Wb,position:[Kb,Jb]});switch(Ob.toLowerCase()){case'nearestneighbor':case'nearestneighbour':Pt.call(this,$b,Hb,Wb);break;default:throw new Error('Unsupported scale algorithm: '+Ob);}return $b}function zt(){this.checkProcessable('hsv',{bitDepth:[8,16],alpha:[0,1],colorModel:[Yr]});for(var Fb=Sb.createFrom(this,{colorModel:Ur}),Ub=0,qb=this.data,Xb=0;Xb<qb.length;Xb+=this.channels){var Ob=qb[Xb],Nb=qb[Xb+1],Gb=qb[Xb+2],Hb=_Mathmin(Ob,Nb,Gb),Wb=_Mathmax(Ob,Nb,Gb),Zb=Wb-Hb,Qb=0,Kb=0===Wb?0:Zb/Wb;if(Wb!==Hb){switch(Wb){case Ob:Qb=(Nb-Gb)/Zb+(Nb<Gb?6:0);break;case Nb:Qb=(Gb-Ob)/Zb+2;break;case Gb:Qb=(Ob-Nb)/Zb+4;break;default:throw new Error('unreachable');}Qb/=6}Fb.data[Ub++]=Qb*this.maxValue,Fb.data[Ub++]=Kb*this.maxValue,Fb.data[Ub++]=Wb,this.alpha&&(Fb.data[Ub++]=qb[Xb+3])}return Fb}function Lt(){this.checkProcessable('hsl',{bitDepth:[8,16],alpha:[0,1],colorModel:[Yr]});for(var Fb=Sb.createFrom(this,{colorModel:Fr}),Ub=_Mathfloor(this.maxValue/2),qb=0,Xb=this.data,Ob=0;Ob<Xb.length;Ob+=this.channels){var Nb=Xb[Ob],Gb=Xb[Ob+1],Hb=Xb[Ob+2],Wb=_Mathmax(Nb,Gb,Hb),Zb=_Mathmin(Nb,Gb,Hb),Qb=0,Kb=0,Jb=(Wb+Zb)/2;if(Wb!==Zb){var $b=Wb-Zb;switch(Kb=Jb>Ub?$b/(2-Wb-Zb):$b/(Wb+Zb),Wb){case Nb:Qb=(Gb-Hb)/$b+(Gb<Hb?6:0);break;case Gb:Qb=(Hb-Nb)/$b+2;break;case Hb:Qb=(Nb-Gb)/$b+4;break;default:throw new Error('unreachable');}Qb/=6}Fb.data[qb++]=Qb*this.maxValue,Fb.data[qb++]=Kb*this.maxValue,Fb.data[qb++]=Jb,this.alpha&&(Fb.data[qb++]=Xb[Ob+3])}return Fb}function Et(){this.checkProcessable('cmyk',{bitDepth:[8,16],alpha:[0,1],colorModel:[Yr]});for(var Fb=Sb.createFrom(this,{components:4,colorModel:Xr}),Ub=0,qb=this.data,Xb=0;Xb<qb.length;Xb+=this.channels){var Ob=qb[Xb],Nb=qb[Xb+1],Gb=qb[Xb+2],Hb=_Mathmin(this.maxValue-Ob,this.maxValue-Nb,this.maxValue-Gb),Wb=(this.maxValue-Ob-Hb)/(1-Hb/this.maxValue),Zb=(this.maxValue-Nb-Hb)/(1-Hb/this.maxValue),Qb=(this.maxValue-Gb-Hb)/(1-Hb/this.maxValue);Fb.data[Ub++]=Wb,Fb.data[Ub++]=Zb,Fb.data[Ub++]=Qb,Fb.data[Ub++]=Hb,this.alpha&&(Fb.data[Ub++]=qb[Xb+3])}return Fb}function Tt(){return new Sb(this.width,this.height,this.getRGBAData(),{kind:'RGBA',parent:this})}function Vt(Fb={}){var Ub=Fb.algorithm,qb=void 0===Ub?'luma709':Ub,Xb=Fb.keepAlpha,Ob=void 0!==Xb&&Xb,Nb=Fb.mergeAlpha,Gb=void 0===Nb||Nb,Hb=Fb.allowGrey,Zb={bitDepth:[8,16],alpha:[0,1]};void 0!==Hb&&Hb||(Zb.colorModel=[Yr],Zb.components=[3]),this.checkProcessable('grey',Zb),1===this.components&&(qb='red'),Ob&=this.alpha,Gb&=this.alpha,Ob&&(Gb=!1);var Qb=Sb.createFrom(this,{components:1,alpha:Ob,colorModel:null}),Kb=kh[qb.toLowerCase()];if(!Kb)throw new Error('Unsupported grey algorithm: '+qb);for(var Jb=0,$b=0;$b<this.data.length;$b+=this.channels)Gb?Qb.data[Jb++]=Kb(this.data,$b,this)*this.data[$b+this.components]/this.maxValue:(Qb.data[Jb++]=Kb(this.data,$b,this),Qb.alpha&&(Qb.data[Jb++]=this.data[$b+this.components]));return Qb}function Ut(Fb){for(var Ub=!1,qb=0,Xb=1;Xb<Fb.length-1;Xb++)if(Fb[Xb-1]<Fb[Xb]&&Fb[Xb+1]<Fb[Xb]&&(qb++,2<qb))return!1;return 2==qb&&(Ub=!0),Ub}function Ht(Fb,Ub){for(var qb=0,Xb=0;Xb<=Ub;Xb++)qb+=Fb[Xb];return qb}function Wt(Fb,Ub){for(var qb=0,Xb=0;Xb<=Ub;Xb++)qb+=Xb*Fb[Xb];return qb}function Zt(Fb,Ub){for(var qb=0,Xb=0;Xb<=Ub;Xb++)qb+=Xb*Xb*Fb[Xb];return qb}function Kt(Fb){for(var Ub=Array(Fb.length),qb=1;qb<Fb.length-1;qb++)Ub[qb]=(Fb[qb-1]+Fb[qb]+Fb[qb+1])/3;return Ub[0]=(Fb[0]+Fb[1])/3,Ub[Fb.length-1]=(Fb[Fb.length-2]+Fb[Fb.length-1])/3,Ub}function Jt(Fb,Ub){for(var qb=void 0,Xb=1;Xb<Ub;Xb++)if(Fb[Xb-1]>Fb[Xb]&&Fb[Xb+1]>=Fb[Xb]){qb=Xb;break}return qb}function $t(Fb){for(var Ub=Fb.length,qb=!1,Xb=0,Ob=1;Ob<Ub-1;Ob++)if(Fb[Ob-1]<Fb[Ob]&&Fb[Ob+1]<Fb[Ob]&&(Xb++,2<Xb))return!1;return 2==Xb&&(qb=!0),qb}function ia(Fb,Ub){for(var qb=0,Xb=0;Xb<=Ub;Xb++)qb+=Fb[Xb];return qb}function ha(Fb={}){var Ub=Fb.algorithm,qb=void 0===Ub?'threshold':Ub,Xb=Fb.threshold,Ob=void 0===Xb?0.5:Xb,Nb=Fb.useAlpha,Hb=Fb.invert,Wb=void 0!==Hb&&Hb;if(this.checkProcessable('mask',{components:1,bitDepth:[8,16]}),'threshold'===qb)Ob=Bt(Ob,this.maxValue);else{var Zb=Dh[qb.toLowerCase()];if(Zb){var Qb=this.getHistogram();Ob=Zb(Qb,this.size)}else throw new Error('mask transform unknown algorithm: '+qb)}var Kb=new Sb(this.width,this.height,{kind:'BINARY',parent:this}),Jb=0;if(this.alpha&&(void 0===Nb||Nb))for(var $b=0,e_;$b<this.data.length;$b+=this.channels)e_=this.data[$b]+(this.maxValue-this.data[$b])*(this.maxValue-this.data[$b+1])/this.maxValue,(Wb&&e_<=Ob||!Wb&&e_>=Ob)&&Kb.setBit(Jb),Jb++;else for(var t_=0;t_<this.data.length;t_+=this.channels)(Wb&&this.data[t_]<=Ob||!Wb&&this.data[t_]>=Ob)&&Kb.setBit(Jb),Jb++;return Kb}function ma(Fb,Ub,qb,Xb){for(var Ob=Fb.width,Nb=Fb.height,Gb=Ub.width,Hb=Fb.channels,Wb=0;Wb<Ob;Wb++)for(var Zb=0;Zb<Nb;Zb++)for(var Qb=0;Qb<Hb;Qb++){var Kb=(Zb*Ob+Wb)*Hb+Qb,Jb=((Xb+Zb)*Gb+qb+Wb)*Hb+Qb;Ub.data[Jb]=Fb.data[Kb]}}function ca(Fb={}){var Ub=Fb.size,qb=void 0===Ub?0:Ub,Xb=Fb.algorithm,Ob=void 0===Xb?'copy':Xb,Nb=Fb.color;if(this.checkProcessable('pad',{bitDepth:[8,16]}),'set'===Ob){if(Nb.length!==this.channels)throw new Error('pad: the color array must have the same length as the number of channels. Here: '+this.channels);for(var Gb=0;Gb<Nb.length;Gb++)0===Nb[Gb]&&(Nb[Gb]=1e-3)}else Nb=_l(this.channels,null);Array.isArray(qb)||(qb=[qb,qb]);var Hb=this.width+2*qb[0],Wb=this.height+2*qb[1],Zb=this.channels,Qb=Sb.createFrom(this,{width:Hb,height:Wb});ma(this,Qb,qb[0],qb[1]);for(var Kb=qb[0];Kb<Hb-qb[0];Kb++)for(var Jb=0,$b;Jb<Zb;Jb++){$b=Nb[Jb]||Qb.data[(qb[1]*Hb+Kb)*Zb+Jb];for(var e_=0;e_<qb[1];e_++)Qb.data[(e_*Hb+Kb)*Zb+Jb]=$b;$b=Nb[Jb]||Qb.data[((Wb-qb[1]-1)*Hb+Kb)*Zb+Jb];for(var t_=Wb-qb[1];t_<Wb;t_++)Qb.data[(t_*Hb+Kb)*Zb+Jb]=$b}for(var a_=0;a_<Wb;a_++)for(var i_=0,n_;i_<Zb;i_++){n_=Nb[i_]||Qb.data[(a_*Hb+qb[0])*Zb+i_];for(var o_=0;o_<qb[0];o_++)Qb.data[(a_*Hb+o_)*Zb+i_]=n_;n_=Nb[i_]||Qb.data[(a_*Hb+Hb-qb[0]-1)*Zb+i_];for(var s_=Hb-qb[0];s_<Hb;s_++)Qb.data[(a_*Hb+s_)*Zb+i_]=n_}return Qb}function ga(Fb=8){if(this.checkProcessable('colorDepth',{bitDepth:[8,16]}),![8,16].includes(Fb))throw Error('You need to specify the new colorDepth as 8 or 16');if(this.bitDepth===Fb)return this.clone();var Ub=Sb.createFrom(this,{bitDepth:Fb});if(8===Fb)for(var qb=0;qb<this.data.length;qb++)Ub.data[qb]=this.data[qb]>>8;else for(var Xb=0;Xb<this.data.length;Xb++)Ub.data[Xb]=this.data[Xb]<<8|this.data[Xb];return Ub}function ua(Fb,Ub={}){var qb=Ub.interpolation,Xb=void 0===qb?'none':qb,Ob=Ub.width,Nb=void 0===Ob?this.width:Ob,Gb=Ub.height,Hb=void 0===Gb?this.height:Gb,Wb=Fb*_MathPI/180,Zb=_Mathfloor(_Mathabs(Nb*_Mathcos(Wb))+_Mathabs(Hb*_Mathsin(Wb))),Qb=_Mathfloor(_Mathabs(Hb*_Mathcos(Wb))+_Mathabs(Nb*_Mathsin(Wb))),Kb=Sb.createFrom(this,{width:Zb,height:Qb}),Jb=_Mathcos(-Wb),$b=_Mathsin(-Wb),e_=Zb/2,t_=Qb/2;0==Zb%2?(e_-=0.5,0==Qb%2?t_-=0.5:t_=_Mathfloor(t_)):(e_=_Mathfloor(e_),0==Qb%2?t_-=0.5:t_=_Mathfloor(t_));var a_=_Mathfloor(Nb/2-e_),i_=_Mathfloor(Hb/2-t_);if('bilinear'===Xb){for(var n_=this.width*this.channels,o_=0;o_<Zb;o_+=1)for(var s_=0;s_<Qb;s_+=1)for(var r_=(o_-e_)*Jb-(s_-t_)*$b+e_+a_,l_=(s_-t_)*Jb+(o_-e_)*$b+t_+i_,d_=0|r_,h_=0|l_,m_=r_-d_,c_=l_-h_,g_=0;g_<this.channels;g_++)if(0>r_||r_>=Nb||0>l_||l_>=Hb)this.alpha?Kb.setValueXY(o_,s_,g_,this.alpha):Kb.setValueXY(o_,s_,g_,this.maxValue);else{var u_=(h_*this.width+d_)*this.channels+g_,p_=this.data[u_],f_=this.data[u_+this.channels],b_=this.data[u_+n_],w_=this.data[u_+n_+this.channels];Kb.setValueXY(o_,s_,g_,0|p_+m_*(f_-p_)+c_*(b_-p_)+m_*c_*(p_-f_-b_+w_))}}else for(var y_=0;y_<Zb;y_+=1)for(var k_=0;k_<Qb;k_+=1)for(var v_=0;v_<this.channels;v_++){var D_=_Mathround((y_-e_)*Jb-(k_-t_)*$b+e_)+a_,j_=_Mathround((k_-t_)*Jb+(y_-e_)*$b+t_)+i_;0>D_||D_>=Nb||0>j_||j_>=Hb?this.alpha?Kb.setValueXY(y_,k_,v_,this.alpha):Kb.setValueXY(y_,k_,v_,this.maxValue):Kb.setValueXY(y_,k_,v_,this.getValueXY(D_,j_,v_))}return Kb}function fa(Fb,Ub){if('number'!=typeof Fb)throw new TypeError('angle must be a number');switch(0>Fb&&(Fb=360*_Mathceil(-Fb/360)+Fb),Fb%360){case 0:return this.clone();case 90:return _a.call(this);case 180:return wa.call(this);case 270:return ba.call(this);default:return ua.call(this,Fb,Ub);}}function ba(){for(var Fb=Sb.createFrom(this,{width:this.height,height:this.width}),Ub=Fb.height-1,qb=0;qb<this.height;qb++)for(var Xb=0;Xb<this.width;Xb++)for(var Ob=0;Ob<this.channels;Ob++)Fb.setValueXY(qb,Ub-Xb,Ob,this.getValueXY(Xb,qb,Ob));return Fb}function _a(){for(var Fb=Sb.createFrom(this,{width:this.height,height:this.width}),Ub=Fb.width-1,qb=0;qb<this.height;qb++)for(var Xb=0;Xb<this.width;Xb++)for(var Ob=0;Ob<this.channels;Ob++)Fb.setValueXY(Ub-qb,Xb,Ob,this.getValueXY(Xb,qb,Ob));return Fb}function wa(){for(var Fb=Sb.createFrom(this),Ub=Fb.width-1,qb=Fb.height-1,Xb=0;Xb<this.height;Xb++)for(var Ob=0;Ob<this.width;Ob++)for(var Nb=0;Nb<this.channels;Nb++)Fb.setValueXY(Ub-Ob,qb-Xb,Nb,this.getValueXY(Ob,Xb,Nb));return Fb}function xa(Fb={}){var Ub=Fb.size,qb=void 0===Ub?0:Ub,Xb=Fb.algorithm,Ob=void 0===Xb?'copy':Xb,Nb=Fb.color;if(this.checkProcessable('setBorder',{bitDepth:[8,16,32,64]}),'set'===Ob){if(Nb.length!==this.channels)throw new Error('setBorder: the color array must have the same length as the number of channels. Here: '+this.channels);for(var Gb=0;Gb<Nb.length;Gb++)0===Nb[Gb]&&(Nb[Gb]=1e-3)}else Nb=_l(this.channels,null);Array.isArray(qb)||(qb=[qb,qb]);for(var Hb=qb[0],Wb=qb[1],Zb=this.channels,Qb=Hb;Qb<this.width-Hb;Qb++)for(var Kb=0,Jb;Kb<Zb;Kb++){Jb=Nb[Kb]||this.data[(Qb+this.width*Wb)*Zb+Kb];for(var $b=0;$b<Wb;$b++)this.data[($b*this.width+Qb)*Zb+Kb]=Jb;Jb=Nb[Kb]||this.data[(Qb+this.width*(this.height-Wb-1))*Zb+Kb];for(var e_=this.height-Wb;e_<this.height;e_++)this.data[(e_*this.width+Qb)*Zb+Kb]=Jb}for(var t_=0;t_<this.height;t_++)for(var a_=0,i_;a_<Zb;a_++){i_=Nb[a_]||this.data[(t_*this.width+Hb)*Zb+a_];for(var n_=0;n_<Hb;n_++)this.data[(t_*this.width+n_)*Zb+a_]=i_;i_=Nb[a_]||this.data[(t_*this.width+this.width-Hb-1)*Zb+a_];for(var o_=this.width-Hb;o_<this.width;o_++)this.data[(t_*this.width+o_)*Zb+a_]=i_}return this}function ya(Fb={}){var Ub=Fb.algorithm,qb=void 0===Ub?'matchToPrevious':Ub,Xb=Fb.ignoreBorder,Ob=void 0===Xb?[0,0]:Xb;this.checkProcessable('matchAndCrop',{bitDepth:[8,16]});var Gb=this[0],Hb=[];Hb[0]={position:[0,0],image:this[0]};for(var Wb=[0,0],Zb=1,Qb;Zb<this.length;Zb++)Qb=Gb.getBestMatch(this[Zb],{border:Ob}),Hb[Zb]={position:[Qb[0]+Wb[0],Qb[1]+Wb[1]],image:this[Zb]},'matchToPrevious'===qb&&(Wb[0]+=Qb[0],Wb[1]+=Qb[1],Gb=this[Zb]);for(var Kb=0,Jb=0,$b=0,e_=0,t_=0,a_;t_<Hb.length;t_++)a_=Hb[t_],a_.position[0]>Kb&&(Kb=a_.position[0]),a_.position[0]<Jb&&(Jb=a_.position[0]),a_.position[1]>$b&&($b=a_.position[1]),a_.position[1]<e_&&(e_=a_.position[1]);Jb=0-Jb,e_=0-e_;for(var i_=0,n_;i_<Hb.length;i_++)n_=Hb[i_],n_.crop=n_.image.crop({x:Kb-n_.position[0],y:$b-n_.position[1],width:Gb.width-Jb-Kb,height:Gb.height-e_-$b});for(var o_=[],s_=0;s_<Hb.length;s_++)o_[s_]=Hb[s_].crop;return new Uh(o_)}function ka(){this.checkProcessable('min',{bitDepth:[8,16]});for(var Fb=this[0].min,Ub=1;Ub<this.length;Ub++)for(var qb=0;qb<Fb.length;qb++)Fb[qb]=_Mathmin(Fb[qb],this[Ub].min[qb]);return Fb}function va(){this.checkProcessable('min',{bitDepth:[8,16]});for(var Fb=this[0].max,Ub=1;Ub<this.length;Ub++)for(var qb=0;qb<Fb.length;qb++)Fb[qb]=_Mathmax(Fb[qb],this[Ub].max[qb]);return Fb}function Da(Fb){var Ub=Fb.reduce((Gb,Hb)=>Gb+Hb);if(0===Ub)throw new Error('unreachable');for(var qb=0,Xb=0,Ob=Ub/2,Nb;;){if(0<Fb[qb]){if(void 0!=Nb)return(Nb+qb)/2;if(Xb+=Fb[qb],Xb>Ob)return qb;Xb===Ob&&(Nb=qb)}qb++}}function ja(Fb){for(var Ub=0,qb=0,Xb=0;Xb<Fb.length;Xb++)Ub+=Fb[Xb],qb+=Fb[Xb]*Xb;return 0===Ub?0:qb/Ub}function Ma(){this.checkProcessable('median',{bitDepth:[8,16]});for(var Fb=this.getHistograms({maxSlots:this[0].maxValue+1}),Ub=Array(Fb.length),qb=0,Xb;qb<Fb.length;qb++)Xb=Fb[qb],Ub[qb]=Da(Xb);return Ub}function Sa(Fb){this.checkProcessable('min',{bitDepth:[8,16]});for(var Ub=this[0].getHistogram(Fb),qb=1,Xb;qb<this.length;qb++){Xb=this[qb].getHistogram(Fb);for(var Ob=0;Ob<Ub.length;Ob++)Ub[Ob]+=Xb[Ob]}return Ub}function Ia(Fb){this.checkProcessable('min',{bitDepth:[8,16]});for(var Ub=this[0].getHistograms(Fb),qb=Ub[0].length,Xb=1,Ob;Xb<this.length;Xb++){Ob=this[Xb].getHistograms(Fb);for(var Nb=0;Nb<Ub.length;Nb++)for(var Gb=0;Gb<qb;Gb++)Ub[Nb][Gb]+=Ob[Nb][Gb]}return Ub}function Pa(){this.checkProcessable('average',{bitDepth:[8,16]});for(var Fb=new Uint32Array(this[0].data.length),Ub=0,qb;Ub<this.length;Ub++){qb=this[Ub];for(var Xb=0;Xb<this[0].data.length;Xb++)Fb[Xb]+=qb.data[Xb]}for(var Ob=Sb.createFrom(this[0]),Nb=Ob.data,Gb=0;Gb<this[0].data.length;Gb++)Nb[Gb]=Fb[Gb]/this.length;return Ob}function Ba(Fb={}){var Ub=Fb.preserveAlpha;if(this.checkProcessable('split',{bitDepth:[8,16]}),1===this.components)return new Uh([this.clone()]);var Xb=new Uh,Ob=this.data;if(this.alpha&&(void 0===Ub||Ub))for(var Nb=0;Nb<this.components;Nb++){for(var Gb=Sb.createFrom(this,{components:1,alpha:!0,colorModel:null}),Hb=0,Wb=0;Wb<Ob.length;Wb+=this.channels)Gb.data[Hb++]=Ob[Wb+Nb],Gb.data[Hb++]=Ob[Wb+this.components];Xb.push(Gb)}else for(var Zb=0;Zb<this.channels;Zb++){for(var Qb=Sb.createFrom(this,{components:1,alpha:!1,colorModel:null}),Kb=0,Jb=0;Jb<Ob.length;Jb+=this.channels)Qb.data[Kb++]=Ob[Jb+Zb];Xb.push(Qb)}return Xb}function Aa(Fb,Ub={}){var qb=Ub.keepAlpha,Xb=void 0!==qb&&qb,Ob=Ub.mergeAlpha,Nb=void 0!==Ob&&Ob;Xb&=this.alpha,Nb&=this.alpha,this.checkProcessable('getChannel',{bitDepth:[8,16]}),Fb=ae(this,Fb);for(var Gb=Sb.createFrom(this,{components:1,alpha:Xb,colorModel:null}),Hb=0,Wb=0;Wb<this.data.length;Wb+=this.channels)Nb?Gb.data[Hb++]=this.data[Wb+Fb]*this.data[Wb+this.components]/this.maxValue:(Gb.data[Hb++]=this.data[Wb+Fb],Xb&&(Gb.data[Hb++]=this.data[Wb+this.components]));return Gb}function Ra(Fb=za,Ub={}){var qb=Ub.mergeAlpha,Xb=void 0!==qb&&qb,Ob=Ub.keepAlpha,Nb=void 0!==Ob&&Ob;Xb&=this.alpha,Nb&=this.alpha,this.checkProcessable('combineChannels',{bitDepth:[8,16]});for(var Gb=Sb.createFrom(this,{components:1,alpha:Nb,colorModel:null}),Hb=0,Wb=0,Zb;Wb<this.size;Wb++)Zb=Fb(this.getPixel(Wb)),Xb?Gb.data[Hb++]=Zb*this.data[Wb*this.channels+this.components]/this.maxValue:(Gb.data[Hb++]=Zb,Nb&&(Gb.data[Hb++]=this.data[Wb*this.channels+this.components]));return Gb}function za(Fb){return(Fb[0]+Fb[1]+Fb[2])/3}function La(Fb,Ub){if(this.checkProcessable('setChannel',{bitDepth:[8,16]}),Ub.checkProcessable('setChannel (image parameter check)',{bitDepth:[this.bitDepth],alpha:[0],components:[1]}),Ub.width!==this.width||Ub.height!==this.height)throw new Error('Images must have exactly the same width and height');Fb=ae(this,Fb);for(var qb=Fb,Xb=0;Xb<Ub.data.length;Xb++)this.data[qb]=Ub.data[Xb],qb+=this.channels;return this}function Ea(Fb,Ub={}){var qb=Ub.shift,Xb=void 0===qb?[0,0]:qb,Ob=Ub.average,Nb=Ub.channels,Gb=Ub.defaultAlpha,Hb=Ub.normalize,Wb=Ub.border,Zb=void 0===Wb?[0,0]:Wb;if(this.checkProcessable('getSimilarity',{bitDepth:[8,16]}),Array.isArray(Zb)||(Zb=[Zb,Zb]),Nb=$(this,{channels:Nb,defaultAlpha:Gb}),this.bitDepth!==Fb.bitDepth)throw new Error('Both images must have the same bitDepth');if(this.channels!==Fb.channels)throw new Error('Both images must have the same number of channels');if(this.colorModel!==Fb.colorModel)throw new Error('Both images must have the same colorModel');'undefined'==typeof Ob&&(Ob=!0);for(var Qb=_Mathmax(Zb[0],-Xb[0]),Kb=_Mathmin(this.width-Zb[0],this.width-Xb[0]),Jb=_Mathmax(Zb[1],-Xb[1]),$b=_Mathmin(this.height-Zb[1],this.height-Xb[1]),e_=_l(Nb.length,0),t_=0;t_<Nb.length;t_++){var a_=Nb[t_],i_=Hb?this.sum[a_]:_Mathmax(this.sum[a_],Fb.sum[a_]),n_=Hb?Fb.sum[a_]:_Mathmax(this.sum[a_],Fb.sum[a_]);if(0!==i_&&0!==n_)for(var o_=Qb;o_<Kb;o_++)for(var s_=Jb;s_<$b;s_++){var r_=o_*this.multiplierX+s_*this.multiplierY+a_,l_=r_+Xb[0]*this.multiplierX+Xb[1]*this.multiplierY;e_[t_]+=_Mathmin(this.data[r_]/i_,Fb.data[l_]/n_)}}return Ob?e_.reduce((d_,h_)=>d_+h_)/e_.length:e_}function Ta(Fb={}){var Ub=Fb.sampling,qb=void 0===Ub?[10,10]:Ub,Xb=Fb.painted,Nb=Fb.mask;this.checkProcessable('getPixelsGrid',{bitDepth:[8,16],channels:1}),Array.isArray(qb)||(qb=[qb,qb]);for(var Gb=qb[0],Hb=qb[1],Wb=Gb*Hb,Zb=Array(Wb),Qb=Array(Wb),Kb=this.width/Gb,Jb=this.height/Hb,$b=_Mathfloor(Kb/2),e_=0,t_=0,a_;t_<Gb;t_++){a_=_Mathfloor(Jb/2);for(var i_=0;i_<Hb;i_++){var n_=_Mathround($b),o_=_Mathround(a_);(!Nb||Nb.getBitXY(n_,o_))&&(Zb[e_]=[n_,o_],Qb[e_]=this.getPixelXY(n_,o_),e_++),a_+=Jb}$b+=Kb}Zb.length=e_,Qb.length=e_;var s_={xyS:Zb,zS:Qb};return void 0!==Xb&&Xb&&(s_.painted=this.rgba8().paintPoints(Zb)),s_}function Va(Fb,Ub,qb){for(var Xb=Array(Fb),Ob=0;Ob<Fb;Ob++)Xb[Ob]=Array(Ub);if(qb)for(var Nb=0;Nb<Fb;Nb++)for(var Gb=0;Gb<Ub;Gb++)Xb[Nb][Gb]=qb;return Xb.width=Fb,Xb.height=Ub,Xb.__proto__=Va.prototype,Xb}function Ya(Fb,Ub={}){var qb=Ub.border;if(this.checkProcessable('getChannel',{bitDepth:[8,16]}),this.bitDepth!==Fb.bitDepth)throw new Error('Both images must have the same bitDepth');if(this.channels!==Fb.channels)throw new Error('Both images must have the same number of channels');if(this.colorModel!==Fb.colorModel)throw new Error('Both images must have the same colorModel');for(var Xb=new Va(Fb.width,Fb.height,-Infinity),Ob=_Mathfloor(Fb.width/2),Nb=_Mathfloor(Fb.height/2),Gb=Ob,Hb=Nb,Wb=!1,Zb;!Wb;){Zb=Xb.localSearch(Ob,Nb,-Infinity);for(var Qb=0;Qb<Zb.length;Qb++){var Kb=Zb[Qb],Jb=this.getSimilarity(Fb,{border:qb,shift:[Gb-Kb[0],Hb-Kb[1]]});Xb[Kb[0]][Kb[1]]=Jb}var $b=Xb.localMax(Ob,Nb);$b.position[0]!==Ob||$b.position[1]!==Nb?(Ob=$b.position[0],Nb=$b.position[1]):Wb=!0}return[Ob-Gb,Nb-Hb]}function Fa(Fb,Ub=0){this.checkProcessable('getRow',{bitDepth:[8,16]}),this.checkRow(Fb),this.checkChannel(Ub);for(var qb=Array(this.width),Xb=0,Ob=Fb*this.width*this.channels+Ub,Nb=Ob+this.width*this.channels,Gb=Ob;Gb<Nb;Gb+=this.channels)qb[Xb++]=this.data[Gb];return qb}function Ua(Fb,Ub=0){this.checkProcessable('getColumn',{bitDepth:[8,16]}),this.checkColumn(Fb),this.checkChannel(Ub);for(var qb=Array(this.height),Xb=0,Ob=this.width*this.channels,Nb=Ub+Fb*this.channels;Nb<this.data.length;Nb+=Ob)qb[Xb++]=this.data[Nb];return qb}function qa(Fb={}){var Ub=Fb.channel;if(this.checkProcessable('getMatrix',{bitDepth:[8,16]}),void 0===Ub){if(1<this.components)throw new RangeError('You need to define the channel for an image that contains more than one channel');Ub=0}for(var qb=new $l(this.height,this.width),Xb=0;Xb<this.height;Xb++)for(var Ob=0;Ob<this.width;Ob++)qb.set(Xb,Ob,this.getValueXY(Ob,Xb,Ub));return qb}function Xa(Fb,Ub={}){var qb=Ub.channel;if(this.checkProcessable('getMatrix',{bitDepth:[8,16]}),void 0===qb){if(1<this.components)throw new RangeError('You need to define the channel for an image that contains more than one channel');qb=0}if(!Fb.length||!Fb[0].length||this.width!==Fb.columns||this.height!==Fb.rows)throw new RangeError('The size of the matrix must be equal to the size of the image');for(var Xb=0;Xb<this.height;Xb++)for(var Ob=0;Ob<this.width;Ob++)this.setValueXY(Ob,Xb,qb,Fb.get(Xb,Ob))}function Oa(){this.checkProcessable('getPixelsArray',{bitDepth:[8,16,32]});for(var Fb=Array(this.size),Ub=0,qb=0,Xb;qb<this.data.length;qb+=this.channels){Xb=Array(this.components);for(var Ob=0;Ob<this.components;Ob++)Xb[Ob]=this.data[qb+Ob];Fb[Ub++]=Xb}return Fb}function Na(Fb){for(var Ub=this,qb=Ub.getClosestCommonParent(Fb),Xb=Ub.getRelativePosition(qb,{defaultFurther:!0}),Ob=Ga(Ub,Xb),Nb=Fb.getRelativePosition(qb,{defaultFurther:!0}),Gb=Ga(Fb,Nb),Hb=Ha(Ob,Gb),Wb={whitePixelsMask1:[],whitePixelsMask2:[],commonWhitePixels:[]},Zb=0;Zb<Hb.length;Zb++){var Qb=Hb[Zb],Kb=[Qb[0]-Xb[0],Qb[1]-Xb[1]],Jb=[Qb[0]-Nb[0],Qb[1]-Nb[1]],$b=Ub.getBitXY(Kb[0],Kb[1]),e_=Fb.getBitXY(Jb[0],Jb[1]);1===$b&&1===e_&&Wb.commonWhitePixels.push(Qb)}for(var t_=0;t_<Ob.length;t_++){var a_=void 0,i_=void 0;0!==t_&&(a_=_Mathfloor(t_/(Ub.width-1)),i_=t_%(Ub.width-1)),1===Ub.getBitXY(a_,i_)&&Wb.whitePixelsMask1.push(Ob[t_])}for(var n_=0;n_<Gb.length;n_++){var o_=0,s_=0;0!==n_&&(o_=_Mathfloor(n_/(Fb.width-1)),s_=n_%(Fb.width-1)),1===Fb.getBitXY(o_,s_)&&Wb.whitePixelsMask2.push(Gb[n_])}return Wb}function Ga(Fb,Ub){for(var qb=[],Xb=0;Xb<Fb.height;Xb++)for(var Ob=0,Nb;Ob<Fb.width;Ob++)Nb=[Xb,Ob],qb.push([Nb[0]+Ub[0],Nb[1]+Ub[1]]);return qb}function Ha(Fb,Ub){for(var qb=0,Xb=0,Ob=[];qb<Fb.length&&Xb<Ub.length;)Fb[qb][0]===Ub[Xb][0]&&Fb[qb][1]===Ub[Xb][1]?(Ob.push(Fb[qb]),qb++,Xb++):Fb[qb][0]<Ub[Xb][0]||Fb[qb][0]===Ub[Xb][0]&&Fb[qb][1]<Ub[Xb][1]?qb++:Xb++;return Ob}function Wa(Fb){var Ub=Za(this),qb=Za(Fb),Xb;if(Xb=Ub>=qb?Qa(this,Ub):Qa(Fb,qb),0===Ub||0===qb)return Xb;for(var Ob=this,Nb=Fb;Ub!==qb;)if(Ub>qb){if(Ob=Ob.parent,void 0===Ob)return Xb;--Ub}else{if(Nb=Nb.parent,void 0===Nb)return Xb;--qb}for(;Ob!==Nb&&void 0!==typeof Ob&&void 0!==typeof Nb;)if(Ob=Ob.parent,Nb=Nb.parent,void 0===Ob||void 0===Nb)return Xb;return Ob===Nb?Ob:Xb}function Za(Fb){for(var Ub=0,qb=Fb;null!=qb.parent;)qb=qb.parent,Ub++;return Ub}function Qa(Fb,Ub){for(var qb=Fb;0<Ub;)qb=qb.parent,--Ub;return qb}function Ja(Fb){var Ub=$h[Fb.toLowerCase()];return Ub?{r:Ub[0],g:Ub[1],b:Ub[2],a:100}:void 0}function $a(Fb){if(0==Fb.indexOf('rgb(')){Fb=Fb.match(/rgb\(([^)]+)\)/)[1];var Ub=Fb.split(/ *, */).map(Number);return{r:Ub[0],g:Ub[1],b:Ub[2],a:100}}}function ei(Fb){if(0===Fb.indexOf('rgba(')){Fb=Fb.match(/rgba\(([^)]+)\)/)[1];var Ub=Fb.split(/ *, */).map(Number);return{r:Ub[0],g:Ub[1],b:Ub[2],a:100*Ub[3]}}}function ti(Fb){if('#'===Fb[0]&&7===Fb.length)return{r:parseInt(Fb.slice(1,3),16),g:parseInt(Fb.slice(3,5),16),b:parseInt(Fb.slice(5,7),16),a:100}}function ai(Fb){if('#'===Fb[0]&&4===Fb.length)return{r:parseInt(Fb[1]+Fb[1],16),g:parseInt(Fb[2]+Fb[2],16),b:parseInt(Fb[3]+Fb[3],16),a:100}}function ni(Fb){if(0===Fb.indexOf('hsl(')){Fb=Fb.match(/hsl\(([^)]+)\)/)[1];var Ub=Fb.split(/ *, */),qb=parseInt(Ub[0],10),Xb=parseInt(Ub[1],10),Ob=parseInt(Ub[2],10),Nb=Jh(qb,Xb,Ob);return Nb.a=100,Nb}}function oi(Fb){if(0===Fb.indexOf('hsla(')){Fb=Fb.match(/hsla\(([^)]+)\)/)[1];var Ub=Fb.split(/ *, */),qb=parseInt(Ub[0],10),Xb=parseInt(Ub[1],10),Ob=parseInt(Ub[2],10),Nb=parseInt(100*Ub[3],10),Gb=Jh(qb,Xb,Ob);return Gb.a=Nb,Gb}}function si(Fb){var Ub=am(Fb);return[Ub.r,Ub.g,Ub.b,_Mathround(255*Ub.a/100)]}function ri(Fb,Ub,qb){return 0>qb&&(qb+=1),1<qb&&(qb-=1),qb<1/6?Fb+6*(Ub-Fb)*qb:qb<1/2?Ub:qb<2/3?Fb+6*((Ub-Fb)*(2/3-qb)):Fb}function di(Fb,Ub,qb){var Xb,Ob,Nb,Gb,Hb,Wb;return Ub/=100,qb/=100,0===Ub?Gb=Hb=Wb=255*qb:(Ob=0.5>=qb?qb*(Ub+1):qb+Ub-qb*Ub,Xb=2*qb-Ob,Nb=Fb/360,Gb=ri(Xb,Ob,Nb+1/3),Hb=ri(Xb,Ob,Nb),Wb=ri(Xb,Ob,Nb-1/3)),{r:Gb,g:Hb,b:Wb}}function hi(Fb){for(var Ub=Array(Fb),qb=0,Xb=0;360>Xb;Xb+=360/Fb){qb++;var Ob=di(Xb,100,30+15*(qb%4));Ub[qb-1]=[_Mathround(255*Ob.r),_Mathround(255*Ob.g),_Mathround(255*Ob.b)]}return Ub}function mi(){return[_Mathfloor(256*Math.random()),_Mathfloor(256*Math.random()),_Mathfloor(256*Math.random())]}function ci(Fb,Ub={}){var qb=Ub.color,Xb=void 0===qb?'red':qb,Ob=Ub.colors,Nb=Ub.alpha,Gb=void 0===Nb?255:Nb,Hb=Ub.randomColors,Zb=Ub.distinctColors,Kb=Ub.labels,Jb=void 0===Kb?[]:Kb,$b=Ub.labelsPosition,e_=void 0===$b?[]:$b,t_=Ub.labelColor,a_=void 0===t_?'blue':t_,i_=Ub.labelFont,n_=void 0===i_?'12px Helvetica':i_;this.checkProcessable('paintMasks',{channels:[3,4],bitDepth:[8,16],colorModel:Yr}),Xb&&!Array.isArray(Xb)&&(Xb=si(Xb)),Ob&&(Ob=Ob.map(function(p_){return Array.isArray(p_)?p_:si(p_)})),Array.isArray(Fb)||(Fb=[Fb]),void 0!==Zb&&Zb&&(Ob=hi(Fb.length));for(var o_=0,s_;o_<Fb.length;o_++){s_=Fb[o_],Ob?Xb=Ob[o_%Ob.length]:void 0!==Hb&&Hb&&(Xb=mi());for(var r_=0;r_<s_.width;r_++)for(var l_=0;l_<s_.height;l_++)if(s_.getBitXY(r_,l_))for(var d_=0;d_<_Mathmin(this.components,Xb.length);d_++)if(255===Gb)this.setValueXY(r_+s_.position[0],l_+s_.position[1],d_,Xb[d_]);else{var h_=this.getValueXY(r_+s_.position[0],l_+s_.position[1],d_);h_=_Mathround((h_*(255-Gb)+Xb[d_]*Gb)/255),this.setValueXY(r_+s_.position[0],l_+s_.position[1],d_,h_)}}if(Array.isArray(Jb)&&0<Jb.length){var m_=this.getCanvas({originalData:!0}),c_=m_.getContext('2d');c_.fillStyle=a_,c_.font=n_;for(var g_=0,u_;g_<_Mathmin(Fb.length,Jb.length);g_++)u_=e_[g_]?e_[g_]:Fb[g_].position,c_.fillText(Jb[g_],u_[0],u_[1]);this.setData(c_.getImageData(0,0,this.width,this.height).data)}return this}function gi(Fb,Ub,qb={}){var Xb=qb.color,Ob=void 0===Xb?'blue':Xb,Nb=qb.colors,Gb=qb.font,Hb=void 0===Gb?'12px Helvetica':Gb,Wb=qb.rotate,Zb=void 0===Wb?0:Wb;if(this.checkProcessable('paintMasks',{channels:[3,4],bitDepth:[8,16],colorModel:Yr}),!Array.isArray(Fb))throw Error('paintLabels: labels must be an array');if(!Array.isArray(Ub))throw Error('paintLabels: positions must be an array');if(Ob&&!Array.isArray(Ob)&&(Ob=si(Ob)),Nb=Nb?Nb.map(function(t_){return Array.isArray(t_)?t_:si(t_)}):[Ob],Fb.length!==Ub.length)throw Error('paintLabels: positions and labels must be arrays from the same size');Array.isArray(Hb)||(Hb=[Hb]),Array.isArray(Zb)||(Zb=[Zb]);for(var Qb=this.getCanvas({originalData:!0}),Kb=Qb.getContext('2d'),Jb=0;Jb<Fb.length;Jb++){Kb.save();var $b=Nb[Jb%Nb.length];Kb.fillStyle=`rgba(${$b[0]},${$b[1]},${$b[2]},${$b[3]/this.maxValue})`,Kb.font=Hb[Jb%Hb.length];var e_=Ub[Jb];Kb.translate(e_[0],e_[1]),Kb.rotate(Zb[Jb%Zb.length]/180*_MathPI),Kb.fillText(Fb[Jb],0,0),Kb.restore()}return this.setData(Kb.getImageData(0,0,this.width,this.height).data),this}function ui(Fb,Ub,qb){var Xb=$l.zeros(Ub,Fb);if(qb.filled)for(var Ob=0;Ob<Ub;Ob++)for(var Nb=0;Nb<Fb;Nb++)Xb.set(Ob,Nb,1);else{for(var Gb of[0,Ub-1])for(var Hb=0;Hb<Fb;Hb++)Xb.set(Gb,Hb,1);for(var Wb=0;Wb<Ub;Wb++)for(var Zb of[0,Fb-1])Xb.set(Wb,Zb,1)}return Xb}function pi(Fb,Ub,qb){var Xb=$l.zeros(Ub,Fb,qb),Ob=1-Ub%2,Nb=1-Fb%2,Gb=_Mathfloor((Fb-1)/2),Hb=_Mathfloor((Ub-1)/2),Wb=Gb*Gb,Zb=Hb*Hb;if(qb.filled)for(var Qb=0,Kb;Qb<=Hb;Qb++){Kb=_Mathfloor(_Mathsqrt(Wb-Wb*Qb*Qb/Zb));for(var Jb=Gb-Kb;Jb<=Gb;Jb++)Xb.set(Hb-Qb,Jb,1),Xb.set(Hb+Qb+Ob,Jb,1),Xb.set(Hb-Qb,Fb-Jb-1,1),Xb.set(Hb+Qb+Ob,Fb-Jb-1,1)}else{for(var $b=0;$b<=Hb;$b++){var e_=_Mathfloor(_Mathsqrt(Wb-Wb*$b*$b/Zb)),t_=Gb-e_;Xb.set(Hb-$b,t_,1),Xb.set(Hb+$b+Ob,t_,1),Xb.set(Hb-$b,Fb-t_-1,1),Xb.set(Hb+$b+Ob,Fb-t_-1,1)}for(var a_=0;a_<=Gb;a_++){var i_=_Mathfloor(_Mathsqrt(Zb-Zb*a_*a_/Wb)),n_=Hb-i_;Xb.set(n_,Gb-a_,1),Xb.set(n_,Gb+a_+Nb,1),Xb.set(Ub-n_-1,Gb-a_,1),Xb.set(Ub-n_-1,Gb+a_+Nb,1)}}return Xb}function fi(Fb,Ub,qb){if(!qb.filled)throw new Error('Non filled triangle is not implemented');for(var Xb=$l.zeros(Ub,Fb,qb),Ob=0,Nb;Ob<Ub;Ob++){Nb=_Mathfloor((1-Ob/Ub)*Fb/2);for(var Gb=Nb;Gb<Fb-Nb;Gb++)Xb.set(Ob,Gb,1)}return Xb}function bi(Fb,Ub={}){var qb=Ub.color,Xb=void 0===qb?[this.maxValue,0,0]:qb,Ob=Ub.shape;this.checkProcessable('paintPoints',{bitDepth:[8,16]});for(var Nb=new sm(Ob).getPoints(),Gb=_Mathmin(this.channels,Xb.length),Hb=0;Hb<Fb.length;Hb++)for(var Wb=Fb[Hb][0],Zb=Fb[Hb][1],Qb=0;Qb<Nb.length;Qb++){var Kb=Nb[Qb][0],Jb=Nb[Qb][1];if(0<=Wb+Kb&&0<=Zb+Jb&&Wb+Kb<this.width&&Zb+Jb<this.height)for(var $b=(Wb+Kb+(Zb+Jb)*this.width)*this.channels,e_=0;e_<Gb;e_++)this.data[$b+e_]=Xb[e_]}return this}function ki(Fb,Ub={}){var qb=Ub.color,Xb=void 0===qb?[this.maxValue,0,0]:qb;this.checkProcessable('paintPoints',{bitDepth:[8,16]});for(var Ob=_Mathmin(this.channels,Xb.length),Nb=0;Nb<Fb.length;Nb++)for(var Gb=Fb[Nb],Hb=Fb[(Nb+1)%Fb.length],Wb=Hb[0]-Gb[0],Zb=Hb[1]-Gb[1],Qb=_Mathmax(_Mathabs(Wb),_Mathabs(Zb)),$b=Gb[0],e_=Gb[1],t_=0;t_<=Qb;t_++){var a_=_Mathround($b),i_=_Mathround(e_);if(0<=a_&&0<=i_&&a_<this.width&&i_<this.height)for(var n_=(a_+i_*this.width)*this.channels,o_=0;o_<Ob;o_++)this.data[n_+o_]=Xb[o_];$b+=Wb/Qb,e_+=Zb/Qb}return this}function Di(Fb,Ub={}){var qb=Ub.position;if(this.checkProcessable('extract',{bitDepth:[1,8,16]}),!qb&&(qb=Fb.getRelativePosition(this),!qb))throw new Error('extract : can not extract an image because the relative position can not be determined, try to specify manually the position as an array of 2 elements [x,y].');if(1<this.bitDepth){for(var Xb=Sb.createFrom(this,{width:Fb.width,height:Fb.height,alpha:1,position:qb,parent:this}),Ob=0;Ob<Fb.width;Ob++)for(var Nb=0;Nb<Fb.height;Nb++){for(var Gb=0,Hb;Gb<this.channels;Gb++)Hb=this.getValueXY(Ob+qb[0],Nb+qb[1],Gb),Xb.setValueXY(Ob,Nb,Gb,Hb);Fb.getBitXY(Ob,Nb)||Xb.setValueXY(Ob,Nb,this.components,0)}return Xb}for(var Wb=Sb.createFrom(this,{width:Fb.width,height:Fb.height,position:qb,parent:this}),Zb=0;Zb<Fb.height;Zb++)for(var Qb=0;Qb<Fb.width;Qb++)Fb.getBitXY(Qb,Zb)&&this.getBitXY(Qb+qb[0],Zb+qb[1])&&Wb.setBitXY(Qb,Zb);return Wb}function ji(Fb={}){var Ub=Fb.x,qb=void 0===Ub?0:Ub,Xb=Fb.y,Ob=void 0===Xb?0:Xb,Nb=Fb.inPlace,Hb=void 0===Nb||Nb?this:Sb.createFrom(this);if(this.checkProcessable('floodFill',{bitDepth:1}),1===this.bitDepth){var Wb=this.getBitXY(qb,Ob);if(Wb)return Hb;var Zb=new lm;for(Zb.push(new Mi(qb,Ob));0<Zb.length;){var Qb=Zb.shift();Hb.setBitXY(Qb.x,Qb.y);for(var Kb=Qb.x+1;Kb<this.width&&!Hb.getBitXY(Kb,Qb.y)&&!this.getBitXY(Kb,Qb.y);Kb++)Hb.setBitXY(Kb,Qb.y),Qb.y+1<this.height&&!this.getBitXY(Kb,Qb.y+1)&&Zb.push(new Mi(Kb,Qb.y+1)),0<=Qb.y-1&&!this.getBitXY(Kb,Qb.y-1)&&Zb.push(new Mi(Kb,Qb.y-1));for(var Jb=Qb.x-1;0<=Jb&&!Hb.getBitXY(Jb,Qb.y)&&!this.getBitXY(Jb,Qb.y);Jb++)Hb.setBitXY(Jb,Qb.y),Qb.y+1<this.height&&!this.getBitXY(Jb,Qb.y+1)&&Zb.push(new Mi(Jb,Qb.y+1)),0<=Qb.y-1&&!this.getBitXY(Jb,Qb.y-1)&&Zb.push(new Mi(Jb,Qb.y-1))}}return Hb}function Mi(Fb,Ub){this.x=Fb,this.y=Ub}function Si(Fb={}){var Ub=Fb.maxSlots,qb=void 0===Ub?256:Ub,Xb=Fb.channel,Ob=Fb.useAlpha;if(this.checkProcessable('getHistogram',{bitDepth:[1,8,16]}),void 0===Xb){if(1<this.components)throw new RangeError('You need to define the channel for an image that contains more than one channel');Xb=0}return Pi.call(this,Xb,{useAlpha:void 0===Ob||Ob,maxSlots:qb})}function Ii(Fb={}){var Ub=Fb.maxSlots,qb=void 0===Ub?256:Ub,Xb=Fb.useAlpha,Ob=void 0===Xb||Xb;this.checkProcessable('getHistograms',{bitDepth:[8,16]});for(var Nb=Array(Ob?this.components:this.channels),Gb=0;Gb<Nb.length;Gb++)Nb[Gb]=Pi.call(this,Gb,{useAlpha:Ob,maxSlots:qb});return Nb}function Pi(Fb,Ub){var qb=Ub.useAlpha,Xb=Ub.maxSlots;if(1===this.bitDepth){for(var Ob=[0,0],Nb=0;Nb<this.height;Nb++)for(var Gb=0,Hb;Gb<this.width;Gb++)Hb=this.getBitXY(Nb,Gb),0===Hb?Ob[0]+=1:1===Hb&&(Ob[1]+=1);return Ob}var Wb=Math.log2(Xb);if(!ml(Wb))throw new RangeError('maxSlots must be a power of 2, for example: 64, 256, 1024');var Zb=0;this.bitDepth>Wb&&(Zb=this.bitDepth-Wb);var Qb=this.data,Kb=_l(_Mathpow(2,_Mathmin(this.bitDepth,Wb)),0);if(qb&&this.alpha)for(var Jb=this.channels-Fb-1,$b=Fb;$b<Qb.length;$b+=this.channels)Kb[Qb[$b]>>Zb]+=Qb[$b+Jb]/this.maxValue;else for(var e_=Fb;e_<Qb.length;e_+=this.channels)Kb[Qb[e_]>>Zb]++;return Kb}function Ci(Fb={}){var Ub=Fb.useAlpha,Xb=Fb.nbSlots,Ob=void 0===Xb?512:Xb;this.checkProcessable('getColorHistogram',{bitDepth:[8,16],components:[3]});var Nb=_Mathlog(Ob)/2.0794415416798357;if(Nb!==_Mathfloor(Nb))throw new RangeError('nbSlots must be a power of 8. Usually 8, 64, 512 or 4096');for(var Gb=this.bitDepth-Nb,Hb=this.data,Wb=_l(_Mathpow(8,Nb),0),Zb=_Mathpow(2,2*Nb),Qb=_Mathpow(2,Nb),Kb=0,Jb;Kb<Hb.length;Kb+=this.channels)Jb=(Hb[Kb]>>Gb)*Zb+(Hb[Kb+1]>>Gb)*Qb+(Hb[Kb+2]>>Gb),(void 0===Ub||Ub)&&this.alpha?Wb[Jb]+=Hb[Kb+this.channels-1]/this.maxValue:Wb[Jb]++;return Wb}function Bi(){this.checkProcessable('min',{bitDepth:[8,16]});for(var Fb=_l(this.channels,+Infinity),Ub=0;Ub<this.data.length;Ub+=this.channels)for(var qb=0;qb<this.channels;qb++)this.data[Ub+qb]<Fb[qb]&&(Fb[qb]=this.data[Ub+qb]);return Fb}function Ai(){this.checkProcessable('max',{bitDepth:[8,16]});for(var Fb=_l(this.channels,-Infinity),Ub=0;Ub<this.data.length;Ub+=this.channels)for(var qb=0;qb<this.channels;qb++)this.data[Ub+qb]>Fb[qb]&&(Fb[qb]=this.data[Ub+qb]);return Fb}function Ri(){this.checkProcessable('sum',{bitDepth:[8,16]});for(var Fb=_l(this.channels,0),Ub=0;Ub<this.data.length;Ub+=this.channels)for(var qb=0;qb<this.channels;qb++)Fb[qb]+=this.data[Ub+qb];return Fb}function zi(Fb=0,Ub=0){this.checkProcessable('getMoment',{bitDepth:[1]});for(var qb=0,Xb=0;Xb<this.width;Xb++)for(var Ob=0;Ob<this.height;Ob++)1===this.getBitXY(Xb,Ob)&&(qb+=_Mathpow(Xb,Fb)*_Mathpow(Ob,Ub));return qb}function Li(Fb={}){var Ub=Fb.mask,qb=Fb.region,Xb=void 0===qb?3:qb,Ob=Fb.removeClosePoints,Nb=void 0===Ob?0:Ob,Gb=Fb.invert,Hb=void 0!==Gb&&Gb,Wb=Fb.maxEquals,Zb=void 0===Wb?2:Wb,Qb=this;this.checkProcessable('localMaxima',{bitDepth:[8,16],components:1}),Xb*=4;for(var Kb=Hb?0:1,Jb=[1,0,-1,0,1,1,-1,-1,2,0,-2,0,2,2,-2,-2],$b=[0,1,0,-1,1,-1,1,-1,0,2,0,-2,2,-2,2,-2],e_=8>=Xb?1:2,t_=[],a_=e_;a_<Qb.height-e_;a_++)for(var i_=e_;i_<Qb.width-e_;i_++)if(!(Ub&&Ub.getBitXY(i_,a_)!==Kb)){for(var n_=0,o_=0,s_=Qb.data[i_+a_*Qb.width],r_=0;r_<Xb;r_++)Hb?Qb.data[i_+Jb[r_]+(a_+$b[r_])*Qb.width]>s_&&n_++:Qb.data[i_+Jb[r_]+(a_+$b[r_])*Qb.width]<s_&&n_++,Qb.data[i_+Jb[r_]+(a_+$b[r_])*Qb.width]===s_&&o_++;n_+o_===Xb&&o_<=Zb&&t_.push([i_,a_])}if(0<Nb)for(var l_=0;l_<t_.length;l_++)for(var d_=l_+1;d_<t_.length;d_++)_Mathsqrt(_Mathpow(t_[l_][0]-t_[d_][0],2)+_Mathpow(t_[l_][1]-t_[d_][1],2))<Nb&&(t_[l_][0]=t_[l_][0]+t_[d_][0]>>1,t_[l_][1]=t_[l_][1]+t_[d_][1]>>1,t_.splice(d_,1),d_--);return t_}function Ei(){for(var Fb=this.getHistograms({maxSlots:this.maxValue+1}),Ub=Array(Fb.length),qb=0,Xb;qb<Fb.length;qb++)Xb=Fb[qb],Ub[qb]=ja(Xb);return Ub}function Ti(){for(var Fb=this.getHistograms({maxSlots:this.maxValue+1}),Ub=Array(Fb.length),qb=0,Xb;qb<Fb.length;qb++)Xb=Fb[qb],Ub[qb]=Da(Xb);return Ub}function Vi(){this.checkProcessable('points',{bitDepth:[1]});for(var Fb=Array(this.size),Ub=0,qb=0;qb<this.width;qb++)for(var Xb=0;Xb<this.height;Xb++)1===this.getBitXY(qb,Xb)&&(Fb[Ub++]=[qb,Xb]);return Fb.length=Ub,Fb}function Yi(Fb,Ub={}){if(this===Fb)return[0,0];for(var qb=[0,0],Xb=this;Xb;){if(Xb===Fb)return qb;Xb.position&&(qb[0]+=Xb.position[0],qb[1]+=Xb.position[1]),Xb=Xb.parent}return!!Ub.defaultFurther&&qb}function Fi(){return this.checkProcessable('getSvd',{bitDepth:[1]}),Ee(this.points)}function Ui(Fb={}){var Ub=Fb.alpha,qb=void 0===Ub?1:Ub;this.checkProcessable('countAlphaPixels',{bitDepth:[8,16],alpha:1});var Xb=0;if(void 0!==qb){for(var Ob=this.components;Ob<this.data.length;Ob+=this.channels)this.data[Ob]===qb&&Xb++;return Xb}return this.size}function qi(Fb,Ub={}){Ub.sorted||Fb.sort(Oi);const qb=Fb.length,Xb=Array(2*qb);for(var Ob=0,Nb=0;Nb<qb;Nb++){const Hb=Fb[Nb];for(;2<=Ob&&0>=Xi(Xb[Ob-2],Xb[Ob-1],Hb);)Ob--;Xb[Ob++]=Hb}const Gb=Ob+1;for(Nb=qb-2;0<=Nb;Nb--){const Hb=Fb[Nb];for(;Ob>=Gb&&0>=Xi(Xb[Ob-2],Xb[Ob-1],Hb);)Ob--;Xb[Ob++]=Hb}return Xb.slice(0,Ob-1)}function Xi(Fb,Ub,qb){return(Ub[1]-Fb[1])*(qb[0]-Fb[0])-(Ub[0]-Fb[0])*(qb[1]-Fb[1])}function Oi(Fb,Ub){return Fb[0]===Ub[0]?Fb[1]-Ub[1]:Fb[0]-Ub[0]}function Ni(){var Fb=this;Fb.checkProcessable('monotoneChainConvexHull',{bitDepth:1});var Ub=Fb.getPoints();return qi(Ub,{sorted:!0})}function Gi(Fb,Ub){return[Fb[0]-Ub[0],Fb[1]-Ub[1]]}function Hi(Fb){var Ub=_Mathsqrt(_Mathpow(Fb[0],2)+_Mathpow(Fb[1],2));return[Fb[0]/Ub,Fb[1]/Ub]}function Wi(Fb,Ub,qb){void 0===qb&&(qb=Array(Ub.length));for(var Xb=_Mathcos(Fb),Ob=_Mathsin(Fb),Nb=0;Nb<qb.length;++Nb)qb[Nb]=[Xb*Ub[Nb][0]-Ob*Ub[Nb][1],Ob*Ub[Nb][0]+Xb*Ub[Nb][1]];return qb}function Zi(Fb={}){for(var Ub=Fb.originalPoints,qb=void 0===Ub?Ni.call(this):Ub,Xb=Array(qb.length),Ob=+Infinity,Nb=0,Gb=void 0,Hb=0,Wb;Hb<Xb.length;Hb++){Wb=Qi(qb[Hb],qb[(Hb+1)%Xb.length]),Wi(-Wb,qb,Xb);for(var Zb=Xb[Hb][0],Qb=Xb[Hb][1],Kb=Xb[(Hb+1)%Xb.length][0],Jb=Xb[(Hb+1)%Xb.length][1],$b=!0,e_=0,t_=0,a_=0,i_=0;i_<Xb.length;i_++){var n_=Xb[i_][0],o_=Xb[i_][1],s_=(n_-Zb)/(Kb-Zb);!0==$b?($b=!1,e_=s_,t_=s_):(s_<e_&&(e_=s_),s_>t_&&(t_=s_));var r_=(-(Kb-Zb)*o_+Kb*Qb-Jb*Zb)/(Kb-Zb);_Mathabs(r_)>_Mathabs(a_)&&(a_=r_)}var l_=[Zb+e_*(Kb-Zb),Qb],d_=[Zb+t_*(Kb-Zb),Qb],h_=_Mathabs(a_*(e_-t_)*(Kb-Zb));h_<Ob&&(Nb=Wb,Ob=h_,Gb=[l_,d_,[d_[0],d_[1]-a_],[l_[0],l_[1]-a_]])}return Wi(Nb,Gb,Gb),Gb}function Qi(Fb,Ub){var qb=Gi(Ub,Fb),Xb=Hi(qb),Ob=Math.acos(Xb[0]);return 0>Xb[1]?-Ob:Ob}function Ji(Fb){for(var Ub=Fb.data,qb=[1,0,-1,0],Xb=[0,1,0,-1],Ob=Fb.minMax,Nb=-Ob.min,Gb=Ob.max+Nb,Hb=[],Wb=0;Wb<=Gb;Wb++)Hb.push(Object.create(null));for(var Zb=0;Zb<Fb.width;Zb++)for(var Qb=0;Qb<Fb.height;Qb++){var Kb=Zb+Qb*Fb.width,Jb=Ub[Kb];if(0!==Jb){for(var $b=Object.create(null),e_=!1,t_=0;4>t_;t_++){var a_=Zb+qb[t_],i_=Qb+Xb[t_];if(0<=a_&&0<=i_&&a_<Fb.width&&i_<Fb.height){var n_=Ub[a_+i_*Fb.width];Jb!==n_&&(e_=!0,0!==n_&&void 0===$b[n_]&&($b[n_]=!0,Hb[n_+Nb][Jb]?Hb[n_+Nb][Jb]++:Hb[n_+Nb][Jb]=1))}else e_=!0}e_&&(Hb[Jb+Nb][Jb]?Hb[Jb+Nb][Jb]++:Hb[Jb+Nb][Jb]=1)}}for(var o_={},s_=0;s_<Hb.length;s_++)0<Object.keys(Hb[s_]).length&&(o_[s_-Nb]=Hb[s_]);return o_}function $i(Fb={}){var Ub=Fb.algorithm,qb=void 0===Ub?'commonBorderLength':Ub,Xb=Fb.minCommonBorderLength,Ob=void 0===Xb?5:Xb,Nb=Fb.maxCommonBorderLength,Gb=void 0===Nb?100:Nb,Hb=Fb.minCommonBorderRatio,Wb=void 0===Hb?0.3:Hb,Zb=Fb.maxCommonBorderRatio,Qb=void 0===Zb?1:Zb,Kb=function(k_,v_,D_){return k_[D_]>=Ob&&k_[D_]<=Gb};'function'==typeof qb&&(Kb=qb),'commonborderratio'===qb.toLowerCase()&&(Kb=function(k_,v_,D_){var j_=_Mathmin(k_[D_]/k_[v_],1);return j_>=Wb&&j_<=Qb});var Jb=this,$b=Jb.commonBorderLength,e_={},t_={};for(var a_ of Object.keys($b)){var i_=$b[a_],n_=Object.keys(i_);for(var o_ of n_)if(o_!==a_&&Kb(i_,a_,o_)){var s_=o_;t_[o_]&&(s_=t_[o_]);var r_=a_;if(t_[a_]&&(r_=t_[a_]),+s_!==r_){var l_=_Mathmin(s_,r_),d_=_Mathmax(s_,r_);if(e_[l_]||(e_[l_]={}),e_[l_][d_]=!0,t_[d_]=l_,e_[d_]){for(var h_ of Object.keys(e_[d_]))e_[l_][h_]=!0,t_[h_]=l_;delete e_[d_]}}}}var m_=Jb.minMax,c_=-m_.min,g_=m_.max+c_,u_=Array(g_+1).fill(0);for(var p_ of Object.keys(t_))u_[+p_+c_]=t_[p_];for(var f_=Jb.data,b_=0,w_;b_<f_.length;b_++)if(w_=f_[b_],0!==w_){var x_=u_[w_+c_];0!==x_&&(f_[b_]=x_)}return Jb.computed={},Jb}function en(Fb,Ub={}){function qb($b,e_){var t_=0,a_=0,i_=Fb.getBitXY($b,e_),n_=i_?++Gb:--Hb;for(Zb[0]=$b,Qb[0]=e_;t_<=a_;){var o_=Zb[t_&Wb],s_=Qb[t_&Wb];if(Nb[s_*Fb.width+o_]=n_,0<o_&&0===Nb[s_*Fb.width+o_-1]&&Fb.getBitXY(o_-1,s_)===i_&&(a_++,Zb[a_&Wb]=o_-1,Qb[a_&Wb]=s_,Nb[s_*Fb.width+o_-1]=-32768),0<s_&&0===Nb[(s_-1)*Fb.width+o_]&&Fb.getBitXY(o_,s_-1)===i_&&(a_++,Zb[a_&Wb]=o_,Qb[a_&Wb]=s_-1,Nb[(s_-1)*Fb.width+o_]=-32768),o_<Fb.width-1&&0===Nb[s_*Fb.width+o_+1]&&Fb.getBitXY(o_+1,s_)===i_&&(a_++,Zb[a_&Wb]=o_+1,Qb[a_&Wb]=s_,Nb[s_*Fb.width+o_+1]=-32768),s_<Fb.height-1&&0===Nb[(s_+1)*Fb.width+o_]&&Fb.getBitXY(o_,s_+1)===i_&&(a_++,Zb[a_&Wb]=o_,Qb[a_&Wb]=s_+1,Nb[(s_+1)*Fb.width+o_]=-32768),Ob&&(0<o_&&0<s_&&0===Nb[(s_-1)*Fb.width+o_-1]&&Fb.getBitXY(o_-1,s_-1)===i_&&(a_++,Zb[a_&Wb]=o_-1,Qb[a_&Wb]=s_-1,Nb[(s_-1)*Fb.width+o_-1]=-32768),o_<Fb.width-1&&0<s_&&0===Nb[(s_-1)*Fb.width+o_+1]&&Fb.getBitXY(o_+1,s_-1)===i_&&(a_++,Zb[a_&Wb]=o_+1,Qb[a_&Wb]=s_-1,Nb[(s_-1)*Fb.width+o_+1]=-32768),0<o_&&s_<Fb.height-1&&0===Nb[(s_+1)*Fb.width+o_-1]&&Fb.getBitXY(o_-1,s_+1)===i_&&(a_++,Zb[a_&Wb]=o_-1,Qb[a_&Wb]=s_+1,Nb[(s_+1)*Fb.width+o_-1]=-32768),o_<Fb.width-1&&s_<Fb.height-1&&0===Nb[(s_+1)*Fb.width+o_+1]&&Fb.getBitXY(o_+1,s_+1)===i_&&(a_++,Zb[a_&Wb]=o_+1,Qb[a_&Wb]=s_+1,Nb[(s_+1)*Fb.width+o_+1]=-32768)),t_++,a_-t_>Wb)throw new Error('analyseMask can not finish, the array to manage internal data is not big enough.You could improve mask by changing MAX_ARRAY')}}for(var Xb=Ub.allowCorners,Ob=void 0!==Xb&&Xb,Nb=new Int16Array(Fb.size),Gb=0,Hb=0,Wb=65535,Zb=new Uint16Array(Wb+1),Qb=new Uint16Array(Wb+1),Kb=0;Kb<Fb.width;Kb++)for(var Jb=0;Jb<Fb.height;Jb++)0===Nb[Jb*Fb.width+Kb]&&qb(Kb,Jb);return new mm(Fb,Nb)}function tn(Fb){this.value=Fb,this.parent=null,this.rank=0}function an(Fb,Ub={}){var qb=Ub.allowCorners,Ob=4;void 0!==qb&&qb&&(Ob=8);var Nb,Gb,Hb;if(8==Ob)Nb=bm,Gb=_m,Hb=wm;else if(4==Ob)Nb=um,Gb=pm,Hb=fm;else throw new RangeError('unsupported neighbours count: '+Ob);for(var Wb=Fb.size,Zb=Fb.width,Qb=Fb.height,Kb=Array(Wb),Jb=new Uint32Array(Wb),$b=new gm,e_=1,t_=0;t_<Qb;t_++)for(var a_=0,i_;a_<Zb;a_++)if(i_=a_+t_*Zb,Fb.getBit(i_)){for(var n_=null,o_=0;o_<Hb.length;o_++){var s_=a_+Nb[o_],r_=t_+Gb[o_];if(0<=s_&&0<=r_&&s_<Zb&&r_<Qb){var d_=Kb[s_+r_*Zb];d_?(Hb[o_]=d_,(!n_||Hb[o_].value<n_.value)&&(n_=Hb[o_])):Hb[o_]=null}}if(!n_)Kb[i_]=$b.add(e_++);else{Kb[i_]=n_;for(var h_=0;h_<Hb.length;h_++)Hb[h_]&&Hb[h_]!==n_&&$b.union(n_,Hb[h_])}}for(var m_=0;m_<Qb;m_++)for(var c_=0,g_;c_<Zb;c_++)g_=c_+m_*Zb,Fb.getBit(g_)&&(Jb[g_]=$b.find(Kb[g_]).value);return new mm(Fb,Jb)}function rn(Fb={}){function Ub({maxima:p_=!0}){for(var f_=1;f_<Qb.height-1;f_++)for(var b_=1,w_;b_<Qb.width-1;b_++)if(w_=b_+f_*Qb.width,0===a_[w_]){var x_=p_?Qb.data[w_]:-Qb.data[b_+f_*Qb.width];if(Qb.data[f_*Qb.width+b_-1]>x_)continue;if(Qb.data[f_*Qb.width+b_+1]>x_)continue;if(Qb.data[(f_-1)*Qb.width+b_]>x_)continue;if(Qb.data[(f_+1)*Qb.width+b_]>x_)continue;if(Nb){if(Qb.data[(f_-1)*Qb.width+b_-1]>x_)continue;if(Qb.data[(f_-1)*Qb.width+b_+1]>x_)continue;if(Qb.data[(f_+1)*Qb.width+b_-1]>x_)continue;if(Qb.data[(f_+1)*Qb.width+b_+1]>x_)continue}t_[w_]=p_?++$b:--e_;var y_=qb(b_,f_,Kb);y_||(p_?--$b:++e_)}}function qb(p_,f_){var b_=l_;m_=0,c_=1,d_[0]=p_,h_[0]=f_;for(var w_=!0;m_<c_;){var x_=d_[m_&n_],y_=h_[m_&n_];w_&=Xb(x_,y_,Kb),m_++}if(!w_){for(var k_=0;k_<c_;k_++){var v_=d_[k_&n_],D_=h_[k_&n_],j_=D_*Qb.width+v_;t_[j_]=0}l_=b_}return w_}function Xb(p_,f_,b_){for(var w_=t_[f_*Qb.width+p_],x_=Qb.data[f_*Qb.width+p_],y_=f_-1;y_<=f_+1;y_++)for(var k_=p_-1,v_;k_<=p_+1;k_++)if(v_=y_*Qb.width+k_,0===a_[v_])switch(a_[v_]=1,i_[v_]=Qb.data[v_]-x_,b_){case Kb:if(0===i_[v_]){if(0===k_||0===y_||k_===Qb.width-1||y_===Qb.height-1)return!1;t_[v_]=w_,d_[c_&n_]=k_,h_[c_&n_]=y_,c_++}else{if(0<i_[v_])return!1;Hb||(t_[v_]=w_,o_[l_&n_]=k_,s_[l_&n_]=y_,l_++)}break;case Jb:0>=i_[v_]&&(t_[v_]=w_,o_[l_&n_]=k_,s_[l_&n_]=y_,l_++);break;default:throw new Error('unreachable');}return!0}var Ob=Fb.allowCorner,Nb=void 0===Ob||Ob,Gb=Fb.onlyTop,Hb=void 0!==Gb&&Gb,Wb=Fb.invert,Qb=this;Qb.checkProcessable('fromMaxima',{components:[1]});var Kb=1,Jb=2,$b=0,e_=0,t_=new Int16Array(Qb.size),a_=new Int8Array(Qb.size),i_=new Float32Array(Qb.size),n_=1048575,o_=new Uint16Array(n_+1),s_=new Uint16Array(n_+1),r_=0,l_=0,d_=new Uint16Array(n_+1),h_=new Uint16Array(n_+1),m_=0,c_=0;for(Ub(Qb,{maxima:!(void 0!==Wb&&Wb)});r_<l_;){var g_=o_[r_&n_],u_=s_[r_&n_];Xb(g_,u_,Jb),r_++}return new mm(Qb,t_)}function ln(Fb={}){var Ub=Fb.points,qb=Fb.mask,Xb=Fb.image,Ob=Fb.fillMaxValue,Nb=void 0===Ob?this.maxValue:Ob,Gb=Fb.invert,Hb=void 0!==Gb&&Gb,Wb=Xb||this;Wb.checkProcessable('fromWaterShed',{bitDepth:[8,16],components:1}),Hb=!Hb,Ub||(Ub=Wb.getLocalMaxima({invert:Hb,mask:qb}));for(var Zb=Hb?0:1,Qb=new Int16Array(Wb.size),Kb=Wb.width,Jb=Wb.height,$b=new xm({comparator:(h_,m_)=>h_[2]-m_[2],strategy:xm.BinaryHeapStrategy}),e_=0,t_;e_<Ub.length;e_++){t_=Ub[e_][0]+Ub[e_][1]*Kb,Qb[t_]=e_+1;var a_=Wb.data[t_];(Hb&&a_<=Nb||!Hb&&a_>=Nb)&&$b.queue([Ub[e_][0],Ub[e_][1],a_])}for(;0<$b.length;)for(var i_=$b.dequeue(),n_=i_[0]+i_[1]*Kb,o_=0;4>o_;o_++){var s_=i_[0]+ym[o_],r_=i_[1]+km[o_];if(0<=s_&&0<=r_&&s_<Kb&&r_<Jb){var l_=s_+r_*Kb;if(!qb||qb.getBit(l_)===Zb){var d_=Wb.data[l_];(Hb&&d_<=Nb||!Hb&&d_>=Nb)&&0===Qb[l_]&&(Qb[l_]=Qb[n_],$b.queue([i_[0]+ym[o_],i_[1]+km[o_],d_]))}}}return new mm(Wb,Qb)}function dn(Fb,Ub={}){for(var qb=new sm(Ub),Xb=new Int16Array(this.size),Ob=0,Nb=qb.getPoints(),Gb=0;Gb<Fb.length;Gb++){Ob++;for(var Hb=Fb[Gb][0],Wb=Fb[Gb][1],Zb=0;Zb<Nb.length;Zb++){var Qb=Nb[Zb][0],Kb=Nb[Zb][1];0<=Hb+Qb&&0<=Wb+Kb&&Hb+Qb<this.width&&Wb+Kb<this.height&&(Xb[Hb+Qb+(Wb+Kb)*this.width]=Ob)}}return new mm(this,Xb)}function hn(Fb){for(var Ub=Fb.map,qb=Ub.data,Xb=new Set,Ob=new Map,Nb=new Set,Gb=[1,0,-1,0],Hb=[0,1,0,-1],Wb=Fb.minX;Wb<=Fb.maxX;Wb++)for(var Zb=Fb.minY,Qb;Zb<=Fb.maxY;Zb++)if(Qb=Wb+Zb*Ub.width,qb[Qb]===Fb.id)for(var Kb=0;4>Kb;Kb++){var Jb=Wb+Gb[Kb],$b=Zb+Hb[Kb];if(0<=Jb&&0<=$b&&Jb<Ub.width&&$b<Ub.height){var e_=Jb+$b*Ub.width;if(qb[e_]!==Fb.id&&!Nb.has(e_)){Nb.add(e_),Xb.add(qb[e_]);var t_=Ob.get(qb[e_]);t_?Ob.set(qb[e_],++t_):Ob.set(qb[e_],1)}}}var a_=Array.from(Xb),i_=a_.map(function(n_){return Ob.get(n_)});return{ids:a_,lengths:i_}}function mn(Fb){var Ub=new Set,qb=Fb.map,Xb=qb.data;for(var Ob of[0,Fb.height-1])for(var Nb=0,Gb;Nb<Fb.width;Nb++){if(Gb=(Ob+Fb.minY)*qb.width+Nb+Fb.minX,0<Nb-Fb.minX&&Xb[Gb]===Fb.id&&Xb[Gb-1]!==Fb.id){var Hb=Xb[Gb-1];Ub.add(Hb)}if(1<qb.width-Nb-Fb.minX&&Xb[Gb]===Fb.id&&Xb[Gb+1]!==Fb.id){var Wb=Xb[Gb+1];Ub.add(Wb)}}for(var Zb of[0,Fb.width-1])for(var Qb=0,Kb;Qb<Fb.height;Qb++){if(Kb=(Qb+Fb.minY)*qb.width+Zb+Fb.minX,0<Qb-Fb.minY&&Xb[Kb]===Fb.id&&Xb[Kb-qb.width]!==Fb.id){var Jb=Xb[Kb-qb.width];Ub.add(Jb)}if(1<qb.height-Qb-Fb.minY&&Xb[Kb]===Fb.id&&Xb[Kb+qb.width]!==Fb.id){var $b=Xb[Kb+qb.width];Ub.add($b)}}return Array.from(Ub)}function cn(Fb){var Ub=0,qb=Fb.map,Xb=qb.data,Ob=[0];1<Fb.height&&(Ob[1]=Fb.height-1);for(var Nb of Ob)for(var Gb=1,Hb;Gb<Fb.width-1;Gb++)Hb=(Nb+Fb.minY)*qb.width+Gb+Fb.minX,Xb[Hb]===Fb.id&&Ub++;var Wb=[0];1<Fb.width&&(Wb[1]=Fb.width-1);for(var Zb of Wb)for(var Qb=0,Kb;Qb<Fb.height;Qb++)Kb=(Qb+Fb.minY)*qb.width+Zb+Fb.minX,Xb[Kb]===Fb.id&&Ub++;return Ub}function gn(Fb){for(var Ub=0,qb=Fb.map,Xb=qb.data,Ob=1;Ob<Fb.width-1;Ob++)for(var Nb=1,Gb;Nb<Fb.height-1;Nb++)Gb=(Nb+Fb.minY)*qb.width+Ob+Fb.minX,Xb[Gb]===Fb.id&&(Xb[Gb-1]!==Fb.id||Xb[Gb+1]!==Fb.id||Xb[Gb-qb.width]!==Fb.id||Xb[Gb+qb.width]!==Fb.id)&&Ub++;return Ub+Fb.box}function un(Fb){for(var Ub=0,qb=Fb.map,Xb=qb.data,Ob=1;Ob<Fb.width-1;Ob++)for(var Nb=1,Gb;Nb<Fb.height-1;Nb++)Gb=(Nb+Fb.minY)*qb.width+Ob+Fb.minX,Xb[Gb]===Fb.id&&(Fb.externalIDs.includes(Xb[Gb-1])||Fb.externalIDs.includes(Xb[Gb+1])||Fb.externalIDs.includes(Xb[Gb-qb.width])||Fb.externalIDs.includes(Xb[Gb+qb.width]))&&Ub++;return Ub+Fb.box}function pn(Fb){var Ub=[Fb.id],qb=Fb.map,Xb=qb.data;if(2<Fb.height)for(var Ob=0,Nb;Ob<Fb.width;Ob++)if(Nb=Fb.minY*qb.width+Ob+Fb.minX,Ub.includes(Xb[Nb])){var Gb=Xb[Nb+qb.width];Ub.includes(Gb)||Fb.boxIDs.includes(Gb)||Ub.push(Gb)}for(var Hb=[,,,,],Wb=1;Wb<Fb.width-1;Wb++)for(var Zb=1,Qb;Zb<Fb.height-1;Zb++)if(Qb=(Zb+Fb.minY)*qb.width+Wb+Fb.minX,Ub.includes(Xb[Qb])){Hb[0]=Xb[Qb-1],Hb[1]=Xb[Qb+1],Hb[2]=Xb[Qb-qb.width],Hb[3]=Xb[Qb+qb.width];for(var Kb=0,Jb;4>Kb;Kb++)Jb=Hb[Kb],Ub.includes(Jb)||Fb.boxIDs.includes(Jb)||Ub.push(Jb)}return Ub}function bn(Fb,Ub,qb,Xb,Ob){for(var Nb={id:[],surface:[],roiSurfaceCovered:[],same:0,opposite:0,total:0},Gb=0;Gb<qb.length;Gb++){var Hb=qb[Gb],Wb=Hb[0],Zb=Hb[1],Qb=Wb+Fb+(Zb+Ub)*Xb.width,Kb=Xb.data[Qb];(0<Kb||0>Kb)&&(Nb.id.includes(Kb)?Nb.surface[Nb.id.indexOf(Kb)]+=1:(Nb.id.push(Kb),Nb.surface.push(1)))}for(var Jb=0,$b;Jb<Nb.id.length;Jb++)$b=_Mathsign(Nb.id[Jb]),$b===Ob?Nb.same+=Nb.surface[Jb]:Nb.opposite+=Nb.surface[Jb],Nb.roiSurfaceCovered[Jb]=Nb.surface[Jb]/qb.length;return Nb.total=Nb.opposite+Nb.same,Nb}function wn(Fb){Am||(Am=new Sb(1,1));var Ub=Bm.get(Fb);return Ub||(Ub=new Rm(Fb),Bm.set(Fb,Ub)),Ub}function xn(Fb){return wn(Fb).canWrite()}function yn(Fb){return Fb.includes('/')||(Fb='image/'+Fb),Fb}function kn(Fb){for(var Ub=Fb.length;0<=--Ub;)Fb[Ub]=0}function vn(Fb,Ub,qb,Xb,Ob){this.static_tree=Fb,this.extra_bits=Ub,this.extra_base=qb,this.elems=Xb,this.max_length=Ob,this.has_stree=Fb&&Fb.length}function Dn(Fb,Ub){this.dyn_tree=Fb,this.max_code=0,this.stat_desc=Ub}function jn(Fb){return 256>Fb?wc[Fb]:wc[256+(Fb>>>7)]}function Mn(Fb,Ub){Fb.pending_buf[Fb.pending++]=255&Ub,Fb.pending_buf[Fb.pending++]=255&Ub>>>8}function Sn(Fb,Ub,qb){Fb.bi_valid>tc-qb?(Fb.bi_buf|=65535&Ub<<Fb.bi_valid,Mn(Fb,Fb.bi_buf),Fb.bi_buf=Ub>>tc-Fb.bi_valid,Fb.bi_valid+=qb-tc):(Fb.bi_buf|=65535&Ub<<Fb.bi_valid,Fb.bi_valid+=qb)}function In(Fb,Ub,qb){Sn(Fb,qb[2*Ub],qb[2*Ub+1])}function Pn(Fb,Ub){var qb=0;do qb|=1&Fb,Fb>>>=1,qb<<=1;while(0<--Ub);return qb>>>1}function Cn(Fb){16===Fb.bi_valid?(Mn(Fb,Fb.bi_buf),Fb.bi_buf=0,Fb.bi_valid=0):8<=Fb.bi_valid&&(Fb.pending_buf[Fb.pending++]=255&Fb.bi_buf,Fb.bi_buf>>=8,Fb.bi_valid-=8)}function Bn(Fb,Ub){var qb=Ub.dyn_tree,Xb=Ub.max_code,Ob=Ub.stat_desc.static_tree,Nb=Ub.stat_desc.has_stree,Gb=Ub.stat_desc.extra_bits,Hb=Ub.stat_desc.extra_base,Wb=Ub.stat_desc.max_length,t_=0,Zb,Qb,Kb,Jb,$b,e_;for(Jb=0;Jb<=ec;Jb++)Fb.bl_count[Jb]=0;for(qb[2*Fb.heap[Fb.heap_max]+1]=0,Zb=Fb.heap_max+1;Zb<$m;Zb++)(Qb=Fb.heap[Zb],Jb=qb[2*qb[2*Qb+1]+1]+1,Jb>Wb&&(Jb=Wb,t_++),qb[2*Qb+1]=Jb,!(Qb>Xb))&&(Fb.bl_count[Jb]++,$b=0,Qb>=Hb&&($b=Gb[Qb-Hb]),e_=qb[2*Qb],Fb.opt_len+=e_*(Jb+$b),Nb&&(Fb.static_len+=e_*(Ob[2*Qb+1]+$b)));if(0!=t_){do{for(Jb=Wb-1;0===Fb.bl_count[Jb];)Jb--;Fb.bl_count[Jb]--,Fb.bl_count[Jb+1]+=2,Fb.bl_count[Wb]--,t_-=2}while(0<t_);for(Jb=Wb;0!==Jb;Jb--)for(Qb=Fb.bl_count[Jb];0!==Qb;)(Kb=Fb.heap[--Zb],!(Kb>Xb))&&(qb[2*Kb+1]!==Jb&&(Fb.opt_len+=(Jb-qb[2*Kb+1])*qb[2*Kb],qb[2*Kb+1]=Jb),Qb--)}}function An(Fb,Ub,qb){var Xb=Array(ec+1),Ob=0,Nb,Gb;for(Nb=1;Nb<=ec;Nb++)Xb[Nb]=Ob=Ob+qb[Nb-1]<<1;for(Gb=0;Gb<=Ub;Gb++){var Hb=Fb[2*Gb+1];0!==Hb&&(Fb[2*Gb]=Pn(Xb[Hb]++,Hb))}}function Rn(){var Nb=Array(ec+1),Fb,Ub,qb,Xb,Ob;for(qb=0,Xb=0;Xb<Wm-1;Xb++)for(yc[Xb]=qb,Fb=0;Fb<1<<hc[Xb];Fb++)xc[qb++]=Xb;for(xc[qb-1]=Xb,Ob=0,Xb=0;16>Xb;Xb++)for(kc[Xb]=Ob,Fb=0;Fb<1<<mc[Xb];Fb++)wc[Ob++]=Xb;for(Ob>>=7;Xb<Km;Xb++)for(kc[Xb]=Ob<<7,Fb=0;Fb<1<<mc[Xb]-7;Fb++)wc[256+Ob++]=Xb;for(Ub=0;Ub<=ec;Ub++)Nb[Ub]=0;for(Fb=0;143>=Fb;)fc[2*Fb+1]=8,Fb++,Nb[8]++;for(;255>=Fb;)fc[2*Fb+1]=9,Fb++,Nb[9]++;for(;279>=Fb;)fc[2*Fb+1]=7,Fb++,Nb[7]++;for(;287>=Fb;)fc[2*Fb+1]=8,Fb++,Nb[8]++;for(An(fc,Qm+1,Nb),Fb=0;Fb<Km;Fb++)bc[2*Fb+1]=5,bc[2*Fb]=Pn(Fb,5);vc=new vn(fc,hc,Zm+1,Qm,ec),Dc=new vn(bc,mc,0,Km,ec),jc=new vn([],cc,0,Jm,ac)}function zn(Fb){var Ub;for(Ub=0;Ub<Qm;Ub++)Fb.dyn_ltree[2*Ub]=0;for(Ub=0;Ub<Km;Ub++)Fb.dyn_dtree[2*Ub]=0;for(Ub=0;Ub<Jm;Ub++)Fb.bl_tree[2*Ub]=0;Fb.dyn_ltree[2*nc]=1,Fb.opt_len=Fb.static_len=0,Fb.last_lit=Fb.matches=0}function Ln(Fb){8<Fb.bi_valid?Mn(Fb,Fb.bi_buf):0<Fb.bi_valid&&(Fb.pending_buf[Fb.pending++]=Fb.bi_buf),Fb.bi_buf=0,Fb.bi_valid=0}function En(Fb,Ub,qb,Xb){Ln(Fb),Xb&&(Mn(Fb,qb),Mn(Fb,~qb)),Vm.arraySet(Fb.pending_buf,Fb.window,Ub,qb,Fb.pending),Fb.pending+=qb}function Tn(Fb,Ub,qb,Xb){var Ob=2*Ub,Nb=2*qb;return Fb[Ob]<Fb[Nb]||Fb[Ob]===Fb[Nb]&&Xb[Ub]<=Xb[qb]}function Vn(Fb,Ub,qb){for(var Xb=Fb.heap[qb],Ob=qb<<1;Ob<=Fb.heap_len&&(Ob<Fb.heap_len&&Tn(Ub,Fb.heap[Ob+1],Fb.heap[Ob],Fb.depth)&&Ob++,!Tn(Ub,Xb,Fb.heap[Ob],Fb.depth));)Fb.heap[qb]=Fb.heap[Ob],qb=Ob,Ob<<=1;Fb.heap[qb]=Xb}function Yn(Fb,Ub,qb){var Nb=0,Xb,Ob,Gb,Hb;if(0!==Fb.last_lit)do Xb=Fb.pending_buf[Fb.d_buf+2*Nb]<<8|Fb.pending_buf[Fb.d_buf+2*Nb+1],Ob=Fb.pending_buf[Fb.l_buf+Nb],Nb++,0===Xb?In(Fb,Ob,Ub):(Gb=xc[Ob],In(Fb,Gb+Zm+1,Ub),Hb=hc[Gb],0!==Hb&&(Ob-=yc[Gb],Sn(Fb,Ob,Hb)),Xb--,Gb=jn(Xb),In(Fb,Gb,qb),Hb=mc[Gb],0!==Hb&&(Xb-=kc[Gb],Sn(Fb,Xb,Hb)));while(Nb<Fb.last_lit);In(Fb,nc,Ub)}function Fn(Fb,Ub){var qb=Ub.dyn_tree,Xb=Ub.stat_desc.static_tree,Ob=Ub.stat_desc.has_stree,Nb=Ub.stat_desc.elems,Wb=-1,Gb,Hb,Zb;for(Fb.heap_len=0,Fb.heap_max=$m,Gb=0;Gb<Nb;Gb++)0===qb[2*Gb]?qb[2*Gb+1]=0:(Fb.heap[++Fb.heap_len]=Wb=Gb,Fb.depth[Gb]=0);for(;2>Fb.heap_len;)Zb=Fb.heap[++Fb.heap_len]=2>Wb?++Wb:0,qb[2*Zb]=1,Fb.depth[Zb]=0,Fb.opt_len--,Ob&&(Fb.static_len-=Xb[2*Zb+1]);for(Ub.max_code=Wb,Gb=Fb.heap_len>>1;1<=Gb;Gb--)Vn(Fb,qb,Gb);Zb=Nb;do Gb=Fb.heap[1],Fb.heap[1]=Fb.heap[Fb.heap_len--],Vn(Fb,qb,1),Hb=Fb.heap[1],Fb.heap[--Fb.heap_max]=Gb,Fb.heap[--Fb.heap_max]=Hb,qb[2*Zb]=qb[2*Gb]+qb[2*Hb],Fb.depth[Zb]=(Fb.depth[Gb]>=Fb.depth[Hb]?Fb.depth[Gb]:Fb.depth[Hb])+1,qb[2*Gb+1]=qb[2*Hb+1]=Zb,Fb.heap[1]=Zb++,Vn(Fb,qb,1);while(2<=Fb.heap_len);Fb.heap[--Fb.heap_max]=Fb.heap[1],Bn(Fb,Ub),An(qb,Wb,Fb.bl_count)}function Un(Fb,Ub,qb){var Ob=-1,Gb=Ub[1],Hb=0,Wb=7,Zb=4,Xb,Nb;for(0===Gb&&(Wb=138,Zb=3),Ub[2*(qb+1)+1]=65535,Xb=0;Xb<=qb;Xb++){if(Nb=Gb,Gb=Ub[2*(Xb+1)+1],++Hb<Wb&&Nb===Gb)continue;else Hb<Zb?Fb.bl_tree[2*Nb]+=Hb:0===Nb?10>=Hb?Fb.bl_tree[2*sc]++:Fb.bl_tree[2*rc]++:(Nb!==Ob&&Fb.bl_tree[2*Nb]++,Fb.bl_tree[2*oc]++);Hb=0,Ob=Nb,0===Gb?(Wb=138,Zb=3):Nb===Gb?(Wb=6,Zb=3):(Wb=7,Zb=4)}}function qn(Fb,Ub,qb){var Ob=-1,Gb=Ub[1],Hb=0,Wb=7,Zb=4,Xb,Nb;for(0===Gb&&(Wb=138,Zb=3),Xb=0;Xb<=qb;Xb++){if(Nb=Gb,Gb=Ub[2*(Xb+1)+1],++Hb<Wb&&Nb===Gb)continue;else if(Hb<Zb)do In(Fb,Nb,Fb.bl_tree);while(0!=--Hb);else 0===Nb?10>=Hb?(In(Fb,sc,Fb.bl_tree),Sn(Fb,Hb-3,3)):(In(Fb,rc,Fb.bl_tree),Sn(Fb,Hb-11,7)):(Nb!==Ob&&(In(Fb,Nb,Fb.bl_tree),Hb--),In(Fb,oc,Fb.bl_tree),Sn(Fb,Hb-3,2));Hb=0,Ob=Nb,0===Gb?(Wb=138,Zb=3):Nb===Gb?(Wb=6,Zb=3):(Wb=7,Zb=4)}}function Xn(Fb){var Ub;for(Un(Fb,Fb.dyn_ltree,Fb.l_desc.max_code),Un(Fb,Fb.dyn_dtree,Fb.d_desc.max_code),Fn(Fb,Fb.bl_desc),Ub=Jm-1;3<=Ub&&0===Fb.bl_tree[2*gc[Ub]+1];Ub--);return Fb.opt_len+=3*(Ub+1)+5+5+4,Ub}function On(Fb,Ub,qb,Xb){var Ob;for(Sn(Fb,Ub-257,5),Sn(Fb,qb-1,5),Sn(Fb,Xb-4,4),Ob=0;Ob<Xb;Ob++)Sn(Fb,Fb.bl_tree[2*gc[Ob]+1],3);qn(Fb,Fb.dyn_ltree,Ub-1),qn(Fb,Fb.dyn_dtree,qb-1)}function Nn(Fb){var Ub=4093624447,qb;for(qb=0;31>=qb;qb++,Ub>>>=1)if(1&Ub&&0!==Fb.dyn_ltree[2*qb])return Fm;if(0!==Fb.dyn_ltree[18]||0!==Fb.dyn_ltree[20]||0!==Fb.dyn_ltree[26])return Um;for(qb=32;qb<Zm;qb++)if(0!==Fb.dyn_ltree[2*qb])return Um;return Fm}function Hn(Fb,Ub,qb,Xb){Sn(Fb,(Xm<<1)+(Xb?1:0),3),En(Fb,Ub,qb,!0)}function eo(Fb,Ub){return Fb.msg=Ec[Ub],Ub}function ao(Fb){return(Fb<<1)-(4<Fb?9:0)}function no(Fb){for(var Ub=Fb.length;0<=--Ub;)Fb[Ub]=0}function oo(Fb){var Ub=Fb.state,qb=Ub.pending;qb>Fb.avail_out&&(qb=Fb.avail_out),0===qb||(Vm.arraySet(Fb.output,Ub.pending_buf,Ub.pending_out,qb,Fb.next_out),Fb.next_out+=qb,Ub.pending_out+=qb,Fb.total_out+=qb,Fb.avail_out-=qb,Ub.pending-=qb,0===Ub.pending&&(Ub.pending_out=0))}function so(Fb,Ub){Ac._tr_flush_block(Fb,0<=Fb.block_start?Fb.block_start:-1,Fb.strstart-Fb.block_start,Ub),Fb.block_start=Fb.strstart,oo(Fb.strm)}function ro(Fb,Ub){Fb.pending_buf[Fb.pending++]=Ub}function lo(Fb,Ub){Fb.pending_buf[Fb.pending++]=255&Ub>>>8,Fb.pending_buf[Fb.pending++]=255&Ub}function ho(Fb,Ub,qb,Xb){var Ob=Fb.avail_in;return(Ob>Xb&&(Ob=Xb),0===Ob)?0:(Fb.avail_in-=Ob,Vm.arraySet(Ub,Fb.input,Fb.next_in,Ob,qb),1===Fb.state.wrap?Fb.adler=Rc(Fb.adler,Ub,Ob,qb):2===Fb.state.wrap&&(Fb.adler=Lc(Fb.adler,Ub,Ob,qb)),Fb.next_in+=Ob,Fb.total_in+=Ob,Ob)}function mo(Fb,Ub){var qb=Fb.max_chain_length,Xb=Fb.strstart,Gb=Fb.prev_length,Hb=Fb.nice_match,Wb=Fb.strstart>Fb.w_size-gg?Fb.strstart-(Fb.w_size-gg):0,Zb=Fb.window,Qb=Fb.w_mask,Kb=Fb.prev,Jb=Fb.strstart+cg,$b=Zb[Xb+Gb-1],e_=Zb[Xb+Gb],Ob,Nb;Fb.prev_length>=Fb.good_match&&(qb>>=2),Hb>Fb.lookahead&&(Hb=Fb.lookahead);do{if(Ob=Ub,Zb[Ob+Gb]!==e_||Zb[Ob+Gb-1]!==$b||Zb[Ob]!==Zb[Xb]||Zb[++Ob]!==Zb[Xb+1])continue;Xb+=2,Ob++;do;while(Zb[++Xb]===Zb[++Ob]&&Zb[++Xb]===Zb[++Ob]&&Zb[++Xb]===Zb[++Ob]&&Zb[++Xb]===Zb[++Ob]&&Zb[++Xb]===Zb[++Ob]&&Zb[++Xb]===Zb[++Ob]&&Zb[++Xb]===Zb[++Ob]&&Zb[++Xb]===Zb[++Ob]&&Xb<Jb);if(Nb=cg-(Jb-Xb),Xb=Jb-cg,Nb>Gb){if(Fb.match_start=Ub,Gb=Nb,Nb>=Hb)break;$b=Zb[Xb+Gb-1],e_=Zb[Xb+Gb]}}while((Ub=Kb[Ub&Qb])>Wb&&0!=--qb);return Gb<=Fb.lookahead?Gb:Fb.lookahead}function co(Fb){var Ub=Fb.w_size,qb,Xb,Ob,Nb,Gb;do{if(Nb=Fb.window_size-Fb.lookahead-Fb.strstart,Fb.strstart>=Ub+(Ub-gg)){Vm.arraySet(Fb.window,Fb.window,Ub,Ub,0),Fb.match_start-=Ub,Fb.strstart-=Ub,Fb.block_start-=Ub,Xb=Fb.hash_size,qb=Xb;do Ob=Fb.head[--qb],Fb.head[qb]=Ob>=Ub?Ob-Ub:0;while(--Xb);Xb=Ub,qb=Xb;do Ob=Fb.prev[--qb],Fb.prev[qb]=Ob>=Ub?Ob-Ub:0;while(--Xb);Nb+=Ub}if(0===Fb.strm.avail_in)break;if(Xb=ho(Fb.strm,Fb.window,Fb.strstart+Fb.lookahead,Nb),Fb.lookahead+=Xb,Fb.lookahead+Fb.insert>=mg)for(Gb=Fb.strstart-Fb.insert,Fb.ins_h=Fb.window[Gb],Fb.ins_h=(Fb.ins_h<<Fb.hash_shift^Fb.window[Gb+1])&Fb.hash_mask;Fb.insert&&(Fb.ins_h=(Fb.ins_h<<Fb.hash_shift^Fb.window[Gb+mg-1])&Fb.hash_mask,Fb.prev[Gb&Fb.w_mask]=Fb.head[Fb.ins_h],Fb.head[Fb.ins_h]=Gb,Gb++,Fb.insert--,!(Fb.lookahead+Fb.insert<mg)););}while(Fb.lookahead<gg&&0!==Fb.strm.avail_in)}function uo(Fb,Ub){for(var qb,Xb;;){if(Fb.lookahead<gg){if(co(Fb),Fb.lookahead<gg&&Ub===Tc)return kg;if(0===Fb.lookahead)break}if(qb=0,Fb.lookahead>=mg&&(Fb.ins_h=(Fb.ins_h<<Fb.hash_shift^Fb.window[Fb.strstart+mg-1])&Fb.hash_mask,qb=Fb.prev[Fb.strstart&Fb.w_mask]=Fb.head[Fb.ins_h],Fb.head[Fb.ins_h]=Fb.strstart),0!==qb&&Fb.strstart-qb<=Fb.w_size-gg&&(Fb.match_length=mo(Fb,qb)),!(Fb.match_length>=mg))Xb=Ac._tr_tally(Fb,0,Fb.window[Fb.strstart]),Fb.lookahead--,Fb.strstart++;else if(Xb=Ac._tr_tally(Fb,Fb.strstart-Fb.match_start,Fb.match_length-mg),Fb.lookahead-=Fb.match_length,Fb.match_length<=Fb.max_lazy_match&&Fb.lookahead>=mg){Fb.match_length--;do Fb.strstart++,Fb.ins_h=(Fb.ins_h<<Fb.hash_shift^Fb.window[Fb.strstart+mg-1])&Fb.hash_mask,qb=Fb.prev[Fb.strstart&Fb.w_mask]=Fb.head[Fb.ins_h],Fb.head[Fb.ins_h]=Fb.strstart;while(0!=--Fb.match_length);Fb.strstart++}else Fb.strstart+=Fb.match_length,Fb.match_length=0,Fb.ins_h=Fb.window[Fb.strstart],Fb.ins_h=(Fb.ins_h<<Fb.hash_shift^Fb.window[Fb.strstart+1])&Fb.hash_mask;if(Xb&&(so(Fb,!1),0===Fb.strm.avail_out))return kg}return Fb.insert=Fb.strstart<mg-1?Fb.strstart:mg-1,Ub===Fc?(so(Fb,!0),0===Fb.strm.avail_out?Dg:jg):Fb.last_lit&&(so(Fb,!1),0===Fb.strm.avail_out)?kg:vg}function po(Fb,Ub){for(var qb,Xb,Ob;;){if(Fb.lookahead<gg){if(co(Fb),Fb.lookahead<gg&&Ub===Tc)return kg;if(0===Fb.lookahead)break}if(qb=0,Fb.lookahead>=mg&&(Fb.ins_h=(Fb.ins_h<<Fb.hash_shift^Fb.window[Fb.strstart+mg-1])&Fb.hash_mask,qb=Fb.prev[Fb.strstart&Fb.w_mask]=Fb.head[Fb.ins_h],Fb.head[Fb.ins_h]=Fb.strstart),Fb.prev_length=Fb.match_length,Fb.prev_match=Fb.match_start,Fb.match_length=mg-1,0!==qb&&Fb.prev_length<Fb.max_lazy_match&&Fb.strstart-qb<=Fb.w_size-gg&&(Fb.match_length=mo(Fb,qb),5>=Fb.match_length&&(Fb.strategy===Wc||Fb.match_length===mg&&4096<Fb.strstart-Fb.match_start)&&(Fb.match_length=mg-1)),Fb.prev_length>=mg&&Fb.match_length<=Fb.prev_length){Ob=Fb.strstart+Fb.lookahead-mg,Xb=Ac._tr_tally(Fb,Fb.strstart-1-Fb.prev_match,Fb.prev_length-mg),Fb.lookahead-=Fb.prev_length-1,Fb.prev_length-=2;do++Fb.strstart<=Ob&&(Fb.ins_h=(Fb.ins_h<<Fb.hash_shift^Fb.window[Fb.strstart+mg-1])&Fb.hash_mask,qb=Fb.prev[Fb.strstart&Fb.w_mask]=Fb.head[Fb.ins_h],Fb.head[Fb.ins_h]=Fb.strstart);while(0!=--Fb.prev_length);if(Fb.match_available=0,Fb.match_length=mg-1,Fb.strstart++,Xb&&(so(Fb,!1),0===Fb.strm.avail_out))return kg}else if(!Fb.match_available)Fb.match_available=1,Fb.strstart++,Fb.lookahead--;else if(Xb=Ac._tr_tally(Fb,0,Fb.window[Fb.strstart-1]),Xb&&so(Fb,!1),Fb.strstart++,Fb.lookahead--,0===Fb.strm.avail_out)return kg}return Fb.match_available&&(Xb=Ac._tr_tally(Fb,0,Fb.window[Fb.strstart-1]),Fb.match_available=0),Fb.insert=Fb.strstart<mg-1?Fb.strstart:mg-1,Ub===Fc?(so(Fb,!0),0===Fb.strm.avail_out?Dg:jg):Fb.last_lit&&(so(Fb,!1),0===Fb.strm.avail_out)?kg:vg}function fo(Fb,Ub){for(var Gb=Fb.window,qb,Xb,Ob,Nb;;){if(Fb.lookahead<=cg){if(co(Fb),Fb.lookahead<=cg&&Ub===Tc)return kg;if(0===Fb.lookahead)break}if(Fb.match_length=0,Fb.lookahead>=mg&&0<Fb.strstart&&(Ob=Fb.strstart-1,Xb=Gb[Ob],Xb===Gb[++Ob]&&Xb===Gb[++Ob]&&Xb===Gb[++Ob])){Nb=Fb.strstart+cg;do;while(Xb===Gb[++Ob]&&Xb===Gb[++Ob]&&Xb===Gb[++Ob]&&Xb===Gb[++Ob]&&Xb===Gb[++Ob]&&Xb===Gb[++Ob]&&Xb===Gb[++Ob]&&Xb===Gb[++Ob]&&Ob<Nb);Fb.match_length=cg-(Nb-Ob),Fb.match_length>Fb.lookahead&&(Fb.match_length=Fb.lookahead)}if(Fb.match_length>=mg?(qb=Ac._tr_tally(Fb,1,Fb.match_length-mg),Fb.lookahead-=Fb.match_length,Fb.strstart+=Fb.match_length,Fb.match_length=0):(qb=Ac._tr_tally(Fb,0,Fb.window[Fb.strstart]),Fb.lookahead--,Fb.strstart++),qb&&(so(Fb,!1),0===Fb.strm.avail_out))return kg}return Fb.insert=0,Ub===Fc?(so(Fb,!0),0===Fb.strm.avail_out?Dg:jg):Fb.last_lit&&(so(Fb,!1),0===Fb.strm.avail_out)?kg:vg}function bo(Fb,Ub){for(var qb;;){if(0===Fb.lookahead&&(co(Fb),0===Fb.lookahead)){if(Ub===Tc)return kg;break}if(Fb.match_length=0,qb=Ac._tr_tally(Fb,0,Fb.window[Fb.strstart]),Fb.lookahead--,Fb.strstart++,qb&&(so(Fb,!1),0===Fb.strm.avail_out))return kg}return Fb.insert=0,Ub===Fc?(so(Fb,!0),0===Fb.strm.avail_out?Dg:jg):Fb.last_lit&&(so(Fb,!1),0===Fb.strm.avail_out)?kg:vg}function _o(Fb,Ub,qb,Xb,Ob){this.good_length=Fb,this.max_lazy=Ub,this.nice_length=qb,this.max_chain=Xb,this.func=Ob}function wo(Fb){Fb.window_size=2*Fb.w_size,no(Fb.head),Fb.max_lazy_match=Sg[Fb.level].max_lazy,Fb.good_match=Sg[Fb.level].good_length,Fb.nice_match=Sg[Fb.level].nice_length,Fb.max_chain_length=Sg[Fb.level].max_chain,Fb.strstart=0,Fb.block_start=0,Fb.lookahead=0,Fb.insert=0,Fb.match_length=Fb.prev_length=mg-1,Fb.match_available=0,Fb.ins_h=0}function xo(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=eg,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Vm.Buf16(2*dg),this.dyn_dtree=new Vm.Buf16(2*(2*rg+1)),this.bl_tree=new Vm.Buf16(2*(2*lg+1)),no(this.dyn_ltree),no(this.dyn_dtree),no(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Vm.Buf16(hg+1),this.heap=new Vm.Buf16(2*sg+1),no(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Vm.Buf16(2*sg+1),no(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function yo(Fb){var Ub;return Fb&&Fb.state?(Fb.total_in=Fb.total_out=0,Fb.data_type=$c,Ub=Fb.state,Ub.pending=0,Ub.pending_out=0,0>Ub.wrap&&(Ub.wrap=-Ub.wrap),Ub.status=Ub.wrap?pg:xg,Fb.adler=2===Ub.wrap?0:1,Ub.last_flush=Tc,Ac._tr_init(Ub),qc):eo(Fb,Oc)}function ko(Fb){var Ub=yo(Fb);return Ub===qc&&wo(Fb.state),Ub}function Do(Fb,Ub,qb,Xb,Ob,Nb){if(!Fb)return Oc;var Gb=1;if(Ub===Hc&&(Ub=6),0>Xb?(Gb=0,Xb=-Xb):15<Xb&&(Gb=2,Xb-=16),1>Ob||Ob>tg||qb!==eg||8>Xb||15<Xb||0>Ub||9<Ub||0>Nb||Nb>Kc)return eo(Fb,Oc);8===Xb&&(Xb=9);var Hb=new xo;return Fb.state=Hb,Hb.strm=Fb,Hb.wrap=Gb,Hb.gzhead=null,Hb.w_bits=Xb,Hb.w_size=1<<Hb.w_bits,Hb.w_mask=Hb.w_size-1,Hb.hash_bits=Ob+7,Hb.hash_size=1<<Hb.hash_bits,Hb.hash_mask=Hb.hash_size-1,Hb.hash_shift=~~((Hb.hash_bits+mg-1)/mg),Hb.window=new Vm.Buf8(2*Hb.w_size),Hb.head=new Vm.Buf16(Hb.hash_size),Hb.prev=new Vm.Buf16(Hb.w_size),Hb.lit_bufsize=1<<Ob+6,Hb.pending_buf_size=4*Hb.lit_bufsize,Hb.pending_buf=new Vm.Buf8(Hb.pending_buf_size),Hb.d_buf=1*Hb.lit_bufsize,Hb.l_buf=3*Hb.lit_bufsize,Hb.level=Ub,Hb.strategy=Nb,Hb.method=qb,ko(Fb)}function Po(Fb,Ub){if(65537>Ub&&(Fb.subarray&&Yg||!Fb.subarray&&Vg))return _StringfromCharCode.apply(null,Vm.shrinkBuf(Fb,Ub));for(var qb='',Xb=0;Xb<Ub;Xb++)qb+=_StringfromCharCode(Fb[Xb]);return qb}function Bo(Fb){if(!(this instanceof Bo))return new Bo(Fb);this.options=Vm.assign({level:tu,method:iu,chunkSize:16384,windowBits:15,memLevel:8,strategy:au,to:''},Fb||{});var Ub=this.options;Ub.raw&&0<Ub.windowBits?Ub.windowBits=-Ub.windowBits:Ub.gzip&&0<Ub.windowBits&&16>Ub.windowBits&&(Ub.windowBits+=16),this.err=0,this.msg='',this.ended=!1,this.chunks=[],this.strm=new Wg,this.strm.avail_out=0;var qb=Tg.deflateInit2(this.strm,Ub.level,Ub.method,Ub.windowBits,Ub.memLevel,Ub.strategy);if(qb!==Jg)throw new Error(Ec[qb]);if(Ub.header&&Tg.deflateSetHeader(this.strm,Ub.header),Ub.dictionary){var Xb;if(Xb='string'==typeof Ub.dictionary?Hg.string2buf(Ub.dictionary):'[object ArrayBuffer]'===Zg.call(Ub.dictionary)?new Uint8Array(Ub.dictionary):Ub.dictionary,qb=Tg.deflateSetDictionary(this.strm,Xb),qb!==Jg)throw new Error(Ec[qb]);this._dict_set=!0}}function Ao(Fb,Ub){var qb=new Bo(Ub);if(qb.push(Fb,!0),qb.err)throw qb.msg||Ec[qb.err];return qb.result}function Lo(Fb){return(255&Fb>>>24)+(65280&Fb>>>8)+((65280&Fb)<<8)+((255&Fb)<<24)}function Eo(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Vm.Buf16(320),this.work=new Vm.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function To(Fb){var Ub;return Fb&&Fb.state?(Ub=Fb.state,Fb.total_in=Fb.total_out=Ub.total=0,Fb.msg='',Ub.wrap&&(Fb.adler=1&Ub.wrap),Ub.mode=Fu,Ub.last=0,Ub.havedict=0,Ub.dmax=32768,Ub.head=null,Ub.hold=0,Ub.bits=0,Ub.lencode=Ub.lendyn=new Vm.Buf32(vp),Ub.distcode=Ub.distdyn=new Vm.Buf32(Dp),Ub.sane=1,Ub.back=-1,Au):Lu}function Vo(Fb){var Ub;return Fb&&Fb.state?(Ub=Fb.state,Ub.wsize=0,Ub.whave=0,Ub.wnext=0,To(Fb)):Lu}function Yo(Fb,Ub){var qb,Xb;return Fb&&Fb.state?(Xb=Fb.state,0>Ub?(qb=0,Ub=-Ub):(qb=(Ub>>4)+1,48>Ub&&(Ub&=15)),Ub&&(8>Ub||15<Ub))?Lu:(null!==Xb.window&&Xb.wbits!==Ub&&(Xb.window=null),Xb.wrap=qb,Xb.wbits=Ub,Vo(Fb)):Lu}function Fo(Fb,Ub){var qb,Xb;return Fb?(Xb=new Eo,Fb.state=Xb,Xb.window=null,qb=Yo(Fb,Ub),qb!==Au&&(Fb.state=null),qb):Lu}function qo(Fb){if(Sp){var Ub;for(Ip=new Vm.Buf32(512),Pp=new Vm.Buf32(32),Ub=0;144>Ub;)Fb.lens[Ub++]=8;for(;256>Ub;)Fb.lens[Ub++]=9;for(;280>Ub;)Fb.lens[Ub++]=7;for(;288>Ub;)Fb.lens[Ub++]=8;for(ju(Su,Fb.lens,0,288,Ip,0,Fb.work,{bits:9}),Ub=0;32>Ub;)Fb.lens[Ub++]=5;ju(Iu,Fb.lens,0,32,Pp,0,Fb.work,{bits:5}),Sp=!1}Fb.lencode=Ip,Fb.lenbits=9,Fb.distcode=Pp,Fb.distbits=5}function Xo(Fb,Ub,qb,Xb){var Nb=Fb.state,Ob;return null===Nb.window&&(Nb.wsize=1<<Nb.wbits,Nb.wnext=0,Nb.whave=0,Nb.window=new Vm.Buf8(Nb.wsize)),Xb>=Nb.wsize?(Vm.arraySet(Nb.window,Ub,qb-Nb.wsize,Nb.wsize,0),Nb.wnext=0,Nb.whave=Nb.wsize):(Ob=Nb.wsize-Nb.wnext,Ob>Xb&&(Ob=Xb),Vm.arraySet(Nb.window,Ub,qb-Xb,Ob,Nb.wnext),Xb-=Ob,Xb?(Vm.arraySet(Nb.window,Ub,qb-Xb,Xb,0),Nb.wnext=Xb,Nb.whave=Nb.wsize):(Nb.wnext+=Ob,Nb.wnext===Nb.wsize&&(Nb.wnext=0),Nb.whave<Nb.wsize&&(Nb.whave+=Ob))),0}function Zo(Fb){if(!(this instanceof Zo))return new Zo(Fb);this.options=Vm.assign({chunkSize:16384,windowBits:0,to:''},Fb||{});var Ub=this.options;Ub.raw&&0<=Ub.windowBits&&16>Ub.windowBits&&(Ub.windowBits=-Ub.windowBits,0===Ub.windowBits&&(Ub.windowBits=-15)),0<=Ub.windowBits&&16>Ub.windowBits&&!(Fb&&Fb.windowBits)&&(Ub.windowBits+=32),15<Ub.windowBits&&48>Ub.windowBits&&0==(15&Ub.windowBits)&&(Ub.windowBits|=15),this.err=0,this.msg='',this.ended=!1,this.chunks=[],this.strm=new Wg,this.strm.avail_out=0;var qb=Fp.inflateInit2(this.strm,Ub.windowBits);if(qb!==Up.Z_OK)throw new Error(Ec[qb]);this.header=new qp,Fp.inflateGetHeader(this.strm,this.header)}function Qo(Fb,Ub){var qb=new Zo(Ub);if(qb.push(Fb,!0),qb.err)throw qb.msg||Ec[qb.err];return qb.result}function Jo(Fb,Ub,qb){for(var Xb=0;Xb<qb;Xb++)Ub[Xb]=Fb[Xb]}function $o(Fb,Ub,qb,Xb){for(var Ob=0;Ob<Xb;Ob++)Ub[Ob]=Fb[Ob];for(;Ob<qb;Ob++)Ub[Ob]=255&Fb[Ob]+Ub[Ob-Xb]}function es(Fb,Ub,qb,Xb){var Ob=0;if(0===qb.length)for(;Ob<Xb;Ob++)Ub[Ob]=Fb[Ob];else for(;Ob<Xb;Ob++)Ub[Ob]=255&Fb[Ob]+qb[Ob]}function ts(Fb,Ub,qb,Xb,Ob){var Nb=0;if(0===qb.length){for(;Nb<Ob;Nb++)Ub[Nb]=Fb[Nb];for(;Nb<Xb;Nb++)Ub[Nb]=255&Fb[Nb]+(Ub[Nb-Ob]>>1)}else{for(;Nb<Ob;Nb++)Ub[Nb]=255&Fb[Nb]+(qb[Nb]>>1);for(;Nb<Xb;Nb++)Ub[Nb]=255&Fb[Nb]+(Ub[Nb-Ob]+qb[Nb]>>1)}}function as(Fb,Ub,qb,Xb,Ob){var Nb=0;if(0===qb.length){for(;Nb<Ob;Nb++)Ub[Nb]=Fb[Nb];for(;Nb<Xb;Nb++)Ub[Nb]=255&Fb[Nb]+Ub[Nb-Ob]}else{for(;Nb<Ob;Nb++)Ub[Nb]=255&Fb[Nb]+qb[Nb];for(;Nb<Xb;Nb++)Ub[Nb]=255&Fb[Nb]+is(Ub[Nb-Ob],qb[Nb],qb[Nb-Ob])}}function is(Fb,Ub,qb){var Xb=Fb+Ub-qb,Ob=_Mathabs(Xb-Fb),Nb=_Mathabs(Xb-Ub),Gb=_Mathabs(Xb-qb);return Ob<=Nb&&Ob<=Gb?Fb:Nb<=Gb?Ub:qb}function ns(Fb){return'number'==typeof Fb?[Fb]:Fb}function os(Fb,Ub){if(1===Ub)return Fb.readUint8();for(var qb=new Uint8Array(Ub),Xb=0;Xb<Ub;Xb++)qb[Xb]=Fb.readUint8();return qb}function _s(Fb,Ub,qb,Xb){return 8===qb?new Uint8Array(Fb*Ub):16===qb?new Uint16Array(Fb*Ub):32===qb&&3===Xb?new Float32Array(Fb*Ub):vs('bit depth / sample format',qb+' / '+Xb)}function ws(Fb,Ub,qb,Xb){for(var Ob=0;Ob<Xb;Ob++)Fb[qb++]=Ub.getUint8(Ob);return qb}function xs(Fb,Ub,qb,Xb,Ob){for(var Nb=0;Nb<2*Xb;Nb+=2)Fb[qb++]=Ub.getUint16(Nb,Ob);return qb}function ys(Fb,Ub,qb,Xb,Ob){for(var Nb=0;Nb<4*Xb;Nb+=4)Fb[qb++]=Ub.getFloat32(Nb,Ob);return qb}function vs(Fb,Ub){throw new Error('Unsupported '+Fb+': '+Ub)}function Ds(Fb){if(Fb.length){const qb=Fb;Fb=qb[0];for(var Ub=0;Ub<qb.length;Ub++)qb[Ub]!==Fb&&vs('bit depth',qb)}return Fb}function Ms(Fb){var qb=Fb.length,Xb='',Ub;for(Ub=0;Ub<qb;Ub+=3)Xb+=Yf[Fb[Ub]>>2],Xb+=Yf[(3&Fb[Ub])<<4|Fb[Ub+1]>>4],Xb+=Yf[(15&Fb[Ub+1])<<2|Fb[Ub+2]>>6],Xb+=Yf[63&Fb[Ub+2]];return 2==qb%3?Xb=Xb.substring(0,Xb.length-1)+'=':1==qb%3&&(Xb=Xb.substring(0,Xb.length-2)+'=='),Xb}function Ss(Fb){var Ub=0.75*Fb.length,qb=Fb.length,Xb=0,Ob,Nb,Gb,Hb;'='===Fb[Fb.length-1]&&(Ub--,'='===Fb[Fb.length-2]&&Ub--);for(var Wb=new Uint8Array(Ub),Zb=0;Zb<qb;Zb+=4)Ob=Ff[Fb.charCodeAt(Zb)],Nb=Ff[Fb.charCodeAt(Zb+1)],Gb=Ff[Fb.charCodeAt(Zb+2)],Hb=Ff[Fb.charCodeAt(Zb+3)],Wb[Xb++]=Ob<<2|Nb>>4,Wb[Xb++]=(15&Nb)<<4|Gb>>2,Wb[Xb++]=(3&Gb)<<6|63&Hb;return Wb}function Is(Fb){return(255&Fb)<<8|255&Fb>>8}function Ps(Fb,Ub){if('string'==typeof Fb)return Bs(Fb,Ub);if(Fb instanceof ArrayBuffer)return Promise.resolve(Cs(new Uint8Array(Fb),Ub));if(Fb.buffer)return Promise.resolve(Cs(Fb,Ub));throw new Error('argument to "load" must be a string or buffer.')}function Cs(Fb,Ub,qb){function Xb(Hb,Wb){if(!Hb)throw new Error(`This kind of image (${Ob}) can only be loaded from URL.`);return Ts(Hb,Wb)}var Ob=Vf(Fb);if(Ob)switch(Ob.ext){case'png':return As(Fb);case'jpg':{var Nb=Lf(Fb),Gb;return Nb.exif&&(Gb=zs(Nb.exif)),Xb(qb,{meta:Gb})}case'tif':return Rs(Fb);}return Xb(qb)}function Bs(Fb,Ub){var qb=Fb.slice(0,64).match(qf),Xb;return Xb=qb?Promise.resolve(Ss(Fb.slice(qb[0].length))):L(Fb,Ub),Xb.then((Ob)=>{var Nb=new Uint8Array(Ob);return Cs(Nb,Ub,Fb)})}function As(Fb){var Ub=new of(Fb),qb=Ub.decode(),Xb=qb.bitDepth,Ob=qb.data.buffer,Nb;if(8===Xb)Nb=new Uint8ClampedArray(Ob);else if(16===Xb){Nb=new Uint16Array(Ob);for(var Gb=0;Gb<Nb.length;Gb++)Nb[Gb]=Is(Nb[Gb])}var Hb=qb.colourType,Zb=0,Wb;switch(Hb){case 0:Wb=1;break;case 2:Wb=3;break;case 4:Wb=1,Zb=1;break;case 6:Wb=3,Zb=1;break;default:throw new Error(`Unexpected colourType: ${Hb}`);}return new Sb(qb.width,qb.height,Nb,{components:Wb,alpha:Zb,bitDepth:Xb})}function Rs(Fb){var Ub=Af(Fb);return 1===Ub.length?Es(Ub[0]):new Uh(Ub.map(Es))}function zs(Fb){var Ub={tiff:Fb};return Fb.exif&&(Ub.exif=Fb.exif),Fb.gps&&(Ub.gps=Fb.gps),Ub}function Es(Fb){return new Sb(Fb.width,Fb.height,Fb.data,{components:1,alpha:0,colorModel:null,bitDepth:Fb.bitsPerSample.length?Fb.bitsPerSample[0]:Fb.bitsPerSample,meta:zs(Fb)})}function Ts(Fb,Ub){return Ub=Ub||{},new Promise(function(qb,Xb){var Ob=new Wr;P(Fb)&&(Ob.crossOrigin='Anonymous'),Ob.onload=function(){var Nb=Ob.width,Gb=Ob.height,Hb=new R(Nb,Gb),Wb=Hb.getContext('2d');Wb.drawImage(Ob,0,0,Nb,Gb);var Zb=Wb.getImageData(0,0,Nb,Gb).data;qb(new Sb(Nb,Gb,Zb,Ub))},Ob.onerror=function(){Xb(new Error('Could not load '+Fb))},Ob.src=Fb})}function Vs(Fb){for(var Ub=0,qb;Ub<Fb.length;Ub++)if(qb=Fb[Ub],qb.buffer instanceof ArrayBuffer){var Xb=qb.buffer;if(qb.byteLength!==Xb.byteLength){var Ob=new Uint8Array(qb.byteLength);Ob.set(new Uint8Array(Xb,qb.byteOffset,qb.byteLength)),Xb=Ob.buffer}Fb[Ub]=Xb}}function Ys(Fb,Ub){Ub=Ub||{};var qb=new Xf;Vs(Fb);for(var Xb=0;Xb<Fb.length;Xb++)qb.append(Fb[Xb]);return Ub.type?qb.getBlob(Ub.type):qb.getBlob()}function Fs(Fb,Ub){return Vs(Fb),new Blob(Fb,Ub||{})}function Us(){eb=!0;for(var qb=tb.length,Fb,Ub;qb;){for(Ub=tb,tb=[],Fb=-1;++Fb<qb;)Ub[Fb]();qb=tb.length}eb=!1}function Xs(){}function Os(Fb){if('function'!=typeof Fb)throw new TypeError('resolver must be a function');this.state=sb,this.queue=[],this.outcome=void 0,Fb!==Xs&&Ws(this,Fb)}function Ns(Fb,Ub,qb){this.promise=Fb,'function'==typeof Ub&&(this.onFulfilled=Ub,this.callFulfilled=this.otherCallFulfilled),'function'==typeof qb&&(this.onRejected=qb,this.callRejected=this.otherCallRejected)}function Gs(Fb,Ub,qb){ab(function(){var Xb;try{Xb=Ub(qb)}catch(Ob){return ib.reject(Fb,Ob)}Xb===Fb?ib.reject(Fb,new TypeError('Cannot resolve promise with itself')):ib.resolve(Fb,Xb)})}function Hs(Fb){var Ub=Fb&&Fb.then;if(Fb&&('object'==typeof Fb||'function'==typeof Fb)&&'function'==typeof Ub)return function(){Ub.apply(Fb,arguments)}}function Ws(Fb,Ub){function qb(Hb){Nb||(Nb=!0,ib.reject(Fb,Hb))}function Xb(Hb){Nb||(Nb=!0,ib.resolve(Fb,Hb))}var Nb=!1,Gb=Zs(function(){Ub(Xb,qb)});'error'===Gb.status&&qb(Gb.value)}function Zs(Fb,Ub){var qb={};try{qb.value=Fb(Ub),qb.status='success'}catch(Xb){qb.status='error',qb.value=Xb}return qb}function er(Fb){for(var Ub=Fb.length,qb=new ArrayBuffer(Ub),Xb=new Uint8Array(qb),Ob=-1;++Ob<Ub;)Xb[Ob]=Fb.charCodeAt(Ob);return qb}function tr(Fb){for(var Ub='',qb=new Uint8Array(Fb),Xb=qb.byteLength,Ob=-1;++Ob<Xb;)Ub+=_StringfromCharCode(qb[Ob]);return Ub}function ar(Fb,Ub){return new lb(function(qb,Xb){var Ob=new Image;Ub&&(Ob.crossOrigin=Ub),Ob.onload=function(){qb(Ob)},Ob.onerror=Xb,Ob.src=Fb})}function nr(Fb){var Ub=document.createElement('canvas');Ub.width=Fb.width,Ub.height=Fb.height;var qb=Ub.getContext('2d');return qb.drawImage(Fb,0,0,Fb.width,Fb.height,0,0,Fb.width,Fb.height),Ub}function or(Fb,Ub){return Ub=Ub||{},'string'==typeof Ub&&(Ub={type:Ub}),new Hf(Fb,Ub)}function lr(Fb){return new lb(function(Ub,qb){var Xb=new FileReader,Ob='function'==typeof Xb.readAsBinaryString;Xb.onloadend=function(Nb){var Gb=Nb.target.result||'';return Ob?Ub(Gb):void Ub(tr(Gb))},Xb.onerror=qb,Ob?Xb.readAsBinaryString(Fb):Xb.readAsArrayBuffer(Fb)})}function dr(Fb,Ub){return lb.resolve().then(function(){var qb=[er(atob(Fb))];return Ub?or(qb,{type:Ub}):or(qb)})}function cr(Fb){return lb.resolve().then(function(){var Ub=Fb.match(/data:([^;]+)/)[1],qb=Fb.replace(/^[^,]+,/,''),Xb=er(atob(qb));return or([Xb],{type:Ub})})}function ur(Fb,Ub,qb){return lb.resolve().then(function(){return'function'==typeof Fb.toBlob?new lb(function(Xb){Fb.toBlob(Xb,Ub,qb)}):cr(Fb.toDataURL(Ub,qb))})}function _r(Fb,Ub){const qb=4*_Mathfloor((Ub.bitDepth*Ub.width+31)/32),Xb=_Mathceil(Ub.bitDepth*Ub.width/8),Nb=Ub.bitDepth*Ub.width%8,Gb=0==Nb?0:8-Nb,Hb=qb*Ub.height;var Wb,Zb;const Qb=new _b(Ub.data);let Kb=0,Jb=0,$b=8;Fb.mark(),Zb=Qb.readUint8();for(var e_=Ub.height-1;0<=e_;e_--){const a_=0===e_;Fb.reset(),Fb.skip(e_*qb);for(var t_=0;t_<Xb;t_++){const i_=t_===Xb-1;Jb<=Gb&&i_?(Fb.writeByte(Zb<<Jb),(0==Gb||Gb==Jb)&&!a_&&(Wb=Zb,Zb=Qb.readByte())):0==Jb?(Wb=Zb,Zb=Qb.readUint8(),Fb.writeByte(Wb)):(Wb=Zb,Zb=Qb.readUint8(),Fb.writeByte(Wb<<Jb&xb[Jb]|Zb>>$b)),i_?(Kb+=Nb||8,Fb.skip(qb-Xb),Jb=Kb%8,$b=8-Jb):Kb+=8}}qb>Xb&&(Fb.reset(),Fb.skip(Hb-1),Fb.writeUint8(0))}function kr(Fb,Ub){8<Ub.bitDepth||Fb.writeUint32(0).writeUint32(16777215)}function Dr(Fb,Ub){Fb.writeChars('BM'),Fb.writeInt32(Fb._lastWrittenByte),Fb.writeUint16(0),Fb.writeUint16(0),Fb.writeUint32(Ub)}function jr(Fb,Ub){Fb.writeUint32(124).writeInt32(Ub.width).writeInt32(Ub.height).writeUint16(1).writeUint16(Ub.bitDepth).writeUint32(wb.BITMAPV5HEADER.Compression.BI_RGB).writeUint32(Ub.width*Ub.height*Ub.bitDepth).writeInt32(0).writeInt32(0).writeUint32(_Mathpow(2,Ub.bitDepth)).writeUint32(_Mathpow(2,Ub.bitDepth)).writeUint32(4278190080).writeUint32(16711680).writeUint32(65280).writeUint32(255).writeUint32(wb.BITMAPV5HEADER.LogicalColorSpace.LCS_sRGB).skip(36).skip(12).writeUint32(wb.BITMAPV5HEADER.GamutMappingIntent.LCS_GM_IMAGES).skip(12)}function Sr(Fb,Ub){if('string'!=typeof Fb&&'function'!=typeof Fb)throw new TypeError('func argument must be a function');if(void 0===Ub&&(Ub={}),'object'!=typeof Ub||null===Ub)throw new TypeError('options argument must be an object');this._workerCode=Fb.toString(),this._numWorkers=void 0===Ub.maxWorkers||'auto'===Ub.maxWorkers?_Mathmin(Rb-1,1):0<Ub.maxWorkers?_Mathmin(Ub.maxWorkers,Rb):Rb,this._workers=new Map,this._timeout=Ub.timeout||0,this._terminateOnError=!!Ub.terminateOnError;var qb=Ub.deps;'string'==typeof qb&&(qb=[qb]),Array.isArray(qb)||(qb=void 0),this._id=0,this._terminated=!1,this._working=0,this._waiting=[],this._init(qb)}function Pr(Fb,Ub,qb){return Fb.post('data',[Ub,qb]).then(function(Xb){for(var Ob in Xb)Xb[Ob]=new Sb(Xb[Ob]);return Xb})}var Ar='BINARY',Er='RGBA',Yr='RGB',Fr='HSL',Ur='HSV',Xr='CMYK',Or='GREY',Nr={};Nr[Ar]={components:1,alpha:0,bitDepth:1,colorModel:Or},Nr['GREYA']={components:1,alpha:1,bitDepth:8,colorModel:Or},Nr['GREY']={components:1,alpha:0,bitDepth:8,colorModel:Or},Nr[Er]={components:3,alpha:1,bitDepth:8,colorModel:Yr},Nr['RGB']={components:3,alpha:0,bitDepth:8,colorModel:Yr},Nr['CMYK']={components:4,alpha:0,bitDepth:8,colorModel:Xr},Nr['CMYKA']={components:4,alpha:1,bitDepth:8,colorModel:Xr};var Hr=self.ImageData,Wr=self.Image,Zr=self.location.origin,Qr=Number.isNaN||function(Fb){return Fb!==Fb},Kr=function(Fb,Ub){return de(Fb),de(Ub),Fb-Ub},Jr='undefined'==typeof window?'undefined'==typeof global?'undefined'==typeof self?{}:self:global:window,$r=ge(function(Fb,Ub){(function(){var Xb=Ub;var Ob={release:'0.3.0',date:'2013-03'};Xb.toString=function(){return'version '+Ob.release+', released '+Ob.date};for(var Nb=0,Gb=null,Hb=null,Wb={init:function(Kb){if(0!==Kb&&0==(Kb&Kb-1))Nb=Kb,Wb._initArray(),Wb._makeBitReversalTable(),Wb._makeCosSinTable();else throw new Error('init: radix-2 required')},fft1d:function(Kb,Jb){Wb.fft(Kb,Jb,1)},ifft1d:function(Kb,Jb){var $b=1/Nb;Wb.fft(Kb,Jb,-1);for(var e_=0;e_<Nb;e_++)Kb[e_]*=$b,Jb[e_]*=$b},bt1d:function(Kb,Jb){Wb.fft(Kb,Jb,-1)},fft2d:function(Kb,Jb){for(var $b=[],e_=[],t_=0,a_=0;a_<Nb;a_++){t_=a_*Nb;for(var i_=0;i_<Nb;i_++)$b[i_]=Kb[i_+t_],e_[i_]=Jb[i_+t_];Wb.fft1d($b,e_);for(var n_=0;n_<Nb;n_++)Kb[n_+t_]=$b[n_],Jb[n_+t_]=e_[n_]}for(var o_=0;o_<Nb;o_++){for(var s_=0;s_<Nb;s_++)t_=o_+s_*Nb,$b[s_]=Kb[t_],e_[s_]=Jb[t_];Wb.fft1d($b,e_);for(var r_=0;r_<Nb;r_++)t_=o_+r_*Nb,Kb[t_]=$b[r_],Jb[t_]=e_[r_]}},ifft2d:function(Kb,Jb){for(var $b=[],e_=[],t_=0,a_=0;a_<Nb;a_++){t_=a_*Nb;for(var i_=0;i_<Nb;i_++)$b[i_]=Kb[i_+t_],e_[i_]=Jb[i_+t_];Wb.ifft1d($b,e_);for(var n_=0;n_<Nb;n_++)Kb[n_+t_]=$b[n_],Jb[n_+t_]=e_[n_]}for(var o_=0;o_<Nb;o_++){for(var s_=0;s_<Nb;s_++)t_=o_+s_*Nb,$b[s_]=Kb[t_],e_[s_]=Jb[t_];Wb.ifft1d($b,e_);for(var r_=0;r_<Nb;r_++)t_=o_+r_*Nb,Kb[t_]=$b[r_],Jb[t_]=e_[r_]}},fft:function(Kb,Jb,$b){for(var d_=Nb>>2,h_=0,e_,t_,a_,i_,n_,o_,s_,r_,l_;h_<Nb;h_++)i_=Gb[h_],h_<i_&&(n_=Kb[h_],Kb[h_]=Kb[i_],Kb[i_]=n_,n_=Jb[h_],Jb[h_]=Jb[i_],Jb[i_]=n_);for(var m_=1;m_<Nb;m_<<=1){t_=0,e_=Nb/(m_<<1);for(var c_=0;c_<m_;c_++){o_=Hb[t_+d_],s_=$b*Hb[t_];for(var g_=c_;g_<Nb;g_+=m_<<1)a_=g_+m_,r_=o_*Kb[a_]+s_*Jb[a_],l_=o_*Jb[a_]-s_*Kb[a_],Kb[a_]=Kb[g_]-r_,Kb[g_]+=r_,Jb[a_]=Jb[g_]-l_,Jb[g_]+=l_;t_+=e_}}},_initArray:function(){Gb='undefined'==typeof Uint32Array?[]:new Uint32Array(Nb),Hb='undefined'==typeof Float64Array?[]:new Float64Array(1.25*Nb)},_paddingZero:function(){},_makeBitReversalTable:function(){var Kb=0,Jb=0,$b=0;for(Gb[0]=0;++Kb<Nb;){for($b=Nb>>1;$b<=Jb;)Jb-=$b,$b>>=1;Jb+=$b,Gb[Kb]=Jb}},_makeCosSinTable:function(){var Kb=Nb>>1,Jb=Nb>>2,$b=Nb>>3,t_=_Mathsin(_MathPI/Nb),a_=2*t_*t_,i_=_Mathsqrt(a_*(2-a_)),n_=Hb[Jb]=1,o_=Hb[0]=0;t_=2*a_;for(var s_=1;s_<$b;s_++)n_-=a_,a_+=t_*n_,o_+=i_,i_-=t_*o_,Hb[s_]=o_,Hb[Jb-s_]=n_;0!=$b&&(Hb[$b]=0.7071067811865476);for(var r_=0;r_<Jb;r_++)Hb[Kb-r_]=Hb[r_];for(var l_=0;l_<Kb+Jb;l_++)Hb[l_+Kb]=-Hb[l_]}},Zb=['init','fft1d','ifft1d','fft2d','ifft2d'],Qb=0;Qb<Zb.length;Qb++)Xb[Zb[Qb]]=Wb[Zb[Qb]];return Xb.bt=Wb.bt1d,Xb.fft=Wb.fft1d,Xb.ifft=Wb.ifft1d,Xb}).call(Jr)}),sl={FFTUtils:{DEBUG:!1,ifft2DArray:function(Fb,Ub,qb){var Xb=Array(Ub*qb),Ob=Ub/2,Nb=2*(qb-1);$r.init(Ob);for(var Gb={re:Array(Ob),im:Array(Ob)},Hb=0;Hb<qb;Hb++){for(var Wb=Ob-1;0<=Wb;Wb--)Gb.re[Wb]=Fb[2*Wb*qb+Hb],Gb.im[Wb]=Fb[(2*Wb+1)*qb+Hb];$r.bt(Gb.re,Gb.im);for(var Wb=Ob-1;0<=Wb;Wb--)Xb[2*Wb*qb+Hb]=Gb.re[Wb],Xb[(2*Wb+1)*qb+Hb]=Gb.im[Wb]}var Zb=Array(Ob*Nb);$r.init(Nb);for(var Qb={re:Array(Nb),im:Array(Nb)},Wb=0;Wb<Ub;Wb+=2){Qb.re[0]=Xb[Wb*qb],Qb.im[0]=Xb[(Wb+1)*qb];for(var Hb=1;Hb<qb;Hb++)Qb.re[Hb]=Xb[Wb*qb+Hb],Qb.im[Hb]=Xb[(Wb+1)*qb+Hb],Qb.re[Nb-Hb]=Xb[Wb*qb+Hb],Qb.im[Nb-Hb]=-Xb[(Wb+1)*qb+Hb];$r.bt(Qb.re,Qb.im);for(var Jb=Wb/2*Nb,Hb=Nb-1;0<=Hb;Hb--)Zb[Jb+Hb]=Qb.re[Hb]/(Nb*Ob)}return Zb},fft2DArray:function(Fb,Ub,qb){var Ob=Object.assign({},{inplace:!0}),Nb=qb/2+1,Gb=2*Ub,Hb=Array(Gb*Nb);$r.init(qb);for(var Wb={re:Array(qb),im:Array(qb)},Zb={re:Array(qb),im:Array(qb)},Qb={re:Array(qb),im:Array(qb)},a_=0,Kb,Jb,$b,e_,t_;a_<Ub/2;a_++){Kb=2*a_*qb,Wb.re=Fb.slice(Kb,Kb+qb),Kb=(2*a_+1)*qb,Wb.im=Fb.slice(Kb,Kb+qb),$r.fft1d(Wb.re,Wb.im),this.reconstructTwoRealFFT(Wb,Zb,Qb),Jb=4*a_*Nb,$b=(4*a_+1)*Nb,e_=(4*a_+2)*Nb,t_=(4*a_+3)*Nb;for(var i_=Nb-1;0<=i_;i_--)Hb[Jb+i_]=Zb.re[i_],Hb[$b+i_]=Zb.im[i_],Hb[e_+i_]=Qb.re[i_],Hb[t_+i_]=Qb.im[i_]}Zb=null,Qb=null;var n_=Array(Gb*Nb);$r.init(Ub);for(var o_={re:Array(Ub),im:Array(Ub)},s_=Nb-1;0<=s_;s_--){for(var a_=Ub-1;0<=a_;a_--)o_.re[a_]=Hb[2*a_*Nb+s_],o_.im[a_]=Hb[(2*a_+1)*Nb+s_],isNaN(o_.re[a_])&&(o_.re[a_]=0),isNaN(o_.im[a_])&&(o_.im[a_]=0);$r.fft1d(o_.re,o_.im);for(var a_=Ub-1;0<=a_;a_--)n_[2*a_*Nb+s_]=o_.re[a_],n_[(2*a_+1)*Nb+s_]=o_.im[a_]}return n_},reconstructTwoRealFFT:function(Fb,Ub,qb){var Xb=Fb.re.length;Ub.re[0]=Fb.re[0],Ub.im[0]=0,qb.re[0]=Fb.im[0],qb.im[0]=0;for(var Zb=Xb/2,Ob,Nb,Gb,Hb,Wb;0<Zb;Zb--)Wb=Xb-Zb,Ob=0.5*(Fb.re[Zb]-Fb.re[Wb]),Nb=0.5*(Fb.re[Zb]+Fb.re[Wb]),Gb=0.5*(Fb.im[Zb]-Fb.im[Wb]),Hb=0.5*(Fb.im[Zb]+Fb.im[Wb]),Ub.re[Zb]=Nb,Ub.im[Zb]=Gb,Ub.re[Wb]=Nb,Ub.im[Wb]=-Gb,qb.re[Zb]=Hb,qb.im[Zb]=-Ob,qb.re[Wb]=Hb,qb.im[Wb]=Ob},convolute2DI:function(Fb,Ub,qb,Xb){for(var Gb=0,Ob,Nb;Gb<qb/2;Gb++)for(var Hb=0;Hb<Xb;Hb++)Ob=Fb[2*Gb*Xb+Hb]*Ub[2*Gb*Xb+Hb]-Fb[(2*Gb+1)*Xb+Hb]*Ub[(2*Gb+1)*Xb+Hb],Nb=Fb[2*Gb*Xb+Hb]*Ub[(2*Gb+1)*Xb+Hb]+Fb[(2*Gb+1)*Xb+Hb]*Ub[2*Gb*Xb+Hb],Fb[2*Gb*Xb+Hb]=Ob,Fb[(2*Gb+1)*Xb+Hb]=Nb},convolute:function(Fb,Ub,qb,Xb){for(var Nb=Array(Xb*qb),Gb=0;Gb<qb*Xb;Gb++)Nb[Gb]=Fb[Gb];Nb=this.fft2DArray(Nb,qb,Xb);for(var Hb=Ub.length,Wb=Ub[0].length,Zb=Array(Xb*qb),Gb=0;Gb<Xb*qb;Gb++)Zb[Gb]=0;for(var Jb=_Mathfloor((Hb-1)/2),$b=_Mathfloor((Wb-1)/2),e_=0,Qb,Kb;e_<Hb;e_++){Qb=(e_-Jb+qb)%qb;for(var t_=0;t_<Wb;t_++)Kb=(t_-$b+Xb)%Xb,Zb[Qb*Xb+Kb]=Ub[e_][t_]}Zb=this.fft2DArray(Zb,qb,Xb);var a_=2*qb,i_=Xb/2+1;return this.convolute2DI(Nb,Zb,a_,i_),this.ifft2DArray(Nb,a_,i_)},toRadix2:function(Fb,Ub,qb){var Hb=qb,Wb=Ub,Zb=0,Qb=0,Xb,Ob,Nb,Gb;if(0===qb||0!=(qb&qb-1)){for(Hb=0;0!=qb>>++Hb;);Hb=1<<Hb,Qb=Hb-qb}if(0===Ub||0!=(Ub&Ub-1)){for(Wb=0;0!=Ub>>++Wb;);Wb=1<<Wb,Zb=(Wb-Ub)*Hb}if(Wb==Ub&&Hb==qb)return{data:Fb,rows:Ub,cols:qb};var Kb=Array(Wb*Hb),Jb=_Mathfloor((Wb-Ub)/2)-Ub,$b=_Mathfloor((Hb-qb)/2)-qb;for(Xb=0;Xb<Wb;Xb++)for(Nb=Xb*Hb,Gb=(Xb-Jb)%Ub*qb,Ob=0;Ob<Hb;Ob++)Kb[Nb+Ob]=Fb[Gb+(Ob-$b)%qb];return{data:Kb,rows:Wb,cols:Hb}},crop:function(Fb,Ub,qb,Xb,Ob,Nb){if(Ub==Xb&&qb==Ob)return Fb;var Gb=Object.assign({},Nb),Hb=Array(Ob*Xb),Wb=_Mathfloor((Ub-Xb)/2),Zb=_Mathfloor((qb-Ob)/2),Qb,Kb,Jb,$b;for(Jb=0;Jb<Xb;Jb++)for(Qb=Jb*Ob,Kb=(Jb+Wb)*qb,$b=0;$b<Ob;$b++)Hb[Qb+$b]=Fb[Kb+($b+Zb)];return Hb}},FFT:$r}.FFTUtils,rl={fft:function(Fb,Ub,qb){var Xb=be(Fb),Ob=Xb.data,Nb=Object.assign({normalize:!1,divisor:1,rows:Xb.rows,cols:Xb.cols},qb),Gb,Hb;if(Nb.rows&&Nb.cols)Gb=Nb.rows,Hb=Nb.cols;else throw new Error('Invalid number of rows or columns '+Gb+' '+Hb);var Wb=Nb.divisor,Kb=Ub.length,Jb=Ub[0].length,Zb,Qb;if(Nb.normalize)for(Wb=0,Zb=0;Zb<Kb;Zb++)for(Qb=0;Qb<Jb;Qb++)Wb+=Ub[Zb][Qb];if(0===Wb)throw new RangeError('convolution: The divisor is equal to zero');var $b=sl.toRadix2(Ob,Gb,Hb),e_=sl.convolute($b.data,Ub,$b.rows,$b.cols);if(e_=sl.crop(e_,$b.rows,$b.cols,Gb,Hb),0!=Wb&&1!=Wb)for(Zb=0;Zb<e_.length;Zb++)e_[Zb]/=Wb;return e_},direct:function(Fb,Ub,qb){var Xb=be(Fb),Ob=Xb.data,Nb=Object.assign({normalize:!1,divisor:1,rows:Xb.rows,cols:Xb.cols},qb),Gb,Hb;if(Nb.rows&&Nb.cols)Gb=Nb.rows,Hb=Nb.cols;else throw new Error('Invalid number of rows or columns '+Gb+' '+Hb);var Wb=Nb.divisor,Zb=Ub.length,Qb=Ub[0].length,Kb,Jb,$b,e_,t_,a_,i_,n_,o_;if(Nb.normalize)for(Wb=0,Kb=0;Kb<Zb;Kb++)for(Jb=0;Jb<Qb;Jb++)Wb+=Ub[Kb][Jb];if(0===Wb)throw new RangeError('convolution: The divisor is equal to zero');var s_=Array(Gb*Hb),r_=_Mathfloor(Zb/2),l_=_Mathfloor(Qb/2);for(e_=0;e_<Gb;e_++)for($b=0;$b<Hb;$b++){for(a_=0,Jb=0;Jb<Zb;Jb++)for(Kb=0;Kb<Qb;Kb++)i_=Ub[Zb-Jb-1][Qb-Kb-1],n_=(e_+Jb-r_+Gb)%Gb,o_=($b+Kb-l_+Hb)%Hb,t_=n_*Hb+o_,a_+=Ob[t_]*i_;t_=e_*Hb+$b,s_[t_]=a_/Wb}return s_},kernelFactory:{LoG:function(Fb,Ub,qb){var Xb=1e3;qb&&qb.factor&&(Xb=qb.factor);var Ob=Array(Ub),Nb,Gb,Hb,Wb;Xb*=-1;var Qb=(Ub-1)/2;for(Nb=0;Nb<Ub;Nb++)for(Ob[Nb]=Array(Ub),Wb=(Nb-Qb)*(Nb-Qb),Gb=0;Gb<Ub;Gb++)Hb=-((Gb-Qb)*(Gb-Qb)+Wb)/(2*Fb*Fb),Ob[Nb][Gb]=_Mathround(Xb*(1+Hb)*_Mathexp(Hb));return Ob}},matrix2Array:be},ll=rl.direct,dl=rl.fft,hl=_NumberisFinite||function(Fb){return!('number'!=typeof Fb||Qr(Fb)||Fb===Infinity||Fb===-Infinity)},ml=_NumberisInteger||function(Fb){return'number'==typeof Fb&&hl(Fb)&&_Mathfloor(Fb)===Fb},ul=[[-1,0,1],[-2,0,2],[-1,0,1]],pl=[[-1,-2,-1],[0,0,0],[1,2,1]],_l=function(Fb,Ub){Fb=Fb||0;for(var qb=Array(Fb),Xb=0;Xb<Fb;Xb++)qb[Xb]=Ub;return qb},wl=Object.prototype.toString,kl=function(Ub){return'Array'===wl.call(Ub).substr(-6,5)},Dl={maybeToPrecision:function(Ub,qb){return 0>Ub?(Ub=-1*Ub,qb?'- '+Ub.toPrecision(qb):'- '+Ub.toString()):qb?Ub.toPrecision(qb):Ub.toString()}};var Ml=class{predict(Fb){var Ub;if(Array.isArray(Fb)){Ub=Array(Fb.length);for(var qb=0;qb<Fb.length;qb++)Ub[qb]=this._predict(Fb[qb])}else if(_NumberisFinite(Fb))Ub=this._predict(Fb);else throw new TypeError('x must be a number or array');return Ub}_predict(){throw new Error('_compute not implemented')}train(){}toString(){return''}toLaTeX(){return''}modelQuality(Fb,Ub){let qb=Fb.length;var Xb=Array(qb);for(let Jb=0;Jb<qb;Jb++)Xb[Jb]=this._predict(Fb[Jb]);var Ob=0,Nb=0,Gb=0,Hb=0,Wb=0,Zb=0,Qb=0;for(let Jb=0;Jb<qb;Jb++)Ob+=Xb[Jb],Nb+=Ub[Jb],Wb+=Xb[Jb]*Xb[Jb],Zb+=Ub[Jb]*Ub[Jb],Qb+=Xb[Jb]*Ub[Jb],0!==Ub[Jb]&&(Gb+=(Ub[Jb]-Xb[Jb])*(Ub[Jb]-Xb[Jb])/Ub[Jb]),Hb=(Ub[Jb]-Xb[Jb])*(Ub[Jb]-Xb[Jb]);var Kb=(qb*Qb-Ob*Nb)/_Mathsqrt((qb*Wb-Ob*Ob)*(qb*Zb-Nb*Nb));return{r:Kb,r2:Kb*Kb,chi2:Gb,rmsd:Hb*Hb/qb}}},Sl=Dl.maybeToPrecision;class Il extends Ml{constructor(Fb,Ub,qb){if(qb=qb||{},super(),!0===Fb)this.slope=Ub.slope,this.intercept=Ub.intercept,this.quality=Ub.quality||{},Ub.quality.r&&(this.quality.r=Ub.quality.r,this.quality.r2=Ub.quality.r2),Ub.quality.chi2&&(this.quality.chi2=Ub.quality.chi2);else{var Xb=Fb.length;if(Xb!==Ub.length)throw new RangeError('input and output array have a different length');for(var Ob=0,Nb=0,Gb=0,Hb=0,Wb=0;Wb<Xb;Wb++)Ob+=Fb[Wb],Nb+=Ub[Wb],Gb+=Fb[Wb]*Fb[Wb],Hb+=Fb[Wb]*Ub[Wb];var Zb=Xb*Hb-Ob*Nb;this.slope=Zb/(Xb*Gb-Ob*Ob),this.intercept=1/Xb*Nb-this.slope*(1/Xb)*Ob,this.coefficients=[this.intercept,this.slope],qb.computeQuality&&(this.quality=this.modelQuality(Fb,Ub))}}toJSON(){var Fb={name:'simpleLinearRegression',slope:this.slope,intercept:this.intercept};return this.quality&&(Fb.quality=this.quality),Fb}_predict(Fb){return this.slope*Fb+this.intercept}computeX(Fb){return(Fb-this.intercept)/this.slope}toString(Fb){var Ub='f(x) = ';if(this.slope){var qb=Sl(this.slope,Fb);if(Ub+=(1e-5>_Mathabs(qb-1)?'':qb+' * ')+'x',this.intercept){var Xb=_Mathabs(this.intercept),Ob=Xb===this.intercept?'+':'-';Ub+=' '+Ob+' '+Sl(Xb,Fb)}}else Ub+=Sl(this.intercept,Fb);return Ub}toLaTeX(Fb){return this.toString(Fb)}static load(Fb){if('simpleLinearRegression'!==Fb.name)throw new TypeError('not a SLR model');return new Il(!0,Fb)}}var Pl=Il;Symbol.species||(Symbol.species=Symbol.for('@@species')),Re.prototype={isSingular:function(){for(var Fb=this.LU,Ub=Fb.columns,qb=0;qb<Ub;qb++)if(0===Fb[qb][qb])return!0;return!1},get determinant(){var Fb=this.LU;if(!Fb.isSquare())throw new Error('Matrix must be square');for(var Ub=this.pivotSign,qb=Fb.columns,Xb=0;Xb<qb;Xb++)Ub*=Fb[Xb][Xb];return Ub},get lowerTriangularMatrix(){for(var Fb=this.LU,Ub=Fb.rows,qb=Fb.columns,Xb=new $l(Ub,qb),Ob=0;Ob<Ub;Ob++)for(var Nb=0;Nb<qb;Nb++)Xb[Ob][Nb]=Ob>Nb?Fb[Ob][Nb]:Ob===Nb?1:0;return Xb},get upperTriangularMatrix(){for(var Fb=this.LU,Ub=Fb.rows,qb=Fb.columns,Xb=new $l(Ub,qb),Ob=0;Ob<Ub;Ob++)for(var Nb=0;Nb<qb;Nb++)Xb[Ob][Nb]=Ob<=Nb?Fb[Ob][Nb]:0;return Xb},get pivotPermutationVector(){return this.pivotVector.slice()},solve:function(Fb){Fb=$l.checkMatrix(Fb);var Ub=this.LU,qb=Ub.rows;if(qb!==Fb.rows)throw new Error('Invalid matrix dimensions');if(this.isSingular())throw new Error('LU matrix is singular');var Xb=Fb.columns,Ob=Fb.subMatrixRow(this.pivotVector,0,Xb-1),Nb=Ub.columns,Gb,Hb,Wb;for(Wb=0;Wb<Nb;Wb++)for(Gb=Wb+1;Gb<Nb;Gb++)for(Hb=0;Hb<Xb;Hb++)Ob[Gb][Hb]-=Ob[Wb][Hb]*Ub[Gb][Wb];for(Wb=Nb-1;0<=Wb;Wb--){for(Hb=0;Hb<Xb;Hb++)Ob[Wb][Hb]/=Ub[Wb][Wb];for(Gb=0;Gb<Wb;Gb++)for(Hb=0;Hb<Xb;Hb++)Ob[Gb][Hb]-=Ob[Wb][Hb]*Ub[Gb][Wb]}return Ob}},Ee.prototype={get condition(){return this.s[0]/this.s[_Mathmin(this.m,this.n)-1]},get norm2(){return this.s[0]},get rank(){for(var Ub=_Mathmax(this.m,this.n)*this.s[0]*2.220446049250313e-16,qb=0,Xb=this.s,Ob=0,Nb=Xb.length;Ob<Nb;Ob++)Xb[Ob]>Ub&&qb++;return qb},get diagonal(){return this.s},get threshold(){return 2.220446049250313e-16/2*_Mathmax(this.m,this.n)*this.s[0]},get leftSingularVectors(){return $l.isMatrix(this.U)||(this.U=new $l(this.U)),this.U},get rightSingularVectors(){return $l.isMatrix(this.V)||(this.V=new $l(this.V)),this.V},get diagonalMatrix(){return $l.diag(this.s)},solve:function(Fb){var qb=this.threshold,Xb=this.s.length,Ob=$l.zeros(Xb,Xb),Nb;for(Nb=0;Nb<Xb;Nb++)Ob[Nb][Nb]=_Mathabs(this.s[Nb])<=qb?0:1/this.s[Nb];var Gb=this.U,Hb=this.rightSingularVectors,Wb=Hb.mmul(Ob),Zb=Hb.rows,Qb=Gb.length,Kb=$l.zeros(Zb,Qb),Jb,$b,e_;for(Nb=0;Nb<Zb;Nb++)for(Jb=0;Jb<Qb;Jb++){for(e_=0,$b=0;$b<Xb;$b++)e_+=Wb[Nb][$b]*Gb[Jb][$b];Kb[Nb][Jb]=e_}return Kb.mmul(Fb)},solveForDiagonal:function(Fb){return this.solve($l.diag(Fb))},inverse:function(){var Fb=this.V,Ub=this.threshold,qb=Fb.length,Xb=Fb[0].length,Ob=new $l(qb,this.s.length),Nb,Gb;for(Nb=0;Nb<qb;Nb++)for(Gb=0;Gb<Xb;Gb++)Ob[Nb][Gb]=_Mathabs(this.s[Gb])>Ub?Fb[Nb][Gb]/this.s[Gb]:0;var Hb=this.U,Wb=Hb.length,Zb=Hb[0].length,Qb=new $l(qb,Wb),Kb,Jb;for(Nb=0;Nb<qb;Nb++)for(Gb=0;Gb<Wb;Gb++){for(Jb=0,Kb=0;Kb<Zb;Kb++)Jb+=Ob[Nb][Kb]*Hb[Gb][Kb];Qb[Nb][Gb]=Jb}return Qb}};var Cl=ge(function(Fb,Ub){'use strict';function qb(Xb,Ob){return Xb-Ob}Ub.sum=function(Ob){for(var Xb=0,Nb=0;Nb<Ob.length;Nb++)Xb+=Ob[Nb];return Xb},Ub.max=function(Ob){for(var Xb=Ob[0],Nb=Ob.length,Gb=1;Gb<Nb;Gb++)Ob[Gb]>Xb&&(Xb=Ob[Gb]);return Xb},Ub.min=function(Ob){for(var Xb=Ob[0],Nb=Ob.length,Gb=1;Gb<Nb;Gb++)Ob[Gb]<Xb&&(Xb=Ob[Gb]);return Xb},Ub.minMax=function(Ob){for(var Nb=Ob[0],Gb=Ob[0],Hb=Ob.length,Wb=1;Wb<Hb;Wb++)Ob[Wb]<Nb&&(Nb=Ob[Wb]),Ob[Wb]>Gb&&(Gb=Ob[Wb]);return{min:Nb,max:Gb}},Ub.arithmeticMean=function(Ob){for(var Nb=0,Gb=Ob.length,Hb=0;Hb<Gb;Hb++)Nb+=Ob[Hb];return Nb/Gb},Ub.mean=Ub.arithmeticMean,Ub.geometricMean=function(Ob){for(var Nb=1,Gb=Ob.length,Hb=0;Hb<Gb;Hb++)Nb*=Ob[Hb];return _Mathpow(Nb,1/Gb)},Ub.logMean=function(Ob){for(var Nb=0,Gb=Ob.length,Hb=0;Hb<Gb;Hb++)Nb+=_Mathlog(Ob[Hb]);return Nb/Gb},Ub.grandMean=function(Ob,Nb){for(var Gb=0,Hb=0,Wb=Ob.length,Zb=0;Zb<Wb;Zb++)Gb+=Nb[Zb]*Ob[Zb],Hb+=Nb[Zb];return Gb/Hb},Ub.truncatedMean=function(Ob,Nb,Gb){void 0===Gb&&(Gb=!1),Gb||(Ob=[].concat(Ob).sort(qb));for(var Hb=Ob.length,Wb=_Mathfloor(Hb*Nb),Zb=0,Qb=Wb;Qb<Hb-Wb;Qb++)Zb+=Ob[Qb];return Zb/(Hb-2*Wb)},Ub.harmonicMean=function(Ob){for(var Nb=0,Gb=Ob.length,Hb=0;Hb<Gb;Hb++){if(0===Ob[Hb])throw new RangeError('value at index '+Hb+'is zero');Nb+=1/Ob[Hb]}return Gb/Nb},Ub.contraHarmonicMean=function(Ob){for(var Nb=0,Gb=0,Hb=Ob.length,Wb=0;Wb<Hb;Wb++)Nb+=Ob[Wb]*Ob[Wb],Gb+=Ob[Wb];if(0>Gb)throw new RangeError('sum of values is negative');return Nb/Gb},Ub.median=function(Ob,Nb){void 0===Nb&&(Nb=!1),Nb||(Ob=[].concat(Ob).sort(qb));var Gb=Ob.length,Hb=_Mathfloor(Gb/2);return 0==Gb%2?0.5*(Ob[Hb-1]+Ob[Hb]):Ob[Hb]},Ub.variance=function(Ob,Nb){void 0===Nb&&(Nb=!0);for(var Gb=Ub.mean(Ob),Hb=0,Wb=Ob.length,Zb=0,Qb;Zb<Wb;Zb++)Qb=Ob[Zb]-Gb,Hb+=Qb*Qb;return Nb?Hb/(Wb-1):Hb/Wb},Ub.standardDeviation=function(Ob,Nb){return _Mathsqrt(Ub.variance(Ob,Nb))},Ub.standardError=function(Ob){return Ub.standardDeviation(Ob)/_Mathsqrt(Ob.length)},Ub.robustMeanAndStdev=function(Ob){var Nb=0,Gb=0,Hb=Ob.length,Wb=0;for(Wb=0;Wb<Hb;Wb++)Nb+=Ob[Wb];Nb/=Hb;var Zb=Array(Hb);for(Wb=0;Wb<Hb;Wb++)Zb[Wb]=_Mathabs(Ob[Wb]-Nb);return Zb.sort(qb),Gb=1==Hb%2?Zb[(Hb-1)/2]/0.6745:0.5*(Zb[Hb/2]+Zb[Hb/2-1])/0.6745,{mean:Nb,stdev:Gb}},Ub.quartiles=function(Ob,Nb){'undefined'==typeof Nb&&(Nb=!1),Nb||(Ob=[].concat(Ob).sort(qb));var Gb=Ob.length/4,Hb=Ob[_Mathceil(Gb)-1],Wb=Ub.median(Ob,!0),Zb=Ob[_Mathceil(3*Gb)-1];return{q1:Hb,q2:Wb,q3:Zb}},Ub.pooledStandardDeviation=function(Ob,Nb){return _Mathsqrt(Ub.pooledVariance(Ob,Nb))},Ub.pooledVariance=function(Ob,Nb){'undefined'==typeof Nb&&(Nb=!0);for(var Gb=0,Hb=0,Wb=Ob.length,Zb=0;Zb<Wb;Zb++){var Qb=Ob[Zb],Kb=Ub.variance(Qb);Gb+=(Qb.length-1)*Kb,Hb+=Nb?Qb.length-1:Qb.length}return Gb/Hb},Ub.mode=function(Ob){var Nb=Ob.length,Gb=Array(Nb),Hb;for(Hb=0;Hb<Nb;Hb++)Gb[Hb]=0;var Wb=Array(Nb),Zb=0;for(Hb=0;Hb<Nb;Hb++){var Qb=Wb.indexOf(Ob[Hb]);0<=Qb?Gb[Qb]++:(Wb[Zb]=Ob[Hb],Gb[Zb]=1,Zb++)}var Kb=0,Jb=0;for(Hb=0;Hb<Zb;Hb++)Gb[Hb]>Kb&&(Kb=Gb[Hb],Jb=Hb);return Wb[Jb]},Ub.covariance=function(Ob,Nb,Gb){'undefined'==typeof Gb&&(Gb=!0);var Hb=Ub.mean(Ob),Wb=Ub.mean(Nb);if(Ob.length!==Nb.length)throw'Vectors do not have the same dimensions';for(var Zb=0,Qb=Ob.length,Kb=0;Kb<Qb;Kb++){var Jb=Ob[Kb]-Hb,$b=Nb[Kb]-Wb;Zb+=Jb*$b}return Gb?Zb/(Qb-1):Zb/Qb},Ub.skewness=function(Ob,Nb){'undefined'==typeof Nb&&(Nb=!0);for(var Gb=Ub.mean(Ob),Hb=0,Wb=0,Zb=Ob.length,Qb=0,Kb;Qb<Zb;Qb++)Kb=Ob[Qb]-Gb,Hb+=Kb*Kb,Wb+=Kb*Kb*Kb;var Jb=Hb/Zb,$b=Wb/Zb,e_=$b/_Mathpow(Jb,3/2);if(Nb){var t_=_Mathsqrt(Zb*(Zb-1));return t_/(Zb-2)*e_}return e_},Ub.kurtosis=function(Ob,Nb){'undefined'==typeof Nb&&(Nb=!0);for(var Gb=Ub.mean(Ob),Hb=Ob.length,Wb=0,Zb=0,Qb=0,Kb;Qb<Hb;Qb++)Kb=Ob[Qb]-Gb,Wb+=Kb*Kb,Zb+=Kb*Kb*Kb*Kb;var Jb=Wb/Hb,$b=Zb/Hb;if(Nb){var e_=Wb/(Hb-1),a_=Zb/(e_*e_);return Hb*(Hb+1)/((Hb-1)*(Hb-2)*(Hb-3))*a_-3*((Hb-1)*(Hb-1)/((Hb-2)*(Hb-3)))}return $b/(Jb*Jb)-3},Ub.entropy=function(Ob,Nb){'undefined'==typeof Nb&&(Nb=0);for(var Gb=0,Hb=Ob.length,Wb=0;Wb<Hb;Wb++)Gb+=Ob[Wb]*_Mathlog(Ob[Wb]+Nb);return-Gb},Ub.weightedMean=function(Ob,Nb){for(var Gb=0,Hb=Ob.length,Wb=0;Wb<Hb;Wb++)Gb+=Ob[Wb]*Nb[Wb];return Gb},Ub.weightedStandardDeviation=function(Ob,Nb){return _Mathsqrt(Ub.weightedVariance(Ob,Nb))},Ub.weightedVariance=function(Ob,Nb){for(var Gb=Ub.weightedMean(Ob,Nb),Hb=0,Wb=Ob.length,Zb=0,Qb=0,Kb=0;Kb<Wb;Kb++){var Jb=Ob[Kb]-Gb,$b=Nb[Kb];Hb+=$b*(Jb*Jb),Qb+=$b,Zb+=$b*$b}return Hb*(Qb/(Qb*Qb-Zb))},Ub.center=function(Ob,Nb){'undefined'==typeof Nb&&(Nb=!1);var Gb=Ob;Nb||(Gb=[].concat(Ob));for(var Hb=Ub.mean(Gb),Wb=Gb.length,Zb=0;Zb<Wb;Zb++)Gb[Zb]-=Hb},Ub.standardize=function(Ob,Nb,Gb){'undefined'==typeof Nb&&(Nb=Ub.standardDeviation(Ob)),'undefined'==typeof Gb&&(Gb=!1);for(var Hb=Ob.length,Wb=Gb?Ob:Array(Hb),Zb=0;Zb<Hb;Zb++)Wb[Zb]=Ob[Zb]/Nb;return Wb},Ub.cumulativeSum=function(Ob){var Nb=Ob.length,Gb=Array(Nb);Gb[0]=Ob[0];for(var Hb=1;Hb<Nb;Hb++)Gb[Hb]=Gb[Hb-1]+Ob[Hb];return Gb}}),Bl=ge(function(Fb,Ub){'use strict';function qb(Xb,Ob){return Xb-Ob}Ub.max=function(Ob){for(var Xb=-Infinity,Nb=0;Nb<Ob.length;Nb++)for(var Gb=0;Gb<Ob[Nb].length;Gb++)Ob[Nb][Gb]>Xb&&(Xb=Ob[Nb][Gb]);return Xb},Ub.min=function(Ob){for(var Xb=Infinity,Nb=0;Nb<Ob.length;Nb++)for(var Gb=0;Gb<Ob[Nb].length;Gb++)Ob[Nb][Gb]<Xb&&(Xb=Ob[Nb][Gb]);return Xb},Ub.minMax=function(Ob){for(var Nb=Infinity,Gb=-Infinity,Hb=0;Hb<Ob.length;Hb++)for(var Wb=0;Wb<Ob[Hb].length;Wb++)Ob[Hb][Wb]<Nb&&(Nb=Ob[Hb][Wb]),Ob[Hb][Wb]>Gb&&(Gb=Ob[Hb][Wb]);return{min:Nb,max:Gb}},Ub.entropy=function(Ob,Nb){'undefined'==typeof Nb&&(Nb=0);for(var Gb=0,Hb=Ob.length,Wb=Ob[0].length,Zb=0;Zb<Hb;Zb++)for(var Qb=0;Qb<Wb;Qb++)Gb+=Ob[Zb][Qb]*_Mathlog(Ob[Zb][Qb]+Nb);return-Gb},Ub.mean=function(Ob,Nb){'undefined'==typeof Nb&&(Nb=0);var Gb=Ob.length,Hb=Ob[0].length,Wb,Zb,Qb,Kb;if(-1===Nb){for(Wb=[0],Zb=Gb*Hb,Qb=0;Qb<Gb;Qb++)for(Kb=0;Kb<Hb;Kb++)Wb[0]+=Ob[Qb][Kb];Wb[0]/=Zb}else if(0===Nb)for(Wb=Array(Hb),Zb=Gb,Kb=0;Kb<Hb;Kb++){for(Wb[Kb]=0,Qb=0;Qb<Gb;Qb++)Wb[Kb]+=Ob[Qb][Kb];Wb[Kb]/=Zb}else if(1===Nb)for(Wb=Array(Gb),Zb=Hb,Kb=0;Kb<Gb;Kb++){for(Wb[Kb]=0,Qb=0;Qb<Hb;Qb++)Wb[Kb]+=Ob[Kb][Qb];Wb[Kb]/=Zb}else throw new Error('Invalid dimension');return Wb},Ub.sum=function(Ob,Nb){'undefined'==typeof Nb&&(Nb=0);var Gb=Ob.length,Hb=Ob[0].length,Wb,Zb,Qb;if(-1===Nb)for(Wb=[0],Zb=0;Zb<Gb;Zb++)for(Qb=0;Qb<Hb;Qb++)Wb[0]+=Ob[Zb][Qb];else if(0===Nb)for(Wb=Array(Hb),Qb=0;Qb<Hb;Qb++)for(Wb[Qb]=0,Zb=0;Zb<Gb;Zb++)Wb[Qb]+=Ob[Zb][Qb];else if(1===Nb)for(Wb=Array(Gb),Qb=0;Qb<Gb;Qb++)for(Wb[Qb]=0,Zb=0;Zb<Hb;Zb++)Wb[Qb]+=Ob[Qb][Zb];else throw new Error('Invalid dimension');return Wb},Ub.product=function(Ob,Nb){'undefined'==typeof Nb&&(Nb=0);var Gb=Ob.length,Hb=Ob[0].length,Wb,Zb,Qb;if(-1===Nb)for(Wb=[1],Zb=0;Zb<Gb;Zb++)for(Qb=0;Qb<Hb;Qb++)Wb[0]*=Ob[Zb][Qb];else if(0===Nb)for(Wb=Array(Hb),Qb=0;Qb<Hb;Qb++)for(Wb[Qb]=1,Zb=0;Zb<Gb;Zb++)Wb[Qb]*=Ob[Zb][Qb];else if(1===Nb)for(Wb=Array(Gb),Qb=0;Qb<Gb;Qb++)for(Wb[Qb]=1,Zb=0;Zb<Hb;Zb++)Wb[Qb]*=Ob[Qb][Zb];else throw new Error('Invalid dimension');return Wb},Ub.standardDeviation=function(Ob,Nb,Gb){for(var Hb=Ub.variance(Ob,Nb,Gb),Wb=Hb.length,Zb=0;Zb<Wb;Zb++)Hb[Zb]=_Mathsqrt(Hb[Zb]);return Hb},Ub.variance=function(Ob,Nb,Gb){'undefined'==typeof Gb&&(Gb=!0),Nb=Nb||Ub.mean(Ob);var Hb=Ob.length;if(0===Hb)return[];for(var Wb=Ob[0].length,Zb=Array(Wb),Qb=0;Qb<Wb;Qb++){for(var Kb=0,Jb=0,$b=0,e_=0;e_<Hb;e_++)$b=Ob[e_][Qb]-Nb[Qb],Kb+=$b,Jb+=$b*$b;Zb[Qb]=Gb?(Jb-Kb*Kb/Hb)/(Hb-1):(Jb-Kb*Kb/Hb)/Hb}return Zb},Ub.median=function(Ob){for(var Nb=Ob.length,Gb=Ob[0].length,Hb=Array(Gb),Wb=0,Zb;Wb<Gb;Wb++){Zb=Array(Nb);for(var Qb=0;Qb<Nb;Qb++)Zb[Qb]=Ob[Qb][Wb];Zb.sort(qb);var Kb=Zb.length;Hb[Wb]=0==Kb%2?0.5*(Zb[Kb/2]+Zb[Kb/2-1]):Zb[_Mathfloor(Kb/2)]}return Hb},Ub.mode=function(Ob){var Nb=Ob.length,Gb=Ob[0].length,Hb=Array(Gb),Wb,Zb;for(Wb=0;Wb<Gb;Wb++){for(var Qb=Array(Nb),Kb=0;Kb<Nb;Kb++)Qb[Kb]=0;var Jb=Array(Nb),$b=0;for(Zb=0;Zb<Nb;Zb++){var e_=Jb.indexOf(Ob[Zb][Wb]);0<=e_?Qb[e_]++:(Jb[$b]=Ob[Zb][Wb],Qb[$b]=1,$b++)}var t_=0,a_=0;for(Zb=0;Zb<$b;Zb++)Qb[Zb]>t_&&(t_=Qb[Zb],a_=Zb);Hb[Wb]=Jb[a_]}return Hb},Ub.skewness=function(Ob,Nb){'undefined'==typeof Nb&&(Nb=!0);for(var Gb=Ub.mean(Ob),Hb=Ob.length,Wb=Gb.length,Zb=Array(Wb),Qb=0;Qb<Wb;Qb++){for(var Kb=0,Jb=0,$b=0,e_;$b<Hb;$b++)e_=Ob[$b][Qb]-Gb[Qb],Kb+=e_*e_,Jb+=e_*e_*e_;var t_=Kb/Hb,a_=Jb/Hb,i_=a_/_Mathpow(t_,3/2);if(Nb){var n_=_Mathsqrt(Hb*(Hb-1));Zb[Qb]=n_/(Hb-2)*i_}else Zb[Qb]=i_}return Zb},Ub.kurtosis=function(Ob,Nb){'undefined'==typeof Nb&&(Nb=!0);for(var Gb=Ub.mean(Ob),Hb=Ob.length,Wb=Ob[0].length,Zb=Array(Wb),Qb=0;Qb<Wb;Qb++){for(var Kb=0,Jb=0,$b=0,e_;$b<Hb;$b++)e_=Ob[$b][Qb]-Gb[Qb],Kb+=e_*e_,Jb+=e_*e_*e_*e_;var t_=Kb/Hb,a_=Jb/Hb;if(Nb){var i_=Kb/(Hb-1),o_=Jb/(i_*i_);Zb[Qb]=Hb*(Hb+1)/((Hb-1)*(Hb-2)*(Hb-3))*o_-3*((Hb-1)*(Hb-1)/((Hb-2)*(Hb-3)))}else Zb[Qb]=a_/(t_*t_)-3}return Zb},Ub.standardError=function(Ob){for(var Nb=Ob.length,Gb=Ub.standardDeviation(Ob),Hb=Gb.length,Wb=Array(Hb),Zb=_Mathsqrt(Nb),Qb=0;Qb<Hb;Qb++)Wb[Qb]=Gb[Qb]/Zb;return Wb},Ub.covariance=function(Ob,Nb){return Ub.scatter(Ob,void 0,Nb)},Ub.scatter=function(Ob,Nb,Gb){'undefined'==typeof Gb&&(Gb=0),'undefined'==typeof Nb&&(0===Gb?Nb=Ob.length-1:1===Gb&&(Nb=Ob[0].length-1));var Hb=Ub.mean(Ob,Gb),Wb=Ob.length;if(0===Wb)return[[]];var Zb=Ob[0].length,Qb,Kb,Jb,$b,e_;if(0===Gb){for(Qb=Array(Zb),Kb=0;Kb<Zb;Kb++)Qb[Kb]=Array(Zb);for(Kb=0;Kb<Zb;Kb++)for(Jb=Kb;Jb<Zb;Jb++){for($b=0,e_=0;e_<Wb;e_++)$b+=(Ob[e_][Jb]-Hb[Jb])*(Ob[e_][Kb]-Hb[Kb]);$b/=Nb,Qb[Kb][Jb]=$b,Qb[Jb][Kb]=$b}}else if(1===Gb){for(Qb=Array(Wb),Kb=0;Kb<Wb;Kb++)Qb[Kb]=Array(Wb);for(Kb=0;Kb<Wb;Kb++)for(Jb=Kb;Jb<Wb;Jb++){for($b=0,e_=0;e_<Zb;e_++)$b+=(Ob[Jb][e_]-Hb[Jb])*(Ob[Kb][e_]-Hb[Kb]);$b/=Nb,Qb[Kb][Jb]=$b,Qb[Jb][Kb]=$b}}else throw new Error('Invalid dimension');return Qb},Ub.correlation=function(Ob){var Nb=Ub.mean(Ob),Gb=Ub.standardDeviation(Ob,!0,Nb),Hb=Ub.zScores(Ob,Nb,Gb),Wb=Ob.length,Zb=Ob[0].length,Jb=Array(Zb),Qb,Kb;for(Qb=0;Qb<Zb;Qb++)Jb[Qb]=Array(Zb);for(Qb=0;Qb<Zb;Qb++)for(Kb=Qb;Kb<Zb;Kb++){for(var $b=0,e_=0,t_=Hb.length;e_<t_;e_++)$b+=Hb[e_][Kb]*Hb[e_][Qb];$b/=Wb-1,Jb[Qb][Kb]=$b,Jb[Kb][Qb]=$b}return Jb},Ub.zScores=function(Ob,Nb,Gb){return Nb=Nb||Ub.mean(Ob),'undefined'==typeof Gb&&(Gb=Ub.standardDeviation(Ob,!0,Nb)),Ub.standardize(Ub.center(Ob,Nb,!1),Gb,!0)},Ub.center=function(Ob,Nb,Gb){Nb=Nb||Ub.mean(Ob);var Hb=Ob,Wb=Ob.length,Zb,Qb,Kb;if(!Gb)for(Hb=Array(Wb),Zb=0;Zb<Wb;Zb++)Hb[Zb]=Array(Ob[Zb].length);for(Zb=0;Zb<Wb;Zb++){var Jb=Hb[Zb];for(Qb=0,Kb=Jb.length;Qb<Kb;Qb++)Jb[Qb]=Ob[Zb][Qb]-Nb[Qb]}return Hb},Ub.standardize=function(Ob,Nb,Gb){'undefined'==typeof Nb&&(Nb=Ub.standardDeviation(Ob));var Hb=Ob,Wb=Ob.length,Zb,Qb,Kb;if(!Gb)for(Hb=Array(Wb),Zb=0;Zb<Wb;Zb++)Hb[Zb]=Array(Ob[Zb].length);for(Zb=0;Zb<Wb;Zb++){var Jb=Hb[Zb],$b=Ob[Zb];for(Qb=0,Kb=Jb.length;Qb<Kb;Qb++)0===Nb[Qb]||isNaN(Nb[Qb])||(Jb[Qb]=$b[Qb]/Nb[Qb])}return Hb},Ub.weightedVariance=function(Ob,Nb){var Gb=Ub.mean(Ob),Hb=Ob.length;if(0===Hb)return[];for(var Wb=Ob[0].length,Zb=Array(Wb),Qb=0;Qb<Wb;Qb++){for(var Kb=0,Jb=0,$b=0,e_=0;e_<Hb;e_++){var t_=Ob[e_][Qb]-Gb[Qb],a_=Nb[e_];Kb+=a_*(t_*t_),$b+=a_,Jb+=a_*a_}Zb[Qb]=Kb*($b/($b*$b-Jb))}return Zb},Ub.weightedMean=function(Ob,Nb,Gb){'undefined'==typeof Gb&&(Gb=0);var Hb=Ob.length;if(0===Hb)return[];var Wb=Ob[0].length,Zb,Qb,Kb,Jb,$b,e_;if(0===Gb){for(Zb=Array(Wb),Qb=0;Qb<Wb;Qb++)Zb[Qb]=0;for(Qb=0;Qb<Hb;Qb++)for(e_=Ob[Qb],$b=Nb[Qb],Jb=0;Jb<Wb;Jb++)Zb[Jb]+=e_[Jb]*$b}else if(1===Gb){for(Zb=Array(Hb),Qb=0;Qb<Hb;Qb++)Zb[Qb]=0;for(Jb=0;Jb<Hb;Jb++)for(e_=Ob[Jb],$b=Nb[Jb],Qb=0;Qb<Wb;Qb++)Zb[Jb]+=e_[Qb]*$b}else throw new Error('Invalid dimension');var t_=Cl.sum(Nb);if(0!==t_)for(Qb=0,Kb=Zb.length;Qb<Kb;Qb++)Zb[Qb]/=t_;return Zb},Ub.weightedCovariance=function(Ob,Nb,Gb,Hb){Hb=Hb||0,Gb=Gb||Ub.weightedMean(Ob,Nb,Hb);for(var Wb=0,Zb=0,Qb=0,Kb=Nb.length;Qb<Kb;Qb++)Wb+=Nb[Qb],Zb+=Nb[Qb]*Nb[Qb];var Jb=Wb/(Wb*Wb-Zb);return Ub.weightedScatter(Ob,Nb,Gb,Jb,Hb)},Ub.weightedScatter=function(Ob,Nb,Gb,Hb,Wb){Wb=Wb||0,Gb=Gb||Ub.weightedMean(Ob,Nb,Wb),'undefined'==typeof Hb&&(Hb=1);var Zb=Ob.length;if(0===Zb)return[[]];var Qb=Ob[0].length,Kb,Jb,$b,e_,t_;if(0===Wb){for(Kb=Array(Qb),Jb=0;Jb<Qb;Jb++)Kb[Jb]=Array(Qb);for(Jb=0;Jb<Qb;Jb++)for($b=Jb;$b<Qb;$b++){for(t_=0,e_=0;e_<Zb;e_++)t_+=Nb[e_]*(Ob[e_][$b]-Gb[$b])*(Ob[e_][Jb]-Gb[Jb]);Kb[Jb][$b]=t_*Hb,Kb[$b][Jb]=t_*Hb}}else if(1===Wb){for(Kb=Array(Zb),Jb=0;Jb<Zb;Jb++)Kb[Jb]=Array(Zb);for(Jb=0;Jb<Zb;Jb++)for($b=Jb;$b<Zb;$b++){for(t_=0,e_=0;e_<Qb;e_++)t_+=Nb[e_]*(Ob[$b][e_]-Gb[$b])*(Ob[Jb][e_]-Gb[Jb]);Kb[Jb][$b]=t_*Hb,Kb[$b][Jb]=t_*Hb}}else throw new Error('Invalid dimension');return Kb}}),zl={array:Cl,matrix:Bl};const Ll=zl.array;var El={coordArrayToPoints:function(Fb,Ub){if(0!=Fb.length%Ub)throw new RangeError('Dimensions number must be accordance with the size of the array.');for(var qb=Fb.length/Ub,Xb=Array(qb),Ob=0,Nb=0,Gb;Nb<Fb.length;Nb+=Ub){Gb=Array(Ub);for(var Hb=0;Hb<Ub;++Hb)Gb[Hb]=Fb[Nb+Hb];Xb[Ob]=Gb,Ob++}return Xb},coordArrayToCoordMatrix:function(Fb,Ub){if(0!=Fb.length%Ub)throw new RangeError('Dimensions number must be accordance with the size of the array.');for(var qb=Array(Ub),Xb=Fb.length/Ub,Ob=0;Ob<qb.length;Ob++)qb[Ob]=Array(Xb);for(Ob=0;Ob<Fb.length;Ob+=Ub)for(var Nb=0,Gb;Nb<Ub;++Nb)Gb=_Mathfloor(Ob/Ub),qb[Nb][Gb]=Fb[Ob+Nb];return qb},coordMatrixToCoordArray:function(Fb){for(var Ub=Array(Fb.length*Fb[0].length),qb=0,Xb=0;Xb<Fb[0].length;++Xb)for(var Ob=0;Ob<Fb.length;++Ob)Ub[qb]=Fb[Ob][Xb],++qb;return Ub},coordMatrixToPoints:Fe,pointsToCoordArray:function(Fb){for(var Ub=Array(Fb.length*Fb[0].length),qb=0,Xb=0;Xb<Fb.length;++Xb)for(var Ob=0;Ob<Fb[0].length;++Ob)Ub[qb]=Fb[Xb][Ob],++qb;return Ub},pointsToCoordMatrix:Fe,applyDotProduct:function(Fb,Ub){var qb,Xb;Fb.length<=Ub.length?(Xb=Fb,qb=Ub):(Xb=Ub,qb=Fb);for(var Ob=qb.length-Xb.length+1,Nb=Array(Ob),Gb=0,Hb;Gb<Ob;++Gb){Hb=0;for(var Wb=0;Wb<Xb.length;++Wb)Hb+=Xb[Wb]*qb[Gb+Wb];Nb[Gb]=Hb}return Nb},scale:function(Fb,Ub){var qb=Ub.inPlace?Fb:Array(Fb.length);const Xb=Ub.max,Ob=Ub.min;if('number'==typeof Xb){if('number'==typeof Ob)for(var Nb=Ll.minMax(Fb),Gb=(Xb-Ob)/(Nb.max-Nb.min),Hb=0;Hb<qb.length;Hb++)qb[Hb]=(Fb[Hb]-Nb.min)*Gb+Ob;else for(var Wb=Ll.max(Fb),Gb=Xb/Wb,Hb=0;Hb<qb.length;Hb++)qb[Hb]=Fb[Hb]*Gb;}else if('number'==typeof Ob)for(var Wb=Ll.min(Fb),Gb=Ob/Wb,Hb=0;Hb<qb.length;Hb++)qb[Hb]=Fb[Hb]*Gb;return qb}},Yl={getEquallySpacedData:function(Fb,Ub,qb){1<Fb.length&&Fb[0]>Fb[1]&&(Fb=Fb.slice().reverse(),Ub=Ub.slice().reverse());var Xb=Fb.length;if(Xb!==Ub.length)throw new RangeError('the x and y vector doesn\'t have the same size.');void 0===qb&&(qb={});var Ob=void 0===qb.from?Fb[0]:qb.from;if(isNaN(Ob)||!isFinite(Ob))throw new RangeError('\'From\' value must be a number');var Nb=void 0===qb.to?Fb[Fb.length-1]:qb.to;if(isNaN(Nb)||!isFinite(Nb))throw new RangeError('\'To\' value must be a number');var Gb=Ob>Nb;if(Gb){var Hb=Ob;Ob=Nb,Nb=Hb}var Wb=void 0===qb.numberOfPoints?100:qb.numberOfPoints;if(isNaN(Wb)||!isFinite(Wb))throw new RangeError('\'Number of points\' value must be a number');if(1>Wb)throw new RangeError('the number of point must be higher than 1');var Zb='slot'===qb.variant?'slot':'smooth',Qb='slot'==Zb?Ge(Fb,Ub,Ob,Nb,Wb):Ne(Fb,Ub,Ob,Nb,Wb);return Gb?Qb.reverse():Qb},integral:He},Ul=zl.array,ql={SNV:function(Fb){for(var Ub=Ul.mean(Fb),qb=Ul.standardDeviation(Fb),Xb=Fb.slice(),Ob=0;Ob<Fb.length;Ob++)Xb[Ob]=(Xb[Ob]-Ub)/qb;return Xb}},Xl=ge(function(Fb,Ub){Fb.exports=Ub=El,Ub.getEquallySpacedData=Yl.getEquallySpacedData,Ub.SNV=ql.SNV}),Ol=Xl.scale;class Nl extends st(){constructor(Fb,Ub,qb){super(),this.matrix=Fb,this.rows=Ub,this.columns=qb}static get[Symbol.species](){return $l}}class Gl extends Nl{constructor(Fb){super(Fb,Fb.columns,Fb.rows)}set(Fb,Ub,qb){return this.matrix.set(Ub,Fb,qb),this}get(Fb,Ub){return this.matrix.get(Ub,Fb)}}class Hl extends Nl{constructor(Fb,Ub){super(Fb,1,Fb.columns),this.row=Ub}set(Fb,Ub,qb){return this.matrix.set(this.row,Ub,qb),this}get(Fb,Ub){return this.matrix.get(this.row,Ub)}}class Wl extends Nl{constructor(Fb,Ub,qb,Xb,Ob){et(Fb,Ub,qb,Xb,Ob),super(Fb,qb-Ub+1,Ob-Xb+1),this.startRow=Ub,this.startColumn=Xb}set(Fb,Ub,qb){return this.matrix.set(this.startRow+Fb,this.startColumn+Ub,qb),this}get(Fb,Ub){return this.matrix.get(this.startRow+Fb,this.startColumn+Ub)}}class Zl extends Nl{constructor(Fb,Ub,qb){var Xb=$e(Fb,Ub,qb);super(Fb,Xb.row.length,Xb.column.length),this.rowIndices=Xb.row,this.columnIndices=Xb.column}set(Fb,Ub,qb){return this.matrix.set(this.rowIndices[Fb],this.columnIndices[Ub],qb),this}get(Fb,Ub){return this.matrix.get(this.rowIndices[Fb],this.columnIndices[Ub])}}class Ql extends Nl{constructor(Fb,Ub){super(Fb,Fb.rows,1),this.column=Ub}set(Fb,Ub,qb){return this.matrix.set(Fb,this.column,qb),this}get(Fb){return this.matrix.get(Fb,this.column)}}class Kl extends Nl{constructor(Fb){super(Fb,Fb.rows,Fb.columns)}set(Fb,Ub,qb){return this.matrix.set(this.rows-Fb-1,Ub,qb),this}get(Fb,Ub){return this.matrix.get(this.rows-Fb-1,Ub)}}class Jl extends Nl{constructor(Fb){super(Fb,Fb.rows,Fb.columns)}set(Fb,Ub,qb){return this.matrix.set(Fb,this.columns-Ub-1,qb),this}get(Fb,Ub){return this.matrix.get(Fb,this.columns-Ub-1)}}class $l extends st(Array){constructor(Fb,Ub){var qb;if(1===arguments.length&&'number'==typeof Fb)return Array(Fb);if($l.isMatrix(Fb))return Fb.clone();if(_NumberisInteger(Fb)&&0<Fb){if(super(Fb),_NumberisInteger(Ub)&&0<Ub)for(qb=0;qb<Fb;qb++)this[qb]=Array(Ub);else throw new TypeError('nColumns must be a positive integer');}else if(Array.isArray(Fb)){const Xb=Fb;if(Fb=Xb.length,Ub=Xb[0].length,'number'!=typeof Ub||0===Ub)throw new TypeError('Data must be a 2D array with at least one element');for(super(Fb),qb=0;qb<Fb;qb++){if(Xb[qb].length!==Ub)throw new RangeError('Inconsistent array dimensions');this[qb]=[].concat(Xb[qb])}}else throw new TypeError('First argument must be a positive number or an array');return this.rows=Fb,this.columns=Ub,this}set(Fb,Ub,qb){return this[Fb][Ub]=qb,this}get(Fb,Ub){return this[Fb][Ub]}clone(){for(var Fb=new this.constructor[Symbol.species](this.rows,this.columns),Ub=0;Ub<this.rows;Ub++)for(var qb=0;qb<this.columns;qb++)Fb.set(Ub,qb,this.get(Ub,qb));return Fb}removeRow(Fb){if(Ze(this,Fb),1===this.rows)throw new RangeError('A matrix cannot have less than one row');return this.splice(Fb,1),this.rows-=1,this}addRow(Fb,Ub){return void 0===Ub&&(Ub=Fb,Fb=this.rows),Ze(this,Fb,!0),Ub=Ke(this,Ub,!0),this.splice(Fb,0,Ub),this.rows+=1,this}removeColumn(Fb){if(Qe(this,Fb),1===this.columns)throw new RangeError('A matrix cannot have less than one column');for(var Ub=0;Ub<this.rows;Ub++)this[Ub].splice(Fb,1);return this.columns-=1,this}addColumn(Fb,Ub){'undefined'==typeof Ub&&(Ub=Fb,Fb=this.columns),Qe(this,Fb,!0),Ub=Je(this,Ub);for(var qb=0;qb<this.rows;qb++)this[qb].splice(Fb,0,Ub[qb]);return this.columns+=1,this}}rt.prototype={solve:function(Fb){Fb=$l.checkMatrix(Fb);var Ub=this.QR,qb=Ub.rows;if(Fb.rows!==qb)throw new Error('Matrix row dimensions must agree');if(!this.isFullRank())throw new Error('Matrix is rank deficient');var Xb=Fb.columns,Ob=Fb.clone(),Nb=Ub.columns,Gb,Hb,Wb,Zb;for(Wb=0;Wb<Nb;Wb++)for(Hb=0;Hb<Xb;Hb++){for(Zb=0,Gb=Wb;Gb<qb;Gb++)Zb+=Ub[Gb][Wb]*Ob[Gb][Hb];for(Zb=-Zb/Ub[Wb][Wb],Gb=Wb;Gb<qb;Gb++)Ob[Gb][Hb]+=Zb*Ub[Gb][Wb]}for(Wb=Nb-1;0<=Wb;Wb--){for(Hb=0;Hb<Xb;Hb++)Ob[Wb][Hb]/=this.Rdiag[Wb];for(Gb=0;Gb<Wb;Gb++)for(Hb=0;Hb<Xb;Hb++)Ob[Gb][Hb]-=Ob[Wb][Hb]*Ub[Gb][Wb]}return Ob.subMatrix(0,Nb-1,0,Xb-1)},isFullRank:function(){for(var Fb=this.QR.columns,Ub=0;Ub<Fb;Ub++)if(0===this.Rdiag[Ub])return!1;return!0},get upperTriangularMatrix(){var Fb=this.QR,Ub=Fb.columns,qb=new $l(Ub,Ub),Xb,Ob;for(Xb=0;Xb<Ub;Xb++)for(Ob=0;Ob<Ub;Ob++)qb[Xb][Ob]=Xb<Ob?Fb[Xb][Ob]:Xb===Ob?this.Rdiag[Xb]:0;return qb},get orthogonalMatrix(){var Fb=this.QR,Ub=Fb.rows,qb=Fb.columns,Xb=new $l(Ub,qb),Ob,Nb,Gb,Hb;for(Gb=qb-1;0<=Gb;Gb--){for(Ob=0;Ob<Ub;Ob++)Xb[Ob][Gb]=0;for(Xb[Gb][Gb]=1,Nb=Gb;Nb<qb;Nb++)if(0!==Fb[Gb][Gb]){for(Hb=0,Ob=Gb;Ob<Ub;Ob++)Hb+=Fb[Ob][Gb]*Xb[Ob][Nb];for(Hb=-Hb/Fb[Gb][Gb],Ob=Gb;Ob<Ub;Ob++)Xb[Ob][Nb]+=Hb*Fb[Ob][Gb]}}return Xb}};const ed={assumeSymmetric:!1};ht.prototype={get realEigenvalues(){return this.d},get imaginaryEigenvalues(){return this.e},get eigenvectorMatrix(){return $l.isMatrix(this.V)||(this.V=new $l(this.V)),this.V},get diagonalMatrix(){var Fb=this.n,Ub=this.e,qb=this.d,Xb=new $l(Fb,Fb),Ob,Nb;for(Ob=0;Ob<Fb;Ob++){for(Nb=0;Nb<Fb;Nb++)Xb[Ob][Nb]=0;Xb[Ob][Ob]=qb[Ob],0<Ub[Ob]?Xb[Ob][Ob+1]=Ub[Ob]:0>Ub[Ob]&&(Xb[Ob][Ob-1]=Ub[Ob])}return Xb}},bt.prototype={get lowerTriangularMatrix(){return this.L},solve:function(Fb){Fb=$l.checkMatrix(Fb);var Ub=this.L,qb=Ub.rows;if(Fb.rows!==qb)throw new Error('Matrix dimensions do not match');var Xb=Fb.columns,Ob=Fb.clone(),Nb,Gb,Hb;for(Hb=0;Hb<qb;Hb++)for(Gb=0;Gb<Xb;Gb++){for(Nb=0;Nb<Hb;Nb++)Ob[Hb][Gb]-=Ob[Nb][Gb]*Ub[Hb][Nb];Ob[Hb][Gb]/=Ub[Hb][Hb]}for(Hb=qb-1;0<=Hb;Hb--)for(Gb=0;Gb<Xb;Gb++){for(Nb=Hb+1;Nb<qb;Nb++)Ob[Hb][Gb]-=Ob[Nb][Gb]*Ub[Nb][Hb];Ob[Hb][Gb]/=Ub[Hb][Hb]}return Ob}};var td=Object.freeze({default:$l,Matrix:$l,abstractMatrix:st,solve:dt,inverse:function(Fb){return Fb=$l.checkMatrix(Fb),dt(Fb,$l.eye(Fb.rows))},SingularValueDecomposition:Ee,SVD:Ee,EigenvalueDecomposition:ht,EVD:ht,CholeskyDecomposition:bt,CHO:bt,LuDecomposition:Re,LU:Re,QrDecomposition:rt,QR:rt}),ad=td&&$l||td;const nd=Dl.maybeToPrecision,od=ad.Matrix,sd=ad.solve;class rd extends Ml{constructor(Fb,Ub,qb,Xb){super();if(!0===Fb)this.coefficients=Ub.coefficients,this.powers=Ub.powers,this.M=Ub.M,Ub.quality&&(this.quality=Ub.quality);else{var Nb=Fb.length;if(Nb!==Ub.length)throw new RangeError('input and output array have a different length');let $b;if(Array.isArray(qb))$b=qb,qb=$b.length;else for(qb++,$b=Array(qb),Wb=0;Wb<qb;Wb++)$b[Wb]=Wb;var Gb=new od(Nb,qb),Hb=new od([Ub]),Wb,Zb;for(Wb=0;Wb<qb;Wb++)for(Zb=0;Zb<Nb;Zb++)Gb[Zb][Wb]=0===$b[Wb]?1:_Mathpow(Fb[Zb],$b[Wb]);var Qb=Gb.transposeView(),Kb=Qb.mmul(Gb),Jb=Qb.mmul(Hb.transposeView());this.coefficients=sd(Kb,Jb).to1DArray(),this.powers=$b,this.M=qb-1,(Xb||{}).computeQuality&&(this.quality=this.modelQuality(Fb,Ub))}}_predict(Fb){for(var Ub=0,qb=0;qb<this.powers.length;qb++)Ub+=this.coefficients[qb]*_Mathpow(Fb,this.powers[qb]);return Ub}toJSON(){var Fb={name:'polynomialRegression',coefficients:this.coefficients,powers:this.powers,M:this.M};return this.quality&&(Fb.quality=this.quality),Fb}toString(Fb){return this._toFormula(Fb,!1)}toLaTeX(Fb){return this._toFormula(Fb,!0)}_toFormula(Fb,Ub){var qb='^',Xb='',Ob=' * ';Ub&&(qb='^{',Xb='}',Ob='');for(var Nb='',Hb=0,Gb;Hb<this.coefficients.length;Hb++)Gb='',0!==this.coefficients[Hb]&&(Gb=0===this.powers[Hb]?nd(this.coefficients[Hb],Fb):1===this.powers[Hb]?nd(this.coefficients[Hb],Fb)+Ob+'x':nd(this.coefficients[Hb],Fb)+Ob+'x'+qb+this.powers[Hb]+Xb,0<this.coefficients[Hb]&&Hb!==this.coefficients.length-1?Gb=' + '+Gb:Hb!==this.coefficients.length-1&&(Gb=' '+Gb)),Nb=Gb+Nb;return' + '===Nb.charAt(0)&&(Nb=Nb.slice(1)),'f(x) = '+Nb}static load(Fb){if('polynomialRegression'!==Fb.name)throw new TypeError('not a polynomial regression model');return new rd(!0,Fb)}}var ld=rd;const dd=Dl.maybeToPrecision;class hd extends Ml{constructor(Fb,Ub,qb,Xb){super();if(!0===Fb)this.A=Ub.A,this.M=Ub.M,Ub.quality&&(this.quality=Ub.quality);else{var Nb=Fb.length;if(Nb!==Ub.length)throw new RangeError('input and output array have a different length');var Gb=new ld(Fb,Ub,[qb],{computeCoefficient:!0});this.A=Gb.coefficients[0],this.M=qb,(Xb||{}).computeQuality&&(this.quality=this.modelQuality(Fb,Ub))}}_predict(Fb){return this.A*_Mathpow(Fb,this.M)}toJSON(){var Fb={name:'potentialRegression',A:this.A,M:this.M};return this.quality&&(Fb.quality=this.quality),Fb}toString(Fb){return'f(x) = '+dd(this.A,Fb)+' * x^'+this.M}toLaTeX(Fb){return 0<=this.M?'f(x) = '+dd(this.A,Fb)+'x^{'+this.M+'}':'f(x) = \\frac{'+dd(this.A,Fb)+'}{x^{'+-this.M+'}}'}static load(Fb){if('potentialRegression'!==Fb.name)throw new TypeError('not a potential regression model');return new hd(!0,Fb)}}const gd=Dl.maybeToPrecision;class ud extends Ml{constructor(Fb,Ub,qb){super();if(!0===Fb)this.A=Ub.A,this.C=Ub.C,Ub.quality&&(this.quality=Ub.quality);else{var Ob=Fb.length;if(Ob!==Ub.length)throw new RangeError('input and output array have a different length');for(var Nb=Array(Ob),Gb=0;Gb<Ob;Gb++)Nb[Gb]=_Mathlog(Ub[Gb]);var Hb=new Pl(Fb,Nb,{computeCoefficient:!1});this.A=Hb.slope,this.C=_Mathexp(Hb.intercept),(qb||{}).computeQuality&&(this.quality=this.modelQuality(Fb,Ub))}}_predict(Fb){return this.C*_Mathexp(Fb*this.A)}toJSON(){var Fb={name:'expRegression',A:this.A,C:this.C};return this.quality&&(Fb.quality=this.quality),Fb}toString(Fb){return'f(x) = '+gd(this.C,Fb)+' * exp('+gd(this.A,Fb)+' * x)'}toLaTeX(Fb){return 0<=this.A?'f(x) = '+gd(this.C,Fb)+'e^{'+gd(this.A,Fb)+'x}':'f(x) = \\frac{'+gd(this.C,Fb)+'}{e^{'+gd(-this.A,Fb)+'x}}'}static load(Fb){if('expRegression'!==Fb.name)throw new TypeError('not a exp regression model');return new ud(!0,Fb)}}const fd=Dl.maybeToPrecision;class bd extends Ml{constructor(Fb,Ub,qb){super();if(!0===Fb)this.A=Ub.A,this.B=Ub.B,this.quality=Ub.quality||{},Ub.quality.r&&(this.quality.r=Ub.quality.r,this.quality.r2=Ub.quality.r2),Ub.quality.chi2&&(this.quality.chi2=Ub.quality.chi2);else{var Ob=Fb.length;if(Ob!==Ub.length)throw new RangeError('input and output array have a different length');for(var Nb=Array(Ob),Gb=Array(Ob),Hb=0;Hb<Ob;Hb++)Nb[Hb]=_Mathlog(Fb[Hb]),Gb[Hb]=_Mathlog(Ub[Hb]);var Wb=new Pl(Nb,Gb,{computeCoefficient:!1});this.A=_Mathexp(Wb.intercept),this.B=Wb.slope,(qb||{}).computeQuality&&(this.quality=this.modelQuality(Fb,Ub))}}_predict(Fb){return this.A*_Mathpow(Fb,this.B)}toJSON(){var Fb={name:'powerRegression',A:this.A,B:this.B};return this.quality&&(Fb.quality=this.quality),Fb}toString(Fb){return'f(x) = '+fd(this.A,Fb)+' * x^'+fd(this.B,Fb)}toLaTeX(Fb){return 0<=this.B?'f(x) = '+fd(this.A,Fb)+'x^{'+fd(this.B,Fb)+'}':'f(x) = \\frac{'+fd(this.A,Fb)+'}{x^{'+fd(-this.B,Fb)+'}}'}static load(Fb){if('powerRegression'!==Fb.name)throw new TypeError('not a power regression model');return new bd(!0,Fb)}}var wd=wt;wt.squared=_t;const xd=wd.squared,yd={sigma:1};var vd=class{constructor(Fb){Fb=Object.assign({},yd,Fb),this.sigma=Fb.sigma,this.divisor=2*Fb.sigma*Fb.sigma}compute(Fb,Ub){const qb=xd(Fb,Ub);return _Mathexp(-qb/this.divisor)}};const Dd={degree:1,constant:1,scale:1};var Md=class{constructor(Fb){Fb=Object.assign({},Dd,Fb),this.degree=Fb.degree,this.constant=Fb.constant,this.scale=Fb.scale}compute(Fb,Ub){for(var qb=0,Xb=0;Xb<Fb.length;Xb++)qb+=Fb[Xb]*Ub[Xb];return _Mathpow(this.scale*qb+this.constant,this.degree)}};const Sd={sigma:1,degree:1};const Cd=wd.squared,Bd={sigma:1};const zd={sigma:1};var Vd=class{compute(Fb,Ub){for(var qb=_Mathmin(Fb.length,Ub.length),Xb=0,Ob=0;Ob<qb;++Ob)Xb+=_Mathmin(Fb[Ob],Ub[Ob]);return Xb}};const Yd={sigma:1};const qd=wd.squared,Xd={constant:1};const Gd=wd.squared,Hd={constant:1};const Qd={alpha:0.01,constant:-Math.E};var Jd=class{constructor(Fb){Fb=Object.assign({},Qd,Fb),this.alpha=Fb.alpha,this.constant=Fb.constant}compute(Fb,Ub){for(var qb=0,Xb=0;Xb<Fb.length;Xb++)qb+=Fb[Xb]*Ub[Xb];return Math.tanh(this.alpha*qb+this.constant)}};const $d=ad.Matrix,eh={gaussian:vd,rbf:vd,polynomial:Md,poly:Md,anova:class{constructor(Fb){Fb=Object.assign({},Sd,Fb),this.sigma=Fb.sigma,this.degree=Fb.degree}compute(Fb,Ub){for(var qb=0,Xb=_Mathmin(Fb.length,Ub.length),Ob=1;Ob<=Xb;++Ob)qb+=_Mathpow(_Mathexp(-this.sigma*_Mathpow(_Mathpow(Fb[Ob-1],Ob)-_Mathpow(Ub[Ob-1],Ob),2)),this.degree);return qb}},cauchy:class{constructor(Fb){Fb=Object.assign({},Bd,Fb),this.sigma=Fb.sigma}compute(Fb,Ub){return 1/(1+Cd(Fb,Ub)/(this.sigma*this.sigma))}},exponential:class{constructor(Fb){Fb=Object.assign({},zd,Fb),this.sigma=Fb.sigma,this.divisor=2*Fb.sigma*Fb.sigma}compute(Fb,Ub){const qb=wd(Fb,Ub);return _Mathexp(-qb/this.divisor)}},histogram:Vd,min:Vd,laplacian:class{constructor(Fb){Fb=Object.assign({},Yd,Fb),this.sigma=Fb.sigma}compute(Fb,Ub){const qb=wd(Fb,Ub);return _Mathexp(-qb/this.sigma)}},multiquadratic:class{constructor(Fb){Fb=Object.assign({},Xd,Fb),this.constant=Fb.constant}compute(Fb,Ub){return _Mathsqrt(qd(Fb,Ub)+this.constant*this.constant)}},rational:class{constructor(Fb){Fb=Object.assign({},Hd,Fb),this.constant=Fb.constant}compute(Fb,Ub){const qb=Gd(Fb,Ub);return 1-qb/(qb+this.constant)}},sigmoid:Jd,mlp:Jd};var ah=class{constructor(Fb,Ub){if(this.kernelType=Fb,'linear'!==Fb)if('string'==typeof Fb){Fb=Fb.toLowerCase();var qb=eh[Fb];if(qb)this.kernelFunction=new qb(Ub);else throw new Error('unsupported kernel type: '+Fb)}else if('object'==typeof Fb&&'function'==typeof Fb.compute)this.kernelFunction=Fb;else throw new TypeError('first argument must be a valid kernel type or instance')}compute(Fb,Ub){if(void 0===Ub&&(Ub=Fb),'linear'===this.kernelType){var qb=new $d(Fb);return qb.mmul(new $d(Ub).transposeView())}const Xb=new $d(Fb.length,Ub.length);var Ob,Nb;if(Fb===Ub)for(Ob=0;Ob<Fb.length;Ob++)for(Nb=Ob;Nb<Fb.length;Nb++)Xb[Ob][Nb]=Xb[Nb][Ob]=this.kernelFunction.compute(Fb[Ob],Fb[Nb]);else for(Ob=0;Ob<Fb.length;Ob++)for(Nb=0;Nb<Ub.length;Nb++)Xb[Ob][Nb]=this.kernelFunction.compute(Fb[Ob],Ub[Nb]);return Xb}};const nh=ad.Matrix,oh=ad.solve,sh={lambda:0.1,kernelType:'gaussian',kernelOptions:{},computeCoefficient:!1};class rh extends Ml{constructor(Fb,Ub,qb){if(super(),!0===Fb)this.alpha=Ub.alpha,this.inputs=Ub.inputs,this.kernelType=Ub.kernelType,this.kernelOptions=Ub.kernelOptions,this.kernel=new ah(Ub.kernelType,Ub.kernelOptions),Ub.quality&&(this.quality=Ub.quality);else{qb=Object.assign({},sh,qb);const Xb=new ah(qb.kernelType,qb.kernelOptions),Ob=Xb.compute(Fb),Nb=Fb.length;Ob.add(nh.eye(Nb,Nb).mul(qb.lambda)),this.alpha=oh(Ob,Ub),this.inputs=Fb,this.kernelType=qb.kernelType,this.kernelOptions=qb.kernelOptions,this.kernel=Xb,qb.computeQuality&&(this.quality=this.modelQuality(Fb,Ub))}}_predict(Fb){return this.kernel.compute([Fb],this.inputs).mmul(this.alpha)[0]}toJSON(){var Fb={name:'kernelRidgeRegression',alpha:this.alpha,inputs:this.inputs,kernelType:this.kernelType,kernelOptions:this.kernelOptions};return this.quality&&(Fb.quality=this.quality),Fb}static load(Fb){if('kernelRidgeRegression'!==Fb.name)throw new TypeError('not a KRR model');return new rh(!0,Fb)}}const dh=ad.Matrix,mh=ad.SVD,ch={order:2};class gh extends Ml{constructor(Fb,Ub,qb){super(),!0===Fb?(this.coefficients=dh.columnVector(Ub.coefficients),this.order=Ub.order,Ub.r&&(this.r=Ub.r,this.r2=Ub.r2),Ub.chi2&&(this.chi2=Ub.chi2)):(qb=Object.assign({},ch,qb),this.order=qb.order,this.coefficients=[],this.X=Fb,this.y=Ub,this.train(this.X,this.y,qb),qb.computeQuality&&(this.quality=this.modelQuality(Fb,Ub)))}train(Fb,Ub){if(dh.isMatrix(Fb)||(Fb=new dh(Fb)),dh.isMatrix(Ub)||(Ub=dh.columnVector(Ub)),Ub.rows!==Fb.rows&&(Ub=Ub.transpose()),2!==Fb.columns)throw new RangeError('You give X with '+Fb.columns+' columns and it must be 2');if(Fb.rows!==Ub.rows)throw new RangeError('X and y must have the same rows');var qb=Fb.rows,Xb=(this.order+2)*(this.order+1)/2;this.coefficients=Array(Xb);var Ob=Fb.getColumnVector(0),Nb=Fb.getColumnVector(1),Gb=1/Ob.clone().apply(yt).max(),Hb=1/Nb.clone().apply(yt).max(),Wb=1/Ub.clone().apply(yt).max();Ob.mulColumn(0,Gb),Nb.mulColumn(0,Hb),Ub.mulColumn(0,Wb);for(var Zb=new dh(qb,Xb),Qb=0,Kb=0,Jb;Kb<=this.order;++Kb){Jb=this.order-Kb;for(var $b=0,e_;$b<=Jb;++$b)e_=xt(Ob,Kb).mulColumnVector(xt(Nb,$b)),Zb.setColumn(Qb,e_),Qb++}var t_=new mh(Zb.transpose(),{computeLeftSingularVectors:!0,computeRightSingularVectors:!0,autoTranspose:!1}),a_=dh.rowVector(t_.diagonal);a_=a_.apply(function(s_,r_){this[s_][r_]=1e-15<=this[s_][r_]?1/this[s_][r_]:0});var i_=dh.zeros(qb,Xb);for(Kb=0;Kb<Xb;++Kb)i_[Kb][Kb]=a_[0][Kb];a_=i_;var n_=t_.rightSingularVectors,o_=t_.leftSingularVectors;for(this.coefficients=o_.mmul(a_.transpose()).mmul(n_.transpose()).mmul(Ub),Qb=0,Kb=0;Kb<=Xb;++Kb)for(Jb=this.order-Kb,$b=0;$b<=Jb;++$b)this.coefficients[Qb][0]=this.coefficients[Qb][0]*_Mathpow(Gb,Kb)*_Mathpow(Hb,$b)/Wb,Qb++}_predict(Fb){for(var Ub=Fb[0],qb=Fb[1],Xb=0,Ob=0,Nb=0;Nb<=this.order;Nb++)for(var Gb=0;Gb<=this.order-Nb;Gb++)Xb+=_Mathpow(Ub,Nb)*_Mathpow(qb,Gb)*this.coefficients[Ob][0],Ob++;return Xb}toJSON(){var Fb={name:'polyfit2D',order:this.order,coefficients:this.coefficients};return this.quality&&(Fb.quality=this.quality),Fb}static load(Fb){if('polyfit2D'!==Fb.name)throw new TypeError('not a polyfit2D model');return new gh(!0,Fb)}}const ph=Dl.maybeToPrecision,fh=Cl.median;class bh extends Ml{constructor(Fb,Ub,qb){if(qb=qb||{},super(),!0===Fb)this.slope=Ub.slope,this.intercept=Ub.intercept,this.quality=Object.assign({},Ub.quality,this.quality);else{let Xb=Fb.length;if(Xb!==Ub.length)throw new RangeError('Input and output array have a different length');let Ob=Array(Xb*Xb),Nb=0;for(let Wb=0;Wb<Xb;++Wb)for(let Zb=Wb+1;Zb<Xb;++Zb)Fb[Wb]!==Fb[Zb]&&(Ob[Nb++]=(Ub[Zb]-Ub[Wb])/(Fb[Zb]-Fb[Wb]));Ob.length=Nb;let Gb=fh(Ob),Hb=Array(Xb);for(let Wb=0;Wb<Xb;++Wb)Hb[Wb]=Ub[Wb]-Gb*Fb[Wb];this.slope=Gb,this.intercept=fh(Hb),this.coefficients=[this.intercept,this.slope],qb.computeQuality&&(this.quality=this.modelQuality(Fb,Ub))}}toJSON(){var Fb={name:'TheilSenRegression',slope:this.slope,intercept:this.intercept};return this.quality&&(Fb.quality=this.quality),Fb}_predict(Fb){return this.slope*Fb+this.intercept}computeX(Fb){return(Fb-this.intercept)/this.slope}toString(Fb){var Ub='f(x) = ';if(this.slope){var qb=ph(this.slope,Fb);if(Ub+=(1e-5>_Mathabs(qb-1)?'':qb+' * ')+'x',this.intercept){var Xb=_Mathabs(this.intercept),Ob=Xb===this.intercept?'+':'-';Ub+=' '+Ob+' '+ph(Xb,Fb)}}else Ub+=ph(this.intercept,Fb);return Ub}toLaTeX(Fb){return this.toString(Fb)}static load(Fb){if('TheilSenRegression'!==Fb.name)throw new TypeError('not a Theil-Sen model');return new bh(!0,Fb)}}var xh=ge(function(Fb,Ub){'use strict';Ub.SimpleLinearRegression=Ub.SLR=Pl,Ub.NonLinearRegression=Ub.NLR={PolynomialRegression:ld,PotentialRegression:hd,ExpRegression:ud,PowerRegression:bd},Ub.KernelRidgeRegression=Ub.KRR=rh,Ub.PolinomialFitting2D=gh,Ub.TheilSenRegression=bh}),yh=xh.KernelRidgeRegression,kh={luma709(Fb,Ub){return 6966*Fb[Ub]+23436*Fb[Ub+1]+2366*Fb[Ub+2]>>15},luma601(Fb,Ub){return 9798*Fb[Ub]+19235*Fb[Ub+1]+3735*Fb[Ub+2]>>15},maximum(Fb,Ub){return _Mathmax(Fb[Ub],Fb[Ub+1],Fb[Ub+2])},minimum(Fb,Ub){return _Mathmin(Fb[Ub],Fb[Ub+1],Fb[Ub+2])},average(Fb,Ub){return(Fb[Ub]+Fb[Ub+1]+Fb[Ub+2])/3>>0},minmax(Fb,Ub){return(_Mathmax(Fb[Ub],Fb[Ub+1],Fb[Ub+2])+_Mathmin(Fb[Ub],Fb[Ub+1],Fb[Ub+2]))/2},red(Fb,Ub){return Fb[Ub]},green(Fb,Ub){return Fb[Ub+1]},blue(Fb,Ub){return Fb[Ub+2]},cyan(Fb,Ub,qb){var Xb=kh.black(Fb,Ub,qb);return(qb.maxValue-Fb[0]-Xb)/(1-Xb/qb.maxValue)>>0},magenta(Fb,Ub,qb){var Xb=kh.black(Fb,Ub,qb);return(qb.maxValue-Fb[1]-Xb)/(1-Xb/qb.maxValue)>>0},yellow(Fb,Ub,qb){var Xb=kh.black(Fb,Ub,qb);return(qb.maxValue-Fb[2]-Xb)/(1-Xb/qb.maxValue)>>0},black(Fb,Ub,qb){return _Mathmin(qb.maxValue-Fb[Ub],qb.maxValue-Fb[Ub+1],qb.maxValue-Fb[Ub+2])},hue(Fb,Ub,qb){var Xb=kh.min(Fb,Ub),Ob=kh.max(Fb,Ub);if(Ob===Xb)return 0;var Nb=0,Gb=Ob-Xb;switch(Ob){case Fb[Ub]:Nb=(Fb[Ub+1]-Fb[Ub+2])/Gb+(Fb[Ub+1]<Fb[Ub+2]?6:0);break;case Fb[Ub+1]:Nb=(Fb[Ub+2]-Fb[Ub])/Gb+2;break;case Fb[Ub+2]:Nb=(Fb[Ub]-Fb[Ub+1])/Gb+4;break;default:throw new Error('unreachable');}return Nb/6*qb.maxValue>>0},saturation(Fb,Ub,qb){var Xb=kh.min(Fb,Ub),Ob=kh.max(Fb,Ub);return 0===Ob?0:(Ob-Xb)/Ob*qb.maxValue},lightness(Fb,Ub){var qb=kh.min(Fb,Ub),Xb=kh.max(Fb,Ub);return(Xb+qb)/2}};Object.defineProperty(kh,'luminosity',{enumerable:!1,value:kh.lightness}),Object.defineProperty(kh,'luminance',{enumerable:!1,value:kh.lightness}),Object.defineProperty(kh,'min',{enumerable:!1,value:kh.minimum}),Object.defineProperty(kh,'max',{enumerable:!1,value:kh.maximum}),Object.defineProperty(kh,'brightness',{enumerable:!1,value:kh.maximum});var vh=Object.keys(kh),Dh={huang:function(Fb){for(var Ub=0,qb=0;qb<Fb.length;qb++)if(0!==Fb[qb]){Ub=qb;break}for(var Xb=Fb.length-1,Ob=Fb.length-1;Ob>=Ub;Ob--)if(0!==Fb[Ob]){Xb=Ob;break}for(var Nb=1/(Xb-Ub),Gb=Array(Fb.length),Hb=0,Wb=0,Zb=Ub;Zb<Fb.length;Zb++)Hb+=Zb*Fb[Zb],Wb+=Fb[Zb],Gb[Zb]=Hb/Wb;var Qb=Array(Fb.length);Hb=Wb=0;for(var Kb=Xb;0<Kb;Kb--)Hb+=Kb*Fb[Kb],Wb+=Fb[Kb],Qb[Kb-1]=Hb/Wb;for(var Jb=-1,$b=_NumberMAX_VALUE,e_=0;e_<Fb.length;e_++){for(var t_=0,a_=void 0,i_=0;i_<=e_;i_++)a_=1/(1+Nb*_Mathabs(i_-Gb[e_])),1e-6>a_||0.999999<a_||(t_+=Fb[i_]*(-a_*_Mathlog(a_)-(1-a_)*_Mathlog(1-a_)));for(var n_=e_+1;n_<Fb.length;n_++)a_=1/(1+Nb*_Mathabs(n_-Qb[e_])),1e-6>a_||0.999999<a_||(t_+=Fb[n_]*(-a_*_Mathlog(a_)-(1-a_)*_Mathlog(1-a_)));t_<$b&&($b=t_,Jb=e_)}return Jb},intermodes:function(Fb){for(var Ub=Fb.slice(),qb=0;!Ut(Ub);){for(var Xb=0,Ob=0,Nb=Ub[0],Gb=0;Gb<Fb.length-1;Gb++)Xb=Ob,Ob=Nb,Nb=Ub[Gb+1],Ub[Gb]=(Xb+Ob+Nb)/3;if(Ub[Fb.length-1]=(Ob+Nb)/3,qb++,1e4<qb)throw new Error('Intermodes Threshold not found after 10000 iterations')}for(var Hb=0,Wb=1;Wb<Fb.length-1;Wb++)Ub[Wb-1]<Ub[Wb]&&Ub[Wb+1]<Ub[Wb]&&(Hb+=Wb);return _Mathfloor(Hb/2)},isodata:function(Fb){for(var Nb=0,Gb=1,Ub,qb,Xb,Ob;Gb<Fb.length;Gb++)if(0<Fb[Gb]){Nb=Gb+1;break}for(;;){Ub=0,Xb=0;for(var Hb=0;Hb<Nb;Hb++)Xb+=Fb[Hb],Ub+=Fb[Hb]*Hb;Ob=0,qb=0;for(var Wb=Nb+1;Wb<Fb.length;Wb++)qb+=Fb[Wb],Ob+=Fb[Wb]*Wb;if(0<Xb&&0<qb&&(Ub/=Xb,Ob/=qb,Nb===_Mathround((Ub+Ob)/2)))break;if(Nb++,Nb>Fb.length-2)throw new Error('Threshold not found')}return Nb},li:function(Fb,Ub){var qb,Xb,Ob,Nb,Gb,Hb,Wb,Zb,Qb,Kb,Jb,$b;Jb=0.5,Kb=0;for(var e_=0;e_<Fb.length;e_++)Kb+=e_*Fb[e_];Kb/=Ub,Wb=Kb;do{Hb=Wb,qb=0|Hb+0.5,Xb=0,Nb=0;for(var t_=0;t_<=qb;t_++)Xb+=t_*Fb[t_],Nb+=Fb[t_];Zb=0===Nb?0:Xb/Nb,Ob=0,Gb=0;for(var a_=qb+1;a_<Fb.length;a_++)Ob+=a_*Fb[a_],Gb+=Fb[a_];Qb=0===Gb?0:Ob/Gb,$b=(Zb-Qb)/(_Mathlog(Zb)-_Mathlog(Qb)),Wb=$b<-_NumberEPSILON?0|$b-0.5:0|$b+0.5}while(_Mathabs(Wb-Hb)>Jb);return qb},maxentropy:function(Fb,Ub){for(var qb=Array(Fb.length),Xb=0;Xb<Fb.length;Xb++)qb[Xb]=Fb[Xb]/Ub;var Ob=Array(Fb.length),Nb=Array(Fb.length);Ob[0]=qb[0],Nb[0]=1-Ob[0];for(var Gb=1;Gb<Fb.length;Gb++)Ob[Gb]=Ob[Gb-1]+qb[Gb],Nb[Gb]=1-Ob[Gb];for(var Hb=0,Wb=0;Wb<Fb.length;Wb++)if(_Mathabs(Ob[Wb])>=_NumberEPSILON){Hb=Wb;break}for(var Zb=Fb.length-1,Qb=Fb.length-1;Qb>=Hb;Qb--)if(_Mathabs(Nb[Qb])>=_NumberEPSILON){Zb=Qb;break}for(var Kb=-1,Jb=void 0,$b=_NumberMIN_VALUE,e_=void 0,t_=void 0,a_=Hb;a_<=Zb;a_++){e_=0;for(var i_=0;i_<=a_;i_++)0!==Fb[i_]&&(e_-=qb[i_]/Ob[a_]*_Mathlog(qb[i_]/Ob[a_]));t_=0;for(var n_=a_+1;n_<Fb.length;n_++)0!==Fb[n_]&&(t_-=qb[n_]/Nb[a_]*_Mathlog(qb[n_]/Nb[a_]));Jb=e_+t_,$b<Jb&&($b=Jb,Kb=a_)}return Kb},mean:function(Fb,Ub){for(var qb=0,Xb=0;Xb<Fb.length;Xb++)qb+=Xb*Fb[Xb];return _Mathfloor(qb/Ub)},minerror:function(Fb,Ub){for(var Xb=-2,t_=0,a_=0,qb,Ob,Nb,Gb,Hb,Wb,Zb,Qb,Kb,Jb,$b,e_;a_<Fb.length;a_++)t_+=a_*Fb[a_];for(t_/=Ub,qb=t_;qb!==Xb;){var i_=Ht(Fb,qb),n_=Ht(Fb,Fb.length-1),o_=Wt(Fb,qb),s_=Wt(Fb,Fb.length-1),r_=Zt(Fb,qb),l_=Zt(Fb,Fb.length-1);if(Ob=o_/i_,Nb=(s_-o_)/(n_-i_),Gb=i_/n_,Hb=(n_-i_)/n_,Wb=r_/i_-Ob*Ob,Zb=(l_-r_)/(n_-i_)-Nb*Nb,Qb=1/Wb-1/Zb,Kb=Ob/Wb-Nb/Zb,Jb=Ob*Ob/Wb-Nb*Nb/Zb+Math.log10(Wb*(Hb*Hb)/(Zb*(Gb*Gb))),$b=Kb*Kb-Qb*Jb,0>$b)return qb;Xb=qb,e_=(Kb+_Mathsqrt($b))/Qb,qb=isNaN(e_)?Xb:_Mathfloor(e_)}return qb},minimum:function(Fb){if(2>Fb.length)return 0;for(var Ub=0,qb=-1,Xb=-1,Ob=Array(Fb.length),Nb=0;Nb<Fb.length;Nb++)Ob[Nb]=Fb[Nb],0<Fb[Nb]&&(Xb=Nb);for(;!$t(Ob);)if(Ob=Kt(Ob),Ub++,1e4<Ub)return qb;return qb=Jt(Ob,Xb),qb},moments:function(Fb,Ub){for(var qb=1,Xb=0,Ob=0,Nb=0,Gb=0,$b=-1,e_=Fb.length,t_=Array(e_),a_=0,Hb,Wb,Zb,Qb,Kb,Jb;a_<e_;a_++)t_[a_]=Fb[a_]/Ub;for(var i_=0;i_<e_;i_++)Xb+=i_*t_[i_],Ob+=i_*i_*t_[i_],Nb+=i_*i_*i_*t_[i_];Wb=qb*Ob-Xb*Xb,Zb=(-Ob*Ob+Xb*Nb)/Wb,Qb=(qb*-Nb+Ob*Xb)/Wb,Kb=0.5*(-Qb-_Mathsqrt(Qb*Qb-4*Zb)),Jb=0.5*(-Qb+_Mathsqrt(Qb*Qb-4*Zb)),Hb=(Jb-Xb)/(Jb-Kb);for(var n_=0;n_<e_;n_++)if(Gb+=t_[n_],Gb>Hb){$b=n_;break}return $b},otsu:function(Fb,Ub){for(var qb=0,Xb=0,Ob=0,Nb=0,Wb=0,Zb=0,Qb=0,Kb=1,Gb,Hb;Kb<Fb.length;++Kb)qb+=Kb*Fb[Kb];for(var Jb=1;Jb<Fb.length;++Jb)if(Ob+=Fb[Jb],0!==Ob){if(Nb=Ub-Ob,0==Nb)break;Xb+=Jb*Fb[Jb],Gb=Xb/Ob,Hb=(qb-Xb)/Nb,Zb=Ob*Nb*(Gb-Hb)*(Gb-Hb),Zb>=Wb&&(Qb=Jb,Wb=Zb)}return Qb},percentile:function(Fb){for(var Ub=-1,Xb=Array(Fb.length),Ob=ia(Fb,Fb.length-1),Nb=1,Gb=0;Gb<Fb.length;Gb++)Xb[Gb]=_Mathabs(ia(Fb,Gb)/Ob-0.5),Xb[Gb]<Nb&&(Nb=Xb[Gb],Ub=Gb);return Ub},renyientropy:function(Fb,Ub){for(var Nb=Array(Fb.length),Gb=Array(Fb.length),Hb=Array(Fb.length),Wb=0,Zb=0,Qb=0,Kb=0,Jb=0,$b=0,t_=1/(1-0.5),i_=1/(1-2),n_=0,qb,Xb,Ob;n_<Fb.length;n_++)Nb[n_]=Fb[n_]/Ub;Gb[0]=Nb[0],Hb[0]=1-Gb[0];for(var o_=1;o_<Fb.length;o_++)Gb[o_]=Gb[o_-1]+Nb[o_],Hb[o_]=1-Gb[o_];Xb=0;for(var s_=0;s_<Fb.length;s_++)if(_Mathabs(Gb[s_])>=_NumberEPSILON){Xb=s_;break}Ob=Fb.length-1;for(var r_=Fb.length-1;r_>=Xb;r_--)if(_Mathabs(Hb[r_])>=_NumberEPSILON){Ob=r_;break}for(var l_=Xb;l_<=Ob;l_++){for(var d_=0,h_=0,m_=0,c_=0;c_<=l_;c_++)0!==Fb[c_]&&(d_-=Nb[c_]/Gb[l_]*_Mathlog(Nb[c_]/Gb[l_])),h_+=_Mathsqrt(Nb[c_]/Gb[l_]),m_+=Nb[c_]*Nb[c_]/(Gb[l_]*Gb[l_]);for(var g_=0,u_=0,p_=0,f_=l_+1;f_<Fb.length;f_++)0!==Fb[f_]&&(g_-=Nb[f_]/Hb[l_]*_Mathlog(Nb[f_]/Hb[l_])),u_+=_Mathsqrt(Nb[f_]/Hb[l_]),p_+=Nb[f_]*Nb[f_]/(Hb[l_]*Hb[l_]);var b_=d_+g_,w_=t_*(0<h_*u_?_Mathlog(h_*u_):0),x_=i_*(0<m_*p_?_Mathlog(m_*p_):0);b_>Kb&&(Kb=b_,Wb=l_),w_>Jb&&(Jb=w_,Zb=l_),x_>$b&&($b=x_,Qb=l_)}var y_=[Wb,Zb,Qb];y_.sort(Kr);var k_=5>=_Mathabs(y_[0]-y_[1])?5>=_Mathabs(y_[1]-y_[2])?[1,2,1]:[0,1,3]:5>=_Mathabs(y_[1]-y_[2])?[3,1,0]:[1,2,1];var v_=Gb[y_[2]]-Gb[y_[0]];return qb=_Mathround(y_[0]*(Gb[y_[0]]+0.25*v_*k_[0])+0.25*y_[1]*v_*k_[1]+y_[2]*(Hb[y_[2]]+0.25*v_*k_[2])),qb},shanbhag:function(Fb,Ub){for(var qb=Array(Fb.length),Xb=0;Xb<Fb.length;Xb++)qb[Xb]=Fb[Xb]/Ub;var Ob=Array(Fb.length),Nb=Array(Fb.length);Ob[0]=qb[0],Nb[0]=1-Ob[0];for(var Gb=1;Gb<Fb.length;Gb++)Ob[Gb]=Ob[Gb-1]+qb[Gb],Nb[Gb]=1-Ob[Gb];for(var Hb=0,Wb=0;Wb<Fb.length;Wb++)if(_Mathabs(Ob[Wb])>=_NumberEPSILON){Hb=Wb;break}for(var Zb=Fb.length-1,Qb=Fb.length-1;Qb>=Hb;Qb--)if(_Mathabs(Nb[Qb])>=_NumberEPSILON){Zb=Qb;break}for(var Kb=-1,Jb=_NumberMAX_VALUE,$b=void 0,e_=void 0,t_=void 0,a_=void 0,i_=Hb;i_<=Zb;i_++){t_=0,$b=0.5/Ob[i_];for(var n_=1;n_<=i_;n_++)t_-=qb[n_]*_Mathlog(1-$b*Ob[n_-1]);t_*=$b,a_=0,$b=0.5/Nb[i_];for(var o_=i_+1;o_<Fb.length;o_++)a_-=qb[o_]*_Mathlog(1-$b*Nb[o_]);a_*=$b,e_=_Mathabs(t_-a_),e_<Jb&&(Jb=e_,Kb=i_)}return Kb},triangle:function(Fb){for(var Ub=0,qb=0,Xb=0,Ob=0,Nb=0;Nb<Fb.length;Nb++)if(0<Fb[Nb]){Ub=Nb;break}0<Ub&&Ub--;for(var Gb=Fb.length-1;0<Gb;Gb--)if(0<Fb[Gb]){Ob=Gb;break}Ob<Fb.length-1&&Ob++;for(var Hb=0;Hb<Fb.length;Hb++)Fb[Hb]>qb&&(Xb=Hb,qb=Fb[Hb]);var Wb=!1;if(Xb-Ub<Ob-Xb){Wb=!0;for(var Zb=0,Qb=Fb.length-1,Kb;Zb<Qb;)Kb=Fb[Zb],Fb[Zb]=Fb[Qb],Fb[Qb]=Kb,Zb++,Qb--;Ub=Fb.length-1-Ob,Xb=Fb.length-1-Xb}if(Ub===Xb)return Ub;var Jb,$b,e_;Jb=Fb[Xb],$b=Ub-Xb,e_=_Mathsqrt(Jb*Jb+$b*$b),Jb/=e_,$b/=e_,e_=Jb*Ub+$b*Fb[Ub];for(var t_=Ub,a_=0,i_=Ub+1,n_;i_<=Xb;i_++)n_=Jb*i_+$b*Fb[i_]-e_,n_>a_&&(t_=i_,a_=n_);if(t_--,Wb){for(var o_=0,s_=Fb.length-1,r_;o_<s_;)r_=Fb[o_],Fb[o_]=Fb[s_],Fb[s_]=r_,o_++,s_--;return Fb.length-1-t_}return t_},yen:function(Fb,Ub){for(var qb=Array(Fb.length),Xb=0;Xb<Fb.length;Xb++)qb[Xb]=Fb[Xb]/Ub;var Ob=Array(Fb.length);Ob[0]=qb[0];for(var Nb=1;Nb<Fb.length;Nb++)Ob[Nb]=Ob[Nb-1]+qb[Nb];var Gb=Array(Fb.length);Gb[0]=qb[0]*qb[0];for(var Hb=1;Hb<Fb.length;Hb++)Gb[Hb]=Gb[Hb-1]+qb[Hb]*qb[Hb];var Wb=Array(Fb.length);Wb[Fb.length-1]=0;for(var Zb=Fb.length-2;0<=Zb;Zb--)Wb[Zb]=Wb[Zb+1]+qb[Zb+1]*qb[Zb+1];for(var Qb=-1,Kb=_NumberMIN_VALUE,Jb=void 0,$b=0;$b<Fb.length;$b++)Jb=-1*(0<Gb[$b]*Wb[$b]?_Mathlog(Gb[$b]*Wb[$b]):0)+2*(0<Ob[$b]*(1-Ob[$b])?_Mathlog(Ob[$b]*(1-Ob[$b])):0),Jb>Kb&&(Kb=Jb,Qb=$b);return Qb}},jh=['threshold'].concat(Object.keys(Dh)),Mh='has-own',Sh='1.0.0',Ih='A safer .hasOwnProperty() - hasOwn(name, obj)',Ph='index.js',Ch={test:'make test'},Bh='Aaron Heckmann <aaron.heckmann+github@gmail.com>',Ah='MIT',Rh={type:'git',url:'git://github.com/pebble/has-own.git'},zh='https://github.com/pebble/has-own/',Lh={mocha:'^1.21.0'},Eh={name:Mh,version:Sh,description:Ih,main:Ph,scripts:Ch,author:Bh,license:Ah,repository:Rh,homepage:zh,devDependencies:Lh},Th=Object.freeze({name:Mh,version:Sh,description:Ih,main:Ph,scripts:Ch,author:Bh,license:Ah,repository:Rh,homepage:zh,devDependencies:Lh,default:Eh}),Yh=ge(function(Fb,Ub){var qb=Object.prototype.hasOwnProperty;Fb.exports=Ub=function(Ob,Nb){return qb.call(Nb,Ob)},Ub.version=(Th&&Eh||Th).version}),Fh={configurable:!0,enumerable:!1,get:void 0};class Uh extends Array{constructor(Fb){if(Array.isArray(Fb)){super(Fb.length);for(var Ub=0;Ub<Fb.length;Ub++)this[Ub]=Fb[Ub]}else'number'==typeof Fb?super(Fb):super();this.computed=null}static load(Fb){return Promise.all(Fb.map(Sb.load)).then((Ub)=>new Uh(Ub))}static extendMethod(Fb,Ub,qb={}){var Xb=qb.inPlace,Nb=qb.returnThis,Hb=qb.partialArgs,Wb=void 0===Hb?[]:Hb;return Uh.prototype[Fb]=void 0!==Xb&&Xb?function(...Zb){this.computed=null;var Qb=Ub.apply(this,[...Wb,...Zb]);return void 0===Nb||Nb?this:Qb}:function(...Zb){return Ub.apply(this,[...Wb,...Zb])},Uh}static extendProperty(Fb,Ub,qb={}){var Xb=qb.partialArgs,Ob=void 0===Xb?[]:Xb;return Fh.get=function(){if(null===this.computed)this.computed={};else if(Yh(Fb,this.computed))return this.computed[Fb];var Nb=Ub.apply(this,Ob);return this.computed[Fb]=Nb,Nb},Object.defineProperty(Uh.prototype,Fb,Fh),Uh}checkProcessable(Fb,Ub={}){if('string'!=typeof Fb)throw new TypeError('checkProcessable requires as first parameter the processName (a string)');if(0===this.size)throw new TypeError('The process: '+Fb+' can not be applied on an empty stack');this[0].checkProcessable(Fb,Ub);for(var qb=1;qb<this.length;qb++){if((void 0===Ub.sameSize||Ub.sameSize)&&this[0].width!==this[qb].width)throw new TypeError('The process: '+Fb+' can not be applied if width is not identical in all images');if((void 0===Ub.sameSize||Ub.sameSize)&&this[0].height!==this[qb].height)throw new TypeError('The process: '+Fb+' can not be applied if height is not identical in all images');if((void 0===Ub.sameAlpha||Ub.sameAlpha)&&this[0].alpha!==this[qb].alpha)throw new TypeError('The process: '+Fb+' can not be applied if alpha is not identical in all images');if((void 0===Ub.sameBitDepth||Ub.sameBitDepth)&&this[0].bitDepth!==this[qb].bitDepth)throw new TypeError('The process: '+Fb+' can not be applied if bitDepth is not identical in all images');if((void 0===Ub.sameColorModel||Ub.sameColorModel)&&this[0].colorModel!==this[qb].colorModel)throw new TypeError('The process: '+Fb+' can not be applied if colorModel is not identical in all images');if((void 0===Ub.sameNumberChannels||Ub.sameNumberChannels)&&this[0].channels!==this[qb].channels)throw new TypeError('The process: '+Fb+' can not be applied if channels is not identical in all images')}}}Array[Symbol.species]||(Uh.prototype.map=function(Fb,Ub){if('function'!=typeof Fb)throw new TypeError(Fb+' is not a function');for(var qb=new Uh(this.length),Xb=0;Xb<this.length;Xb++)qb[Xb]=Fb.call(Ub,this[Xb],Xb,this);return qb}),function(Fb){Fb.extendMethod('matchAndCrop',ya),Fb.extendMethod('getMin',ka),Fb.extendMethod('getMax',va),Fb.extendMethod('getMedian',Ma),Fb.extendMethod('getHistogram',Sa),Fb.extendMethod('getHistograms',Ia),Fb.extendMethod('getAverage',Pa)}(Uh),Va.prototype.localMin=function(Fb,Ub){for(var qb=this[Fb][Ub],Xb=[Fb,Ub],Ob=_Mathmax(0,Fb-1);Ob<_Mathmin(this.length,Fb+2);Ob++)for(var Nb=_Mathmax(0,Ub-1);Nb<_Mathmin(this[0].length,Ub+2);Nb++)this[Ob][Nb]<qb&&(qb=this[Ob][Nb],Xb=[Ob,Nb]);return{position:Xb,value:qb}},Va.prototype.localMax=function(Fb,Ub){for(var qb=this[Fb][Ub],Xb=[Fb,Ub],Ob=_Mathmax(0,Fb-1);Ob<_Mathmin(this.length,Fb+2);Ob++)for(var Nb=_Mathmax(0,Ub-1);Nb<_Mathmin(this[0].length,Ub+2);Nb++)this[Ob][Nb]>qb&&(qb=this[Ob][Nb],Xb=[Ob,Nb]);return{position:Xb,value:qb}},Va.prototype.localSearch=function(Fb,Ub,qb){for(var Xb=[],Ob=_Mathmax(0,Fb-1);Ob<_Mathmin(this.length,Fb+2);Ob++)for(var Nb=_Mathmax(0,Ub-1);Nb<_Mathmin(this[0].length,Ub+2);Nb++)this[Ob][Nb]===qb&&Xb.push([Ob,Nb]);return Xb};var Xh=function(Fb,Ub,qb){var Ub=Ub/100,qb=qb/100,Xb=[],Ob=qb*Ub,Nb=Fb/60,Gb=Ob*(1-_Mathabs(Nb%2-1)),Hb=qb-Ob;switch(parseInt(Nb,10)){case 0:Xb=[Ob,Gb,0];break;case 1:Xb=[Gb,Ob,0];break;case 2:Xb=[0,Ob,Gb];break;case 3:Xb=[0,Gb,Ob];break;case 4:Xb=[Gb,0,Ob];break;case 5:Xb=[Ob,0,Gb];}return{r:_Mathround(255*(Xb[0]+Hb)),g:_Mathround(255*(Xb[1]+Hb)),b:_Mathround(255*(Xb[2]+Hb))}},Oh=function(Fb,Ub,qb){function Xb(Ob){var Nb=Ob.toString(16);return 1===Nb.length?'0'+Nb:Nb}return[Xb(Fb),Xb(Ub),Xb(qb)].join('')},Wh=function(Fb,Ub,qb,Xb){return Xb/=100,{r:parseInt(255*(1-Xb)+Xb*Fb,10),g:parseInt(255*(1-Xb)+Xb*Ub,10),b:parseInt(255*(1-Xb)+Xb*qb,10)}},Qh=function(Fb,Ub,qb){return Ub*=(50>qb?qb:100-qb)/100,console.log('s',Ub),{h:Fb,s:100*(2*Ub/(qb+Ub)),v:qb+Ub}},Jh=function(Fb,Ub,qb){var Xb=Qh(Fb,Ub,qb);return Xh(Xb.h,Xb.s,Xb.v)},$h={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,132,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,255,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,203],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[119,128,144],slategrey:[119,128,144],snow:[255,255,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,5]},am={hex2rgb:function(Fb){return('#'===Fb[0]&&(Fb=Fb.substr(1)),6===Fb.length)?{r:parseInt(Fb.substr(0,2),16),g:parseInt(Fb.substr(2,2),16),b:parseInt(Fb.substr(4,2),16)}:3===Fb.length?{r:parseInt(Fb[0]+Fb[0],16),g:parseInt(Fb[1]+Fb[1],16),b:parseInt(Fb[2]+Fb[2],16)}:void 0},hsv2hex:function(Fb,Ub,qb){var Xb=Xh(Fb,Ub,qb);return Oh(Xb.r,Xb.g,Xb.b)},hsv2rgb:Xh,rgb2hex:Oh,rgb2hsv:function(Fb,Ub,qb){var Gb=_Mathmax(Fb,Ub,qb),Hb=_Mathmin(Fb,Ub,qb),Wb=Gb-Hb,Xb,Ob,Nb;return 0==Wb?Xb=0:Fb===Gb?Xb=(Ub-qb)/Wb%6:Ub===Gb?Xb=(qb-Fb)/Wb+2:qb===Gb&&(Xb=(Fb-Ub)/Wb+4),Xb=_Mathround(60*Xb),0>Xb&&(Xb+=360),Ob=_Mathround(100*(0===Gb?0:Wb/Gb)),Nb=_Mathround(100*(Gb/255)),{h:Xb,s:Ob,v:Nb}},rgba:function(Fb,Ub,qb,Xb){return'rgba('+[Fb,Ub,qb,Xb/100].join(',')+')'},rgba2rgb:Wh,rgba2hex:function(Fb,Ub,qb,Xb){var Ob=Wh(Fb,Ub,qb,Xb);return Oh(Ob.r,Ob.g,Ob.b)},hsl2hsv:Qh,hsv2hsl:function(Fb,Ub,qb){var Xb=(200-Ub)*qb/100;return{h:Fb,s:Ub*qb/(100>Xb?Xb:200-Xb),l:Xb/2}},hsl2rgb:Jh,cssColor:function(Fb){return Ja(Fb)||ai(Fb)||ti(Fb)||$a(Fb)||ei(Fb)||ni(Fb)||oi(Fb)}}.cssColor,nm=[[0,0,1,0,0],[0,0,1,0,0],[1,1,1,1,1],[0,0,1,0,0],[0,0,1,0,0]],om=[[0,1,0],[1,1,1],[0,1,0]];class sm{constructor(Fb={}){var Ub=Fb.kind,qb=void 0===Ub?'cross':Ub,Xb=Fb.shape,Ob=Fb.size,Nb=Fb.width,Gb=Fb.height,Hb=Fb.filled,Wb=void 0===Hb||Hb;if(Ob&&(Nb=Ob,Gb=Ob),Xb)switch(Xb.toLowerCase()){case'square':case'rectangle':this.matrix=ui(Nb,Gb,{filled:Wb});break;case'circle':case'ellipse':this.matrix=pi(Nb,Gb,{filled:Wb});break;case'triangle':this.matrix=fi(Nb,Gb,{filled:Wb});break;default:throw new Error(`Shape: unexpected shape: ${Xb}`);}else if(qb)switch(qb.toLowerCase()){case'cross':this.matrix=nm;break;case'smallcross':this.matrix=om;break;default:throw new Error(`Shape: unexpected kind: ${qb}`);}else throw new Error('Shape: expected a kind or a shape option');this.height=this.matrix.length,this.width=this.matrix[0].length,this.halfHeight=this.height/2>>0,this.halfWidth=this.width/2>>0}getPoints(){for(var Fb=this.matrix,Ub=[],qb=0;qb<Fb.length;qb++)for(var Xb=0;Xb<Fb[0].length;Xb++)Fb[qb][Xb]&&Ub.push([Xb-this.halfWidth,qb-this.halfHeight]);return Ub}getMask(){for(var Fb=new Sb(this.width,this.height,{kind:Ar}),Ub=0;Ub<this.matrix.length;Ub++)for(var qb=0;qb<this.matrix[0].length;qb++)this.matrix[Ub][qb]&&Fb.setBitXY(qb,Ub);return Fb}}var lm=ge(function(Fb){(function(){function qb(Ob,Nb,Gb){this.next=Gb,Gb&&(Gb.prev=this),this.prev=Nb,Nb&&(Nb.next=this),this.data=Ob}function Xb(){return this instanceof Xb?void(this._head=null,this._tail=null,this.length=0):new Xb}Xb.prototype={push:function(Ob){this._tail=new qb(Ob,this._tail,null),this._head||(this._head=this._tail),this.length++},pop:function(){if(0!==this.length){var Ob=this._tail;return this._tail=Ob.prev,Ob.prev&&(Ob.prev=this._tail.next=null),this.length--,1===this.length?this._head=this._tail:0===this.length&&(this._head=this._tail=null),Ob.data}},unshift:function(Ob){this._head=new qb(Ob,null,this._head),this._tail||(this._tail=this._head),this.length++},shift:function(){if(0!==this.length){var Ob=this._head;return this._head=Ob.next,Ob.next&&(Ob.next=this._head.prev=null),this.length--,1===this.length?this._tail=this._head:0===this.length&&(this._head=this._tail=null),Ob.data}},item:function(Ob){0>Ob&&(Ob=this.length+Ob);for(var Nb=this._head;0<Ob--&&Nb;)Nb=Nb.next;return Nb?Nb.data:void 0},slice:function(Ob,Nb){if(Ob||(Ob=0),Nb||(Nb=this.length),0>Nb&&(Nb=this.length+Nb),0>Ob&&(Ob=this.length+Ob),Nb===Ob)return[];if(Nb<Ob)throw new Error('invalid offset: '+Ob+','+Nb+' (length='+this.length+')');for(var Gb=Nb-Ob,Hb=Array(Gb),Wb=0,Zb=this._head;0<Ob--&&Zb;)Zb=Zb.next;for(;Wb<Gb&&Zb;)Hb[Wb++]=Zb.data,Zb=Zb.next;return Hb},drop:function(){Xb.call(this)},forEach:function(Ob,Nb){for(var Gb=this._head,Hb=0,Wb=this.length;Hb<Wb&&Gb;)Ob.call(Nb||this,Gb.data,Hb,this),Gb=Gb.next,Hb++},map:function(Ob,Nb){var Gb=new Xb;return this.forEach(function(Hb,Wb,Zb){Gb.push(Ob.call(Nb||Zb,Hb,Wb,Zb))}),Gb},filter:function(Ob,Nb){var Gb=new Xb;return this.forEach(function(Hb,Wb,Zb){Ob.call(Nb||Zb,Hb,Wb,Zb)&&Gb.push(Hb)}),Gb},reduce:function(Ob,Nb,Gb){var Hb=0,Wb=this._head,Zb=this.length;for(Nb||(Hb=1,Nb=Wb&&Wb.data,Wb=Wb&&Wb.next);Hb<Zb&&Wb;)Nb=Ob.call(Gb||this,Nb,Wb.data,this),Hb++,Wb=Wb.next;return Nb}},Fb.exports=Xb})()}),dm={setBitXY(Fb,Ub){var qb=Ub*this.width+Fb;this.data[qb>>3]|=1<<7-(7&qb)},clearBitXY(Fb,Ub){var qb=Ub*this.width+Fb;this.data[qb>>3]&=~(1<<7-(7&qb))},toggleBitXY(Fb,Ub){var qb=Ub*this.width+Fb;this.data[qb>>3]^=1<<7-(7&qb)},getBitXY(Fb,Ub){var qb=Ub*this.width+Fb;return this.data[qb>>3]&1<<7-(7&qb)?1:0},setBit(Fb){this.data[Fb>>3]|=1<<7-(7&Fb)},clearBit(Fb){this.data[Fb>>3]&=~(1<<7-(7&Fb))},toggleBit(Fb){this.data[Fb>>3]^=1<<7-(7&Fb)},getBit(Fb){return this.data[Fb>>3]&1<<7-(7&Fb)?1:0}};class mm{constructor(Fb,Ub){this.parent=Fb,this.width=Fb.width,this.height=Fb.height,this.data=Ub,this.negative=0,this.positive=0,this.computed={}}get total(){return this.negative+this.positive}get minMax(){if(this.computed.minMax)return this.computed.minMax;for(var Fb=Number.MAX_SAFE_INTEGER,Ub=Number.MIN_SAFE_INTEGER,qb=0;qb<this.data.length;qb++)this.data[qb]<Fb&&(Fb=this.data[qb]),this.data[qb]>Ub&&(Ub=this.data[qb]);return this.computed.minMax={min:Fb,max:Ub}}get commonBorderLength(){return Ji(this)}mergeRoi(Fb={}){return $i.call(this,Fb)}rowsInfo(){for(var Fb=Array(this.height),Ub=0,qb=0,Xb;qb<this.data.length;qb+=this.width){Xb={row:Ub,positivePixel:0,negativePixel:0,zeroPixel:0,positiveRoi:0,negativeRoi:0,medianChange:0},Fb[Ub++]=Xb;for(var Ob={},Nb={},Gb=[],Hb=this.data[qb],Wb=0,Zb=qb,Qb;Zb<qb+this.width;Zb++)Qb=this.data[Zb],Hb!==Qb&&(Hb=Qb,Gb.push(Wb),Wb=0),Wb++,0<Qb?(Xb.positivePixel++,!Ob[Qb]&&(Ob[Qb]=!0)):0>Qb?(Xb.negativePixel++,!Nb[Qb]&&(Nb[Qb]=!0)):Xb.zeroPixel++;Gb.push(Wb),Xb.medianChange=Gb.sort((Kb,Jb)=>Kb-Jb)[_Mathfloor(Gb.length/2)],Xb.positiveRoiIDs=Object.keys(Ob),Xb.negativeRoiIDs=Object.keys(Nb),Xb.positiveRoi=Xb.positiveRoiIDs.length,Xb.negativeRoi=Xb.negativeRoiIDs.length}return Fb}colsInfo(){for(var Fb=Array(this.width),Ub=0,qb=0,Xb;qb<this.width;qb++){Xb={col:Ub,positivePixel:0,negativePixel:0,zeroPixel:0,positiveRoi:0,negativeRoi:0,medianChange:0},Fb[Ub++]=Xb;for(var Ob={},Nb={},Gb=[],Hb=this.data[qb],Wb=0,Zb=qb,Qb;Zb<qb+this.data.length;Zb+=this.width)Qb=this.data[Zb],Hb!==Qb&&(Hb=Qb,Gb.push(Wb),Wb=0),Wb++,0<Qb?(Xb.positivePixel++,!Ob[Qb]&&(Ob[Qb]=!0)):0>Qb?(Xb.negativePixel++,!Nb[Qb]&&(Nb[Qb]=!0)):Xb.zeroPixel++;Gb.push(Wb),Xb.medianChange=Gb.sort((Kb,Jb)=>Kb-Jb)[_Mathfloor(Gb.length/2)],Xb.positiveRoiIDs=Object.keys(Ob),Xb.negativeRoiIDs=Object.keys(Nb),Xb.positiveRoi=Xb.positiveRoiIDs.length,Xb.negativeRoi=Xb.negativeRoiIDs.length}return Fb}}var gm=class{constructor(){this.nodes=new Map}add(Fb){var Ub=this.nodes.get(Fb);return Ub||(Ub=new tn(Fb),this.nodes.set(Fb,Ub)),Ub}union(Fb,Ub){const qb=this.find(Fb),Xb=this.find(Ub);qb===Xb||(qb.rank<Xb.rank?qb.parent=Xb:qb.rank>Xb.rank?Xb.parent=qb:(Xb.parent=qb,qb.rank++))}find(Fb){for(var Ub=Fb;null!==Ub.parent;)Ub=Ub.parent;for(var qb=Fb,Xb;null!==qb.parent;)Xb=qb,qb=qb.parent,Xb.parent=Ub;return Ub}connected(Fb,Ub){return this.find(Fb)===this.find(Ub)}},um=[-1,0],pm=[0,-1],fm=[null,null],bm=[-1,-1,0,1],_m=[0,-1,-1,-1],wm=[null,null,null,null],xm=ge(function(Fb){(function(qb){Fb.exports=qb()})(function(){return function Nb(Gb,Hb,Wb){function Zb(Jb,$b){if(!Hb[Jb]){if(!Gb[Jb]){var e_='function'==typeof ce&&ce;if(!$b&&e_)return e_(Jb,!0);if(Qb)return Qb(Jb,!0);var t_=new Error('Cannot find module \''+Jb+'\'');throw t_.code='MODULE_NOT_FOUND',t_}var a_=Hb[Jb]={exports:{}};Gb[Jb][0].call(a_.exports,function(i_){var n_=Gb[Jb][1][i_];return Zb(n_?n_:i_)},a_,a_.exports,Nb,Gb,Hb,Wb)}return Hb[Jb].exports}for(var Qb='function'==typeof ce&&ce,Kb=0;Kb<Wb.length;Kb++)Zb(Wb[Kb]);return Zb}({1:[function(Nb,Gb){var $b=function(t_,a_){function i_(){this.constructor=t_}for(var n_ in a_)e_.call(a_,n_)&&(t_[n_]=a_[n_]);return i_.prototype=a_.prototype,t_.prototype=new i_,t_.__super__=a_.prototype,t_},e_={}.hasOwnProperty,Wb,Zb,Qb,Kb,Jb;Wb=Nb('./PriorityQueue/AbstractPriorityQueue'),Zb=Nb('./PriorityQueue/ArrayStrategy'),Kb=Nb('./PriorityQueue/BinaryHeapStrategy'),Qb=Nb('./PriorityQueue/BHeapStrategy'),Jb=function(t_){function a_(i_){i_||(i_={}),i_.strategy||(i_.strategy=Kb),i_.comparator||(i_.comparator=function(n_,o_){return(n_||0)-(o_||0)}),a_.__super__.constructor.call(this,i_)}return $b(a_,t_),a_}(Wb),Jb.ArrayStrategy=Zb,Jb.BinaryHeapStrategy=Kb,Jb.BHeapStrategy=Qb,Gb.exports=Jb},{'./PriorityQueue/AbstractPriorityQueue':2,'./PriorityQueue/ArrayStrategy':3,'./PriorityQueue/BHeapStrategy':4,'./PriorityQueue/BinaryHeapStrategy':5}],2:[function(Nb,Gb){var Wb;Gb.exports=Wb=function(){function Zb(Qb){var Kb;if(null==(null==Qb?void 0:Qb.strategy))throw'Must pass options.strategy, a strategy';if(null==(null==Qb?void 0:Qb.comparator))throw'Must pass options.comparator, a comparator';this.priv=new Qb.strategy(Qb),this.length=(null==Qb||null==(Kb=Qb.initialValues)?void 0:Kb.length)||0}return Zb.prototype.queue=function(Qb){return this.length++,this.priv.queue(Qb),void 0},Zb.prototype.dequeue=function(){if(!this.length)throw'Empty queue';return this.length--,this.priv.dequeue()},Zb.prototype.peek=function(){if(!this.length)throw'Empty queue';return this.priv.peek()},Zb.prototype.clear=function(){return this.length=0,this.priv.clear()},Zb}()},{}],3:[function(Nb,Gb){var Wb,Zb;Zb=function(Qb,Kb,Jb){var $b,e_,t_;for(e_=0,$b=Qb.length;e_<$b;)t_=e_+$b>>>1,0<=Jb(Qb[t_],Kb)?e_=t_+1:$b=t_;return e_},Gb.exports=Wb=function(){function Qb(Kb){var Jb;this.options=Kb,this.comparator=this.options.comparator,this.data=(null==(Jb=this.options.initialValues)?void 0:Jb.slice(0))||[],this.data.sort(this.comparator).reverse()}return Qb.prototype.queue=function(Kb){var Jb;return Jb=Zb(this.data,Kb,this.comparator),this.data.splice(Jb,0,Kb),void 0},Qb.prototype.dequeue=function(){return this.data.pop()},Qb.prototype.peek=function(){return this.data[this.data.length-1]},Qb.prototype.clear=function(){return this.data.length=0,void 0},Qb}()},{}],4:[function(Nb,Gb){var Wb;Gb.exports=Wb=function(){function Zb(Qb){var Kb,Jb,$b,e_,t_,a_,i_,n_,o_;for(this.comparator=(null==Qb?void 0:Qb.comparator)||function(s_,r_){return s_-r_},this.pageSize=(null==Qb?void 0:Qb.pageSize)||512,this.length=0,n_=0;1<<n_<this.pageSize;)n_+=1;if(1<<n_!==this.pageSize)throw'pageSize must be a power of two';for(this._shift=n_,this._emptyMemoryPageTemplate=Kb=[],(Jb=$b=0,a_=this.pageSize);0<=a_?$b<a_:$b>a_;Jb=0<=a_?++$b:--$b)Kb.push(null);if(this._memory=[],this._mask=this.pageSize-1,Qb.initialValues)for(i_=Qb.initialValues,e_=0,t_=i_.length;e_<t_;e_++)o_=i_[e_],this.queue(o_)}return Zb.prototype.queue=function(Qb){return this.length+=1,this._write(this.length,Qb),this._bubbleUp(this.length,Qb),void 0},Zb.prototype.dequeue=function(){var Qb,Kb;return Qb=this._read(1),Kb=this._read(this.length),this.length-=1,0<this.length&&(this._write(1,Kb),this._bubbleDown(1,Kb)),Qb},Zb.prototype.peek=function(){return this._read(1)},Zb.prototype.clear=function(){return this.length=0,this._memory.length=0,void 0},Zb.prototype._write=function(Qb,Kb){var Jb;for(Jb=Qb>>this._shift;Jb>=this._memory.length;)this._memory.push(this._emptyMemoryPageTemplate.slice(0));return this._memory[Jb][Qb&this._mask]=Kb},Zb.prototype._read=function(Qb){return this._memory[Qb>>this._shift][Qb&this._mask]},Zb.prototype._bubbleUp=function(Qb,Kb){var Jb,$b,e_,t_;for(Jb=this.comparator;1<Qb&&($b=Qb&this._mask,Qb<this.pageSize||3<$b?e_=Qb&~this._mask|$b>>1:2>$b?(e_=Qb-this.pageSize>>this._shift,e_+=e_&~(this._mask>>1),e_|=this.pageSize>>1):e_=Qb-2,t_=this._read(e_),!(0>Jb(t_,Kb)));)this._write(e_,Kb),this._write(Qb,t_),Qb=e_},Zb.prototype._bubbleDown=function(Qb,Kb){var Jb,$b,e_,t_,a_;for(a_=this.comparator;Qb<this.length;)if(Qb>this._mask&&!(Qb&this._mask-1)?Jb=$b=Qb+2:Qb&this.pageSize>>1?(Jb=(Qb&~this._mask)>>1,Jb|=Qb&this._mask>>1,Jb=Jb+1<<this._shift,$b=Jb+1):(Jb=Qb+(Qb&this._mask),$b=Jb+1),Jb!==$b&&$b<=this.length){if(e_=this._read(Jb),t_=this._read($b),0>a_(e_,Kb)&&0>=a_(e_,t_))this._write(Jb,Kb),this._write(Qb,e_),Qb=Jb;else if(0>a_(t_,Kb))this._write($b,Kb),this._write(Qb,t_),Qb=$b;else break;}else if(!(Jb<=this.length))break;else if(e_=this._read(Jb),0>a_(e_,Kb))this._write(Jb,Kb),this._write(Qb,e_),Qb=Jb;else break},Zb}()},{}],5:[function(Nb,Gb){var Wb;Gb.exports=Wb=function(){function Zb(Qb){var Kb;this.comparator=(null==Qb?void 0:Qb.comparator)||function(Jb,$b){return Jb-$b},this.length=0,this.data=(null==(Kb=Qb.initialValues)?void 0:Kb.slice(0))||[],this._heapify()}return Zb.prototype._heapify=function(){var Qb,Kb,Jb;if(0<this.data.length)for(Qb=Kb=1,Jb=this.data.length;1<=Jb?Kb<Jb:Kb>Jb;Qb=1<=Jb?++Kb:--Kb)this._bubbleUp(Qb)},Zb.prototype.queue=function(Qb){return this.data.push(Qb),this._bubbleUp(this.data.length-1),void 0},Zb.prototype.dequeue=function(){var Qb,Kb;return Kb=this.data[0],Qb=this.data.pop(),0<this.data.length&&(this.data[0]=Qb,this._bubbleDown(0)),Kb},Zb.prototype.peek=function(){return this.data[0]},Zb.prototype.clear=function(){return this.length=0,this.data.length=0,void 0},Zb.prototype._bubbleUp=function(Qb){for(var Kb,Jb;0<Qb&&(Kb=Qb-1>>>1,0>this.comparator(this.data[Qb],this.data[Kb]));)Jb=this.data[Kb],this.data[Kb]=this.data[Qb],this.data[Qb]=Jb,Qb=Kb},Zb.prototype._bubbleDown=function(Qb){var Kb,Jb,$b,e_,t_;for(Kb=this.data.length-1;Jb=(Qb<<1)+1,e_=Jb+1,$b=Qb,Jb<=Kb&&0>this.comparator(this.data[Jb],this.data[$b])&&($b=Jb),e_<=Kb&&0>this.comparator(this.data[e_],this.data[$b])&&($b=e_),$b!==Qb;)t_=this.data[$b],this.data[$b]=this.data[Qb],this.data[Qb]=t_,Qb=$b},Zb}()},{}]},{},[1])(1)})}),ym=[1,0,-1,0,1,1,-1,-1],km=[0,1,0,-1,1,-1,1,-1],vm=Object.prototype.hasOwnProperty,Dm=Object.prototype.toString,jm=function(Ub){return'function'==typeof Array.isArray?Array.isArray(Ub):'[object Array]'===Dm.call(Ub)},Mm=function(Ub){if(!Ub||'[object Object]'!==Dm.call(Ub))return!1;var qb=vm.call(Ub,'constructor'),Xb=Ub.constructor&&Ub.constructor.prototype&&vm.call(Ub.constructor.prototype,'isPrototypeOf');if(Ub.constructor&&!qb&&!Xb)return!1;for(var Ob in Ub);return'undefined'==typeof Ob||vm.call(Ub,Ob)},Sm=function Fb(){var Hb=arguments[0],Wb=1,Zb=arguments.length,Qb=!1,Ub,qb,Xb,Ob,Nb,Gb;for('boolean'==typeof Hb&&(Qb=Hb,Hb=arguments[1]||{},Wb=2),(null==Hb||'object'!=typeof Hb&&'function'!=typeof Hb)&&(Hb={});Wb<Zb;++Wb)if(Ub=arguments[Wb],null!=Ub)for(qb in Ub)Xb=Hb[qb],Ob=Ub[qb],Hb!==Ob&&(Qb&&Ob&&(Mm(Ob)||(Nb=jm(Ob)))?(Nb?(Nb=!1,Gb=Xb&&jm(Xb)?Xb:[]):Gb=Xb&&Mm(Xb)?Xb:{},Hb[qb]=Fb(Qb,Gb,Ob)):'undefined'!=typeof Ob&&(Hb[qb]=Ob));return Hb};class Im{constructor(Fb,Ub){this.map=Fb,this.id=Ub,this.minX=_NumberPOSITIVE_INFINITY,this.maxX=_NumberNEGATIVE_INFINITY,this.minY=_NumberPOSITIVE_INFINITY,this.maxY=_NumberNEGATIVE_INFINITY,this.meanX=0,this.meanY=0,this.surface=0,this.computed={}}getMask(Fb={}){var Ub=Fb.scale,qb=void 0===Ub?1:Ub,Xb=Fb.kind,Ob=void 0===Xb?'':Xb,Nb;return Nb='contour'===Ob?this.contourMask:'box'===Ob?this.boxMask:'filled'===Ob?this.filledMask:'center'===Ob?this.centerMask:this.mask,1>qb&&(Nb=Nb.scale({factor:qb}),Nb.parent=this.mask.parent,Nb.position[0]+=this.minX,Nb.position[1]+=this.minY),Nb}get mean(){throw new Error('Roi mean not implemented yet')}get center(){return this.computed.center?this.computed.center:this.computed.center=[this.width/2>>0,this.height/2>>0]}get ratio(){return this.width/this.height}get width(){return this.maxX-this.minX+1}get height(){return this.maxY-this.minY+1}_computExternalIDs(){var Fb=this.borderIDs,Ub=this.borderLengths;this.computed.externalIDs=[],this.computed.externalLengths=[];for(var qb=this.internalIDs,Xb=0;Xb<Fb.length;Xb++)qb.includes(Fb[Xb])||(this.computed.externalIDs.push(Fb[Xb]),this.computed.externalLengths.push(Ub[Xb]))}get externalIDs(){return this.computed.externalIDs?this.computed.externalIDs:(this._computExternalIDs(),this.computed.externalIDs)}get externalLengths(){return this.computed.externalLengths?this.computed.externalLengths:(this._computExternalIDs(),this.computed.externalLengths)}_computeBorderIDs(){var Fb=hn(this);this.computed.borderIDs=Fb.ids,this.computed.borderLengths=Fb.lengths}get borderIDs(){return this.computed.borderIDs?this.computed.borderIDs:(this._computeBorderIDs(),this.computed.borderIDs)}get borderLengths(){return this.computed.borderLengths?this.computed.borderLengths:(this._computeBorderIDs(),this.computed.borderLengths)}get boxIDs(){return this.computed.boxIDs?this.computed.boxIDs:this.computed.boxIDs=mn(this)}get internalIDs(){return this.computed.internalIDs?this.computed.internalIDs:this.computed.internalIDs=pn(this)}get box(){return this.computed.box?this.computed.box:this.computed.box=cn(this)}get external(){return this.computed.external?this.computed.external:this.computed.external=un(this)}get border(){return this.computed.border?this.computed.border:this.computed.border=gn(this)}get contourMask(){if(this.computed.contourMask)return this.computed.contourMask;for(var Fb=new Sb(this.width,this.height,{kind:Ar,position:[this.minX,this.minY],parent:this.map.parent}),Ub=0;Ub<this.width;Ub++)for(var qb=0;qb<this.height;qb++)this.map.data[Ub+this.minX+(qb+this.minY)*this.map.width]===this.id&&(0<Ub&&Ub<this.width-1&&0<qb&&qb<this.height-1?(this.map.data[Ub-1+this.minX+(qb+this.minY)*this.map.width]!==this.id||this.map.data[Ub+1+this.minX+(qb+this.minY)*this.map.width]!==this.id||this.map.data[Ub+this.minX+(qb-1+this.minY)*this.map.width]!==this.id||this.map.data[Ub+this.minX+(qb+1+this.minY)*this.map.width]!==this.id)&&Fb.setBitXY(Ub,qb):Fb.setBitXY(Ub,qb));return this.computed.contour=Fb}get boxMask(){if(this.computed.boxMask)return this.computed.boxMask;for(var Fb=new Sb(this.width,this.height,{kind:Ar,position:[this.minX,this.minY],parent:this.map.parent}),Ub=0;Ub<this.width;Ub++)Fb.setBitXY(Ub,0),Fb.setBitXY(Ub,this.height-1);for(var qb=0;qb<this.height;qb++)Fb.setBitXY(0,qb),Fb.setBitXY(this.width-1,qb);return this.computed.boxMask=Fb}get mask(){if(this.computed.mask)return this.computed.mask;for(var Fb=new Sb(this.width,this.height,{kind:Ar,position:[this.minX,this.minY],parent:this.map.parent}),Ub=0;Ub<this.width;Ub++)for(var qb=0;qb<this.height;qb++)this.map.data[Ub+this.minX+(qb+this.minY)*this.map.width]===this.id&&Fb.setBitXY(Ub,qb);return this.computed.mask=Fb}get filledMask(){if(this.computed.filledMask)return this.computed.filledMask;for(var Fb=new Sb(this.width,this.height,{kind:Ar,position:[this.minX,this.minY],parent:this.map.parent}),Ub=0;Ub<this.width;Ub++)for(var qb=0,Xb;qb<this.height;qb++)Xb=Ub+this.minX+(qb+this.minY)*this.map.width,this.internalIDs.includes(this.map.data[Xb])&&Fb.setBitXY(Ub,qb);return this.computed.filledMask=Fb}get centerMask(){if(this.computed.centerMask)return this.computed.centerMask;var Fb=new sm({kind:'smallCross'}).getMask();return Fb.parent=this.map.parent,Fb.position=[this.minX+this.center[0]-1,this.minY+this.center[1]-1],this.computed.centerMask=Fb}get points(){if(this.computed.points)return this.computed.points;for(var Fb=[],Ub=0;Ub<this.height;Ub++)for(var qb=0,Xb;qb<this.width;qb++)Xb=(Ub+this.minY)*this.map.width+qb+this.minX,this.map.data[Xb]===this.id&&Fb.push([qb,Ub]);return this.computed.points=Fb}get maxLengthPoints(){if(this.computed.maxLengthPoints)return this.computed.maxLengthPoints;for(var Fb=0,Ub=void 0,qb=this.points,Xb=0;Xb<qb.length;Xb++)for(var Ob=Xb+1,Nb;Ob<qb.length;Ob++)Nb=_Mathpow(qb[Xb][0]-qb[Ob][0],2)+_Mathpow(qb[Xb][1]-qb[Ob][1],2),Nb>=Fb&&(Fb=Nb,Ub=[qb[Xb],qb[Ob]]);return this.computed.maxLengthPoints=Ub}get maxLength(){if(this.computed.maxLength)return this.computed.maxLength;var Fb=_Mathsqrt(_Mathpow(this.maxLengthPoints[0][0]-this.maxLengthPoints[1][0],2)+_Mathpow(this.maxLengthPoints[0][1]-this.maxLengthPoints[1][1],2));return this.computed.maxLength=Fb}get angle(){if(this.computed.angle)return this.computed.angle;var Fb=this.maxLengthPoints,Ub=180*-Math.atan2(Fb[0][1]-Fb[1][1],Fb[0][0]-Fb[1][0])/_MathPI;return this.computed.angle=Ub}toJSON(){return{id:this.id,minX:this.minX,maxX:this.maxX,minY:this.minY,maxY:this.maxY,meanX:this.meanX,meanY:this.meanY,height:this.height,width:this.width,surface:this.surface}}}class Pm{constructor(Fb,Ub){this.roiMap=Fb,this.options=Ub,this.roi=this.createRoi()}createRoi(){var Fb=this.roiMap.data,Ub={};this.roiMap.positive=0,this.roiMap.negative=0;for(var qb=0;qb<Fb.length;qb++)Fb[qb]&&!Ub[Fb[qb]]&&(Ub[Fb[qb]]=!0,0<Fb[qb]?this.roiMap.positive++:this.roiMap.negative++);var Xb={};for(var Ob in Ub)Xb[Ob]=new Im(this.roiMap,1*Ob);for(var Nb=this.roiMap.width,Gb=this.roiMap.height,Hb=0;Hb<Gb;Hb++)for(var Wb=0,Zb;Wb<Nb;Wb++)if(Zb=Hb*Nb+Wb,0!==Fb[Zb]){var Qb=Fb[Zb],Kb=Xb[Qb];Wb<Kb.minX&&(Kb.minX=Wb),Wb>Kb.maxX&&(Kb.maxX=Wb),Hb<Kb.minY&&(Kb.minY=Hb),Hb>Kb.maxY&&(Kb.maxY=Hb),Kb.meanX+=Wb,Kb.meanY+=Hb,Kb.surface++}var Jb=[];for(var $b in Ub)Xb[$b].meanX/=Xb[$b].surface,Xb[$b].meanY/=Xb[$b].surface,Jb.push(Xb[$b]);return Jb}}class Cm{constructor(Fb,Ub={}){this._image=Fb,this._options=Ub,this._options.label||(this._options.label='default'),this._layers={},this._painted=null}fromMaxima(Fb={}){var Ub=Sm({},this._options,Fb),qb=rn.call(this._image,Fb);this._layers[Ub.label]=new Pm(qb,Ub)}fromPoints(Fb,Ub={}){var qb=Sm({},this._options,Ub),Xb=dn.call(this._image,Fb,Ub);return this._layers[qb.label]=new Pm(Xb,qb),this}putMap(Fb,Ub={}){var qb=new mm(this._image,Fb),Xb=Sm({},this._options,Ub);return this._layers[Xb.label]=new Pm(qb,Xb),this}fromWaterShed(Fb={}){var Ub=Sm({},this._options,Fb),qb=ln.call(this._image,Fb);this._layers[Ub.label]=new Pm(qb,Ub)}fromMask(Fb,Ub={}){var qb=Sm({},this._options,Ub),Xb=en.call(this._image,Fb,Ub);return this._layers[qb.label]=new Pm(Xb,qb),this}fromMaskConnectedComponentLabelingAlgorithm(Fb,Ub={}){var qb=Sm({},this._options,Ub),Xb=an.call(this._image,Fb,Ub);return this._layers[qb.label]=new Pm(Xb,qb),this}getMap(Fb={}){var Ub=Sm({},this._options,Fb);return this._assertLayerWithLabel(Ub.label),this._layers[Ub.label].roiMap}rowsInfo(Fb={}){return this.getMap(Fb).rowsInfo()}colsInfo(Fb={}){return this.getMap(Fb).rowsInfo()}getRoiIds(Fb={}){var Ub=this.getRois(Fb);if(Ub){for(var qb=Array(Ub.length),Xb=0;Xb<Ub.length;Xb++)qb[Xb]=Ub[Xb].id;return qb}throw new Error('ROIs not found')}getRois(Fb={}){var Ub=Fb.label,qb=void 0===Ub?this._options.label:Ub,Xb=Fb.positive,Nb=Fb.negative,Hb=Fb.minSurface,Wb=void 0===Hb?0:Hb,Zb=Fb.maxSurface,Qb=void 0===Zb?_NumberPOSITIVE_INFINITY:Zb,Kb=Fb.minWidth,Jb=void 0===Kb?0:Kb,$b=Fb.maxWidth,e_=void 0===$b?_NumberPOSITIVE_INFINITY:$b,t_=Fb.minHeight,a_=void 0===t_?0:t_,i_=Fb.maxHeight,n_=void 0===i_?_NumberPOSITIVE_INFINITY:i_,o_=Fb.minRatio,s_=void 0===o_?0:o_,r_=Fb.maxRatio,l_=void 0===r_?_NumberPOSITIVE_INFINITY:r_;if(!this._layers[qb])throw new Error('getRoi: This Roi layer ('+qb+') does not exists.');for(var d_=this._layers[qb].roi,h_=Array(d_.length),m_=0,c_=0,g_;c_<d_.length;c_++)g_=d_[c_],(0>g_.id&&(void 0===Nb||Nb)||0<g_.id&&(void 0===Xb||Xb))&&g_.surface>=Wb&&g_.surface<=Qb&&g_.width>=Jb&&g_.width<=e_&&g_.height>=a_&&g_.height<=n_&&g_.ratio>=s_&&g_.ratio<=l_&&(h_[m_++]=g_);return h_.length=m_,h_}getMasks(Fb={}){for(var Ub=this.getRois(Fb),qb=Array(Ub.length),Xb=0;Xb<Ub.length;Xb++)qb[Xb]=Ub[Xb].getMask(Fb);return qb}getData(Fb={}){var Ub=Sm({},this._options,Fb);return this._assertLayerWithLabel(Ub.label),this._layers[Ub.label].roiMap.data}paint(Fb={}){var Ub=Fb.labelProperty;this._painted||(this._painted=this._image.rgba8());var qb=this.getMasks(Fb);if(Ub){var Xb=this.getRois(Fb);Fb.labels=Xb.map((Ob)=>Ob[Ub]),Fb.labelsPosition=Xb.map((Ob)=>[Ob.meanX,Ob.meanY])}return this._painted.paintMasks(qb,Fb),this._painted}getMask(Fb={}){for(var Ub=new Sb(this._image.width,this._image.height,{kind:'BINARY'}),qb=this.getMasks(Fb),Xb=0,Ob;Xb<qb.length;Xb++){Ob=qb[Xb];for(var Nb=0;Nb<Ob.width;Nb++)for(var Gb=0;Gb<Ob.height;Gb++)Ob.getBitXY(Nb,Gb)&&Ub.setBitXY(Nb+Ob.position[0],Gb+Ob.position[1])}return Ub}resetPainted(Fb={}){var Ub=Fb.image;this._painted=Ub?this.image.rgba8():this._image.rgba8()}mergeRoi(Fb={}){var Ub=this.getMap(Fb);return Ub.mergeRoi(Fb),this.putMap(Ub.data,Fb),this}findCorrespondingRoi(Fb,Ub={}){for(var qb=this.getRois(Ub),Xb=[],Ob=0;Ob<qb.length;Ob++){var Nb=qb[Ob],Gb=Nb.minX,Hb=Nb.minY,Wb=Nb.points,Zb=_Mathsign(Nb.id),Qb=bn(Gb,Hb,Wb,Fb,Zb);Xb.push(Qb)}return Xb}_assertLayerWithLabel(Fb){if(!this._layers[Fb])throw new Error(`no layer with label ${Fb}`)}}var Bm=new Map,Am;class Rm{constructor(Fb){this.type=Fb,this._canWrite=null}canWrite(){return null===this._canWrite&&(this._canWrite=Am.toDataURL(this.type).startsWith('data:'+this.type)),this._canWrite}}const zm=8192,Lm=[];var Tm=class{constructor(Fb,Ub){Ub=Ub||{},void 0===Fb&&(Fb=zm),'number'==typeof Fb&&(Fb=new ArrayBuffer(Fb));let qb=Fb.byteLength;const Xb=Ub.offset?Ub.offset>>>0:0;Fb.buffer&&(qb=Fb.byteLength-Xb,Fb=Fb.byteLength===Fb.buffer.byteLength?Xb?Fb.buffer.slice(Xb):Fb.buffer:Fb.buffer.slice(Fb.byteOffset+Xb,Fb.byteOffset+Fb.byteLength)),this.buffer=Fb,this.length=qb,this.byteLength=qb,this.byteOffset=0,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer),this._increment=qb||zm,this._mark=0}available(Fb){return void 0===Fb&&(Fb=1),this.offset+Fb<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){this.littleEndian=!0}isBigEndian(){return!this.littleEndian}setBigEndian(){this.littleEndian=!1}skip(Fb){void 0===Fb&&(Fb=1),this.offset+=Fb}seek(Fb){this.offset=Fb}mark(){this._mark=this.offset}reset(){this.offset=this._mark}rewind(){this.offset=0}ensureAvailable(Fb){if(void 0===Fb&&(Fb=1),!this.available(Fb)){const Ub=this._increment+this._increment;this._increment=Ub;const qb=this.length+Ub,Xb=new Uint8Array(qb);Xb.set(new Uint8Array(this.buffer)),this.buffer=Xb.buffer,this.length=qb,this._data=new DataView(this.buffer)}}readBoolean(){return 0!==this.readUint8()}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(Fb){void 0===Fb&&(Fb=1);for(var Ub=new Uint8Array(Fb),qb=0;qb<Fb;qb++)Ub[qb]=this.readByte();return Ub}readInt16(){var Fb=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,Fb}readUint16(){var Fb=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,Fb}readInt32(){var Fb=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,Fb}readUint32(){var Fb=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,Fb}readFloat32(){var Fb=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,Fb}readFloat64(){var Fb=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,Fb}readChar(){return _StringfromCharCode(this.readInt8())}readChars(Fb){void 0===Fb&&(Fb=1),Lm.length=Fb;for(var Ub=0;Ub<Fb;Ub++)Lm[Ub]=this.readChar();return Lm.join('')}writeBoolean(Fb){this.writeUint8(Fb?255:0)}writeInt8(Fb){this.ensureAvailable(1),this._data.setInt8(this.offset++,Fb)}writeUint8(Fb){this.ensureAvailable(1),this._data.setUint8(this.offset++,Fb)}writeByte(Fb){this.writeUint8(Fb)}writeBytes(Fb){this.ensureAvailable(Fb.length);for(var Ub=0;Ub<Fb.length;Ub++)this._data.setUint8(this.offset++,Fb[Ub])}writeInt16(Fb){this.ensureAvailable(2),this._data.setInt16(this.offset,Fb,this.littleEndian),this.offset+=2}writeUint16(Fb){this.ensureAvailable(2),this._data.setUint16(this.offset,Fb,this.littleEndian),this.offset+=2}writeInt32(Fb){this.ensureAvailable(4),this._data.setInt32(this.offset,Fb,this.littleEndian),this.offset+=4}writeUint32(Fb){this.ensureAvailable(4),this._data.setUint32(this.offset,Fb,this.littleEndian),this.offset+=4}writeFloat32(Fb){this.ensureAvailable(4),this._data.setFloat32(this.offset,Fb,this.littleEndian),this.offset+=4}writeFloat64(Fb){this.ensureAvailable(8),this._data.setFloat64(this.offset,Fb,this.littleEndian),this.offset+=8}writeChar(Fb){this.writeUint8(Fb.charCodeAt(0))}writeChars(Fb){for(var Ub=0;Ub<Fb.length;Ub++)this.writeUint8(Fb.charCodeAt(Ub))}toArray(){return new Uint8Array(this.buffer,0,this.offset)}},Vm=ge(function(Fb,Ub){'use strict';var qb='undefined'!=typeof Uint8Array&&'undefined'!=typeof Uint16Array&&'undefined'!=typeof Int32Array;Ub.assign=function(Nb){for(var Gb=Array.prototype.slice.call(arguments,1),Hb;Gb.length;)if(Hb=Gb.shift(),!!Hb){if('object'!=typeof Hb)throw new TypeError(Hb+'must be non-object');for(var Wb in Hb)Hb.hasOwnProperty(Wb)&&(Nb[Wb]=Hb[Wb])}return Nb},Ub.shrinkBuf=function(Nb,Gb){return Nb.length===Gb?Nb:Nb.subarray?Nb.subarray(0,Gb):(Nb.length=Gb,Nb)};var Xb={arraySet:function(Nb,Gb,Hb,Wb,Zb){if(Gb.subarray&&Nb.subarray)return void Nb.set(Gb.subarray(Hb,Hb+Wb),Zb);for(var Qb=0;Qb<Wb;Qb++)Nb[Zb+Qb]=Gb[Hb+Qb]},flattenChunks:function(Nb){var Gb,Hb,Wb,Zb,Qb,Kb;for(Wb=0,Gb=0,Hb=Nb.length;Gb<Hb;Gb++)Wb+=Nb[Gb].length;for(Kb=new Uint8Array(Wb),Zb=0,(Gb=0,Hb=Nb.length);Gb<Hb;Gb++)Qb=Nb[Gb],Kb.set(Qb,Zb),Zb+=Qb.length;return Kb}},Ob={arraySet:function(Nb,Gb,Hb,Wb,Zb){for(var Qb=0;Qb<Wb;Qb++)Nb[Zb+Qb]=Gb[Hb+Qb]},flattenChunks:function(Nb){return[].concat.apply([],Nb)}};Ub.setTyped=function(Nb){Nb?(Ub.Buf8=Uint8Array,Ub.Buf16=Uint16Array,Ub.Buf32=Int32Array,Ub.assign(Ub,Xb)):(Ub.Buf8=Array,Ub.Buf16=Array,Ub.Buf32=Array,Ub.assign(Ub,Ob))},Ub.setTyped(qb)}),Fm=0,Um=1,Xm=0,Om=1,Wm=29,Zm=256,Qm=Zm+1+Wm,Km=30,Jm=19,$m=2*Qm+1,ec=15,tc=16,ac=7,nc=256,oc=16,sc=17,rc=18,hc=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],mc=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],cc=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],gc=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],fc=Array(2*(Qm+2));kn(fc);var bc=Array(2*Km);kn(bc);var wc=Array(512);kn(wc);var xc=Array(258-3+1);kn(xc);var yc=Array(Wm);kn(yc);var kc=Array(Km);kn(kc);var Mc=!1,Ac={_tr_init:function(Fb){Mc||(Rn(),Mc=!0),Fb.l_desc=new Dn(Fb.dyn_ltree,vc),Fb.d_desc=new Dn(Fb.dyn_dtree,Dc),Fb.bl_desc=new Dn(Fb.bl_tree,jc),Fb.bi_buf=0,Fb.bi_valid=0,zn(Fb)},_tr_stored_block:Hn,_tr_flush_block:function(Fb,Ub,qb,Xb){var Gb=0,Ob,Nb;0<Fb.level?(Fb.strm.data_type===2&&(Fb.strm.data_type=Nn(Fb)),Fn(Fb,Fb.l_desc),Fn(Fb,Fb.d_desc),Gb=Xn(Fb),Ob=Fb.opt_len+3+7>>>3,Nb=Fb.static_len+3+7>>>3,Nb<=Ob&&(Ob=Nb)):Ob=Nb=qb+5,qb+4<=Ob&&-1!==Ub?Hn(Fb,Ub,qb,Xb):Fb.strategy===4||Nb===Ob?(Sn(Fb,(Om<<1)+(Xb?1:0),3),Yn(Fb,fc,bc)):(Sn(Fb,(2<<1)+(Xb?1:0),3),On(Fb,Fb.l_desc.max_code+1,Fb.d_desc.max_code+1,Gb+1),Yn(Fb,Fb.dyn_ltree,Fb.dyn_dtree)),zn(Fb),Xb&&Ln(Fb)},_tr_tally:function(Fb,Ub,qb){return Fb.pending_buf[Fb.d_buf+2*Fb.last_lit]=255&Ub>>>8,Fb.pending_buf[Fb.d_buf+2*Fb.last_lit+1]=255&Ub,Fb.pending_buf[Fb.l_buf+Fb.last_lit]=255&qb,Fb.last_lit++,0===Ub?Fb.dyn_ltree[2*qb]++:(Fb.matches++,Ub--,Fb.dyn_ltree[2*(xc[qb]+Zm+1)]++,Fb.dyn_dtree[2*jn(Ub)]++),Fb.last_lit===Fb.lit_bufsize-1},_tr_align:function(Fb){Sn(Fb,Om<<1,3),In(Fb,nc,fc),Cn(Fb)}},Rc=function(Fb,Ub,qb,Xb){for(var Ob=0|65535&Fb,Nb=0|65535&Fb>>>16,Gb=0;0!==qb;){Gb=2e3<qb?2e3:qb,qb-=Gb;do Ob=0|Ob+Ub[Xb++],Nb=0|Nb+Ob;while(--Gb);Ob%=65521,Nb%=65521}return 0|(Ob|Nb<<16)},zc=function(){for(var Ub=[],qb=0,Fb;256>qb;qb++){Fb=qb;for(var Xb=0;8>Xb;Xb++)Fb=1&Fb?3988292384^Fb>>>1:Fb>>>1;Ub[qb]=Fb}return Ub}(),Lc=function(Fb,Ub,qb,Xb){Fb^=-1;for(var Gb=Xb;Gb<Xb+qb;Gb++)Fb=Fb>>>8^zc[255&(Fb^Ub[Gb])];return-1^Fb},Ec={0:'',1:'stream end',2:'need dictionary','-1':'file error','-2':'stream error','-3':'data error','-4':'insufficient memory','-5':'buffer error','-6':'incompatible version'},Tc=0,Fc=4,Uc=5,qc=0,Xc=1,Oc=-2,Gc=-5,Hc=-1,Wc=1,Zc=2,Kc=4,$c=2,eg=8,tg=9,sg=256+1+29,rg=30,lg=19,dg=2*sg+1,hg=15,mg=3,cg=258,gg=cg+mg+1,pg=42,fg=69,bg=73,_g=91,wg=103,xg=113,yg=666,kg=1,vg=2,Dg=3,jg=4,vc,Dc,jc,Sg;Sg=[new _o(0,0,0,0,function(Fb,Ub){var qb=65535;for(qb>Fb.pending_buf_size-5&&(qb=Fb.pending_buf_size-5);;){if(1>=Fb.lookahead){if(co(Fb),0===Fb.lookahead&&Ub===Tc)return kg;if(0===Fb.lookahead)break}Fb.strstart+=Fb.lookahead,Fb.lookahead=0;var Xb=Fb.block_start+qb;if((0===Fb.strstart||Fb.strstart>=Xb)&&(Fb.lookahead=Fb.strstart-Xb,Fb.strstart=Xb,so(Fb,!1),0===Fb.strm.avail_out))return kg;if(Fb.strstart-Fb.block_start>=Fb.w_size-gg&&(so(Fb,!1),0===Fb.strm.avail_out))return kg}return Fb.insert=0,Ub===Fc?(so(Fb,!0),0===Fb.strm.avail_out?Dg:jg):Fb.strstart>Fb.block_start&&(so(Fb,!1),0===Fb.strm.avail_out)?kg:kg}),new _o(4,4,8,4,uo),new _o(4,5,16,8,uo),new _o(4,6,32,32,uo),new _o(4,4,16,16,po),new _o(8,16,32,32,po),new _o(8,16,128,128,po),new _o(8,32,128,256,po),new _o(32,128,258,1024,po),new _o(32,258,258,4096,po)];var Tg={deflateInit:function(Fb,Ub){return Do(Fb,Ub,eg,15,8,0)},deflateInit2:Do,deflateReset:ko,deflateResetKeep:yo,deflateSetHeader:function(Fb,Ub){return Fb&&Fb.state?2===Fb.state.wrap?(Fb.state.gzhead=Ub,qc):Oc:Oc},deflate:function(Fb,Ub){var qb,Xb,Ob,Nb;if(!Fb||!Fb.state||Ub>Uc||0>Ub)return Fb?eo(Fb,Oc):Oc;if(Xb=Fb.state,!Fb.output||!Fb.input&&0!==Fb.avail_in||Xb.status===yg&&Ub!==Fc)return eo(Fb,0===Fb.avail_out?Gc:Oc);if(Xb.strm=Fb,qb=Xb.last_flush,Xb.last_flush=Ub,Xb.status===pg)if(2===Xb.wrap)Fb.adler=0,ro(Xb,31),ro(Xb,139),ro(Xb,8),Xb.gzhead?(ro(Xb,(Xb.gzhead.text?1:0)+(Xb.gzhead.hcrc?2:0)+(Xb.gzhead.extra?4:0)+(Xb.gzhead.name?8:0)+(Xb.gzhead.comment?16:0)),ro(Xb,255&Xb.gzhead.time),ro(Xb,255&Xb.gzhead.time>>8),ro(Xb,255&Xb.gzhead.time>>16),ro(Xb,255&Xb.gzhead.time>>24),ro(Xb,9===Xb.level?2:Xb.strategy>=Zc||2>Xb.level?4:0),ro(Xb,255&Xb.gzhead.os),Xb.gzhead.extra&&Xb.gzhead.extra.length&&(ro(Xb,255&Xb.gzhead.extra.length),ro(Xb,255&Xb.gzhead.extra.length>>8)),Xb.gzhead.hcrc&&(Fb.adler=Lc(Fb.adler,Xb.pending_buf,Xb.pending,0)),Xb.gzindex=0,Xb.status=fg):(ro(Xb,0),ro(Xb,0),ro(Xb,0),ro(Xb,0),ro(Xb,0),ro(Xb,9===Xb.level?2:Xb.strategy>=Zc||2>Xb.level?4:0),ro(Xb,3),Xb.status=xg);else{var Gb=eg+(Xb.w_bits-8<<4)<<8,Hb=-1;Hb=Xb.strategy>=Zc||2>Xb.level?0:6>Xb.level?1:6===Xb.level?2:3,Gb|=Hb<<6,0!==Xb.strstart&&(Gb|=32),Gb+=31-Gb%31,Xb.status=xg,lo(Xb,Gb),0!==Xb.strstart&&(lo(Xb,Fb.adler>>>16),lo(Xb,65535&Fb.adler)),Fb.adler=1}if(Xb.status===fg)if(Xb.gzhead.extra){for(Ob=Xb.pending;Xb.gzindex<(65535&Xb.gzhead.extra.length)&&!(Xb.pending===Xb.pending_buf_size&&(Xb.gzhead.hcrc&&Xb.pending>Ob&&(Fb.adler=Lc(Fb.adler,Xb.pending_buf,Xb.pending-Ob,Ob)),oo(Fb),Ob=Xb.pending,Xb.pending===Xb.pending_buf_size));)ro(Xb,255&Xb.gzhead.extra[Xb.gzindex]),Xb.gzindex++;Xb.gzhead.hcrc&&Xb.pending>Ob&&(Fb.adler=Lc(Fb.adler,Xb.pending_buf,Xb.pending-Ob,Ob)),Xb.gzindex===Xb.gzhead.extra.length&&(Xb.gzindex=0,Xb.status=bg)}else Xb.status=bg;if(Xb.status===bg)if(Xb.gzhead.name){Ob=Xb.pending;do{if(Xb.pending===Xb.pending_buf_size&&(Xb.gzhead.hcrc&&Xb.pending>Ob&&(Fb.adler=Lc(Fb.adler,Xb.pending_buf,Xb.pending-Ob,Ob)),oo(Fb),Ob=Xb.pending,Xb.pending===Xb.pending_buf_size)){Nb=1;break}Nb=Xb.gzindex<Xb.gzhead.name.length?255&Xb.gzhead.name.charCodeAt(Xb.gzindex++):0,ro(Xb,Nb)}while(0!==Nb);Xb.gzhead.hcrc&&Xb.pending>Ob&&(Fb.adler=Lc(Fb.adler,Xb.pending_buf,Xb.pending-Ob,Ob)),0===Nb&&(Xb.gzindex=0,Xb.status=_g)}else Xb.status=_g;if(Xb.status===_g)if(Xb.gzhead.comment){Ob=Xb.pending;do{if(Xb.pending===Xb.pending_buf_size&&(Xb.gzhead.hcrc&&Xb.pending>Ob&&(Fb.adler=Lc(Fb.adler,Xb.pending_buf,Xb.pending-Ob,Ob)),oo(Fb),Ob=Xb.pending,Xb.pending===Xb.pending_buf_size)){Nb=1;break}Nb=Xb.gzindex<Xb.gzhead.comment.length?255&Xb.gzhead.comment.charCodeAt(Xb.gzindex++):0,ro(Xb,Nb)}while(0!==Nb);Xb.gzhead.hcrc&&Xb.pending>Ob&&(Fb.adler=Lc(Fb.adler,Xb.pending_buf,Xb.pending-Ob,Ob)),0===Nb&&(Xb.status=wg)}else Xb.status=wg;if(Xb.status===wg&&(Xb.gzhead.hcrc?(Xb.pending+2>Xb.pending_buf_size&&oo(Fb),Xb.pending+2<=Xb.pending_buf_size&&(ro(Xb,255&Fb.adler),ro(Xb,255&Fb.adler>>8),Fb.adler=0,Xb.status=xg)):Xb.status=xg),0!==Xb.pending){if(oo(Fb),0===Fb.avail_out)return Xb.last_flush=-1,qc;}else if(0===Fb.avail_in&&ao(Ub)<=ao(qb)&&Ub!==Fc)return eo(Fb,Gc);if(Xb.status===yg&&0!==Fb.avail_in)return eo(Fb,Gc);if(0!==Fb.avail_in||0!==Xb.lookahead||Ub!==Tc&&Xb.status!==yg){var Wb=Xb.strategy===Zc?bo(Xb,Ub):Xb.strategy===3?fo(Xb,Ub):Sg[Xb.level].func(Xb,Ub);if((Wb===Dg||Wb===jg)&&(Xb.status=yg),Wb===kg||Wb===Dg)return 0===Fb.avail_out&&(Xb.last_flush=-1),qc;if(Wb===vg&&(Ub===1?Ac._tr_align(Xb):Ub!==Uc&&(Ac._tr_stored_block(Xb,0,0,!1),Ub===3&&(no(Xb.head),0===Xb.lookahead&&(Xb.strstart=0,Xb.block_start=0,Xb.insert=0))),oo(Fb),0===Fb.avail_out))return Xb.last_flush=-1,qc}return Ub===Fc?0>=Xb.wrap?Xc:(2===Xb.wrap?(ro(Xb,255&Fb.adler),ro(Xb,255&Fb.adler>>8),ro(Xb,255&Fb.adler>>16),ro(Xb,255&Fb.adler>>24),ro(Xb,255&Fb.total_in),ro(Xb,255&Fb.total_in>>8),ro(Xb,255&Fb.total_in>>16),ro(Xb,255&Fb.total_in>>24)):(lo(Xb,Fb.adler>>>16),lo(Xb,65535&Fb.adler)),oo(Fb),0<Xb.wrap&&(Xb.wrap=-Xb.wrap),0===Xb.pending?Xc:qc):qc},deflateEnd:function(Fb){var Ub;return Fb&&Fb.state?(Ub=Fb.state.status,Ub!==pg&&Ub!==fg&&Ub!==bg&&Ub!==_g&&Ub!==wg&&Ub!==xg&&Ub!==yg)?eo(Fb,Oc):(Fb.state=null,Ub===xg?eo(Fb,-3):qc):Oc},deflateSetDictionary:function(Fb,Ub){var qb=Ub.length,Xb,Ob,Nb,Gb,Hb,Wb,Zb,Qb;if(!Fb||!Fb.state)return Oc;if(Xb=Fb.state,Gb=Xb.wrap,2===Gb||1===Gb&&Xb.status!==pg||Xb.lookahead)return Oc;for(1===Gb&&(Fb.adler=Rc(Fb.adler,Ub,qb,0)),Xb.wrap=0,qb>=Xb.w_size&&(0===Gb&&(no(Xb.head),Xb.strstart=0,Xb.block_start=0,Xb.insert=0),Qb=new Vm.Buf8(Xb.w_size),Vm.arraySet(Qb,Ub,qb-Xb.w_size,Xb.w_size,0),Ub=Qb,qb=Xb.w_size),Hb=Fb.avail_in,Wb=Fb.next_in,Zb=Fb.input,Fb.avail_in=qb,Fb.next_in=0,Fb.input=Ub,co(Xb);Xb.lookahead>=mg;){Ob=Xb.strstart,Nb=Xb.lookahead-(mg-1);do Xb.ins_h=(Xb.ins_h<<Xb.hash_shift^Xb.window[Ob+mg-1])&Xb.hash_mask,Xb.prev[Ob&Xb.w_mask]=Xb.head[Xb.ins_h],Xb.head[Xb.ins_h]=Ob,Ob++;while(--Nb);Xb.strstart=Ob,Xb.lookahead=mg-1,co(Xb)}return Xb.strstart+=Xb.lookahead,Xb.block_start=Xb.strstart,Xb.insert=Xb.lookahead,Xb.lookahead=0,Xb.match_length=Xb.prev_length=mg-1,Xb.match_available=0,Fb.next_in=Wb,Fb.input=Zb,Fb.avail_in=Hb,Xb.wrap=Gb,qc},deflateInfo:'pako deflate (from Nodeca project)'},Vg=!0,Yg=!0;try{_StringfromCharCode.apply(null,[0])}catch(Fb){Vg=!1}try{_StringfromCharCode.apply(null,new Uint8Array(1))}catch(Fb){Yg=!1}for(var Fg=new Vm.Buf8(256),Ug=0;256>Ug;Ug++)Fg[Ug]=252<=Ug?6:248<=Ug?5:240<=Ug?4:224<=Ug?3:192<=Ug?2:1;Fg[254]=Fg[254]=1;var Hg={string2buf:function(Fb){var Gb=Fb.length,Hb=0,Ub,qb,Xb,Ob,Nb;for(Ob=0;Ob<Gb;Ob++)qb=Fb.charCodeAt(Ob),55296==(64512&qb)&&Ob+1<Gb&&(Xb=Fb.charCodeAt(Ob+1),56320==(64512&Xb)&&(qb=65536+(qb-55296<<10)+(Xb-56320),Ob++)),Hb+=128>qb?1:2048>qb?2:65536>qb?3:4;for(Ub=new Vm.Buf8(Hb),Nb=0,Ob=0;Nb<Hb;Ob++)qb=Fb.charCodeAt(Ob),55296==(64512&qb)&&Ob+1<Gb&&(Xb=Fb.charCodeAt(Ob+1),56320==(64512&Xb)&&(qb=65536+(qb-55296<<10)+(Xb-56320),Ob++)),128>qb?Ub[Nb++]=qb:2048>qb?(Ub[Nb++]=192|qb>>>6,Ub[Nb++]=128|63&qb):65536>qb?(Ub[Nb++]=224|qb>>>12,Ub[Nb++]=128|63&qb>>>6,Ub[Nb++]=128|63&qb):(Ub[Nb++]=240|qb>>>18,Ub[Nb++]=128|63&qb>>>12,Ub[Nb++]=128|63&qb>>>6,Ub[Nb++]=128|63&qb);return Ub},buf2binstring:function(Fb){return Po(Fb,Fb.length)},binstring2buf:function(Fb){for(var Ub=new Vm.Buf8(Fb.length),qb=0,Xb=Ub.length;qb<Xb;qb++)Ub[qb]=Fb.charCodeAt(qb);return Ub},buf2string:function(Fb,Ub){var Gb=Ub||Fb.length,Hb=Array(2*Gb),qb,Xb,Ob,Nb;for(Xb=0,qb=0;qb<Gb;){if(Ob=Fb[qb++],128>Ob){Hb[Xb++]=Ob;continue}if(Nb=Fg[Ob],4<Nb){Hb[Xb++]=65533,qb+=Nb-1;continue}for(Ob&=2===Nb?31:3===Nb?15:7;1<Nb&&qb<Gb;)Ob=Ob<<6|63&Fb[qb++],Nb--;if(1<Nb){Hb[Xb++]=65533;continue}65536>Ob?Hb[Xb++]=Ob:(Ob-=65536,Hb[Xb++]=55296|1023&Ob>>10,Hb[Xb++]=56320|1023&Ob)}return Po(Hb,Xb)},utf8border:function(Fb,Ub){var qb;for(Ub=Ub||Fb.length,Ub>Fb.length&&(Ub=Fb.length),qb=Ub-1;0<=qb&&128==(192&Fb[qb]);)qb--;return 0>qb?Ub:0===qb?Ub:qb+Fg[Fb[qb]]>Ub?qb:Ub}},Wg=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg='',this.state=null,this.data_type=2,this.adler=0},Zg=Object.prototype.toString,Kg=4,Jg=0,$g=1,eu=2,tu=-1,au=0,iu=8;Bo.prototype.push=function(Fb,Ub){var qb=this.strm,Xb=this.options.chunkSize,Ob,Nb;if(this.ended)return!1;Nb=Ub===~~Ub?Ub:!0===Ub?Kg:0,qb.input='string'==typeof Fb?Hg.string2buf(Fb):'[object ArrayBuffer]'===Zg.call(Fb)?new Uint8Array(Fb):Fb,qb.next_in=0,qb.avail_in=qb.input.length;do{if(0===qb.avail_out&&(qb.output=new Vm.Buf8(Xb),qb.next_out=0,qb.avail_out=Xb),Ob=Tg.deflate(qb,Nb),Ob!==$g&&Ob!==Jg)return this.onEnd(Ob),this.ended=!0,!1;(0===qb.avail_out||0===qb.avail_in&&(Nb===Kg||Nb===eu))&&('string'===this.options.to?this.onData(Hg.buf2binstring(Vm.shrinkBuf(qb.output,qb.next_out))):this.onData(Vm.shrinkBuf(qb.output,qb.next_out)))}while((0<qb.avail_in||0===qb.avail_out)&&Ob!==$g);return Nb===Kg?(Ob=Tg.deflateEnd(this.strm),this.onEnd(Ob),this.ended=!0,Ob===Jg):Nb!==eu||(this.onEnd(Jg),qb.avail_out=0,!0)},Bo.prototype.onData=function(Fb){this.chunks.push(Fb)},Bo.prototype.onEnd=function(Fb){Fb===Jg&&('string'===this.options.to?this.result=this.chunks.join(''):this.result=Vm.flattenChunks(this.chunks)),this.chunks=[],this.err=Fb,this.msg=this.strm.msg};var cu=30,uu=function(Ub,qb){var Xb,Ob,Nb,Gb,Hb,Wb,Zb,Qb,Kb,Jb,$b,e_,t_,a_,i_,n_,o_,s_,r_,l_,d_,h_,m_,c_,g_;Xb=Ub.state,Ob=Ub.next_in,c_=Ub.input,Nb=Ob+(Ub.avail_in-5),Gb=Ub.next_out,g_=Ub.output,Hb=Gb-(qb-Ub.avail_out),Wb=Gb+(Ub.avail_out-257),Zb=Xb.dmax,Qb=Xb.wsize,Kb=Xb.whave,Jb=Xb.wnext,$b=Xb.window,e_=Xb.hold,t_=Xb.bits,a_=Xb.lencode,i_=Xb.distcode,n_=(1<<Xb.lenbits)-1,o_=(1<<Xb.distbits)-1;top:do{15>t_&&(e_+=c_[Ob++]<<t_,t_+=8,e_+=c_[Ob++]<<t_,t_+=8),s_=a_[e_&n_];dolen:for(;;){if(r_=s_>>>24,e_>>>=r_,t_-=r_,r_=255&s_>>>16,0===r_)g_[Gb++]=65535&s_;else if(16&r_){l_=65535&s_,r_&=15,r_&&(t_<r_&&(e_+=c_[Ob++]<<t_,t_+=8),l_+=e_&(1<<r_)-1,e_>>>=r_,t_-=r_),15>t_&&(e_+=c_[Ob++]<<t_,t_+=8,e_+=c_[Ob++]<<t_,t_+=8),s_=i_[e_&o_];dodist:for(;;){if(r_=s_>>>24,e_>>>=r_,t_-=r_,r_=255&s_>>>16,16&r_){if(d_=65535&s_,r_&=15,t_<r_&&(e_+=c_[Ob++]<<t_,t_+=8,t_<r_&&(e_+=c_[Ob++]<<t_,t_+=8)),d_+=e_&(1<<r_)-1,d_>Zb){Ub.msg='invalid distance too far back',Xb.mode=cu;break top}if(e_>>>=r_,t_-=r_,r_=Gb-Hb,d_>r_){if(r_=d_-r_,r_>Kb&&Xb.sane){Ub.msg='invalid distance too far back',Xb.mode=cu;break top}if(h_=0,m_=$b,0===Jb){if(h_+=Qb-r_,r_<l_){l_-=r_;do g_[Gb++]=$b[h_++];while(--r_);h_=Gb-d_,m_=g_}}else if(Jb<r_){if(h_+=Qb+Jb-r_,r_-=Jb,r_<l_){l_-=r_;do g_[Gb++]=$b[h_++];while(--r_);if(h_=0,Jb<l_){r_=Jb,l_-=r_;do g_[Gb++]=$b[h_++];while(--r_);h_=Gb-d_,m_=g_}}}else if(h_+=Jb-r_,r_<l_){l_-=r_;do g_[Gb++]=$b[h_++];while(--r_);h_=Gb-d_,m_=g_}for(;2<l_;)g_[Gb++]=m_[h_++],g_[Gb++]=m_[h_++],g_[Gb++]=m_[h_++],l_-=3;l_&&(g_[Gb++]=m_[h_++],1<l_&&(g_[Gb++]=m_[h_++]))}else{h_=Gb-d_;do g_[Gb++]=g_[h_++],g_[Gb++]=g_[h_++],g_[Gb++]=g_[h_++],l_-=3;while(2<l_);l_&&(g_[Gb++]=g_[h_++],1<l_&&(g_[Gb++]=g_[h_++]))}}else if(0==(64&r_)){s_=i_[(65535&s_)+(e_&(1<<r_)-1)];continue dodist}else{Ub.msg='invalid distance code',Xb.mode=cu;break top}break}}else if(0==(64&r_)){s_=a_[(65535&s_)+(e_&(1<<r_)-1)];continue dolen}else if(32&r_){Xb.mode=12;break top}else{Ub.msg='invalid literal/length code',Xb.mode=cu;break top}break}}while(Ob<Nb&&Gb<Wb);return l_=t_>>3,Ob-=l_,t_-=l_<<3,e_&=(1<<t_)-1,Ub.next_in=Ob,Ub.next_out=Gb,Ub.avail_in=Ob<Nb?5+(Nb-Ob):5-(Ob-Nb),Ub.avail_out=Gb<Wb?257+(Wb-Gb):257-(Gb-Wb),Xb.hold=e_,void(Xb.bits=t_)},pu=15,fu=852,bu=592,_u=0,wu=1,xu=2,yu=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],ku=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],vu=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],Du=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64],ju=function(Ub,qb,Xb,Ob,Nb,Gb,Hb,Wb){var Zb=Wb.bits,Qb=0,Kb=0,Jb=0,$b=0,e_=0,t_=0,a_=0,i_=0,n_=0,o_=0,m_=null,c_=0,u_=new Vm.Buf16(pu+1),p_=new Vm.Buf16(pu+1),f_=null,b_=0,s_,r_,l_,d_,h_,g_,w_,x_,y_;for(Qb=0;Qb<=pu;Qb++)u_[Qb]=0;for(Kb=0;Kb<Ob;Kb++)u_[qb[Xb+Kb]]++;for(e_=Zb,$b=pu;1<=$b&&0===u_[$b];$b--);if(e_>$b&&(e_=$b),0==$b)return Nb[Gb++]=20971520,Nb[Gb++]=20971520,Wb.bits=1,0;for(Jb=1;Jb<$b&&0===u_[Jb];Jb++);for(e_<Jb&&(e_=Jb),i_=1,Qb=1;Qb<=pu;Qb++)if(i_<<=1,i_-=u_[Qb],0>i_)return-1;if(0<i_&&(Ub===_u||1!=$b))return-1;for(p_[1]=0,Qb=1;Qb<pu;Qb++)p_[Qb+1]=p_[Qb]+u_[Qb];for(Kb=0;Kb<Ob;Kb++)0!==qb[Xb+Kb]&&(Hb[p_[qb[Xb+Kb]]++]=Kb);if(Ub===_u?(m_=f_=Hb,g_=19):Ub===wu?(m_=yu,c_-=257,f_=ku,b_-=257,g_=256):(m_=vu,f_=Du,g_=-1),o_=0,Kb=0,Qb=Jb,h_=Gb,t_=e_,a_=0,l_=-1,n_=1<<e_,d_=n_-1,Ub===wu&&n_>fu||Ub===xu&&n_>bu)return 1;for(;;){w_=Qb-a_,Hb[Kb]<g_?(x_=0,y_=Hb[Kb]):Hb[Kb]>g_?(x_=f_[b_+Hb[Kb]],y_=m_[c_+Hb[Kb]]):(x_=96,y_=0),s_=1<<Qb-a_,r_=1<<t_,Jb=r_;do r_-=s_,Nb[h_+(o_>>a_)+r_]=0|(w_<<24|x_<<16|y_);while(0!==r_);for(s_=1<<Qb-1;o_&s_;)s_>>=1;if(0===s_?o_=0:(o_&=s_-1,o_+=s_),Kb++,0==--u_[Qb]){if(Qb==$b)break;Qb=qb[Xb+Hb[Kb]]}if(Qb>e_&&(o_&d_)!==l_){for(0==a_&&(a_=e_),h_+=Jb,t_=Qb-a_,i_=1<<t_;t_+a_<$b&&(i_-=u_[t_+a_],!(0>=i_));)t_++,i_<<=1;if(n_+=1<<t_,Ub===wu&&n_>fu||Ub===xu&&n_>bu)return 1;l_=o_&d_,Nb[l_]=0|(e_<<24|t_<<16|h_-Gb)}}return 0!==o_&&(Nb[h_+o_]=0|(4194304|Qb-a_<<24)),Wb.bits=e_,0},Su=1,Iu=2,Pu=4,Bu=6,Au=0,Lu=-2,Eu=-3,Tu=-4,Yu=8,Fu=1,Uu=2,qu=3,Xu=4,Ou=5,Nu=6,Gu=7,Hu=8,Wu=9,Zu=10,Qu=11,Ku=12,Ju=13,$u=14,ep=15,tp=16,ap=17,np=18,lp=19,dp=20,hp=21,mp=22,cp=23,gp=24,up=25,fp=26,bp=27,_p=28,wp=29,xp=30,yp=31,vp=852,Dp=592,Sp=!0,Fp={inflateReset:Vo,inflateReset2:Yo,inflateResetKeep:To,inflateInit:function(Fb){return Fo(Fb,15)},inflateInit2:Fo,inflate:function(Fb,Ub){var a_=0,m_=new Vm.Buf8(4),u_=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],qb,Xb,Ob,Nb,Gb,Hb,Wb,Zb,Qb,Kb,Jb,$b,e_,t_,i_,n_,o_,s_,r_,l_,d_,h_,c_,g_;if(!Fb||!Fb.state||!Fb.output||!Fb.input&&0!==Fb.avail_in)return Lu;qb=Fb.state,qb.mode===Ku&&(qb.mode=Ju),Gb=Fb.next_out,Ob=Fb.output,Wb=Fb.avail_out,Nb=Fb.next_in,Xb=Fb.input,Hb=Fb.avail_in,Zb=qb.hold,Qb=qb.bits,Kb=Hb,Jb=Wb,h_=Au;inf_leave:for(;;)switch(qb.mode){case Fu:if(0===qb.wrap){qb.mode=Ju;break}for(;16>Qb;){if(0===Hb)break inf_leave;Hb--,Zb+=Xb[Nb++]<<Qb,Qb+=8}if(2&qb.wrap&&35615===Zb){qb.check=0,m_[0]=255&Zb,m_[1]=255&Zb>>>8,qb.check=Lc(qb.check,m_,2,0),Zb=0,Qb=0,qb.mode=Uu;break}if(qb.flags=0,qb.head&&(qb.head.done=!1),!(1&qb.wrap)||(((255&Zb)<<8)+(Zb>>8))%31){Fb.msg='incorrect header check',qb.mode=xp;break}if((15&Zb)!=Yu){Fb.msg='unknown compression method',qb.mode=xp;break}if(Zb>>>=4,Qb-=4,d_=(15&Zb)+8,0===qb.wbits)qb.wbits=d_;else if(d_>qb.wbits){Fb.msg='invalid window size',qb.mode=xp;break}qb.dmax=1<<d_,Fb.adler=qb.check=1,qb.mode=512&Zb?Zu:Ku,Zb=0,Qb=0;break;case Uu:for(;16>Qb;){if(0===Hb)break inf_leave;Hb--,Zb+=Xb[Nb++]<<Qb,Qb+=8}if(qb.flags=Zb,(255&qb.flags)!=Yu){Fb.msg='unknown compression method',qb.mode=xp;break}if(57344&qb.flags){Fb.msg='unknown header flags set',qb.mode=xp;break}qb.head&&(qb.head.text=1&Zb>>8),512&qb.flags&&(m_[0]=255&Zb,m_[1]=255&Zb>>>8,qb.check=Lc(qb.check,m_,2,0)),Zb=0,Qb=0,qb.mode=qu;case qu:for(;32>Qb;){if(0===Hb)break inf_leave;Hb--,Zb+=Xb[Nb++]<<Qb,Qb+=8}qb.head&&(qb.head.time=Zb),512&qb.flags&&(m_[0]=255&Zb,m_[1]=255&Zb>>>8,m_[2]=255&Zb>>>16,m_[3]=255&Zb>>>24,qb.check=Lc(qb.check,m_,4,0)),Zb=0,Qb=0,qb.mode=Xu;case Xu:for(;16>Qb;){if(0===Hb)break inf_leave;Hb--,Zb+=Xb[Nb++]<<Qb,Qb+=8}qb.head&&(qb.head.xflags=255&Zb,qb.head.os=Zb>>8),512&qb.flags&&(m_[0]=255&Zb,m_[1]=255&Zb>>>8,qb.check=Lc(qb.check,m_,2,0)),Zb=0,Qb=0,qb.mode=Ou;case Ou:if(1024&qb.flags){for(;16>Qb;){if(0===Hb)break inf_leave;Hb--,Zb+=Xb[Nb++]<<Qb,Qb+=8}qb.length=Zb,qb.head&&(qb.head.extra_len=Zb),512&qb.flags&&(m_[0]=255&Zb,m_[1]=255&Zb>>>8,qb.check=Lc(qb.check,m_,2,0)),Zb=0,Qb=0}else qb.head&&(qb.head.extra=null);qb.mode=Nu;case Nu:if(1024&qb.flags&&($b=qb.length,$b>Hb&&($b=Hb),$b&&(qb.head&&(d_=qb.head.extra_len-qb.length,!qb.head.extra&&(qb.head.extra=Array(qb.head.extra_len)),Vm.arraySet(qb.head.extra,Xb,Nb,$b,d_)),512&qb.flags&&(qb.check=Lc(qb.check,Xb,$b,Nb)),Hb-=$b,Nb+=$b,qb.length-=$b),qb.length))break inf_leave;qb.length=0,qb.mode=Gu;case Gu:if(2048&qb.flags){if(0===Hb)break inf_leave;$b=0;do d_=Xb[Nb+$b++],qb.head&&d_&&65536>qb.length&&(qb.head.name+=_StringfromCharCode(d_));while(d_&&$b<Hb);if(512&qb.flags&&(qb.check=Lc(qb.check,Xb,$b,Nb)),Hb-=$b,Nb+=$b,d_)break inf_leave}else qb.head&&(qb.head.name=null);qb.length=0,qb.mode=Hu;case Hu:if(4096&qb.flags){if(0===Hb)break inf_leave;$b=0;do d_=Xb[Nb+$b++],qb.head&&d_&&65536>qb.length&&(qb.head.comment+=_StringfromCharCode(d_));while(d_&&$b<Hb);if(512&qb.flags&&(qb.check=Lc(qb.check,Xb,$b,Nb)),Hb-=$b,Nb+=$b,d_)break inf_leave}else qb.head&&(qb.head.comment=null);qb.mode=Wu;case Wu:if(512&qb.flags){for(;16>Qb;){if(0===Hb)break inf_leave;Hb--,Zb+=Xb[Nb++]<<Qb,Qb+=8}if(Zb!==(65535&qb.check)){Fb.msg='header crc mismatch',qb.mode=xp;break}Zb=0,Qb=0}qb.head&&(qb.head.hcrc=1&qb.flags>>9,qb.head.done=!0),Fb.adler=qb.check=0,qb.mode=Ku;break;case Zu:for(;32>Qb;){if(0===Hb)break inf_leave;Hb--,Zb+=Xb[Nb++]<<Qb,Qb+=8}Fb.adler=qb.check=Lo(Zb),Zb=0,Qb=0,qb.mode=Qu;case Qu:if(0===qb.havedict)return Fb.next_out=Gb,Fb.avail_out=Wb,Fb.next_in=Nb,Fb.avail_in=Hb,qb.hold=Zb,qb.bits=Qb,2;Fb.adler=qb.check=1,qb.mode=Ku;case Ku:if(Ub===5||Ub===Bu)break inf_leave;case Ju:if(qb.last){Zb>>>=7&Qb,Qb-=7&Qb,qb.mode=bp;break}for(;3>Qb;){if(0===Hb)break inf_leave;Hb--,Zb+=Xb[Nb++]<<Qb,Qb+=8}switch(qb.last=1&Zb,Zb>>>=1,Qb-=1,3&Zb){case 0:qb.mode=$u;break;case 1:if(qo(qb),qb.mode=dp,Ub===Bu){Zb>>>=2,Qb-=2;break inf_leave}break;case 2:qb.mode=ap;break;case 3:Fb.msg='invalid block type',qb.mode=xp;}Zb>>>=2,Qb-=2;break;case $u:for(Zb>>>=7&Qb,Qb-=7&Qb;32>Qb;){if(0===Hb)break inf_leave;Hb--,Zb+=Xb[Nb++]<<Qb,Qb+=8}if((65535&Zb)!=(65535^Zb>>>16)){Fb.msg='invalid stored block lengths',qb.mode=xp;break}if(qb.length=65535&Zb,Zb=0,Qb=0,qb.mode=ep,Ub===Bu)break inf_leave;case ep:qb.mode=tp;case tp:if($b=qb.length,$b){if($b>Hb&&($b=Hb),$b>Wb&&($b=Wb),0===$b)break inf_leave;Vm.arraySet(Ob,Xb,Nb,$b,Gb),Hb-=$b,Nb+=$b,Wb-=$b,Gb+=$b,qb.length-=$b;break}qb.mode=Ku;break;case ap:for(;14>Qb;){if(0===Hb)break inf_leave;Hb--,Zb+=Xb[Nb++]<<Qb,Qb+=8}if(qb.nlen=(31&Zb)+257,Zb>>>=5,Qb-=5,qb.ndist=(31&Zb)+1,Zb>>>=5,Qb-=5,qb.ncode=(15&Zb)+4,Zb>>>=4,Qb-=4,286<qb.nlen||30<qb.ndist){Fb.msg='too many length or distance symbols',qb.mode=xp;break}qb.have=0,qb.mode=np;case np:for(;qb.have<qb.ncode;){for(;3>Qb;){if(0===Hb)break inf_leave;Hb--,Zb+=Xb[Nb++]<<Qb,Qb+=8}qb.lens[u_[qb.have++]]=7&Zb,Zb>>>=3,Qb-=3}for(;19>qb.have;)qb.lens[u_[qb.have++]]=0;if(qb.lencode=qb.lendyn,qb.lenbits=7,c_={bits:qb.lenbits},h_=ju(0,qb.lens,0,19,qb.lencode,0,qb.work,c_),qb.lenbits=c_.bits,h_){Fb.msg='invalid code lengths set',qb.mode=xp;break}qb.have=0,qb.mode=lp;case lp:for(;qb.have<qb.nlen+qb.ndist;){for(;;){if(a_=qb.lencode[Zb&(1<<qb.lenbits)-1],i_=a_>>>24,n_=255&a_>>>16,o_=65535&a_,i_<=Qb)break;if(0===Hb)break inf_leave;Hb--,Zb+=Xb[Nb++]<<Qb,Qb+=8}if(16>o_)Zb>>>=i_,Qb-=i_,qb.lens[qb.have++]=o_;else{if(16===o_){for(g_=i_+2;Qb<g_;){if(0===Hb)break inf_leave;Hb--,Zb+=Xb[Nb++]<<Qb,Qb+=8}if(Zb>>>=i_,Qb-=i_,0===qb.have){Fb.msg='invalid bit length repeat',qb.mode=xp;break}d_=qb.lens[qb.have-1],$b=3+(3&Zb),Zb>>>=2,Qb-=2}else if(17===o_){for(g_=i_+3;Qb<g_;){if(0===Hb)break inf_leave;Hb--,Zb+=Xb[Nb++]<<Qb,Qb+=8}Zb>>>=i_,Qb-=i_,d_=0,$b=3+(7&Zb),Zb>>>=3,Qb-=3}else{for(g_=i_+7;Qb<g_;){if(0===Hb)break inf_leave;Hb--,Zb+=Xb[Nb++]<<Qb,Qb+=8}Zb>>>=i_,Qb-=i_,d_=0,$b=11+(127&Zb),Zb>>>=7,Qb-=7}if(qb.have+$b>qb.nlen+qb.ndist){Fb.msg='invalid bit length repeat',qb.mode=xp;break}for(;$b--;)qb.lens[qb.have++]=d_}}if(qb.mode===xp)break;if(0===qb.lens[256]){Fb.msg='invalid code -- missing end-of-block',qb.mode=xp;break}if(qb.lenbits=9,c_={bits:qb.lenbits},h_=ju(Su,qb.lens,0,qb.nlen,qb.lencode,0,qb.work,c_),qb.lenbits=c_.bits,h_){Fb.msg='invalid literal/lengths set',qb.mode=xp;break}if(qb.distbits=6,qb.distcode=qb.distdyn,c_={bits:qb.distbits},h_=ju(Iu,qb.lens,qb.nlen,qb.ndist,qb.distcode,0,qb.work,c_),qb.distbits=c_.bits,h_){Fb.msg='invalid distances set',qb.mode=xp;break}if(qb.mode=dp,Ub===Bu)break inf_leave;case dp:qb.mode=hp;case hp:if(6<=Hb&&258<=Wb){Fb.next_out=Gb,Fb.avail_out=Wb,Fb.next_in=Nb,Fb.avail_in=Hb,qb.hold=Zb,qb.bits=Qb,uu(Fb,Jb),Gb=Fb.next_out,Ob=Fb.output,Wb=Fb.avail_out,Nb=Fb.next_in,Xb=Fb.input,Hb=Fb.avail_in,Zb=qb.hold,Qb=qb.bits,qb.mode===Ku&&(qb.back=-1);break}for(qb.back=0;;){if(a_=qb.lencode[Zb&(1<<qb.lenbits)-1],i_=a_>>>24,n_=255&a_>>>16,o_=65535&a_,i_<=Qb)break;if(0===Hb)break inf_leave;Hb--,Zb+=Xb[Nb++]<<Qb,Qb+=8}if(n_&&0==(240&n_)){for(s_=i_,r_=n_,l_=o_;;){if(a_=qb.lencode[l_+((Zb&(1<<s_+r_)-1)>>s_)],i_=a_>>>24,n_=255&a_>>>16,o_=65535&a_,s_+i_<=Qb)break;if(0===Hb)break inf_leave;Hb--,Zb+=Xb[Nb++]<<Qb,Qb+=8}Zb>>>=s_,Qb-=s_,qb.back+=s_}if(Zb>>>=i_,Qb-=i_,qb.back+=i_,qb.length=o_,0===n_){qb.mode=fp;break}if(32&n_){qb.back=-1,qb.mode=Ku;break}if(64&n_){Fb.msg='invalid literal/length code',qb.mode=xp;break}qb.extra=15&n_,qb.mode=mp;case mp:if(qb.extra){for(g_=qb.extra;Qb<g_;){if(0===Hb)break inf_leave;Hb--,Zb+=Xb[Nb++]<<Qb,Qb+=8}qb.length+=Zb&(1<<qb.extra)-1,Zb>>>=qb.extra,Qb-=qb.extra,qb.back+=qb.extra}qb.was=qb.length,qb.mode=cp;case cp:for(;;){if(a_=qb.distcode[Zb&(1<<qb.distbits)-1],i_=a_>>>24,n_=255&a_>>>16,o_=65535&a_,i_<=Qb)break;if(0===Hb)break inf_leave;Hb--,Zb+=Xb[Nb++]<<Qb,Qb+=8}if(0==(240&n_)){for(s_=i_,r_=n_,l_=o_;;){if(a_=qb.distcode[l_+((Zb&(1<<s_+r_)-1)>>s_)],i_=a_>>>24,n_=255&a_>>>16,o_=65535&a_,s_+i_<=Qb)break;if(0===Hb)break inf_leave;Hb--,Zb+=Xb[Nb++]<<Qb,Qb+=8}Zb>>>=s_,Qb-=s_,qb.back+=s_}if(Zb>>>=i_,Qb-=i_,qb.back+=i_,64&n_){Fb.msg='invalid distance code',qb.mode=xp;break}qb.offset=o_,qb.extra=15&n_,qb.mode=gp;case gp:if(qb.extra){for(g_=qb.extra;Qb<g_;){if(0===Hb)break inf_leave;Hb--,Zb+=Xb[Nb++]<<Qb,Qb+=8}qb.offset+=Zb&(1<<qb.extra)-1,Zb>>>=qb.extra,Qb-=qb.extra,qb.back+=qb.extra}if(qb.offset>qb.dmax){Fb.msg='invalid distance too far back',qb.mode=xp;break}qb.mode=up;case up:if(0===Wb)break inf_leave;if($b=Jb-Wb,qb.offset>$b){if($b=qb.offset-$b,$b>qb.whave&&qb.sane){Fb.msg='invalid distance too far back',qb.mode=xp;break}$b>qb.wnext?($b-=qb.wnext,e_=qb.wsize-$b):e_=qb.wnext-$b,$b>qb.length&&($b=qb.length),t_=qb.window}else t_=Ob,e_=Gb-qb.offset,$b=qb.length;$b>Wb&&($b=Wb),Wb-=$b,qb.length-=$b;do Ob[Gb++]=t_[e_++];while(--$b);0===qb.length&&(qb.mode=hp);break;case fp:if(0===Wb)break inf_leave;Ob[Gb++]=qb.length,Wb--,qb.mode=hp;break;case bp:if(qb.wrap){for(;32>Qb;){if(0===Hb)break inf_leave;Hb--,Zb|=Xb[Nb++]<<Qb,Qb+=8}if(Jb-=Wb,Fb.total_out+=Jb,qb.total+=Jb,Jb&&(Fb.adler=qb.check=qb.flags?Lc(qb.check,Ob,Jb,Gb-Jb):Rc(qb.check,Ob,Jb,Gb-Jb)),Jb=Wb,(qb.flags?Zb:Lo(Zb))!==qb.check){Fb.msg='incorrect data check',qb.mode=xp;break}Zb=0,Qb=0}qb.mode=_p;case _p:if(qb.wrap&&qb.flags){for(;32>Qb;){if(0===Hb)break inf_leave;Hb--,Zb+=Xb[Nb++]<<Qb,Qb+=8}if(Zb!==(4294967295&qb.total)){Fb.msg='incorrect length check',qb.mode=xp;break}Zb=0,Qb=0}qb.mode=wp;case wp:h_=1;break inf_leave;case xp:h_=Eu;break inf_leave;case yp:return Tu;case 32:default:return Lu;}return(Fb.next_out=Gb,Fb.avail_out=Wb,Fb.next_in=Nb,Fb.avail_in=Hb,qb.hold=Zb,qb.bits=Qb,(qb.wsize||Jb!==Fb.avail_out&&qb.mode<xp&&(qb.mode<bp||Ub!==Pu))&&Xo(Fb,Fb.output,Fb.next_out,Jb-Fb.avail_out))?(qb.mode=yp,Tu):(Kb-=Fb.avail_in,Jb-=Fb.avail_out,Fb.total_in+=Kb,Fb.total_out+=Jb,qb.total+=Jb,qb.wrap&&Jb&&(Fb.adler=qb.check=qb.flags?Lc(qb.check,Ob,Jb,Fb.next_out-Jb):Rc(qb.check,Ob,Jb,Fb.next_out-Jb)),Fb.data_type=qb.bits+(qb.last?64:0)+(qb.mode===Ku?128:0)+(qb.mode===dp||qb.mode===ep?256:0),(0===Kb&&0===Jb||Ub===Pu)&&h_===Au&&(h_=-5),h_)},inflateEnd:function(Fb){if(!Fb||!Fb.state)return Lu;var Ub=Fb.state;return Ub.window&&(Ub.window=null),Fb.state=null,Au},inflateGetHeader:function(Fb,Ub){var qb;return Fb&&Fb.state?(qb=Fb.state,0==(2&qb.wrap))?Lu:(qb.head=Ub,Ub.done=!1,Au):Lu},inflateSetDictionary:function(Fb,Ub){var qb=Ub.length,Xb,Ob,Nb;return Fb&&Fb.state?(Xb=Fb.state,0!==Xb.wrap&&Xb.mode!==Qu)?Lu:Xb.mode===Qu&&(Ob=1,Ob=Rc(Ob,Ub,qb,0),Ob!==Xb.check)?Eu:(Nb=Xo(Fb,Ub,qb,qb),Nb)?(Xb.mode=yp,Tu):(Xb.havedict=1,Au):Lu},inflateInfo:'pako inflate (from Nodeca project)'},Up={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},qp=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name='',this.comment='',this.hcrc=0,this.done=!1},Xp=Object.prototype.toString,Ip,Pp;Zo.prototype.push=function(Fb,Ub){var qb=this.strm,Xb=this.options.chunkSize,Ob=this.options.dictionary,Kb=!1,Nb,Gb,Hb,Wb,Zb,Qb;if(this.ended)return!1;Gb=Ub===~~Ub?Ub:!0===Ub?Up.Z_FINISH:Up.Z_NO_FLUSH,qb.input='string'==typeof Fb?Hg.binstring2buf(Fb):'[object ArrayBuffer]'===Xp.call(Fb)?new Uint8Array(Fb):Fb,qb.next_in=0,qb.avail_in=qb.input.length;do{if(0===qb.avail_out&&(qb.output=new Vm.Buf8(Xb),qb.next_out=0,qb.avail_out=Xb),Nb=Fp.inflate(qb,Up.Z_NO_FLUSH),Nb===Up.Z_NEED_DICT&&Ob&&(Qb='string'==typeof Ob?Hg.string2buf(Ob):'[object ArrayBuffer]'===Xp.call(Ob)?new Uint8Array(Ob):Ob,Nb=Fp.inflateSetDictionary(this.strm,Qb)),Nb===Up.Z_BUF_ERROR&&!0==Kb&&(Nb=Up.Z_OK,Kb=!1),Nb!==Up.Z_STREAM_END&&Nb!==Up.Z_OK)return this.onEnd(Nb),this.ended=!0,!1;qb.next_out&&(0===qb.avail_out||Nb===Up.Z_STREAM_END||0===qb.avail_in&&(Gb===Up.Z_FINISH||Gb===Up.Z_SYNC_FLUSH))&&('string'===this.options.to?(Hb=Hg.utf8border(qb.output,qb.next_out),Wb=qb.next_out-Hb,Zb=Hg.buf2string(qb.output,Hb),qb.next_out=Wb,qb.avail_out=Xb-Wb,Wb&&Vm.arraySet(qb.output,qb.output,Hb,Wb,0),this.onData(Zb)):this.onData(Vm.shrinkBuf(qb.output,qb.next_out))),0===qb.avail_in&&0===qb.avail_out&&(Kb=!0)}while((0<qb.avail_in||0===qb.avail_out)&&Nb!==Up.Z_STREAM_END);return Nb===Up.Z_STREAM_END&&(Gb=Up.Z_FINISH),Gb===Up.Z_FINISH?(Nb=Fp.inflateEnd(this.strm),this.onEnd(Nb),this.ended=!0,Nb===Up.Z_OK):Gb!==Up.Z_SYNC_FLUSH||(this.onEnd(Up.Z_OK),qb.avail_out=0,!0)},Zo.prototype.onData=function(Fb){this.chunks.push(Fb)},Zo.prototype.onEnd=function(Fb){Fb===Up.Z_OK&&('string'===this.options.to?this.result=this.chunks.join(''):this.result=Vm.flattenChunks(this.chunks)),this.chunks=[],this.err=Fb,this.msg=this.strm.msg};var Zp=Vm.assign,Qp={};Zp(Qp,{Deflate:Bo,deflate:Ao,deflateRaw:function(Fb,Ub){return Ub=Ub||{},Ub.raw=!0,Ao(Fb,Ub)},gzip:function(Fb,Ub){return Ub=Ub||{},Ub.gzip=!0,Ao(Fb,Ub)}},{Inflate:Zo,inflate:Qo,inflateRaw:function(Fb,Ub){return Ub=Ub||{},Ub.raw=!0,Qo(Fb,Ub)},ungzip:Qo},Up);const Jp=Qp.Inflate,$p=new Uint8Array(0),tf=[137,80,78,71,13,10,26,10];var of=class extends Tm{constructor(Fb){super(Fb),this._decoded=!1,this._inflator=new Jp,this._png=null,this._end=!1,this.setBigEndian()}decode(){if(this._decoded)return this._png;for(this._png={tEXt:{}},this.decodeSignature();!this._end;)this.decodeChunk();return this.decodeImage(),this._png}decodeSignature(){for(var Fb=0;8>Fb;Fb++)if(this.readUint8()!==tf[Fb])throw new Error(`Wrong PNG signature. Byte at ${Fb} should be ${tf[Fb]}.`)}decodeChunk(){var Fb=this.readUint32(),Ub=this.readChars(4),qb=this.offset;if('IHDR'===Ub?this.decodeIHDR():'PLTE'===Ub?this.decodePLTE(Fb):'IDAT'===Ub?this.decodeIDAT(Fb):'tEXt'===Ub?this.decodetEXt(Fb):'IEND'===Ub?this._end=!0:this.skip(Fb),this.offset-qb!==Fb)throw new Error('Length mismatch while decoding chunk '+Ub);this.readUint32()}decodeIHDR(){var Fb=this._png;if(Fb.width=this.readUint32(),Fb.height=this.readUint32(),Fb.bitDepth=this.readUint8(),Fb.colourType=this.readUint8(),Fb.compressionMethod=this.readUint8(),Fb.filterMethod=this.readUint8(),Fb.interlaceMethod=this.readUint8(),0!==this._png.compressionMethod)throw new Error('Unsupported compression method: '+Fb.compressionMethod)}decodePLTE(Fb){if(0!=Fb%3)throw new RangeError('PLTE field length must be a multiple of 3. Got '+Fb);var Ub=Fb/3;this._hasPalette=!0;for(var qb=this._palette=Array(Ub),Xb=0;Xb<Ub;Xb++)qb[Xb]=[this.readUint8(),this.readUint8(),this.readUint8()]}decodeIDAT(Fb){this._inflator.push(new Uint8Array(this.buffer,this.offset,Fb)),this.skip(Fb)}decodetEXt(Fb){for(var Ub='',qb;(qb=this.readChar())!=='\0';)Ub+=qb;this._png.tEXt[Ub]=this.readChars(Fb-Ub.length-1)}decodeImage(){if(this._inflator.push($p,!0),this._inflator.err)throw new Error('Error while decompressing the data');var Fb=this._inflator.result;if(this._inflator=null,0!==this._png.filterMethod)throw new Error('Filter method '+this._png.filterMethod+' not supported');if(0===this._png.interlaceMethod)this.decodeInterlaceNull(Fb);else throw new Error('Interlace method '+this._png.interlaceMethod+' not supported')}decodeInterlaceNull(Fb){var Ub;switch(this._png.colourType){case 0:Ub=1;break;case 2:Ub=3;break;case 3:if(!this._hasPalette)throw new Error('Missing palette');Ub=1;break;case 4:Ub=2;break;case 6:Ub=4;break;default:throw new Error('Unknown colour type: '+this._png.colourType);}const qb=this._png.height,Xb=Ub*this._png.bitDepth/8,Ob=this._png.width*Xb,Nb=new Uint8Array(this._png.height*Ob);for(var Gb=$p,Hb=0,Qb=0,Wb,Zb;Qb<qb;Qb++){switch(Wb=Fb.subarray(Hb+1,Hb+1+Ob),Zb=Nb.subarray(Qb*Ob,(Qb+1)*Ob),Fb[Hb]){case 0:Jo(Wb,Zb,Ob);break;case 1:$o(Wb,Zb,Ob,Xb);break;case 2:es(Wb,Zb,Gb,Ob);break;case 3:ts(Wb,Zb,Gb,Ob,Xb);break;case 4:as(Wb,Zb,Gb,Ob,Xb);break;default:throw new Error('Unsupported filter: '+Fb[Hb]);}Gb=Zb,Hb+=Ob+1}this._hasPalette&&(this._png.palette=this._palette),this._png.data=Nb}};const sf={254:'NewSubfileType',255:'SubfileType',256:'ImageWidth',257:'ImageLength',258:'BitsPerSample',259:'Compression',262:'PhotometricInterpretation',263:'Threshholding',264:'CellWidth',265:'CellLength',266:'FillOrder',269:'DocumentName',270:'ImageDescription',271:'Make',272:'Model',273:'StripOffsets',274:'Orientation',277:'SamplesPerPixel',278:'RowsPerStrip',279:'StripByteCounts',280:'MinSampleValue',281:'MaxSampleValue',282:'XResolution',283:'YResolution',284:'PlanarConfiguration',285:'PageName',286:'XPosition',287:'YPosition',288:'FreeOffsets',289:'FreeByteCounts',290:'GrayResponseUnit',291:'GrayResponseCurve',292:'T4Options',293:'T6Options',296:'ResolutionUnit',297:'PageNumber',301:'TransferFunction',305:'Software',306:'DateTime',315:'Artist',316:'HostComputer',317:'Predictor',318:'WhitePoint',319:'PrimaryChromaticities',320:'ColorMap',321:'HalftoneHints',322:'TileWidth',323:'TileLength',324:'TileOffsets',325:'TileByteCounts',326:'BadFaxLines',327:'CleanFaxData',328:'ConsecutiveBadFaxLines',330:'SubIFDs',332:'InkSet',333:'InkNames',334:'NumberOfInks',336:'DotRange',337:'TargetPrinter',338:'ExtraSamples',339:'SampleFormat',340:'SMinSampleValue',341:'SMaxSampleValue',342:'TransferRange',343:'ClipPath',344:'XClipPathUnits',345:'YClipPathUnits',346:'Indexed',347:'JPEGTables',351:'OPIProxy',400:'GlobalParametersIFD',401:'ProfileType',402:'FaxProfile',403:'CodingMethods',404:'VersionYear',405:'ModeNumber',433:'Decode',434:'DefaultImageColor',512:'JPEGProc',513:'JPEGInterchangeFormat',514:'JPEGInterchangeFormatLength',515:'JPEGRestartInterval',517:'JPEGLosslessPredictors',518:'JPEGPointTransforms',519:'JPEGQTables',520:'JPEGDCTables',521:'JPEGACTables',529:'YCbCrCoefficients',530:'YCbCrSubSampling',531:'YCbCrPositioning',532:'ReferenceBlackWhite',559:'StripRowCounts',700:'XMP',32781:'ImageID',32932:'WangAnnotatio',33432:'Copyright',33445:'MDFileTag',33446:'MDScalePixel',33447:'MDColorTable',33448:'MDLabName',33449:'MDSampleInfo',33450:'MDPrepDate',33451:'MDPrepTime',33452:'MDFileUnits',33550:'ModelPixelScaleTag',33723:'IPTC',33918:'INGRPacketDataTag',33919:'INGRFlagRegisters',33920:'IrasBTransformationMatrix',33922:'ModelTiepointTag',34264:'ModelTransformationTag',34377:'Photoshop',34665:'ExifIFD',34675:'ICCProfile',34732:'ImageLayer',34735:'GeoKeyDirectoryTag',34736:'GeoDoubleParamsTag',34737:'GeoAsciiParamsTag',34853:'GPSIFD',34908:'HylaFAXFaxRecvParams',34909:'HylaFAXFaxSubAddress',34910:'HylaFAXFaxRecvTime',37724:'ImageSourceData',40965:'InteroperabilityIFD',42112:'GDAL_METADATA',42113:'GDAL_NODATA',50215:'OceScanjobDescription',50216:'OceApplicationSelector',50217:'OceIdentificationNumber',50218:'OceImageLogicCharacteristics',50706:'DNGVersion',50707:'DNGBackwardVersion',50708:'UniqueCameraModel',50709:'LocalizedCameraModel',50710:'CFAPlaneColor',50711:'CFALayout',50712:'LinearizationTable',50713:'BlackLevelRepeatDim',50714:'BlackLevel',50715:'BlackLevelDeltaH',50716:'BlackLevelDeltaV',50717:'WhiteLevel',50718:'DefaultScale',50719:'DefaultCropOrigin',50720:'DefaultCropSize',50721:'ColorMatrix1',50722:'ColorMatrix2',50723:'CameraCalibration1',50724:'CameraCalibration2',50725:'ReductionMatrix1',50726:'ReductionMatrix2',50727:'AnalogBalance',50728:'AsShotNeutral',50729:'AsShotWhiteXY',50730:'BaselineExposure',50731:'BaselineNoise',50732:'BaselineSharpness',50733:'BayerGreenSplit',50734:'LinearResponseLimit',50735:'CameraSerialNumber',50736:'LensInfo',50737:'ChromaBlurRadius',50738:'AntiAliasStrength',50740:'DNGPrivateData',50741:'MakerNoteSafety',50778:'CalibrationIlluminant1',50779:'CalibrationIlluminant2',50780:'BestQualityScale',50784:'AliasLayerMetadata'},rf={};for(var lf in sf)rf[sf[lf]]=lf;const hf={33434:'ExposureTime',33437:'FNumber',34850:'ExposureProgram',34852:'SpectralSensitivity',34855:'ISOSpeedRatings',34856:'OECF',34864:'SensitivityType',34865:'StandardOutputSensitivity',34866:'RecommendedExposureIndex',34867:'ISOSpeed',34868:'ISOSpeedLatitudeyyy',34869:'ISOSpeedLatitudezzz',36864:'ExifVersion',36867:'DateTimeOriginal',36868:'DateTimeDigitized',37121:'ComponentsConfiguration',37122:'CompressedBitsPerPixel',37377:'ShutterSpeedValue',37378:'ApertureValue',37379:'BrightnessValue',37380:'ExposureBiasValue',37381:'MaxApertureValue',37382:'SubjectDistance',37383:'MeteringMode',37384:'LightSource',37385:'Flash',37386:'FocalLength',37396:'SubjectArea',37500:'MakerNote',37510:'UserComment',37520:'SubsecTime',37521:'SubsecTimeOriginal',37522:'SubsecTimeDigitized',40960:'FlashpixVersion',40961:'ColorSpace',40962:'PixelXDimension',40963:'PixelYDimension',40964:'RelatedSoundFile',41483:'FlashEnergy',41484:'SpatialFrequencyResponse',41486:'FocalPlaneXResolution',41487:'FocalPlaneYResolution',41488:'FocalPlaneResolutionUnit',41492:'SubjectLocation',41493:'ExposureIndex',41495:'SensingMethod',41728:'FileSource',41729:'SceneType',41730:'CFAPattern',41985:'CustomRendered',41986:'ExposureMode',41987:'WhiteBalance',41988:'DigitalZoomRatio',41989:'FocalLengthIn35mmFilm',41990:'SceneCaptureType',41991:'GainControl',41992:'Contrast',41993:'Saturation',41994:'Sharpness',41995:'DeviceSettingDescription',41996:'SubjectDistanceRange',42016:'ImageUniqueID',42032:'CameraOwnerName',42033:'BodySerialNumber',42034:'LensSpecification',42035:'LensMake',42036:'LensModel',42037:'LensSerialNumber',42240:'Gamma'},mf={};for(var cf in hf)mf[hf[cf]]=cf;const uf={0:'GPSVersionID',1:'GPSLatitudeRef',2:'GPSLatitude',3:'GPSLongitudeRef',4:'GPSLongitude',5:'GPSAltitudeRef',6:'GPSAltitude',7:'GPSTimeStamp',8:'GPSSatellites',9:'GPSStatus',10:'GPSMeasureMode',11:'GPSDOP',12:'GPSSpeedRef',13:'GPSSpeed',14:'GPSTrackRef',15:'GPSTrack',16:'GPSImgDirectionRef',17:'GPSImgDirection',18:'GPSMapDatum',19:'GPSDestLatitudeRef',20:'GPSDestLatitude',21:'GPSDestLongitudeRef',22:'GPSDestLongitude',23:'GPSDestBearingRef',24:'GPSDestBearing',25:'GPSDestDistanceRef',26:'GPSDestDistance',27:'GPSProcessingMethod',28:'GPSAreaInformation',29:'GPSDateStamp',30:'GPSDifferential',31:'GPSHPositioningError'},pf={};for(var ff in uf)pf[uf[ff]]=ff;const _f={standard:{tagsById:sf,tagsByName:rf},exif:{tagsById:hf,tagsByName:mf},gps:{tagsById:uf,tagsByName:pf}};class wf{constructor(Fb){if(!Fb)throw new Error('missing kind');this.data=null,this.fields=new Map,this.kind=Fb,this._map=null}get(Fb){if('number'==typeof Fb)return this.fields.get(Fb);if('string'==typeof Fb)return this.fields.get(_f[this.kind].tagsByName[Fb]);throw new Error('expected a number or string')}get map(){if(!this._map){this._map={};const Ub=_f[this.kind].tagsById;for(var Fb of this.fields.keys())Ub[Fb]&&(this._map[Ub[Fb]]=this.fields.get(Fb))}return this._map}}var xf=wf;const yf=/^(\d{4}):(\d{2}):(\d{2}) (\d{2}):(\d{2}):(\d{2})$/;class kf extends xf{constructor(){super('standard')}get size(){return this.width*this.height}get width(){return this.imageWidth}get height(){return this.imageLength}get components(){return this.samplesPerPixel}get date(){var Fb=new Date,Ub=yf.exec(this.dateTime);return Fb.setFullYear(Ub[1],Ub[2]-1,Ub[3]),Fb.setHours(Ub[4],Ub[5],Ub[6]),Fb}get newSubfileType(){return this.get(254)}get imageWidth(){return this.get(256)}get imageLength(){return this.get(257)}get bitsPerSample(){return this.get(258)}get compression(){return this.get(259)||1}get type(){return this.get(262)}get fillOrder(){return this.get(266)||1}get documentName(){return this.get(269)}get imageDescription(){return this.get(270)}get stripOffsets(){return ns(this.get(273))}get orientation(){return this.get(274)}get samplesPerPixel(){return this.get(277)}get rowsPerStrip(){return this.get(278)}get stripByteCounts(){return ns(this.get(279))}get minSampleValue(){return this.get(280)||0}get maxSampleValue(){return this.get(281)||_Mathpow(2,this.bitsPerSample)-1}get xResolution(){return this.get(282)}get yResolution(){return this.get(283)}get planarConfiguration(){return this.get(284)||1}get resolutionUnit(){return this.get(296)||2}get dateTime(){return this.get(306)}get predictor(){return this.get(317)||1}get sampleFormat(){return this.get(339)||1}get sMinSampleValue(){return this.get(340)||this.minSampleValue}get sMaxSampleValue(){return this.get(341)||this.maxSampleValue}}var Df=new Map([[1,[1,os]],[2,[1,function(Fb,Ub){for(var qb=[],Xb='',Ob=0,Nb;Ob<Ub;Ob++)Nb=_StringfromCharCode(Fb.readUint8()),'\0'===Nb?(qb.push(Xb),Xb=''):Xb+=Nb;return 1===qb.length?qb[0]:qb}]],[3,[2,function(Fb,Ub){if(1===Ub)return Fb.readUint16();for(var qb=new Uint16Array(Ub),Xb=0;Xb<Ub;Xb++)qb[Xb]=Fb.readUint16();return qb}]],[4,[4,function(Fb,Ub){if(1===Ub)return Fb.readUint32();for(var qb=new Uint32Array(Ub),Xb=0;Xb<Ub;Xb++)qb[Xb]=Fb.readUint32();return qb}]],[5,[8,function(Fb,Ub){if(1===Ub)return Fb.readUint32()/Fb.readUint32();for(var qb=Array(Ub),Xb=0;Xb<Ub;Xb++)qb[Xb]=Fb.readUint32()/Fb.readUint32();return qb}]],[6,[1,function(Fb,Ub){if(1===Ub)return Fb.readInt8();for(var qb=new Int8Array(Ub),Xb=0;Xb<Ub;Xb++)qb[Xb]=Fb.readInt8();return qb}]],[7,[1,os]],[8,[2,function(Fb,Ub){if(1===Ub)return Fb.readInt16();for(var qb=new Int16Array(Ub),Xb=0;Xb<Ub;Xb++)qb[Xb]=Fb.readInt16();return qb}]],[9,[4,function(Fb,Ub){if(1===Ub)return Fb.readInt32();for(var qb=new Int32Array(Ub),Xb=0;Xb<Ub;Xb++)qb[Xb]=Fb.readInt32();return qb}]],[10,[8,function(Fb,Ub){if(1===Ub)return Fb.readInt32()/Fb.readInt32();for(var qb=Array(Ub),Xb=0;Xb<Ub;Xb++)qb[Xb]=Fb.readInt32()/Fb.readInt32();return qb}]],[11,[4,function(Fb,Ub){if(1===Ub)return Fb.readFloat32();for(var qb=new Float32Array(Ub),Xb=0;Xb<Ub;Xb++)qb[Xb]=Fb.readFloat32();return qb}]],[12,[8,function(Fb,Ub){if(1===Ub)return Fb.readFloat64();for(var qb=new Float64Array(Ub),Xb=0;Xb<Ub;Xb++)qb[Xb]=Fb.readFloat64();return qb}]]]),Sf={getByteLength:function(Fb,Ub){return Df.get(Fb)[0]*Ub},readData:function(Fb,Ub,qb){return Df.get(Ub)[1](Fb,qb)}};const If={ignoreImageData:!1,onlyFirst:!1};var Cf=class extends Tm{constructor(Fb,Ub){super(Fb,Ub),this._nextIFD=0}decode(Fb){Fb=Object.assign({},If,Fb);const Ub=[];for(this.decodeHeader();this._nextIFD;)if(Ub.push(this.decodeIFD(Fb)),Fb.onlyFirst)return Ub[0];return Ub}decodeHeader(){let Fb=this.readUint16();if(18761===Fb)this.setLittleEndian();else if(19789===Fb)this.setBigEndian();else throw new Error('invalid byte order: 0x'+Fb.toString(16));if(Fb=this.readUint16(),42!==Fb)throw new Error('not a TIFF file');this._nextIFD=this.readUint32()}decodeIFD(Fb){this.seek(this._nextIFD);var Ub=Fb.kind?new xf(Fb.kind):new kf;const qb=this.readUint16();for(var Xb=0;Xb<qb;Xb++)this.decodeIFDEntry(Ub);return Fb.ignoreImageData||this.decodeImageData(Ub),this._nextIFD=this.readUint32(),Ub}decodeIFDEntry(Fb){const Ub=this.offset,qb=this.readUint16(),Xb=this.readUint16(),Ob=this.readUint32();if(1>Xb||12<Xb)return void this.skip(4);const Nb=Sf.getByteLength(Xb,Ob);4<Nb&&this.seek(this.readUint32());const Gb=Sf.readData(this,Xb,Ob);if(Fb.fields.set(qb,Gb),34665===qb||34853===qb){let Hb=this.offset,Wb;34665===qb?Wb='exif':34853===qb&&(Wb='gps'),this._nextIFD=Gb,Fb[Wb]=this.decodeIFD({kind:Wb,ignoreImageData:!0}),this.offset=Hb}this.seek(Ub),this.skip(12)}decodeImageData(Fb){const Ub=Fb.orientation;switch(Ub&&1!==Ub&&vs('orientation',Ub),Fb.type){case 1:case 2:this.readStripData(Fb);break;default:vs('image type',Fb.type);}}readStripData(Fb){const Ub=Fb.width,qb=Fb.height,Xb=Ds(Fb.bitsPerSample),Ob=Fb.sampleFormat;let Nb=Ub*qb;const Gb=_s(Nb,1,Xb,Ob),Hb=Fb.compression,Wb=Fb.rowsPerStrip,Zb=Wb*Ub,Qb=Fb.stripOffsets,Kb=Fb.stripByteCounts;for(var Jb=0,$b=0;$b<Qb.length;$b++){var e_=this.getStripData(Hb,Qb[$b],Kb[$b]),t_=Nb>Zb?Zb:Nb;Nb-=t_,8===Xb?Jb=ws(Gb,e_,Jb,t_):16===Xb?Jb=xs(Gb,e_,Jb,t_,this.isLittleEndian()):32===Xb&&3===Ob?Jb=ys(Gb,e_,Jb,t_,this.isLittleEndian()):vs('bitDepth',Xb)}Fb.data=Gb}getStripData(Fb,Ub,qb){switch(Fb){case 1:return new DataView(this.buffer,Ub,qb);case 2:case 32773:return vs('Compression',Fb);default:throw new Error('invalid compression: '+Fb);}}},Af=function(Ub,qb){const Xb=new Cf(Ub,qb);return Xb.decode(qb)},Rf={decode:Af},Lf=function(Fb){const Ub=new Tm(Fb),qb={};Ub.setBigEndian();const Xb=Ub.readUint16();if(65496!==Xb)throw new Error('SOI marker not found. Not a valid JPEG file');const Ob=Ub.readUint16();if(65505===Ob){const Nb=Ub.readUint16(),Gb=Ub.readBytes(6);if(69===Gb[0]&&120===Gb[1]&&105===Gb[2]&&102===Gb[3]&&0===Gb[4]&&0===Gb[5]){const Hb=Rf.decode(Ub,{onlyFirst:!0,ignoreImageData:!0,offset:Ub.offset});qb.exif=Hb}}return qb},Ef=(Fb)=>{const Ub=new Uint8Array(Fb);if(!(Ub&&1<Ub.length))return null;const qb=(Xb,Ob)=>{Ob=Object.assign({offset:0},Ob);for(let Nb=0;Nb<Xb.length;Nb++)if(Xb[Nb]!==Ub[Nb+Ob.offset])return!1;return!0};if(qb([255,216,255]))return{ext:'jpg',mime:'image/jpeg'};if(qb([137,80,78,71,13,10,26,10]))return{ext:'png',mime:'image/png'};if(qb([71,73,70]))return{ext:'gif',mime:'image/gif'};if(qb([87,69,66,80],{offset:8}))return{ext:'webp',mime:'image/webp'};if(qb([70,76,73,70]))return{ext:'flif',mime:'image/flif'};if((qb([73,73,42,0])||qb([77,77,0,42]))&&qb([67,82],{offset:8}))return{ext:'cr2',mime:'image/x-canon-cr2'};if(qb([73,73,42,0])||qb([77,77,0,42]))return{ext:'tif',mime:'image/tiff'};if(qb([66,77]))return{ext:'bmp',mime:'image/bmp'};if(qb([73,73,188]))return{ext:'jxr',mime:'image/vnd.ms-photo'};if(qb([56,66,80,83]))return{ext:'psd',mime:'image/vnd.adobe.photoshop'};if(qb([80,75,3,4])&&qb([109,105,109,101,116,121,112,101,97,112,112,108,105,99,97,116,105,111,110,47,101,112,117,98,43,122,105,112],{offset:30}))return{ext:'epub',mime:'application/epub+zip'};if(qb([80,75,3,4])&&qb([77,69,84,65,45,73,78,70,47,109,111,122,105,108,108,97,46,114,115,97],{offset:30}))return{ext:'xpi',mime:'application/x-xpinstall'};if(qb([80,75])&&(3===Ub[2]||5===Ub[2]||7===Ub[2])&&(4===Ub[3]||6===Ub[3]||8===Ub[3]))return{ext:'zip',mime:'application/zip'};if(qb([117,115,116,97,114],{offset:257}))return{ext:'tar',mime:'application/x-tar'};if(qb([82,97,114,33,26,7])&&(0===Ub[6]||1===Ub[6]))return{ext:'rar',mime:'application/x-rar-compressed'};if(qb([31,139,8]))return{ext:'gz',mime:'application/gzip'};if(qb([66,90,104]))return{ext:'bz2',mime:'application/x-bzip2'};if(qb([55,122,188,175,39,28]))return{ext:'7z',mime:'application/x-7z-compressed'};if(qb([120,1]))return{ext:'dmg',mime:'application/x-apple-diskimage'};if(qb([0,0,0])&&(24===Ub[3]||32===Ub[3])&&qb([102,116,121,112],{offset:4})||qb([51,103,112,53])||qb([0,0,0,28,102,116,121,112,109,112,52,50])&&qb([109,112,52,49,109,112,52,50,105,115,111,109],{offset:16})||qb([0,0,0,28,102,116,121,112,105,115,111,109])||qb([0,0,0,28,102,116,121,112,109,112,52,50,0,0,0,0]))return{ext:'mp4',mime:'video/mp4'};if(qb([0,0,0,28,102,116,121,112,77,52,86]))return{ext:'m4v',mime:'video/x-m4v'};if(qb([77,84,104,100]))return{ext:'mid',mime:'audio/midi'};if(qb([26,69,223,163])){const Xb=Ub.subarray(4,4100),Ob=Xb.findIndex((Nb,Gb,Hb)=>66===Hb[Gb]&&130===Hb[Gb+1]);if(0<=Ob){const Gb=(Hb)=>Array.from(Hb).every((Wb,Zb)=>Xb[Ob+3+Zb]===Wb.charCodeAt(0));if(Gb('matroska'))return{ext:'mkv',mime:'video/x-matroska'};if(Gb('webm'))return{ext:'webm',mime:'video/webm'}}}return qb([0,0,0,20,102,116,121,112,113,116,32,32])||qb([102,114,101,101],{offset:4})||qb([102,116,121,112,113,116,32,32],{offset:4})||qb([109,100,97,116],{offset:4})||qb([119,105,100,101],{offset:4})?{ext:'mov',mime:'video/quicktime'}:qb([82,73,70,70])&&qb([65,86,73],{offset:8})?{ext:'avi',mime:'video/x-msvideo'}:qb([48,38,178,117,142,102,207,17,166,217])?{ext:'wmv',mime:'video/x-ms-wmv'}:qb([0,0,1,186])?{ext:'mpg',mime:'video/mpeg'}:qb([73,68,51])||qb([255,251])?{ext:'mp3',mime:'audio/mpeg'}:qb([102,116,121,112,77,52,65],{offset:4})||qb([77,52,65,32])?{ext:'m4a',mime:'audio/m4a'}:qb([79,112,117,115,72,101,97,100],{offset:28})?{ext:'opus',mime:'audio/opus'}:qb([79,103,103,83])?{ext:'ogg',mime:'audio/ogg'}:qb([102,76,97,67])?{ext:'flac',mime:'audio/x-flac'}:qb([82,73,70,70])&&qb([87,65,86,69],{offset:8})?{ext:'wav',mime:'audio/x-wav'}:qb([35,33,65,77,82,10])?{ext:'amr',mime:'audio/amr'}:qb([37,80,68,70])?{ext:'pdf',mime:'application/pdf'}:qb([77,90])?{ext:'exe',mime:'application/x-msdownload'}:(67===Ub[0]||70===Ub[0])&&qb([87,83],{offset:1})?{ext:'swf',mime:'application/x-shockwave-flash'}:qb([123,92,114,116,102])?{ext:'rtf',mime:'application/rtf'}:qb([0,97,115,109])?{ext:'wasm',mime:'application/wasm'}:qb([119,79,70,70])&&(qb([0,1,0,0],{offset:4})||qb([79,84,84,79],{offset:4}))?{ext:'woff',mime:'application/font-woff'}:qb([119,79,70,50])&&(qb([0,1,0,0],{offset:4})||qb([79,84,84,79],{offset:4}))?{ext:'woff2',mime:'application/font-woff'}:qb([76,80],{offset:34})&&(qb([0,0,1],{offset:8})||qb([1,0,2],{offset:8})||qb([2,0,2],{offset:8}))?{ext:'eot',mime:'application/octet-stream'}:qb([0,1,0,0,0])?{ext:'ttf',mime:'application/font-sfnt'}:qb([79,84,84,79,0])?{ext:'otf',mime:'application/font-sfnt'}:qb([0,0,1,0])?{ext:'ico',mime:'image/x-icon'}:qb([70,76,86,1])?{ext:'flv',mime:'video/x-flv'}:qb([37,33])?{ext:'ps',mime:'application/postscript'}:qb([253,55,122,88,90,0])?{ext:'xz',mime:'application/x-xz'}:qb([83,81,76,105])?{ext:'sqlite',mime:'application/x-sqlite3'}:qb([78,69,83,26])?{ext:'nes',mime:'application/x-nintendo-nes-rom'}:qb([67,114,50,52])?{ext:'crx',mime:'application/x-google-chrome-extension'}:qb([77,83,67,70])||qb([73,83,99,40])?{ext:'cab',mime:'application/vnd.ms-cab-compressed'}:qb([33,60,97,114,99,104,62,10,100,101,98,105,97,110,45,98,105,110,97,114,121])?{ext:'deb',mime:'application/x-deb'}:qb([33,60,97,114,99,104,62])?{ext:'ar',mime:'application/x-unix-archive'}:qb([237,171,238,219])?{ext:'rpm',mime:'application/x-rpm'}:qb([31,160])||qb([31,157])?{ext:'Z',mime:'application/x-compress'}:qb([76,90,73,80])?{ext:'lz',mime:'application/x-lzip'}:qb([208,207,17,224,161,177,26,225])?{ext:'msi',mime:'application/x-msi'}:qb([6,14,43,52,2,5,1,1,13,1,2,1,1,2])?{ext:'mxf',mime:'application/mxf'}:null};const Tf=new Set(['jpg','png','gif','webp','tif','bmp','jxr','psd']);for(var Vf=(Fb)=>{const Ub=Ef(Fb);return Tf.has(Ub&&Ub.ext)?Ub:null},Yf='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/',Ff=new Uint8Array(256),Uf=0;Uf<Yf.length;Uf++)Ff[Yf.charCodeAt(Uf)]=Uf;var qf=/^data:[a-z]+\/([a-z]+);base64,/,Xf=Jr.BlobBuilder||Jr.WebKitBlobBuilder||Jr.MSBlobBuilder||Jr.MozBlobBuilder,Of=function(){try{var Fb=new Blob(['hi']);return 2===Fb.size}catch(Ub){return!1}}(),Nf=Of&&function(){try{var Fb=new Blob([new Uint8Array([1,2])]);return 2===Fb.size}catch(Ub){return!1}}(),Gf=Xf&&Xf.prototype.append&&Xf.prototype.getBlob,Hf=function(){return Of?Nf?Jr.Blob:Fs:Gf?Ys:void 0}(),Wf=Jr.MutationObserver||Jr.WebKitMutationObserver,Zf;if(Wf){var Qf=0,Kf=new Wf(Us),Jf=Jr.document.createTextNode('');Kf.observe(Jf,{characterData:!0}),Zf=function(){Jf.data=Qf=++Qf%2}}else if(!Jr.setImmediate&&'undefined'!=typeof Jr.MessageChannel){var $f=new Jr.MessageChannel;$f.port1.onmessage=Us,Zf=function(){$f.port2.postMessage(0)}}else Zf='document'in Jr&&'onreadystatechange'in Jr.document.createElement('script')?function(){var Fb=Jr.document.createElement('script');Fb.onreadystatechange=function(){Us(),Fb.onreadystatechange=null,Fb.parentNode.removeChild(Fb),Fb=null},Jr.document.documentElement.appendChild(Fb)}:function(){setTimeout(Us,0)};var tb=[],ab=function(Fb){1!==tb.push(Fb)||eb||Zf()},ib={},nb=['REJECTED'],ob=['FULFILLED'],sb=['PENDING'],eb;Os.prototype['catch']=function(Fb){return this.then(null,Fb)},Os.prototype.then=function(Fb,Ub){if('function'!=typeof Fb&&this.state===ob||'function'!=typeof Ub&&this.state===nb)return this;var qb=new this.constructor(Xs);if(this.state!==sb){var Xb=this.state===ob?Fb:Ub;Gs(qb,Xb,this.outcome)}else this.queue.push(new Ns(qb,Fb,Ub));return qb},Ns.prototype.callFulfilled=function(Fb){ib.resolve(this.promise,Fb)},Ns.prototype.otherCallFulfilled=function(Fb){Gs(this.promise,this.onFulfilled,Fb)},Ns.prototype.callRejected=function(Fb){ib.reject(this.promise,Fb)},Ns.prototype.otherCallRejected=function(Fb){Gs(this.promise,this.onRejected,Fb)},ib.resolve=function(Fb,Ub){var qb=Zs(Hs,Ub);if('error'===qb.status)return ib.reject(Fb,qb.value);var Xb=qb.value;if(Xb)Ws(Fb,Xb);else{Fb.state=ob,Fb.outcome=Ub;for(var Ob=-1,Nb=Fb.queue.length;++Ob<Nb;)Fb.queue[Ob].callFulfilled(Ub)}return Fb},ib.reject=function(Fb,Ub){Fb.state=nb,Fb.outcome=Ub;for(var qb=-1,Xb=Fb.queue.length;++qb<Xb;)Fb.queue[qb].callRejected(Ub);return Fb},Os.resolve=function(Fb){return Fb instanceof this?Fb:ib.resolve(new this(Xs),Fb)},Os.reject=function(Fb){var Ub=new this(Xs);return ib.reject(Ub,Fb)},Os.all=function(Fb){function Ub(Zb,Qb){qb.resolve(Zb).then(function(Jb){Nb[Qb]=Jb,++Gb!==Xb||Ob||(Ob=!0,ib.resolve(Wb,Nb))},function(Jb){Ob||(Ob=!0,ib.reject(Wb,Jb))})}var qb=this;if('[object Array]'!==Object.prototype.toString.call(Fb))return this.reject(new TypeError('must be an array'));var Xb=Fb.length,Ob=!1;if(!Xb)return this.resolve([]);for(var Nb=Array(Xb),Gb=0,Hb=-1,Wb=new this(Xs);++Hb<Xb;)Ub(Fb[Hb],Hb);return Wb},Os.race=function(Fb){function Ub(Hb){qb.resolve(Hb).then(function(Wb){Ob||(Ob=!0,ib.resolve(Gb,Wb))},function(Wb){Ob||(Ob=!0,ib.reject(Gb,Wb))})}var qb=this;if('[object Array]'!==Object.prototype.toString.call(Fb))return this.reject(new TypeError('must be an array'));var Xb=Fb.length,Ob=!1;if(!Xb)return this.resolve([]);for(var Nb=-1,Gb=new this(Xs);++Nb<Xb;)Ub(Fb[Nb]);return Gb};var lb='function'==typeof Promise?Promise:Os,hb={createBlob:or,createObjectURL:function(Fb){return(window.URL||window.webkitURL).createObjectURL(Fb)},revokeObjectURL:function(Fb){return(window.URL||window.webkitURL).revokeObjectURL(Fb)},imgSrcToBlob:function(Fb,Ub,qb,Xb){return Ub=Ub||'image/png',ar(Fb,qb).then(function(Ob){return nr(Ob)}).then(function(Ob){return ur(Ob,Ub,Xb)})},imgSrcToDataURL:function(Fb,Ub,qb,Xb){return Ub=Ub||'image/png',ar(Fb,qb).then(function(Ob){return nr(Ob)}).then(function(Ob){return Ob.toDataURL(Ub,Xb)})},canvasToBlob:ur,dataURLToBlob:cr,blobToBase64String:function(Fb){return lr(Fb).then(function(Ub){return btoa(Ub)})},base64StringToBlob:dr,binaryStringToBlob:function(Fb,Ub){return lb.resolve().then(function(){return dr(btoa(Fb),Ub)})},blobToBinaryString:lr,arrayBufferToBlob:function(Fb,Ub){return lb.resolve().then(function(){return or([Fb],Ub)})},blobToArrayBuffer:function(Fb){return new lb(function(Ub,qb){var Xb=new FileReader;Xb.onloadend=function(Ob){var Nb=Ob.target.result||new ArrayBuffer(0);Ub(Nb)},Xb.onerror=qb,Xb.readAsArrayBuffer(Fb)})}}.canvasToBlob,mb=ge(function(Fb,Ub){(function(qb){function Xb(d_){for(var h_=[],m_=0,c_=d_.length,g_,u_;m_<c_;)g_=d_.charCodeAt(m_++),55296<=g_&&56319>=g_&&m_<c_?(u_=d_.charCodeAt(m_++),56320==(64512&u_)?h_.push(((1023&g_)<<10)+(1023&u_)+65536):(h_.push(g_),m_--)):h_.push(g_);return h_}function Ob(d_){for(var h_=d_.length,m_=-1,g_='',c_;++m_<h_;)c_=d_[m_],65535<c_&&(c_-=65536,g_+=t_(55296|1023&c_>>>10),c_=56320|1023&c_),g_+=t_(c_);return g_}function Nb(d_){if(55296<=d_&&57343>=d_)throw Error('Lone surrogate U+'+d_.toString(16).toUpperCase()+' is not a scalar value')}function Gb(d_,h_){return t_(128|63&d_>>h_)}function Hb(d_){if(0==(4294967168&d_))return t_(d_);var h_='';return 0==(4294965248&d_)?h_=t_(192|31&d_>>6):0==(4294901760&d_)?(Nb(d_),h_=t_(224|15&d_>>12),h_+=Gb(d_,6)):0==(4292870144&d_)&&(h_=t_(240|7&d_>>18),h_+=Gb(d_,12),h_+=Gb(d_,6)),h_+=t_(128|63&d_),h_}function Zb(){if(n_>=i_)throw Error('Invalid byte index');var d_=255&a_[n_];if(n_++,128==(192&d_))return 63&d_;throw Error('Invalid continuation byte')}function Qb(){var d_,h_,m_,c_,g_;if(n_>i_)throw Error('Invalid byte index');if(n_==i_)return!1;if(d_=255&a_[n_],n_++,0==(128&d_))return d_;if(192==(224&d_)){if(h_=Zb(),g_=(31&d_)<<6|h_,128<=g_)return g_;throw Error('Invalid continuation byte')}if(224==(240&d_)){if(h_=Zb(),m_=Zb(),g_=(15&d_)<<12|h_<<6|m_,2048<=g_)return Nb(g_),g_;throw Error('Invalid continuation byte')}if(240==(248&d_)&&(h_=Zb(),m_=Zb(),c_=Zb(),g_=(7&d_)<<18|h_<<12|m_<<6|c_,65536<=g_&&1114111>=g_))return g_;throw Error('Invalid UTF-8 detected')}var Jb=Ub,$b=Fb&&Fb.exports==Jb&&Fb,e_='object'==typeof Jr&&Jr;(e_.global===e_||e_.window===e_)&&(qb=e_);var t_=_StringfromCharCode,o_={version:'2.1.2',encode:function(d_){for(var h_=Xb(d_),m_=h_.length,c_=-1,u_='',g_;++c_<m_;)g_=h_[c_],u_+=Hb(g_);return u_},decode:function(d_){a_=Xb(d_),i_=a_.length,n_=0;for(var h_=[],m_;!1!==(m_=Qb());)h_.push(m_);return Ob(h_)}},a_,i_,n_;if(!Jb||Jb.nodeType)qb.utf8=o_;else if($b)$b.exports=o_;else{var r_={}.hasOwnProperty;for(var l_ in o_)r_.call(o_,l_)&&(Jb[l_]=o_[l_])}})(Jr)});const ub=[];var _b=class{constructor(Fb,Ub){Ub=Ub||{};var qb=!1;void 0===Fb&&(Fb=8192),'number'==typeof Fb?Fb=new ArrayBuffer(Fb):(qb=!0,this._lastWrittenByte=Fb.byteLength);const Xb=Ub.offset?Ub.offset>>>0:0;let Ob=Fb.byteLength-Xb,Nb=Xb;Fb.buffer&&(Fb.byteLength!==Fb.buffer.byteLength&&(Nb=Fb.byteOffset+Xb),Fb=Fb.buffer),this._lastWrittenByte=qb?Ob:0,this.buffer=Fb,this.length=Ob,this.byteLength=Ob,this.byteOffset=Nb,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,Nb,Ob),this._mark=0,this._marks=[]}available(Fb){return void 0===Fb&&(Fb=1),this.offset+Fb<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(Fb){return void 0===Fb&&(Fb=1),this.offset+=Fb,this}seek(Fb){return this.offset=Fb,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const Fb=this._marks.pop();if(void 0===Fb)throw new Error('Mark stack empty');return this.seek(Fb),this}rewind(){return this.offset=0,this}ensureAvailable(Fb){if(void 0===Fb&&(Fb=1),!this.available(Fb)){const Ub=this.offset+Fb,qb=2*Ub,Xb=new Uint8Array(qb);Xb.set(new Uint8Array(this.buffer)),this.buffer=Xb.buffer,this.length=this.byteLength=qb,this._data=new DataView(this.buffer)}return this}readBoolean(){return 0!==this.readUint8()}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(Fb){void 0===Fb&&(Fb=1);for(var Ub=new Uint8Array(Fb),qb=0;qb<Fb;qb++)Ub[qb]=this.readByte();return Ub}readInt16(){var Fb=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,Fb}readUint16(){var Fb=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,Fb}readInt32(){var Fb=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,Fb}readUint32(){var Fb=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,Fb}readFloat32(){var Fb=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,Fb}readFloat64(){var Fb=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,Fb}readChar(){return _StringfromCharCode(this.readInt8())}readChars(Fb){void 0===Fb&&(Fb=1),ub.length=Fb;for(var Ub=0;Ub<Fb;Ub++)ub[Ub]=this.readChar();return ub.join('')}readUtf8(Fb){void 0===Fb&&(Fb=1);const Ub=this.readChars(Fb);return mb.decode(Ub)}writeBoolean(Fb){return this.writeUint8(Fb?255:0),this}writeInt8(Fb){return this.ensureAvailable(1),this._data.setInt8(this.offset++,Fb),this._updateLastWrittenByte(),this}writeUint8(Fb){return this.ensureAvailable(1),this._data.setUint8(this.offset++,Fb),this._updateLastWrittenByte(),this}writeByte(Fb){return this.writeUint8(Fb)}writeBytes(Fb){this.ensureAvailable(Fb.length);for(var Ub=0;Ub<Fb.length;Ub++)this._data.setUint8(this.offset++,Fb[Ub]);return this._updateLastWrittenByte(),this}writeInt16(Fb){return this.ensureAvailable(2),this._data.setInt16(this.offset,Fb,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(Fb){return this.ensureAvailable(2),this._data.setUint16(this.offset,Fb,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(Fb){return this.ensureAvailable(4),this._data.setInt32(this.offset,Fb,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(Fb){return this.ensureAvailable(4),this._data.setUint32(this.offset,Fb,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(Fb){return this.ensureAvailable(4),this._data.setFloat32(this.offset,Fb,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(Fb){return this.ensureAvailable(8),this._data.setFloat64(this.offset,Fb,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(Fb){return this.writeUint8(Fb.charCodeAt(0))}writeChars(Fb){for(var Ub=0;Ub<Fb.length;Ub++)this.writeUint8(Fb.charCodeAt(Ub));return this}writeUtf8(Fb){const Ub=mb.encode(Fb);return this.writeChars(Ub)}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this._lastWrittenByte)}getBuffer(){return'undefined'==typeof Buffer?this.toArray():Buffer.from(this.toArray())}_updateLastWrittenByte(){this.offset>this._lastWrittenByte&&(this._lastWrittenByte=this.offset)}},wb={BITMAPV5HEADER:{LogicalColorSpace:{LCS_CALIBRATED_RGB:0,LCS_sRGB:1934772034,LCS_WINDOWS_COLOR_SPACE:1466527264},Compression:{BI_RGB:0,BI_RLE8:1,BI_RLE4:2,BI_BITFIELDS:3,BI_JPEG:4,BI_PNG:5,BI_CMYK:11,BI_CMYKRLE8:12,BI_CMYKRLE4:13},GamutMappingIntent:{LCS_GM_ABS_COLORIMETRIC:8,LCS_GM_BUSINESS:1,LCS_GM_GRAPHICS:2,LCS_GM_IMAGES:4}}};const xb=[];for(var yb=0;8>=yb;yb++)xb.push(255<<yb);var vb=function(Fb){if(1!==Fb.bitDepth)throw new Error('Only bitDepth of 1 is supported');if(!Fb.height||!Fb.width)throw new Error('ImageData width and height are required');if(1!==Fb.components)throw new Error('Only 1 component is supported');if(1!==Fb.channels)throw new Error('Only 1 channel is supported');var Ub=new _b;Ub.skip(14),jr(Ub,Fb),kr(Ub,Fb);const qb=Ub.offset;return _r(Ub,Fb),Ub.rewind(),Dr(Ub,qb),Ub.getBuffer()},Db={configurable:!0,enumerable:!1,get:void 0},jb=Object.prototype.toString,Mb='IJSImage';class Sb{constructor(Fb,Ub,qb,Xb){if(void 0===Fb&&(Fb=1),void 0===Ub&&(Ub=1),'object'==typeof Fb){var Ob=Fb,Nb=!0===Ub;Fb=Ob.width,Ub=Ob.height,qb=Nb?Ob.data.slice():Ob.data,Xb={position:Ob.position,components:Ob.components,alpha:Ob.alpha,bitDepth:Ob.bitDepth,colorModel:Ob.colorModel,parent:Ob,meta:Ob.meta}}if(qb&&!qb.length&&(Xb=qb,qb=null),void 0===Xb&&(Xb={}),this.width=Fb,this.height=Ub,0>=this.width)throw new RangeError('width must be greater than 0');if(0>=this.height)throw new RangeError('height must be greater than 0');Object.defineProperty(this,'parent',{enumerable:!1,writable:!0}),this.parent=Xb.parent,this.position=Xb.position||[0,0];var Gb;if('string'!=typeof Xb.kind)Gb=_(Er);else if(Gb=_(Xb.kind),!Gb)throw new RangeError('invalid image kind: '+Xb.kind);var Hb=Sm({},Gb,Xb);this.components=Hb.components,this.alpha=Hb.alpha+0,this.bitDepth=Hb.bitDepth,this.colorModel=Hb.colorModel,this.meta=Xb.meta||{},this.computed=null,this.initialize(),qb||(qb=I(this)),this.setData(qb)}get[Symbol.toStringTag](){return Mb}static isImage(Fb){return`[object ${Mb}]`===jb.call(Fb)}initialize(){this.size=this.width*this.height,this.sizes=[this.width,this.height],this.channels=this.components+this.alpha,this.maxValue=32===this.bitDepth?_NumberMAX_VALUE:_Mathpow(2,this.bitDepth)-1,this.multiplierX=this.channels,this.multiplierY=this.channels*this.width,this.isClamped=32>this.bitDepth,this.borderSizes=[0,0]}setData(Fb){var Ub=S(this);if(Ub!==Fb.length)throw new RangeError(`incorrect data size. Should be ${Ub} and found ${Fb.length}`);this.data=Fb}static load(Fb,Ub){return Ps(Fb,Ub)}static fromCanvas(Fb){var Ub=Fb.getContext('2d'),qb=Ub.getImageData(0,0,Fb.width,Fb.height);return new Sb(qb.width,qb.height,qb.data)}static extendMethod(Fb,Ub,qb={}){var Xb=qb.inPlace,Nb=qb.returnThis,Gb=void 0===Nb||Nb,Hb=qb.partialArgs,Wb=void 0===Hb?[]:Hb,Zb=qb.stack,Qb=void 0!==Zb&&Zb;if(void 0!==Xb&&Xb){if(Sb.prototype[Fb]=function(...$b){this.computed=null;var e_=Ub.apply(this,[...Wb,...$b]);return Gb?this:e_},Qb){var Kb='string'==typeof Qb?Qb:Fb;Uh.prototype[Kb]=Gb?function(...$b){for(var e_ of this)e_[Fb](...$b);return this}:function(...$b){for(var e_=new Uh(this.length),t_=0;t_<this.length;t_++)e_[t_]=this[t_][Fb](...$b);return e_}}}else if(Sb.prototype[Fb]=function(...$b){return Ub.apply(this,[...Wb,...$b])},Qb){var Jb='string'==typeof Qb?Qb:Fb;Uh.prototype[Jb]=function(...$b){for(var e_=new Uh(this.length),t_=0;t_<this.length;t_++)e_[t_]=this[t_][Fb](...$b);return e_}}return Sb}static extendProperty(Fb,Ub,qb={}){var Xb=qb.partialArgs,Ob=void 0===Xb?[]:Xb;return Db.get=function(){if(null===this.computed)this.computed={};else if(Yh(Fb,this.computed))return this.computed[Fb];var Nb=Ub.apply(this,Ob);return this.computed[Fb]=Nb,Nb},Object.defineProperty(Sb.prototype,Fb,Db),Sb}static createFrom(Fb,Ub){var qb={width:Fb.width,height:Fb.height,position:[0,0],components:Fb.components,alpha:Fb.alpha,colorModel:Fb.colorModel,bitDepth:Fb.bitDepth,parent:Fb};return Sm(qb,Ub),new Sb(qb.width,qb.height,qb)}static isTypeSupported(Fb,Ub='write'){if('string'!=typeof Fb)throw new TypeError('type argument must be a string');if(Fb=yn(Fb),'write'===Ub)return xn(Fb);throw new TypeError('unknown operation: '+Ub)}getPixelIndex(Fb){for(var Ub=0,qb=0;qb<Fb.length;qb++)Ub+=this.multipliers[qb]*Fb[qb];return Ub}setValueXY(Fb,Ub,qb,Xb){return this.data[(Ub*this.width+Fb)*this.channels+qb]=Xb,this.computed=null,this}getValueXY(Fb,Ub,qb){return this.data[(Ub*this.width+Fb)*this.channels+qb]}setValue(Fb,Ub,qb){return this.data[Fb*this.channels+Ub]=qb,this.computed=null,this}getValue(Fb,Ub){return this.data[Fb*this.channels+Ub]}setPixelXY(Fb,Ub,qb){return this.setPixel(Ub*this.width+Fb,qb)}getPixelXY(Fb,Ub){return this.getPixel(Ub*this.width+Fb)}setPixel(Fb,Ub){for(var qb=Fb*this.channels,Xb=0;Xb<Ub.length;Xb++)this.data[qb+Xb]=Ub[Xb];return this.computed=null,this}getPixel(Fb){for(var Ub=Array(this.channels),qb=Fb*this.channels,Xb=0;Xb<this.channels;Xb++)Ub[Xb]=this.data[qb+Xb];return Ub}toDataURL(Fb='image/png',Ub=!1){function qb(Xb){var Ob=vb(Xb),Nb=Ms(Ob);return`data:${Fb};base64,${Nb}`}return Fb=yn(Fb),Ub?new Promise((Xb,Ob)=>{'image/bmp'===Fb?Xb(qb(this)):this.getCanvas().toDataURL(Fb,function(Nb,Gb){Nb?Ob(Nb):Xb(Gb)})}):'image/bmp'===Fb?qb(this):this.getCanvas().toDataURL(Fb)}toBase64(Fb='image/png',Ub=!1){if(Ub)return this.toDataURL(Fb,!0).then(function(Xb){return Xb.substring(Xb.indexOf(',')+1)});var qb=this.toDataURL(Fb);return qb.substring(qb.indexOf(',')+1)}toBlob(Fb='image/png',Ub=0.8){return hb(this.getCanvas({originalData:!0}),Fb,Ub)}getCanvas(Fb={}){var Ub=Fb.originalData,Xb;void 0!==Ub&&Ub?(this.checkProcessable('getInPlaceCanvas',{channels:[4],bitDepth:[8]}),Xb=new Hr(this.data,this.width,this.height)):Xb=new Hr(this.getRGBAData(),this.width,this.height);var Ob=new R(this.width,this.height),Nb=Ob.getContext('2d');return Nb.putImageData(Xb,0,0),Ob}getRGBAData(){this.checkProcessable('getRGBAData',{components:[1,3],bitDepth:[1,8,16]});var Fb=this.size,Ub=new Uint8ClampedArray(4*(this.width*this.height));if(1===this.bitDepth)for(var qb=0,Xb;qb<Fb;qb++)Xb=this.getBit(qb),Ub[4*qb]=255*Xb,Ub[4*qb+1]=255*Xb,Ub[4*qb+2]=255*Xb;else if(1===this.components)for(var Ob=0;Ob<Fb;Ob++)Ub[4*Ob]=this.data[Ob*this.channels]>>>this.bitDepth-8,Ub[4*Ob+1]=this.data[Ob*this.channels]>>>this.bitDepth-8,Ub[4*Ob+2]=this.data[Ob*this.channels]>>>this.bitDepth-8;else if(3===this.components&&(this.checkProcessable('getRGBAData',{colorModel:[Yr]}),this.colorModel===Yr))for(var Nb=0;Nb<Fb;Nb++)Ub[4*Nb]=this.data[Nb*this.channels]>>>this.bitDepth-8,Ub[4*Nb+1]=this.data[Nb*this.channels+1]>>>this.bitDepth-8,Ub[4*Nb+2]=this.data[Nb*this.channels+2]>>>this.bitDepth-8;if(this.alpha){this.checkProcessable('getRGBAData',{bitDepth:[8,16]});for(var Gb=0;Gb<Fb;Gb++)Ub[4*Gb+3]=this.data[Gb*this.channels+this.components]>>this.bitDepth-8}else for(var Hb=0;Hb<Fb;Hb++)Ub[4*Hb+3]=255;return Ub}getRoiManager(Fb){return new Cm(this,Fb)}clone(Fb={}){var Ub=Fb.copyData;return new Sb(this,void 0===Ub||Ub)}save(Fb,Ub={}){var qb=Ub.format,Xb=void 0===qb?'png':qb;return new Promise((Ob,Nb)=>{var Gb=E(Fb),Hb,Wb;switch(Xb.toLowerCase()){case'png':Hb=this.getCanvas().pngStream();break;case'jpg':case'jpeg':Hb=this.getCanvas().jpegStream();break;case'bmp':Wb=vb(this);break;default:throw new RangeError('invalid output format: '+Xb);}Hb?(Gb.on('finish',Ob),Gb.on('error',Nb),Hb.pipe(Gb)):Wb&&T(Fb,Buffer.from(Wb),(Zb)=>{return Zb?void Nb(Zb):void Ob()})})}checkProcessable(Fb,Ub={}){var qb=Ub.bitDepth,Xb=Ub.alpha,Ob=Ub.colorModel,Nb=Ub.components,Gb=Ub.channels;if('string'!=typeof Fb)throw new TypeError('checkProcessable requires as first parameter the processName (a string)');if(qb&&(Array.isArray(qb)||(qb=[qb]),!qb.includes(this.bitDepth)))throw new TypeError('The process: '+Fb+' can only be applied if bit depth is in: '+qb);if(Xb&&(Array.isArray(Xb)||(Xb=[Xb]),!Xb.includes(this.alpha)))throw new TypeError('The process: '+Fb+' can only be applied if alpha is in: '+Xb);if(Ob&&(Array.isArray(Ob)||(Ob=[Ob]),!Ob.includes(this.colorModel)))throw new TypeError('The process: '+Fb+' can only be applied if color model is in: '+Ob);if(Nb&&(Array.isArray(Nb)||(Nb=[Nb]),!Nb.includes(this.components)))throw new TypeError('The process: '+Fb+' can only be applied if the number of components is in: '+Nb);if(Gb&&(Array.isArray(Gb)||(Gb=[Gb]),!Gb.includes(this.channels)))throw new TypeError('The process: '+Fb+' can only be applied if the number of channels is in: '+Gb)}checkColumn(Fb){if(0>Fb||Fb>=this.width)throw new RangeError(`checkColumn: column should be included between 0 and ${this.width-1}. Current value: ${Fb}`)}checkRow(Fb){if(0>Fb||Fb>=this.height)throw new RangeError(`checkRow: row should be included between 0 and ${this.height-1}. Current value: ${Fb}`)}checkChannel(Fb){if(0>Fb||Fb>=this.channels)throw new RangeError(`checkChannel: channel should be included between 0 and ${this.channels-1}. Current value: ${Fb}`)}apply(Fb){for(var Ub=0;Ub<this.height;Ub++)for(var qb=0,Xb;qb<this.width;qb++)Xb=(Ub*this.width+qb)*this.channels,Fb.call(this,Xb)}}(function(Fb){var Ub={inPlace:!0},Xb={stack:!0};Fb.extendMethod('invertGetSet',O,Ub),Fb.extendMethod('invertIterator',G,Ub),Fb.extendMethod('invertPixel',Z,Ub),Fb.extendMethod('invertOneLoop',W,Ub),Fb.extendMethod('invertApply',Q,Ub),Fb.extendMethod('invert',ie,{inPlace:!0,stack:!0}),Fb.extendMethod('invertBinaryLoop',J,Ub),Fb.extendMethod('level',je,Ub),Fb.extendMethod('add',Ie,Ub),Fb.extendMethod('subtract',Pe,Ub),Fb.extendMethod('multiply',Be,Ub),Fb.extendMethod('divide',Ae,Ub),Fb.extendMethod('hypotenuse',Ce),Fb.extendMethod('background',kt),Fb.extendMethod('flipX',ne),Fb.extendMethod('flipY',oe),Fb.extendMethod('blurFilter',le),Fb.extendMethod('medianFilter',he),Fb.extendMethod('gaussianFilter',xe),Fb.extendMethod('sobelFilter',ve),Fb.extendMethod('crop',vt,Xb),Fb.extendMethod('cropAlpha',Dt,Xb),Fb.extendMethod('scale',Rt,Xb),Fb.extendMethod('hsv',zt),Fb.extendMethod('hsl',Lt),Fb.extendMethod('cmyk',Et),Fb.extendMethod('rgba8',Tt),Fb.extendMethod('grey',Vt).extendMethod('gray',Vt),Fb.extendMethod('mask',ha),Fb.extendMethod('pad',ca),Fb.extendMethod('colorDepth',ga),Fb.extendMethod('setBorder',xa,Ub),Fb.extendMethod('rotate',fa),Fb.extendMethod('rotateLeft',ba),Fb.extendMethod('rotateRight',_a),Fb.extendMethod('getRow',Fa),Fb.extendMethod('getColumn',Ua),Fb.extendMethod('getMatrix',qa),Fb.extendMethod('setMatrix',Xa),Fb.extendMethod('getPixelsArray',Oa),Fb.extendMethod('getIntersection',Na),Fb.extendMethod('getClosestCommonParent',Wa),Fb.extendMethod('split',Ba),Fb.extendMethod('getChannel',Aa),Fb.extendMethod('combineChannels',Ra),Fb.extendMethod('setChannel',La),Fb.extendMethod('getSimilarity',Ea),Fb.extendMethod('getPixelsGrid',Ta),Fb.extendMethod('getBestMatch',Ya),Fb.extendMethod('paintMasks',ci,Ub),Fb.extendMethod('paintLabels',gi,Ub),Fb.extendMethod('paintPoints',bi,Ub),Fb.extendMethod('paintPolyline',ki,Ub),Fb.extendMethod('extract',Di),Fb.extendMethod('convolution',we),Fb.extendMethod('convolutionFft',se),Fb.extendMethod('floodFill',ji),Fb.extendMethod('countAlphaPixels',Ui),Fb.extendMethod('monotoneChainConvexHull',Ni),Fb.extendMethod('minimalBoundingRectangle',Zi),Fb.extendMethod('getHistogram',Si).extendProperty('histogram',Si),Fb.extendMethod('getHistograms',Ii).extendProperty('histograms',Ii),Fb.extendMethod('getColorHistogram',Ci).extendProperty('colorHistogram',Ci),Fb.extendMethod('getMin',Bi).extendProperty('min',Bi),Fb.extendMethod('getMax',Ai).extendProperty('max',Ai),Fb.extendMethod('getSum',Ri).extendProperty('sum',Ri),Fb.extendMethod('getMoment',zi).extendProperty('moment',zi),Fb.extendMethod('getLocalMaxima',Li),Fb.extendMethod('getMedian',Ti).extendProperty('median',Ti),Fb.extendMethod('getMean',Ei).extendProperty('mean',Ei),Fb.extendMethod('getPoints',Vi).extendProperty('points',Vi),Fb.extendMethod('getRelativePosition',Yi),Fb.extendMethod('getSvd',Fi).extendProperty('svd',Fi)})(Sb),function(Fb){for(var Ub in dm)Fb.prototype[Ub]=dm[Ub]}(Sb);var Ib=Object.freeze({laplacianOfGaussian:function(Fb,Ub,qb){var Xb=Array(Ub),Ob=void 0,Nb=void 0,Gb,Hb;qb||(qb=100),qb*=-1;var Wb=(Ub-1)/2,Zb=2*Fb*Fb;for(Ob=0;Ob<Ub;Ob++)for(Xb[Ob]=Array(Ub),Hb=(Ob-Wb)*(Ob-Wb),Nb=0;Nb<Ub;Nb++)Gb=(Nb-Wb)*(Nb-Wb),Xb[Ob][Nb]=_Mathround(qb*(1-(Gb+Hb)/Zb)*_Mathexp(-(Gb+Hb)/Zb));return Xb},DISCRETE_LAPLACE_4:[[0,1,0],[1,-4,1],[0,1,0]],DISCRETE_LAPLACE_8:[[1,1,1],[1,-8,1],[1,1,1]],GRADIENT_X:ul,GRADIENT_Y:pl,SECOND_DERIVATIVE:[[-1,-2,0,2,1],[-2,-4,0,4,2],[0,0,0,0,0],[1,2,0,-2,-1],[2,4,0,-4,-2]],SECOND_DERIVATIVE_INV:[[1,2,0,-2,-1],[2,4,0,-4,-2],[0,0,0,0,0],[-2,-4,0,4,2],[-1,-2,0,2,1]]}),Cb=function(){function Fb(){this._listeners={}}self.window=self;Fb.prototype.on=function(Xb,Ob){if(this._listeners[Xb])throw new RangeError('there is already a listener for '+Xb);if('function'!=typeof Ob)throw new TypeError('callback argument must be a function');this._listeners[Xb]=Ob},Fb.prototype._send=function(Xb,Ob,Nb){void 0===Nb?Nb=[]:!Array.isArray(Nb)&&(Nb=[Nb]),self.postMessage({id:Xb,data:Ob},Nb)},Fb.prototype._trigger=function(Xb,Ob){if(!this._listeners[Xb])throw new Error('event '+Xb+' is not defined');this._listeners[Xb].apply(null,Ob)};var qb=new Fb;self.onmessage=function(Xb){switch(Xb.data.action){case'exec':Xb.data.args.unshift(function(Ob,Nb){qb._send(Xb.data.id,Ob,Nb)}),qb._trigger(Xb.data.event,Xb.data.args);break;case'ping':qb._send(Xb.data.id,'pong');break;default:throw new Error('unexpected action: '+Xb.data.action);}},'CODE'}.toString().split('"CODE";'),Ab={newWorkerURL:function(Ub,qb){var Xb=new Blob(['(',Cb[0],'importScripts.apply(self, '+JSON.stringify(qb)+');\n','(',Ub,')();',Cb[1],')();'],{type:'application/javascript'});return URL.createObjectURL(Xb)}},Rb=navigator.hardwareConcurrency||1;Sr.prototype._init=function(Fb){for(var Ub=Ab.newWorkerURL(this._workerCode,Fb),qb=0,Xb;qb<this._numWorkers;qb++)Xb=new Worker(Ub),Xb.onmessage=this._onmessage.bind(this,Xb),Xb.onerror=this._onerror.bind(this,Xb),Xb.running=!1,Xb.id=qb,this._workers.set(Xb,null);URL.revokeObjectURL(Ub)},Sr.prototype._onerror=function(Fb,Ub){if(!this._terminated){this._working--,Fb.running=!1;var qb=this._workers.get(Fb);qb&&qb[1](Ub.message),this._workers.set(Fb,null),this._terminateOnError?this.terminate():this._exec()}},Sr.prototype._onmessage=function(Fb,Ub){if(!this._terminated){this._working--,Fb.running=!1;var qb=this._workers.get(Fb);qb&&qb[0](Ub.data.data),this._workers.set(Fb,null),this._exec()}},Sr.prototype._exec=function(){for(var Fb of this._workers.keys()){if(this._working===this._numWorkers||0===this._waiting.length)return;if(!Fb.running)for(var Ub=0,qb;Ub<this._waiting.length;Ub++)if(qb=this._waiting[Ub],'number'!=typeof qb[4]||qb[4]===Fb.id){this._waiting.splice(Ub,1),Fb.postMessage({action:'exec',event:qb[0],args:qb[1]},qb[2]),Fb.running=!0,Fb.time=Date.now(),this._workers.set(Fb,qb[3]),this._working++;break}}},Sr.prototype.terminate=function(){if(!this._terminated){for(var Fb of this._workers)Fb[0].terminate(),Fb[1]&&Fb[1][1](new Error('Terminated'));this._workers.clear(),this._waiting=[],this._working=0,this._terminated=!0}},Sr.prototype.postAll=function(Fb,Ub){if(this._terminated)throw new Error('Cannot post (terminated)');var qb=[];for(var Xb of this._workers.keys())qb.push(this.post(Fb,Ub,[],Xb.id));return Promise.all(qb)},Sr.prototype.post=function(Fb,Ub,qb,Xb){void 0===Ub&&(Ub=[]),void 0===qb&&(qb=[]),Array.isArray(Ub)||(Ub=[Ub]),Array.isArray(qb)||(qb=[qb]);var Ob=this;return new Promise(function(Nb,Gb){if(Ob._terminated)throw new Error('Cannot post (terminated)');Ob._waiting.push([Fb,Ub,qb,[Nb,Gb],Xb]),Ob._exec()})};var zb=Sr,Lb={regression:{kernelType:'polynomial',kernelOptions:{degree:2,constant:1}},threshold:0.02,roi:{minSurface:100,positive:!1},sampling:20,include:[]},Eb={run:function(Fb,Ub,qb){Ub=Sm({},Lb,Ub);var Xb=this.manager;return Array.isArray(Fb)?Promise.all(Fb.map(function(Ob){var Nb=Pr(Xb,Ob,Ub);return'function'==typeof qb&&Nb.then(qb),Nb})):Pr(Xb,Fb,Ub)},work:function(){worker.on('data',function(Fb,Ub,qb){function Xb(e_,t_){qb.include.includes(e_)&&(Ob[e_]=t_,Nb.push(t_.data.buffer))}Ub=new IJS(Ub);var Ob={},Nb=[],Gb=Ub.grey(),Hb=Gb.sobelFilter();Xb('sobel',Hb);var Wb=Hb.level().mask({threshold:qb.threshold});Xb('mask',Wb);var Zb=Hb.getRoiManager();Zb.fromMask(Wb);var Qb=Zb.getMask(qb.roi);Xb('realMask',Qb);var Kb=Gb.getPixelsGrid({sampling:qb.sampling,mask:Qb}),Jb=Ub.getBackground(Kb.xyS,Kb.zS,qb.regression);Xb('background',Jb);var $b=Ub.subtract(Jb);Ob.result=$b,Nb.push($b.data.buffer),Fb(Ob,Nb)})}};class Tb{constructor(){this._url=null,this._deps=[null]}checkUrl(){if(null===this._url)throw new Error('image worker must be initialized with an URL')}get url(){return this._url}set url(Fb){if('string'!=typeof Fb)throw new TypeError('worker URL must be a string');this._url=Fb,this._deps[0]=Fb}static extendMethod(Fb,Ub){function qb(...Gb){return Xb||(this.checkUrl(),Ob=this.url,Xb=new zb(Ub.work,{deps:Ob}),Nb.manager=Xb),Ub.run.call(Nb,...Gb)}var Nb={},Xb,Ob;qb.reset=function(){Xb&&(Xb.terminate(),Xb=new zb(Ub.work,{deps:Ob}),Nb.manager=Xb)},Tb.prototype[Fb]=qb}}(function(Fb){Fb.extendMethod('background',Eb)})(Tb);var Vb=new Tb;Sb.Stack=Uh,Sb.Shape=sm,Sb.Kernel=Ib;return Sb.Static={grey:vh,mask:jh,maskMethods:Dh},Sb.Worker=Vb,Sb});

//# sourceMappingURL=image.min.js.map