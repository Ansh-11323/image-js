var _StringfromCharCode=String.fromCharCode,_Mathsign=Math.sign,_NumberNEGATIVE_INFINITY=Number.NEGATIVE_INFINITY,_NumberPOSITIVE_INFINITY=Number.POSITIVE_INFINITY,_Mathcos=Math.cos,_NumberEPSILON=Number.EPSILON,_NumberMAX_VALUE=Number.MAX_VALUE,_NumberMIN_VALUE=Number.MIN_VALUE,_Mathlog=Math.log,_Mathpow=Math.pow,_Mathabs=Math.abs,_Mathmin=Math.min,_Mathmax=Math.max,_NumberisFinite=Number.isFinite,_NumberisInteger=Number.isInteger,_Mathround=Math.round,_Mathexp=Math.exp,_Mathsqrt=Math.sqrt,_Mathsin=Math.sin,_MathPI=Math.PI,_Mathfloor=Math.floor,_Mathceil=Math.ceil;(function(_,S){'object'==typeof exports&&'undefined'!=typeof module?module.exports=S():'function'==typeof define&&define.amd?define(S):_.IJS=S()})(this,function(){'use strict';function _(Xb){return Wr[Xb]}function S(Xb){var Ob=Xb.channels*Xb.size;return 1===Xb.bitDepth&&(Ob=_Mathceil(Ob/8)),Ob}function I(Xb){var Ob=Xb.channels*Xb.size,Nb;switch(Xb.bitDepth){case 1:Nb=new Uint8Array(_Mathceil(Ob/8));break;case 8:Nb=new Uint8ClampedArray(Ob);break;case 16:Nb=new Uint16Array(Ob);break;case 32:Nb=new Float32Array(Ob);break;default:throw new Error('Cannot create pixel array for bit depth '+Xb.bitDepth);}if(Xb.alpha)for(var Gb=Xb.components;Gb<Nb.length;Gb+=Xb.channels)Nb[Gb]=Xb.maxValue;return Nb}function P(Xb){try{var Ob=new URL(Xb);return Ob.origin!==Jr}catch(Nb){return!1}}function R(Xb,Ob){var Nb=self.document.createElement('canvas');return Nb.width=Xb,Nb.height=Ob,Nb}function L(Xb,{withCredentials:Ob=!1}={}){return new Promise(function(Nb,Gb){var Hb=new self.XMLHttpRequest;Hb.open('GET',Xb,!0),Hb.responseType='arraybuffer',Hb.withCredentials=Ob,Hb.onload=function(Wb){200===this.status?Nb(this.response):Gb(Wb)},Hb.onerror=Gb,Hb.send()})}function E(){throw new Error('createWriteStream does not exist in the browser')}function T(){throw new Error('writeFile does not exist in the browser')}function O(){if(this.checkProcessable('invert',{bitDepth:[1,8,16]}),1===this.bitDepth)for(var Xb=this.data,Ob=0;Ob<Xb.length;Ob++)Xb[Ob]=~Xb[Ob];else for(var Nb=0;Nb<this.width;Nb++)for(var Gb=0;Gb<this.height;Gb++)for(var Hb=0,Wb;Hb<this.components;Hb++)Wb=this.getValueXY(Nb,Gb,Hb),this.setValueXY(Nb,Gb,Hb,this.maxValue-Wb)}function G(){if(this.checkProcessable('invert',{bitDepth:[1,8,16]}),1===this.bitDepth)for(var Xb=this.data,Ob=0;Ob<Xb.length;Ob++)Xb[Ob]=~Xb[Ob];else for(var Nb of this.pixels())for(var Gb=Nb.index,Hb=Nb.pixel,Wb=0;Wb<this.components;Wb++)this.setValue(Gb,Wb,this.maxValue-Hb[Wb])}function W(){this.checkProcessable('invertOneLoop',{bitDepth:[8,16]});for(var Xb=this.data,Ob=0;Ob<Xb.length;Ob+=this.channels)for(var Nb=0;Nb<this.components;Nb++)Xb[Ob+Nb]=this.maxValue-Xb[Ob+Nb]}function Z(){this.checkProcessable('invertPixel',{bitDepth:[8,16]});for(var Xb=0;Xb<this.width;Xb++)for(var Ob=0,Nb;Ob<this.height;Ob++){Nb=this.getPixelXY(Xb,Ob);for(var Gb=0;Gb<this.components;Gb++)Nb[Gb]=this.maxValue-Nb[Gb];this.setPixelXY(Xb,Ob,Nb)}}function Q(){if(1===this.bitDepth)for(var Xb=this.data,Ob=0;Ob<Xb.length;Ob++)Xb[Ob]=~Xb[Ob];else this.checkProcessable('invertApply',{bitDepth:[8,16]}),this.apply(function(Nb){for(var Gb=0;Gb<this.components;Gb++)this.data[Nb+Gb]=this.maxValue-this.data[Nb+Gb]})}function J(){this.checkProcessable('invertBinaryLoop',{bitDepth:[1]});for(var Xb=0;Xb<this.size;Xb++)this.toggleBit(Xb)}function $(Xb,Ob={}){var Nb=Ob.channels,Gb=Ob.allowAlpha,Hb=Ob.defaultAlpha;return'boolean'!=typeof Gb&&(Gb=!0),'undefined'==typeof Nb?ee(Xb,Hb):te(Xb,Nb,Gb)}function ee(Xb,Ob){for(var Nb=Ob?Xb.channels:Xb.components,Gb=Array(Nb),Hb=0;Hb<Nb;Hb++)Gb[Hb]=Hb;return Gb}function te(Xb,Ob,Nb){Array.isArray(Ob)||(Ob=[Ob]);for(var Gb=0;Gb<Ob.length;Gb++)Ob[Gb]=ae(Xb,Ob[Gb],Nb);return Ob}function ae(Xb,Ob,Nb=!0){if(void 0===Ob)throw new RangeError('validateChannel : the channel has to be >=0 and <'+Xb.channels);if('string'==typeof Ob){switch(Xb.colorModel){case Hr:break;case Xr:'rgb'.includes(Ob)&&('r'===Ob?Ob=0:'g'===Ob?Ob=1:'b'===Ob?Ob=2:void 0);break;case Or:'hsl'.includes(Ob)&&('h'===Ob?Ob=0:'s'===Ob?Ob=1:'l'===Ob?Ob=2:void 0);break;case Nr:'hsv'.includes(Ob)&&('h'===Ob?Ob=0:'s'===Ob?Ob=1:'v'===Ob?Ob=2:void 0);break;case Gr:'cmyk'.includes(Ob)&&('c'===Ob?Ob=0:'m'===Ob?Ob=1:'y'===Ob?Ob=2:'k'===Ob?Ob=3:void 0);break;default:throw new Error(`Unexpected color model: ${Xb.colorModel}`);}if('a'===Ob){if(!Xb.alpha)throw new Error('validateChannel : the image does not contain alpha channel');Ob=Xb.components}if('string'==typeof Ob)throw new Error('validateChannel : undefined channel: '+Ob)}if(Ob>=Xb.channels)throw new RangeError('validateChannel : the channel has to be >=0 and <'+Xb.channels);if(!Nb&&Ob>=Xb.components)throw new RangeError('validateChannel : alpha channel may not be selected');return Ob}function ie(Xb={}){var Ob=Xb.channels;if(this.checkProcessable('invertOneLoop',{bitDepth:[1,8,16]}),1===this.bitDepth)for(var Nb=this.data,Gb=0;Gb<Nb.length;Gb++)Nb[Gb]=~Nb[Gb];else{Ob=$(this,{channels:Ob});for(var Hb=0,Wb;Hb<Ob.length;Hb++){Wb=Ob[Hb];for(var Zb=Wb;Zb<this.data.length;Zb+=this.channels)this.data[Zb]=this.maxValue-this.data[Zb]}}return this}function ne(){this.checkProcessable('flipX',{bitDepth:[8,16]});for(var Xb=0,Ob;Xb<this.height;Xb++){Ob=Xb*this.width*this.channels;for(var Nb=0;Nb<_Mathfloor(this.width/2);Nb++)for(var Gb=Nb*this.channels+Ob,Hb=(this.width-Nb-1)*this.channels+Ob,Wb=0,Zb;Wb<this.channels;Wb++)Zb=this.data[Gb+Wb],this.data[Gb+Wb]=this.data[Hb+Wb],this.data[Hb+Wb]=Zb}return this}function oe(){this.checkProcessable('flipY',{bitDepth:[8,16]});for(var Xb=0;Xb<_Mathfloor(this.height/2);Xb++)for(var Ob=0;Ob<this.width;Ob++)for(var Nb=Ob*this.channels+Xb*this.width*this.channels,Gb=Ob*this.channels+(this.height-1-Xb)*this.channels*this.width,Hb=0,Wb;Hb<this.channels;Hb++)Wb=this.data[Nb+Hb],this.data[Nb+Hb]=this.data[Gb+Hb],this.data[Gb+Hb]=Wb;return this}function se(Xb,Ob={}){return Ob=Object.assign({},Ob),Ob.algorithm='fft',this.convolution(Xb,Ob)}function le(Xb={}){var Ob=Xb.radius,Nb=void 0===Ob?1:Ob;if(this.checkProcessable('meanFilter',{components:[1],bitDepth:[8,16]}),1>Nb)throw new Error('Number of neighbors should be grater than 0');for(var Gb=2*Nb+1,Wb=Array(Gb*Gb),Zb=0;Zb<Wb.length;Zb++)Wb[Zb]=1;return se.call(this,Wb)}function de(Xb){if('number'!=typeof Xb||$r(Xb))throw new TypeError('Expected a number')}function he(Xb={}){var Ob=Xb.radius,Nb=void 0===Ob?1:Ob,Gb=Xb.channels,Hb=Xb.border,Wb=void 0===Hb?'copy':Hb;if(this.checkProcessable('median',{bitDepth:[8,16]}),1>Nb)throw new Error('Kernel radius should be greater than 0');Gb=$(this,Gb,!0);for(var Zb=Nb,Qb=Nb,Kb=Cb.createFrom(this),Jb=(2*Zb+1)*(2*Qb+1),$b=_Mathfloor(Jb/2),e_=Array(Jb),t_=0,a_;t_<Gb.length;t_++){a_=Gb[t_];for(var i_=Qb;i_<this.height-Qb;i_++)for(var n_=Zb,o_;n_<this.width-Zb;n_++){o_=0;for(var s_=-Qb;s_<=Qb;s_++)for(var r_=-Zb,l_;r_<=Zb;r_++)l_=((i_+s_)*this.width+n_+r_)*this.channels+a_,e_[o_++]=this.data[l_];var d_=(i_*this.width+n_)*this.channels+a_,h_=e_.sort(tl)[$b];Kb.data[d_]=h_}}if(this.alpha&&!Gb.includes(this.channels))for(var m_=this.components;m_<this.data.length;m_+=this.channels)Kb.data[m_]=this.data[m_];return Kb.setBorder({size:[Zb,Qb],algorithm:Wb}),Kb}function ge(){throw new Error('Dynamic requires are not currently supported by rollup-plugin-commonjs')}function ce(Xb,Ob){return Ob={exports:{}},Xb(Ob,Ob.exports),Ob.exports}function be(Xb){var Ob=Xb,Nb,Gb;if('number'!=typeof Xb[0]){Nb=Xb.length,Gb=Xb[0].length,Ob=Array(Nb*Gb);for(var Hb=0;Hb<Nb;Hb++)for(var Wb=0;Wb<Gb;Wb++)Ob[Hb*Gb+Wb]=Xb[Hb][Wb]}else{var Zb=_Mathsqrt(Xb.length);_NumberisInteger(Zb)&&(Nb=Zb,Gb=Zb)}return{data:Ob,rows:Nb,cols:Gb}}function _e(Xb){var Ob,Nb;if(!Array.isArray(Xb))throw new Error('validateKernel: Invalid Kernel: '+Xb);else if(!Array.isArray(Xb[0])){var Gb=_Mathsqrt(Xb.length);if(ul(Gb))Nb=Ob=_Mathfloor(_Mathsqrt(Xb.length)/2);else throw new RangeError('validateKernel: Kernel array should be a square');for(var Hb=Array(Gb),Wb=0;Wb<Gb;Wb++){Hb[Wb]=Array(Gb);for(var Zb=0;Zb<Gb;Zb++)Hb[Wb][Zb]=Xb[Wb*Gb+Zb]}Xb=Hb}else if(0==(1&Xb.length)||0==(1&Xb[0].length))throw new RangeError('validateKernel: Kernel rows and columns should be odd numbers');else Ob=_Mathfloor(Xb.length/2),Nb=_Mathfloor(Xb[0].length/2);return{kernel:Xb,kWidth:Nb,kHeight:Ob}}function we(Xb,Ob,Nb){if(void 0===Nb){const Wb=Xb.length+Ob.length-1;Nb=Array(Wb)}xe(Nb);for(var Gb=0;Gb<Xb.length;Gb++)for(var Hb=0;Hb<Ob.length;Hb++)Nb[Gb+Hb]+=Xb[Gb]*Ob[Hb];return Nb}function xe(Xb){for(var Ob=0;Ob<Xb.length;Ob++)Xb[Ob]=0}function ye(Xb,Ob,Nb,Gb){var Hb=Array(Xb.length),Wb=(Ob.length-1)/2,Zb,Qb;Qb=Array(Nb+Ob.length-1),Zb=Array(Nb);for(var Kb=0;Kb<Gb;Kb++){for(var Jb=0;Jb<Nb;Jb++)Zb[Jb]=Xb[Kb*Nb+Jb];we(Zb,Ob,Qb);for(var $b=0;$b<Nb;$b++)Hb[Kb*Nb+$b]=Qb[Wb+$b]}Qb=Array(Gb+Ob.length-1),Zb=Array(Gb);for(var e_=0;e_<Nb;e_++){for(var t_=0;t_<Gb;t_++)Zb[t_]=Hb[t_*Nb+e_];we(Zb,Ob,Qb);for(var a_=0;a_<Gb;a_++)Hb[a_*Nb+e_]=Qb[Wb+a_]}return Hb}function ke(Xb,Ob={}){var Nb=Ob.channels,Gb=Ob.bitDepth,Hb=Ob.normalize,Wb=void 0!==Hb&&Hb,Zb=Ob.divisor,Qb=void 0===Zb?1:Zb,Kb=Ob.border,Jb=void 0===Kb?'copy':Kb,$b=Ob.algorithm,e_=void 0===$b?'auto':$b,t_=Cb.createFrom(this,{bitDepth:Gb});Nb=$(this,Nb,!0);var a_=_e(Xb);Xb=a_.kernel,'auto'===e_&&(9<Xb.length||9<Xb[0].length?e_='fft':e_='direct'),(4096<this.width||4096<this.height)&&(e_='direct');var i_=_Mathfloor(Xb.length/2),n_=_Mathfloor(Xb[0].length/2),o_=t_.isClamped,s_=Array(this.height*this.width),l_=void 0,d_=void 0,h_=void 0,r_,m_,g_;for(h_=0;h_<Nb.length;h_++){for(m_=Nb[h_],d_=0;d_<this.height;d_++)for(l_=0;l_<this.width;l_++)r_=d_*this.width+l_,s_[r_]=this.data[r_*this.channels+m_];if('direct'===e_)g_=ml(s_,Xb,{rows:this.height,cols:this.width,normalize:Wb,divisor:Qb});else if('separable'===e_){for(var c_=Array(Xb.length),u_=0;u_<Xb.length;u_++)c_[u_]=_Mathsqrt(Xb[u_][u_]);g_=ye(s_,c_,this.width,this.height)}else g_=gl(s_,Xb,{rows:this.height,cols:this.width,normalize:Wb,divisor:Qb});for(d_=0;d_<this.height;d_++)for(l_=0;l_<this.width;l_++)r_=d_*this.width+l_,t_.data[r_*this.channels+m_]=o_?_Mathmin(_Mathmax(g_[r_],0),t_.maxValue):g_[r_]}if(this.alpha&&!Nb.includes(this.channels))for(l_=this.components;l_<this.data.length;l_+=this.channels)t_.data[l_]=this.data[l_];return'periodic'!==Jb&&t_.setBorder({size:[n_,i_],algorithm:Jb}),t_}function ve(Xb={}){var Ob=Xb.radius,Nb=void 0===Ob?1:Ob,Gb=Xb.sigma,Hb=Xb.channels,Wb=Xb.border,Zb=void 0===Wb?'copy':Wb,Qb=Xb.algorithm,Kb=void 0===Qb?'auto':Qb;this.checkProcessable('gaussian',{bitDepth:[8,16]});var Jb;return Gb?Jb=je(Gb):(Gb=0.3*(Nb-1)+0.8,Jb=De(Nb,Gb)),ke.call(this,Jb,{border:Zb,channels:Hb,algorithm:Kb})}function De(Xb,Ob){if(1>Xb)throw new RangeError('Radius should be grater than 0');for(var Nb=2*Xb+1,Gb=Array(Nb*Nb),Hb=2*(Ob*Ob),Zb=0;Zb<=Xb;Zb++)for(var Qb=Zb,Kb;Qb<=Xb;Qb++)Kb=_Mathexp(-(Zb*Zb+Qb*Qb)/Hb)/(_MathPI*Hb),Gb[(Zb+Xb)*Nb+(Qb+Xb)]=Kb,Gb[(Zb+Xb)*Nb+(-Qb+Xb)]=Kb,Gb[(-Zb+Xb)*Nb+(Qb+Xb)]=Kb,Gb[(-Zb+Xb)*Nb+(-Qb+Xb)]=Kb,Gb[(Qb+Xb)*Nb+(Zb+Xb)]=Kb,Gb[(Qb+Xb)*Nb+(-Zb+Xb)]=Kb,Gb[(-Qb+Xb)*Nb+(Zb+Xb)]=Kb,Gb[(-Qb+Xb)*Nb+(-Zb+Xb)]=Kb;return Gb}function je(Xb){if(0>=Xb)throw new RangeError('Sigma should be grater than 0');for(var Ob=2*(Xb*Xb),Nb=_MathPI*Ob,Gb=1/Nb,Hb=Gb,Wb=0;0.99>Hb;){Wb++,Gb=_Mathexp(-(Wb*Wb)/Ob)/Nb,Hb+=4*Gb;for(var Zb=1;Zb<Wb;Zb++)Gb=_Mathexp(-(Zb*Zb+Wb*Wb)/Ob)/Nb,Hb+=8*Gb;Gb=4*_Mathexp(-(2*Wb*Wb)/Ob)/Nb,Hb+=Gb}if(1<Hb)throw new Error('unexpected sum over 1');return De(Wb,Xb)}function Me(Xb={}){var Ob=Xb.kernelX,Nb=void 0===Ob?bl:Ob,Gb=Xb.kernelY,Hb=void 0===Gb?_l:Gb,Wb=Xb.border,Zb=void 0===Wb?'copy':Wb,Qb=Xb.channels,Kb=Xb.bitDepth,Jb=void 0===Kb?this.bitDepth:Kb;this.checkProcessable('sobel',{bitDepth:[8,16]});var $b=ke.call(this,Nb,{channels:Qb,border:Zb,bitDepth:32}),e_=ke.call(this,Hb,{channels:Qb,border:Zb,bitDepth:32});return $b.hypotenuse(e_,{bitDepth:Jb,channels:Qb})}function Ie(Xb={}){var Ob=Xb.algorithm,Nb=void 0===Ob?'range':Ob,Gb=Xb.channels,Hb=Xb.min,Wb=void 0===Hb?this.min:Hb,Zb=Xb.max,Qb=void 0===Zb?this.max:Zb;switch(this.checkProcessable('level',{bitDepth:[8,16]}),Gb=$(this,{channels:Gb}),Nb){case'range':0>Wb&&(Wb=0),Qb>this.maxValue&&(Qb=this.maxValue),Array.isArray(Wb)||(Wb=vl(Gb.length,Wb)),Array.isArray(Qb)||(Qb=vl(Gb.length,Qb)),Pe(this,Wb,Qb,Gb);break;default:throw new Error('level: algorithm not implement: '+Nb);}return this}function Pe(Xb,Ob,Nb,Gb){var Hb=1e-5,Wb=Array(Xb.channels);for(var Zb of Gb)Wb[Zb]=0===Ob[Zb]&&Nb[Zb]===Xb.maxValue?0:Nb[Zb]===Ob[Zb]?0:(Xb.maxValue+1-Hb)/(Nb[Zb]-Ob[Zb]),Ob[Zb]+=(0.5-Hb/2)/Wb[Zb];for(var Qb=0,Kb;Qb<Gb.length;Qb++)if(Kb=Gb[Qb],0!==Wb[Kb])for(var Jb=0;Jb<Xb.data.length;Jb+=Xb.channels)Xb.data[Jb+Kb]=_Mathmin(_Mathmax(0,0|(Xb.data[Jb+Kb]-Ob[Kb])*Wb[Kb]+0.5),Xb.maxValue)}function Ce(Xb){if(!isNaN(Xb)){if(0>=Xb)throw new Error('checkNumberArray: the value must be greater than 0');return Xb}if(Xb instanceof Cb)return Xb.data;if(!jl(Xb))throw new Error('checkNumberArray: the value should be either a number, array or Image');return Xb}function Be(Xb,Ob={}){var Nb=Ob.channels;if(this.checkProcessable('add',{bitDepth:[8,16]}),Nb=$(this,{channels:Nb}),Xb=Ce(Xb),!isNaN(Xb))for(var Gb=0,Hb;Gb<Nb.length;Gb++){Hb=Nb[Gb];for(var Wb=0;Wb<this.data.length;Wb+=this.channels)this.data[Wb+Hb]=_Mathmin(this.maxValue,this.data[Wb+Hb]+Xb>>0)}else{if(this.data.length!==Xb.length)throw new Error('add: the data size is different');for(var Zb=0,Qb;Zb<Nb.length;Zb++){Qb=Nb[Zb];for(var Kb=0;Kb<this.data.length;Kb+=this.channels)this.data[Kb+Qb]=_Mathmax(0,_Mathmin(this.maxValue,this.data[Kb+Qb]+Xb[Kb+Qb]>>0))}}return this}function Ae(Xb,Ob={}){var Nb=Ob.channels;if(this.checkProcessable('subtract',{bitDepth:[8,16]}),Nb=$(this,{channels:Nb}),Xb=Ce(Xb),!isNaN(Xb))for(var Gb=0,Hb;Gb<Nb.length;Gb++){Hb=Nb[Gb];for(var Wb=0;Wb<this.data.length;Wb+=this.channels)this.data[Wb+Hb]=_Mathmax(0,this.data[Wb+Hb]-Xb>>0)}else{if(this.data.length!==Xb.length)throw new Error('substract: the data size is different');for(var Zb=0,Qb;Zb<Nb.length;Zb++){Qb=Nb[Zb];for(var Kb=0;Kb<this.data.length;Kb+=this.channels)this.data[Kb+Qb]=_Mathmax(0,_Mathmin(this.maxValue,this.data[Kb+Qb]-Xb[Kb+Qb]>>0))}}return this}function Re(Xb,Ob={}){var Nb=Ob.bitDepth,Gb=void 0===Nb?this.bitDepth:Nb,Hb=Ob.channels;if(this.checkProcessable('hypotenuse',{bitDepth:[8,16,32]}),this.width!==Xb.width||this.height!==Xb.height)throw new Error('hypotenuse: both images must have the same size');if(this.alpha!==Xb.alpha||this.bitDepth!==Xb.bitDepth)throw new Error('hypotenuse: both images must have the same alpha and bitDepth');if(this.channels!==Xb.channels)throw new Error('hypotenuse: both images must have the same number of channels');var Wb=Cb.createFrom(this,{bitDepth:Gb});Hb=$(this,{channels:Hb});for(var Zb=Wb.isClamped,Qb=0,Kb;Qb<Hb.length;Qb++){Kb=Hb[Qb];for(var Jb=Kb,$b;Jb<this.data.length;Jb+=this.channels)$b=Math.hypot(this.data[Jb],Xb.data[Jb]),Wb.data[Jb]=Zb?_Mathmin(_Mathmax(_Mathround($b),0),Wb.maxValue):$b}return Wb}function ze(Xb,Ob={}){var Nb=Ob.channels;if(this.checkProcessable('multiply',{bitDepth:[8,16]}),0>=Xb)throw new Error('multiply: the value must be greater than 0');if(Nb=$(this,{channels:Nb}),Xb=Ce(Xb),!isNaN(Xb))for(var Gb=0,Hb;Gb<Nb.length;Gb++){Hb=Nb[Gb];for(var Wb=0;Wb<this.data.length;Wb+=this.channels)this.data[Wb+Hb]=_Mathmin(this.maxValue,this.data[Wb+Hb]*Xb>>0)}else{if(this.data.length!==Xb.length)throw new Error('multiply: the data size is different');for(var Zb=0,Qb;Zb<Nb.length;Zb++){Qb=Nb[Zb];for(var Kb=0;Kb<this.data.length;Kb+=this.channels)this.data[Kb+Qb]=_Mathmax(0,_Mathmin(this.maxValue,this.data[Kb+Qb]*Xb[Kb+Qb]>>0))}}return this}function Le(Xb,Ob={}){var Nb=Ob.channels;if(this.checkProcessable('divide',{bitDepth:[8,16]}),Nb=$(this,{channels:Nb}),Xb=Ce(Xb),!isNaN(Xb))for(var Gb=0,Hb;Gb<Nb.length;Gb++){Hb=Nb[Gb];for(var Wb=0;Wb<this.data.length;Wb+=this.channels)this.data[Wb+Hb]=_Mathmin(this.maxValue,this.data[Wb+Hb]/Xb>>0)}else{if(this.data.length!==Xb.length)throw new Error('divide: the: the data size is different');for(var Zb=0,Qb;Zb<Nb.length;Zb++){Qb=Nb[Zb];for(var Kb=0;Kb<this.data.length;Kb+=this.channels)this.data[Kb+Qb]=_Mathmax(0,_Mathmin(this.maxValue,this.data[Kb+Qb]/Xb[Kb+Qb]>>0))}}return this}function Ee(Xb){if(!(this instanceof Ee))return new Ee(Xb);Xb=ad.checkMatrix(Xb);var Ob=Xb.clone(),Nb=Ob.rows,Gb=Ob.columns,Hb=Array(Nb),Wb=1,Zb,Qb,Kb,Jb,$b,e_,t_,a_,i_,n_;for(Zb=0;Zb<Nb;Zb++)Hb[Zb]=Zb;for(i_=Array(Nb),Qb=0;Qb<Gb;Qb++){for(Zb=0;Zb<Nb;Zb++)i_[Zb]=Ob[Zb][Qb];for(Zb=0;Zb<Nb;Zb++){for(a_=Ob[Zb],n_=_Mathmin(Zb,Qb),$b=0,Kb=0;Kb<n_;Kb++)$b+=a_[Kb]*i_[Kb];a_[Qb]=i_[Zb]-=$b}for(Jb=Qb,Zb=Qb+1;Zb<Nb;Zb++)_Mathabs(i_[Zb])>_Mathabs(i_[Jb])&&(Jb=Zb);if(Jb!==Qb){for(Kb=0;Kb<Gb;Kb++)e_=Ob[Jb][Kb],Ob[Jb][Kb]=Ob[Qb][Kb],Ob[Qb][Kb]=e_;t_=Hb[Jb],Hb[Jb]=Hb[Qb],Hb[Qb]=t_,Wb=-Wb}if(Qb<Nb&&0!==Ob[Qb][Qb])for(Zb=Qb+1;Zb<Nb;Zb++)Ob[Zb][Qb]/=Ob[Qb][Qb]}this.LU=Ob,this.pivotVector=Hb,this.pivotSign=Wb}function Te(Xb,Ob){var Nb;return _Mathabs(Xb)>_Mathabs(Ob)?(Nb=Ob/Xb,_Mathabs(Xb)*_Mathsqrt(1+Nb*Nb)):0===Ob?0:(Nb=Xb/Ob,_Mathabs(Ob)*_Mathsqrt(1+Nb*Nb))}function Ve(Xb,Ob,Nb){for(var Gb=Array(Xb),Hb=0;Hb<Xb;Hb++){Gb[Hb]=Array(Ob);for(var Wb=0;Wb<Ob;Wb++)Gb[Hb][Wb]=Nb}return Gb}function Ye(Xb,Ob){if(!(this instanceof Ye))return new Ye(Xb,Ob);Xb=ad.checkMatrix(Xb),Ob=Ob||{};var Nb=Xb.rows,Gb=Xb.columns,Hb=_Mathmin(Nb,Gb),Wb=!0,Zb=!0;!1===Ob.computeLeftSingularVectors&&(Wb=!1),!1===Ob.computeRightSingularVectors&&(Zb=!1);var Qb=!0===Ob.autoTranspose,Kb=!1,Jb;if(!(Nb<Gb))Jb=Xb.clone();else if(!Qb)Jb=Xb.clone(),console.warn('Computing SVD on a matrix with more columns than rows. Consider enabling autoTranspose');else{Jb=Xb.transpose(),Nb=Jb.rows,Gb=Jb.columns,Kb=!0;var $b=Wb;Wb=Zb,Zb=$b}var e_=Array(_Mathmin(Nb+1,Gb)),t_=Ve(Nb,Hb,0),a_=Ve(Gb,Gb,0),i_=Array(Gb),n_=Array(Nb),o_=_Mathmin(Nb-1,Gb),s_=_Mathmax(0,_Mathmin(Gb-2,Nb)),r_,l_,d_,h_,m_,g_,c_,u_,p_,f_,b_,w_,x_,y_,k_,v_,D_,j_,M_,S_,I_;for(d_=0,f_=_Mathmax(o_,s_);d_<f_;d_++){if(d_<o_){for(e_[d_]=0,r_=d_;r_<Nb;r_++)e_[d_]=Te(e_[d_],Jb[r_][d_]);if(0!==e_[d_]){for(0>Jb[d_][d_]&&(e_[d_]=-e_[d_]),r_=d_;r_<Nb;r_++)Jb[r_][d_]/=e_[d_];Jb[d_][d_]+=1}e_[d_]=-e_[d_]}for(l_=d_+1;l_<Gb;l_++){if(d_<o_&&0!==e_[d_]){for(m_=0,r_=d_;r_<Nb;r_++)m_+=Jb[r_][d_]*Jb[r_][l_];for(m_=-m_/Jb[d_][d_],r_=d_;r_<Nb;r_++)Jb[r_][l_]+=m_*Jb[r_][d_]}i_[l_]=Jb[d_][l_]}if(Wb&&d_<o_)for(r_=d_;r_<Nb;r_++)t_[r_][d_]=Jb[r_][d_];if(d_<s_){for(i_[d_]=0,r_=d_+1;r_<Gb;r_++)i_[d_]=Te(i_[d_],i_[r_]);if(0!==i_[d_]){for(0>i_[d_+1]&&(i_[d_]=0-i_[d_]),r_=d_+1;r_<Gb;r_++)i_[r_]/=i_[d_];i_[d_+1]+=1}if(i_[d_]=-i_[d_],d_+1<Nb&&0!==i_[d_]){for(r_=d_+1;r_<Nb;r_++)n_[r_]=0;for(l_=d_+1;l_<Gb;l_++)for(r_=d_+1;r_<Nb;r_++)n_[r_]+=i_[l_]*Jb[r_][l_];for(l_=d_+1;l_<Gb;l_++)for(m_=-i_[l_]/i_[d_+1],r_=d_+1;r_<Nb;r_++)Jb[r_][l_]+=m_*n_[r_]}if(Zb)for(r_=d_+1;r_<Gb;r_++)a_[r_][d_]=i_[r_]}}if(h_=_Mathmin(Gb,Nb+1),o_<Gb&&(e_[o_]=Jb[o_][o_]),Nb<h_&&(e_[h_-1]=0),s_+1<h_&&(i_[s_]=Jb[s_][h_-1]),i_[h_-1]=0,Wb){for(l_=o_;l_<Hb;l_++){for(r_=0;r_<Nb;r_++)t_[r_][l_]=0;t_[l_][l_]=1}for(d_=o_-1;0<=d_;d_--)if(0!==e_[d_]){for(l_=d_+1;l_<Hb;l_++){for(m_=0,r_=d_;r_<Nb;r_++)m_+=t_[r_][d_]*t_[r_][l_];for(m_=-m_/t_[d_][d_],r_=d_;r_<Nb;r_++)t_[r_][l_]+=m_*t_[r_][d_]}for(r_=d_;r_<Nb;r_++)t_[r_][d_]=-t_[r_][d_];for(t_[d_][d_]=1+t_[d_][d_],r_=0;r_<d_-1;r_++)t_[r_][d_]=0}else{for(r_=0;r_<Nb;r_++)t_[r_][d_]=0;t_[d_][d_]=1}}if(Zb)for(d_=Gb-1;0<=d_;d_--){if(d_<s_&&0!==i_[d_])for(l_=d_+1;l_<Gb;l_++){for(m_=0,r_=d_+1;r_<Gb;r_++)m_+=a_[r_][d_]*a_[r_][l_];for(m_=-m_/a_[d_+1][d_],r_=d_+1;r_<Gb;r_++)a_[r_][l_]+=m_*a_[r_][d_]}for(r_=0;r_<Gb;r_++)a_[r_][d_]=0;a_[d_][d_]=1}for(var P_=h_-1,C_=0,B_=2.220446049250313e-16;0<h_;){for(d_=h_-2;-1<=d_&&-1!==d_;d_--)if(_Mathabs(i_[d_])<=B_*(_Mathabs(e_[d_])+_Mathabs(e_[d_+1]))){i_[d_]=0;break}if(d_===h_-2)b_=4;else{for(g_=h_-1;g_>=d_&&g_!==d_;g_--)if(m_=(g_===h_?0:_Mathabs(i_[g_]))+(g_===d_+1?0:_Mathabs(i_[g_-1])),_Mathabs(e_[g_])<=B_*m_){e_[g_]=0;break}g_===d_?b_=3:g_===h_-1?b_=1:(b_=2,d_=g_)}switch(d_++,b_){case 1:{for(c_=i_[h_-2],i_[h_-2]=0,l_=h_-2;l_>=d_;l_--)if(m_=Te(e_[l_],c_),u_=e_[l_]/m_,p_=c_/m_,e_[l_]=m_,l_!==d_&&(c_=-p_*i_[l_-1],i_[l_-1]=u_*i_[l_-1]),Zb)for(r_=0;r_<Gb;r_++)m_=u_*a_[r_][l_]+p_*a_[r_][h_-1],a_[r_][h_-1]=-p_*a_[r_][l_]+u_*a_[r_][h_-1],a_[r_][l_]=m_;break}case 2:{for(c_=i_[d_-1],i_[d_-1]=0,l_=d_;l_<h_;l_++)if(m_=Te(e_[l_],c_),u_=e_[l_]/m_,p_=c_/m_,e_[l_]=m_,c_=-p_*i_[l_],i_[l_]=u_*i_[l_],Wb)for(r_=0;r_<Nb;r_++)m_=u_*t_[r_][l_]+p_*t_[r_][d_-1],t_[r_][d_-1]=-p_*t_[r_][l_]+u_*t_[r_][d_-1],t_[r_][l_]=m_;break}case 3:{for(w_=_Mathmax(_Mathmax(_Mathmax(_Mathmax(_Mathabs(e_[h_-1]),_Mathabs(e_[h_-2])),_Mathabs(i_[h_-2])),_Mathabs(e_[d_])),_Mathabs(i_[d_])),x_=e_[h_-1]/w_,y_=e_[h_-2]/w_,k_=i_[h_-2]/w_,v_=e_[d_]/w_,D_=i_[d_]/w_,j_=((y_+x_)*(y_-x_)+k_*k_)/2,M_=x_*k_*(x_*k_),S_=0,(0!==j_||0!==M_)&&(S_=_Mathsqrt(j_*j_+M_),0>j_&&(S_=-S_),S_=M_/(j_+S_)),c_=(v_+x_)*(v_-x_)+S_,I_=v_*D_,l_=d_;l_<h_-1;l_++){if(m_=Te(c_,I_),u_=c_/m_,p_=I_/m_,l_!==d_&&(i_[l_-1]=m_),c_=u_*e_[l_]+p_*i_[l_],i_[l_]=u_*i_[l_]-p_*e_[l_],I_=p_*e_[l_+1],e_[l_+1]=u_*e_[l_+1],Zb)for(r_=0;r_<Gb;r_++)m_=u_*a_[r_][l_]+p_*a_[r_][l_+1],a_[r_][l_+1]=-p_*a_[r_][l_]+u_*a_[r_][l_+1],a_[r_][l_]=m_;if(m_=Te(c_,I_),u_=c_/m_,p_=I_/m_,e_[l_]=m_,c_=u_*i_[l_]+p_*e_[l_+1],e_[l_+1]=-p_*i_[l_]+u_*e_[l_+1],I_=p_*i_[l_+1],i_[l_+1]=u_*i_[l_+1],Wb&&l_<Nb-1)for(r_=0;r_<Nb;r_++)m_=u_*t_[r_][l_]+p_*t_[r_][l_+1],t_[r_][l_+1]=-p_*t_[r_][l_]+u_*t_[r_][l_+1],t_[r_][l_]=m_}i_[h_-2]=c_,++C_;break}case 4:{if(0>=e_[d_]&&(e_[d_]=0>e_[d_]?-e_[d_]:0,Zb))for(r_=0;r_<=P_;r_++)a_[r_][d_]=-a_[r_][d_];for(;d_<P_&&!(e_[d_]>=e_[d_+1]);){if(m_=e_[d_],e_[d_]=e_[d_+1],e_[d_+1]=m_,Zb&&d_<Gb-1)for(r_=0;r_<Gb;r_++)m_=a_[r_][d_+1],a_[r_][d_+1]=a_[r_][d_],a_[r_][d_]=m_;if(Wb&&d_<Nb-1)for(r_=0;r_<Nb;r_++)m_=t_[r_][d_+1],t_[r_][d_+1]=t_[r_][d_],t_[r_][d_]=m_;d_++}C_=0,h_--;break}}}if(Kb){var A_=a_;a_=t_,t_=A_}this.m=Nb,this.n=Gb,this.s=e_,this.U=t_,this.V=a_}function Xe(Xb){for(var Ob=Array(Xb[0].length),Nb=0;Nb<Ob.length;++Nb)Ob[Nb]=Array(Xb.length);for(Nb=0;Nb<Xb.length;++Nb)for(var Gb=0;Gb<Xb[0].length;++Gb)Ob[Gb][Nb]=Xb[Nb][Gb];return Ob}function We(Xb,Ob,Nb,Gb,Hb){function Wb(f_,b_,w_,x_){return(x_-b_)/(w_-f_)}var Zb=Xb.length,Qb=(Gb-Nb)/(Hb-1),Jb=Nb-Qb/2,$b=Array(Hb),e_=Xb[1]-Xb[0],t_=Xb[Xb.length-1]-Xb[Xb.length-2],a_=Jb,i_=Jb+Qb,n_=_NumberMIN_VALUE,o_=0,s_=Xb[0]-e_,r_=0,l_=0,d_=0,h_=0,m_=0,g_=0,c_=0,u_=0;main:for(;;){for(;0<=s_-i_;){var p_=Qe(0,i_-n_,d_,o_);if(g_=l_+p_,$b[u_]=(g_-m_)/Qb,u_++,u_===Hb)break main;a_=i_,i_+=Qb,m_=g_}n_<=a_&&a_<=s_&&(p_=Qe(0,a_-n_,d_,o_),m_=l_+p_),l_+=Qe(n_,s_,d_,h_),n_=s_,o_=r_,c_<Zb?(s_=Xb[c_],r_=Ob[c_],c_++):c_===Zb&&(s_+=t_,r_=0),d_=Wb(n_,o_,s_,r_),h_=-d_*n_+o_}return $b}function Ze(Xb,Ob,Nb,Gb,Hb){var Wb=Xb.length,Zb=(Gb-Nb)/(Hb-1),Kb=Xb[Xb.length-1]-Xb[Xb.length-2],Jb=Nb-Zb/2,$b=Array(Hb),e_=Jb,t_=Jb+Zb,a_=-_NumberMAX_VALUE,i_=0,n_=Xb[0],o_=Ob[0],s_=0,r_=!0,l_=0,d_=0,h_=1,m_=0;main:for(;;){if(a_>=n_)throw new Error('x must be an increasing serie');for(;0<a_-t_;){if(r_&&(d_++,r_=!1),$b[m_]=0>=d_?0:l_/d_,m_++,m_===Hb)break main;e_=t_,t_+=Zb,l_=0,d_=0}a_>e_&&(l_+=i_,d_++),(a_==-_NumberMAX_VALUE||1<s_)&&d_--,a_=n_,i_=o_,h_<Wb?(n_=Xb[h_],o_=Ob[h_],h_++):(n_+=Kb,o_=0,s_++)}return $b}function Qe(Xb,Ob,Nb,Gb){return 0.5*Nb*Ob*Ob+Gb*Ob-(0.5*Nb*Xb*Xb+Gb*Xb)}function Je(Xb,Ob,Nb){var Gb=Nb?Xb.rows:Xb.rows-1;if(0>Ob||Ob>Gb)throw new RangeError('Row index out of range')}function $e(Xb,Ob,Nb){var Gb=Nb?Xb.columns:Xb.columns-1;if(0>Ob||Ob>Gb)throw new RangeError('Column index out of range')}function et(Xb,Ob){if(Ob.to1DArray&&(Ob=Ob.to1DArray()),Ob.length!==Xb.columns)throw new RangeError('vector size must be the same as the number of columns');return Ob}function at(Xb,Ob){if(Ob.to1DArray&&(Ob=Ob.to1DArray()),Ob.length!==Xb.rows)throw new RangeError('vector size must be the same as the number of rows');return Ob}function nt(Xb,Ob,Nb){var Gb=Ob.some((Wb)=>{return 0>Wb||Wb>=Xb.rows}),Hb=Nb.some((Wb)=>{return 0>Wb||Wb>=Xb.columns});if(Gb||Hb)throw new RangeError('Indices are out of range');if('object'!=typeof Ob||'object'!=typeof Nb)throw new TypeError('Unexpected type for row/column indices');return Array.isArray(Ob)||(Ob=Array.from(Ob)),Array.isArray(Nb)||(Ob=Array.from(Nb)),{row:Ob,column:Nb}}function ot(Xb,Ob,Nb,Gb,Hb){if(5!==arguments.length)throw new TypeError('Invalid argument type');var Wb=Array.from(arguments).slice(1).some(function(Zb){return'number'!=typeof Zb});if(Wb)throw new TypeError('Invalid argument type');if(Ob>Nb||Gb>Hb||0>Ob||Ob>=Xb.rows||0>Nb||Nb>=Xb.rows||0>Gb||Gb>=Xb.columns||0>Hb||Hb>=Xb.columns)throw new RangeError('Submatrix indices are out of range')}function st(Xb){for(var Ob=ad.zeros(Xb.rows,1),Nb=0;Nb<Xb.rows;++Nb)for(var Gb=0;Gb<Xb.columns;++Gb)Ob.set(Nb,0,Ob.get(Nb,0)+Xb.get(Nb,Gb));return Ob}function rt(Xb){for(var Ob=ad.zeros(1,Xb.columns),Nb=0;Nb<Xb.rows;++Nb)for(var Gb=0;Gb<Xb.columns;++Gb)Ob.set(0,Gb,Ob.get(0,Gb)+Xb.get(Nb,Gb));return Ob}function lt(Xb){for(var Ob=0,Nb=0;Nb<Xb.rows;Nb++)for(var Gb=0;Gb<Xb.columns;Gb++)Ob+=Xb.get(Nb,Gb);return Ob}function dt(Xb){function Ob(I_,P_){return I_-P_}function Nb(I_,P_){for(var C_ in P_)I_=I_.replace(new RegExp('%'+C_+'%','g'),P_[C_]);return I_}void 0===Xb&&(Xb=Object);class Gb extends Xb{static get[Symbol.species](){return this}static from1DArray(I_,P_,C_){if(I_*P_!==C_.length)throw new RangeError('Data length does not match given dimensions');for(var A_=new this(I_,P_),R_=0;R_<I_;R_++)for(var z_=0;z_<P_;z_++)A_.set(R_,z_,C_[R_*P_+z_]);return A_}static rowVector(I_){for(var P_=new this(1,I_.length),C_=0;C_<I_.length;C_++)P_.set(0,C_,I_[C_]);return P_}static columnVector(I_){for(var P_=new this(I_.length,1),C_=0;C_<I_.length;C_++)P_.set(C_,0,I_[C_]);return P_}static empty(I_,P_){return new this(I_,P_)}static zeros(I_,P_){return this.empty(I_,P_).fill(0)}static ones(I_,P_){return this.empty(I_,P_).fill(1)}static rand(I_,P_,C_){void 0===C_&&(C_=Math.random);for(var B_=this.empty(I_,P_),A_=0;A_<I_;A_++)for(var R_=0;R_<P_;R_++)B_.set(A_,R_,C_());return B_}static randInt(I_,P_,C_,B_){void 0===C_&&(C_=1e3),void 0===B_&&(B_=Math.random);for(var A_=this.empty(I_,P_),R_=0;R_<I_;R_++)for(var z_=0,L_;z_<P_;z_++)L_=_Mathfloor(B_()*C_),A_.set(R_,z_,L_);return A_}static eye(I_,P_,C_){void 0===P_&&(P_=I_),void 0===C_&&(C_=1);for(var B_=_Mathmin(I_,P_),A_=this.zeros(I_,P_),R_=0;R_<B_;R_++)A_.set(R_,R_,C_);return A_}static diag(I_,P_,C_){var B_=I_.length;void 0===P_&&(P_=B_),void 0===C_&&(C_=P_);for(var A_=_Mathmin(B_,P_,C_),R_=this.zeros(P_,C_),z_=0;z_<A_;z_++)R_.set(z_,z_,I_[z_]);return R_}static min(I_,P_){I_=this.checkMatrix(I_),P_=this.checkMatrix(P_);for(var C_=I_.rows,B_=I_.columns,A_=new this(C_,B_),R_=0;R_<C_;R_++)for(var z_=0;z_<B_;z_++)A_.set(R_,z_,_Mathmin(I_.get(R_,z_),P_.get(R_,z_)));return A_}static max(I_,P_){I_=this.checkMatrix(I_),P_=this.checkMatrix(P_);for(var C_=I_.rows,B_=I_.columns,A_=new this(C_,B_),R_=0;R_<C_;R_++)for(var z_=0;z_<B_;z_++)A_.set(R_,z_,_Mathmax(I_.get(R_,z_),P_.get(R_,z_)));return A_}static checkMatrix(I_){return Gb.isMatrix(I_)?I_:new this(I_)}static isMatrix(I_){return null!=I_&&'Matrix'===I_.klass}get size(){return this.rows*this.columns}apply(I_){if('function'!=typeof I_)throw new TypeError('callback must be a function');for(var P_=this.rows,C_=this.columns,B_=0;B_<P_;B_++)for(var A_=0;A_<C_;A_++)I_.call(this,B_,A_);return this}to1DArray(){for(var I_=Array(this.size),P_=0;P_<this.rows;P_++)for(var C_=0;C_<this.columns;C_++)I_[P_*this.columns+C_]=this.get(P_,C_);return I_}to2DArray(){for(var I_=Array(this.rows),P_=0;P_<this.rows;P_++){I_[P_]=Array(this.columns);for(var C_=0;C_<this.columns;C_++)I_[P_][C_]=this.get(P_,C_)}return I_}isRowVector(){return 1===this.rows}isColumnVector(){return 1===this.columns}isVector(){return 1===this.rows||1===this.columns}isSquare(){return this.rows===this.columns}isSymmetric(){if(this.isSquare()){for(var I_=0;I_<this.rows;I_++)for(var P_=0;P_<=I_;P_++)if(this.get(I_,P_)!==this.get(P_,I_))return!1;return!0}return!1}set(){throw new Error('set method is unimplemented')}get(){throw new Error('get method is unimplemented')}repeat(I_,P_){I_=I_||1,P_=P_||1;for(var C_=new this.constructor[Symbol.species](this.rows*I_,this.columns*P_),B_=0;B_<I_;B_++)for(var A_=0;A_<P_;A_++)C_.setSubMatrix(this,this.rows*B_,this.columns*A_);return C_}fill(I_){for(var P_=0;P_<this.rows;P_++)for(var C_=0;C_<this.columns;C_++)this.set(P_,C_,I_);return this}neg(){return this.mulS(-1)}getRow(I_){Je(this,I_);for(var P_=Array(this.columns),C_=0;C_<this.columns;C_++)P_[C_]=this.get(I_,C_);return P_}getRowVector(I_){return this.constructor.rowVector(this.getRow(I_))}setRow(I_,P_){Je(this,I_),P_=et(this,P_);for(var C_=0;C_<this.columns;C_++)this.set(I_,C_,P_[C_]);return this}swapRows(I_,P_){Je(this,I_),Je(this,P_);for(var C_=0,B_;C_<this.columns;C_++)B_=this.get(I_,C_),this.set(I_,C_,this.get(P_,C_)),this.set(P_,C_,B_);return this}getColumn(I_){$e(this,I_);for(var P_=Array(this.rows),C_=0;C_<this.rows;C_++)P_[C_]=this.get(C_,I_);return P_}getColumnVector(I_){return this.constructor.columnVector(this.getColumn(I_))}setColumn(I_,P_){$e(this,I_),P_=at(this,P_);for(var C_=0;C_<this.rows;C_++)this.set(C_,I_,P_[C_]);return this}swapColumns(I_,P_){$e(this,I_),$e(this,P_);for(var C_=0,B_;C_<this.rows;C_++)B_=this.get(C_,I_),this.set(C_,I_,this.get(C_,P_)),this.set(C_,P_,B_);return this}addRowVector(I_){I_=et(this,I_);for(var P_=0;P_<this.rows;P_++)for(var C_=0;C_<this.columns;C_++)this.set(P_,C_,this.get(P_,C_)+I_[C_]);return this}subRowVector(I_){I_=et(this,I_);for(var P_=0;P_<this.rows;P_++)for(var C_=0;C_<this.columns;C_++)this.set(P_,C_,this.get(P_,C_)-I_[C_]);return this}mulRowVector(I_){I_=et(this,I_);for(var P_=0;P_<this.rows;P_++)for(var C_=0;C_<this.columns;C_++)this.set(P_,C_,this.get(P_,C_)*I_[C_]);return this}divRowVector(I_){I_=et(this,I_);for(var P_=0;P_<this.rows;P_++)for(var C_=0;C_<this.columns;C_++)this.set(P_,C_,this.get(P_,C_)/I_[C_]);return this}addColumnVector(I_){I_=at(this,I_);for(var P_=0;P_<this.rows;P_++)for(var C_=0;C_<this.columns;C_++)this.set(P_,C_,this.get(P_,C_)+I_[P_]);return this}subColumnVector(I_){I_=at(this,I_);for(var P_=0;P_<this.rows;P_++)for(var C_=0;C_<this.columns;C_++)this.set(P_,C_,this.get(P_,C_)-I_[P_]);return this}mulColumnVector(I_){I_=at(this,I_);for(var P_=0;P_<this.rows;P_++)for(var C_=0;C_<this.columns;C_++)this.set(P_,C_,this.get(P_,C_)*I_[P_]);return this}divColumnVector(I_){I_=at(this,I_);for(var P_=0;P_<this.rows;P_++)for(var C_=0;C_<this.columns;C_++)this.set(P_,C_,this.get(P_,C_)/I_[P_]);return this}mulRow(I_,P_){Je(this,I_);for(var C_=0;C_<this.columns;C_++)this.set(I_,C_,this.get(I_,C_)*P_);return this}mulColumn(I_,P_){$e(this,I_);for(var C_=0;C_<this.rows;C_++)this.set(C_,I_,this.get(C_,I_)*P_);return this}max(){for(var I_=this.get(0,0),P_=0;P_<this.rows;P_++)for(var C_=0;C_<this.columns;C_++)this.get(P_,C_)>I_&&(I_=this.get(P_,C_));return I_}maxIndex(){for(var I_=this.get(0,0),P_=[0,0],C_=0;C_<this.rows;C_++)for(var B_=0;B_<this.columns;B_++)this.get(C_,B_)>I_&&(I_=this.get(C_,B_),P_[0]=C_,P_[1]=B_);return P_}min(){for(var I_=this.get(0,0),P_=0;P_<this.rows;P_++)for(var C_=0;C_<this.columns;C_++)this.get(P_,C_)<I_&&(I_=this.get(P_,C_));return I_}minIndex(){for(var I_=this.get(0,0),P_=[0,0],C_=0;C_<this.rows;C_++)for(var B_=0;B_<this.columns;B_++)this.get(C_,B_)<I_&&(I_=this.get(C_,B_),P_[0]=C_,P_[1]=B_);return P_}maxRow(I_){Je(this,I_);for(var P_=this.get(I_,0),C_=1;C_<this.columns;C_++)this.get(I_,C_)>P_&&(P_=this.get(I_,C_));return P_}maxRowIndex(I_){Je(this,I_);for(var P_=this.get(I_,0),C_=[I_,0],B_=1;B_<this.columns;B_++)this.get(I_,B_)>P_&&(P_=this.get(I_,B_),C_[1]=B_);return C_}minRow(I_){Je(this,I_);for(var P_=this.get(I_,0),C_=1;C_<this.columns;C_++)this.get(I_,C_)<P_&&(P_=this.get(I_,C_));return P_}minRowIndex(I_){Je(this,I_);for(var P_=this.get(I_,0),C_=[I_,0],B_=1;B_<this.columns;B_++)this.get(I_,B_)<P_&&(P_=this.get(I_,B_),C_[1]=B_);return C_}maxColumn(I_){$e(this,I_);for(var P_=this.get(0,I_),C_=1;C_<this.rows;C_++)this.get(C_,I_)>P_&&(P_=this.get(C_,I_));return P_}maxColumnIndex(I_){$e(this,I_);for(var P_=this.get(0,I_),C_=[0,I_],B_=1;B_<this.rows;B_++)this.get(B_,I_)>P_&&(P_=this.get(B_,I_),C_[0]=B_);return C_}minColumn(I_){$e(this,I_);for(var P_=this.get(0,I_),C_=1;C_<this.rows;C_++)this.get(C_,I_)<P_&&(P_=this.get(C_,I_));return P_}minColumnIndex(I_){$e(this,I_);for(var P_=this.get(0,I_),C_=[0,I_],B_=1;B_<this.rows;B_++)this.get(B_,I_)<P_&&(P_=this.get(B_,I_),C_[0]=B_);return C_}diag(){for(var I_=_Mathmin(this.rows,this.columns),P_=Array(I_),C_=0;C_<I_;C_++)P_[C_]=this.get(C_,C_);return P_}sum(I_){return'row'===I_?st(this):'column'===I_?rt(this):lt(this)}mean(){return this.sum()/this.size}prod(){for(var I_=1,P_=0;P_<this.rows;P_++)for(var C_=0;C_<this.columns;C_++)I_*=this.get(P_,C_);return I_}cumulativeSum(){for(var I_=0,P_=0;P_<this.rows;P_++)for(var C_=0;C_<this.columns;C_++)I_+=this.get(P_,C_),this.set(P_,C_,I_);return this}dot(I_){Gb.isMatrix(I_)&&(I_=I_.to1DArray());var P_=this.to1DArray();if(P_.length!==I_.length)throw new RangeError('vectors do not have the same size');for(var C_=0,B_=0;B_<P_.length;B_++)C_+=P_[B_]*I_[B_];return C_}mmul(I_){I_=this.constructor.checkMatrix(I_),this.columns!==I_.rows&&console.warn('Number of columns of left matrix are not equal to number of rows of right matrix.');for(var P_=this.rows,C_=this.columns,B_=I_.columns,A_=new this.constructor[Symbol.species](P_,B_),R_=Array(C_),z_=0;z_<B_;z_++){for(var L_=0;L_<C_;L_++)R_[L_]=I_.get(L_,z_);for(var E_=0,T_;E_<P_;E_++){for(T_=0,L_=0;L_<C_;L_++)T_+=this.get(E_,L_)*R_[L_];A_.set(E_,z_,T_)}}return A_}strassen2x2(I_){var P_=new this.constructor[Symbol.species](2,2);const C_=this.get(0,0),B_=I_.get(0,0),A_=this.get(0,1),R_=I_.get(0,1),z_=this.get(1,0),L_=I_.get(1,0),E_=this.get(1,1),T_=I_.get(1,1),V_=(C_+E_)*(B_+T_),Y_=(z_+E_)*B_,F_=C_*(R_-T_),U_=E_*(L_-B_),q_=(C_+A_)*T_;return P_.set(0,0,V_+U_-q_+(A_-E_)*(L_+T_)),P_.set(0,1,F_+q_),P_.set(1,0,Y_+U_),P_.set(1,1,V_-Y_+F_+(z_-C_)*(B_+R_)),P_}strassen3x3(I_){var P_=new this.constructor[Symbol.species](3,3);const C_=this.get(0,0),B_=this.get(0,1),A_=this.get(0,2),R_=this.get(1,0),z_=this.get(1,1),L_=this.get(1,2),E_=this.get(2,0),T_=this.get(2,1),V_=this.get(2,2),Y_=I_.get(0,0),F_=I_.get(0,1),U_=I_.get(0,2),q_=I_.get(1,0),X_=I_.get(1,1),O_=I_.get(1,2),N_=I_.get(2,0),G_=I_.get(2,1),H_=I_.get(2,2),Z_=(C_-R_)*(-F_+X_),K_=(-C_+R_+z_)*(Y_-F_+X_),J_=(R_+z_)*(-Y_+F_),$_=C_*Y_,ew=(-C_+E_+T_)*(Y_-U_+O_),tw=(-C_+E_)*(U_-O_),aw=(E_+T_)*(-Y_+U_),ow=(-A_+T_+V_)*(X_+N_-G_),sw=(A_-V_)*(X_-G_),rw=A_*N_,lw=(T_+V_)*(-N_+G_),dw=(-A_+z_+L_)*(O_+N_-H_),hw=(A_-L_)*(O_-H_),mw=(z_+L_)*(-N_+H_);return P_.set(0,0,$_+rw+B_*q_),P_.set(0,1,(C_+B_+A_-R_-z_-T_-V_)*X_+K_+J_+$_+ow+rw+lw),P_.set(0,2,$_+ew+aw+(C_+B_+A_-z_-L_-E_-T_)*O_+rw+dw+mw),P_.set(1,0,Z_+z_*(-Y_+F_+q_-X_-O_-N_+H_)+K_+$_+rw+dw+hw),P_.set(1,1,Z_+K_+J_+$_+L_*G_),P_.set(1,2,rw+dw+hw+mw+R_*U_),P_.set(2,0,$_+ew+tw+T_*(-Y_+U_+q_-X_-O_-N_+G_)+ow+sw+rw),P_.set(2,1,ow+sw+rw+lw+E_*F_),P_.set(2,2,$_+ew+tw+aw+V_*H_),P_}mmulStrassen(I_){function P_(V_,Y_,F_){var U_=V_.rows,q_=V_.columns;if(U_===Y_&&q_===F_)return V_;var X_=Gb.zeros(Y_,F_);return X_=X_.setSubMatrix(V_,0,0),X_}function C_(V_,Y_,F_,U_){if(512>=F_||512>=U_)return V_.mmul(Y_);1==F_%2&&1==U_%2?(V_=P_(V_,F_+1,U_+1),Y_=P_(Y_,F_+1,U_+1)):1==F_%2?(V_=P_(V_,F_+1,U_),Y_=P_(Y_,F_+1,U_)):1==U_%2&&(V_=P_(V_,F_,U_+1),Y_=P_(Y_,F_,U_+1));var q_=parseInt(V_.rows/2),X_=parseInt(V_.columns/2),O_=V_.subMatrix(0,q_-1,0,X_-1),N_=Y_.subMatrix(0,q_-1,0,X_-1),G_=V_.subMatrix(0,q_-1,X_,V_.columns-1),H_=Y_.subMatrix(0,q_-1,X_,Y_.columns-1),W_=V_.subMatrix(q_,V_.rows-1,0,X_-1),Z_=Y_.subMatrix(q_,Y_.rows-1,0,X_-1),Q_=V_.subMatrix(q_,V_.rows-1,X_,V_.columns-1),K_=Y_.subMatrix(q_,Y_.rows-1,X_,Y_.columns-1),J_=C_(Gb.add(O_,Q_),Gb.add(N_,K_),q_,X_),$_=C_(Gb.add(W_,Q_),N_,q_,X_),ew=C_(O_,Gb.sub(H_,K_),q_,X_),tw=C_(Q_,Gb.sub(Z_,N_),q_,X_),aw=C_(Gb.add(O_,G_),K_,q_,X_),iw=C_(Gb.sub(W_,O_),Gb.add(N_,H_),q_,X_),nw=C_(Gb.sub(G_,Q_),Gb.add(Z_,K_),q_,X_),ow=Gb.add(J_,tw);ow.sub(aw),ow.add(nw);var sw=Gb.add(ew,aw),rw=Gb.add($_,tw),lw=Gb.sub(J_,$_);lw.add(ew),lw.add(iw);var dw=Gb.zeros(2*ow.rows,2*ow.columns);return dw=dw.setSubMatrix(ow,0,0),dw=dw.setSubMatrix(sw,ow.rows,0),dw=dw.setSubMatrix(rw,0,ow.columns),dw=dw.setSubMatrix(lw,ow.rows,ow.columns),dw.subMatrix(0,F_-1,0,U_-1)}var B_=this.clone(),A_=B_.rows,R_=B_.columns,z_=I_.rows,L_=I_.columns;R_!==z_&&console.warn(`Multiplying ${A_} x ${R_} and ${z_} x ${L_} matrix: dimensions do not match.`);var E_=_Mathmax(A_,z_),T_=_Mathmax(R_,L_);return B_=P_(B_,E_,T_),I_=P_(I_,E_,T_),C_(B_,I_,E_,T_)}scaleRows(I_,P_){if(I_=void 0===I_?0:I_,P_=void 0===P_?1:P_,I_>=P_)throw new RangeError('min should be strictly smaller than max');for(var C_=this.constructor.empty(this.rows,this.columns),B_=0,A_;B_<this.rows;B_++)A_=Hl(this.getRow(B_),{min:I_,max:P_}),C_.setRow(B_,A_);return C_}scaleColumns(I_,P_){if(I_=void 0===I_?0:I_,P_=void 0===P_?1:P_,I_>=P_)throw new RangeError('min should be strictly smaller than max');for(var C_=this.constructor.empty(this.rows,this.columns),B_=0,A_;B_<this.columns;B_++)A_=Hl(this.getColumn(B_),{min:I_,max:P_}),C_.setColumn(B_,A_);return C_}kroneckerProduct(I_){I_=this.constructor.checkMatrix(I_);for(var P_=this.rows,C_=this.columns,B_=I_.rows,A_=I_.columns,R_=new this.constructor[Symbol.species](P_*B_,C_*A_),z_=0;z_<P_;z_++)for(var L_=0;L_<C_;L_++)for(var E_=0;E_<B_;E_++)for(var T_=0;T_<A_;T_++)R_[B_*z_+E_][A_*L_+T_]=this.get(z_,L_)*I_.get(E_,T_);return R_}transpose(){for(var I_=new this.constructor[Symbol.species](this.columns,this.rows),P_=0;P_<this.rows;P_++)for(var C_=0;C_<this.columns;C_++)I_.set(C_,P_,this.get(P_,C_));return I_}sortRows(I_){void 0===I_&&(I_=Ob);for(var P_=0;P_<this.rows;P_++)this.setRow(P_,this.getRow(P_).sort(I_));return this}sortColumns(I_){void 0===I_&&(I_=Ob);for(var P_=0;P_<this.columns;P_++)this.setColumn(P_,this.getColumn(P_).sort(I_));return this}subMatrix(I_,P_,C_,B_){ot(this,I_,P_,C_,B_);for(var A_=new this.constructor[Symbol.species](P_-I_+1,B_-C_+1),R_=I_;R_<=P_;R_++)for(var z_=C_;z_<=B_;z_++)A_[R_-I_][z_-C_]=this.get(R_,z_);return A_}subMatrixRow(I_,P_,C_){if(void 0===P_&&(P_=0),void 0===C_&&(C_=this.columns-1),P_>C_||0>P_||P_>=this.columns||0>C_||C_>=this.columns)throw new RangeError('Argument out of range');for(var B_=new this.constructor[Symbol.species](I_.length,C_-P_+1),A_=0;A_<I_.length;A_++)for(var R_=P_;R_<=C_;R_++){if(0>I_[A_]||I_[A_]>=this.rows)throw new RangeError('Row index out of range: '+I_[A_]);B_.set(A_,R_-P_,this.get(I_[A_],R_))}return B_}subMatrixColumn(I_,P_,C_){if(void 0===P_&&(P_=0),void 0===C_&&(C_=this.rows-1),P_>C_||0>P_||P_>=this.rows||0>C_||C_>=this.rows)throw new RangeError('Argument out of range');for(var B_=new this.constructor[Symbol.species](C_-P_+1,I_.length),A_=0;A_<I_.length;A_++)for(var R_=P_;R_<=C_;R_++){if(0>I_[A_]||I_[A_]>=this.columns)throw new RangeError('Column index out of range: '+I_[A_]);B_.set(R_-P_,A_,this.get(R_,I_[A_]))}return B_}setSubMatrix(I_,P_,C_){I_=this.constructor.checkMatrix(I_);var B_=P_+I_.rows-1,A_=C_+I_.columns-1;ot(this,P_,B_,C_,A_);for(var R_=0;R_<I_.rows;R_++)for(var z_=0;z_<I_.columns;z_++)this[P_+R_][C_+z_]=I_.get(R_,z_);return this}selection(I_,P_){for(var C_=nt(this,I_,P_),B_=new this.constructor[Symbol.species](I_.length,P_.length),A_=0,R_;A_<C_.row.length;A_++){R_=C_.row[A_];for(var z_=0,L_;z_<C_.column.length;z_++)L_=C_.column[z_],B_[A_][z_]=this.get(R_,L_)}return B_}trace(){for(var I_=_Mathmin(this.rows,this.columns),P_=0,C_=0;C_<I_;C_++)P_+=this.get(C_,C_);return P_}transposeView(){return new Zl(this)}rowView(I_){return Je(this,I_),new Ql(this,I_)}columnView(I_){return $e(this,I_),new $l(this,I_)}flipRowView(){return new ed(this)}flipColumnView(){return new td(this)}subMatrixView(I_,P_,C_,B_){return new Kl(this,I_,P_,C_,B_)}selectionView(I_,P_){return new Jl(this,I_,P_)}det(){if(this.isSquare()){var I_,P_,C_,B_;if(2===this.columns)return I_=this.get(0,0),P_=this.get(0,1),C_=this.get(1,0),B_=this.get(1,1),I_*B_-P_*C_;if(3===this.columns){var A_,R_,z_;return A_=this.selectionView([1,2],[1,2]),R_=this.selectionView([1,2],[0,2]),z_=this.selectionView([1,2],[0,1]),I_=this.get(0,0),P_=this.get(0,1),C_=this.get(0,2),I_*A_.det()-P_*R_.det()+C_*z_.det()}return new Ee(this).determinant}throw Error('Determinant can only be calculated for a square matrix.')}pseudoInverse(I_){void 0===I_&&(I_=_NumberEPSILON);for(var P_=new Ye(this,{autoTranspose:!0}),C_=P_.leftSingularVectors,B_=P_.rightSingularVectors,A_=P_.diagonal,R_=0;R_<A_.length;R_++)A_[R_]=_Mathabs(A_[R_])>I_?1/A_[R_]:0;return A_=this.constructor[Symbol.species].diag(A_),B_.mmul(A_.mmul(C_.transposeView()))}}Gb.prototype.klass='Matrix',Gb.random=Gb.rand,Gb.diagonal=Gb.diag,Gb.prototype.diagonal=Gb.prototype.diag,Gb.identity=Gb.eye,Gb.prototype.negate=Gb.prototype.neg,Gb.prototype.tensorProduct=Gb.prototype.kroneckerProduct,Gb.prototype.determinant=Gb.prototype.det;var Hb=`
(function %name%(value) {
    if (typeof value === 'number') return this.%name%S(value);
    return this.%name%M(value);
})
`,Wb=`
(function %name%S(value) {
    for (var i = 0; i < this.rows; i++) {
        for (var j = 0; j < this.columns; j++) {
            this.set(i, j, this.get(i, j) %op% value);
        }
    }
    return this;
})
`,Zb=`
(function %name%M(matrix) {
    matrix = this.constructor.checkMatrix(matrix);
    if (this.rows !== matrix.rows ||
        this.columns !== matrix.columns) {
        throw new RangeError('Matrices dimensions must be equal');
    }
    for (var i = 0; i < this.rows; i++) {
        for (var j = 0; j < this.columns; j++) {
            this.set(i, j, this.get(i, j) %op% matrix.get(i, j));
        }
    }
    return this;
})
`,Qb=`
(function %name%(matrix, value) {
    var newMatrix = new this[Symbol.species](matrix);
    return newMatrix.%name%(value);
})
`,Kb=`
(function %name%() {
    for (var i = 0; i < this.rows; i++) {
        for (var j = 0; j < this.columns; j++) {
            this.set(i, j, %method%(this.get(i, j)));
        }
    }
    return this;
})
`,Jb=`
(function %name%(matrix) {
    var newMatrix = new this[Symbol.species](matrix);
    return newMatrix.%name%();
})
`,$b=`
(function %name%(%args%) {
    for (var i = 0; i < this.rows; i++) {
        for (var j = 0; j < this.columns; j++) {
            this.set(i, j, %method%(this.get(i, j), %args%));
        }
    }
    return this;
})
`,e_=`
(function %name%(matrix, %args%) {
    var newMatrix = new this[Symbol.species](matrix);
    return newMatrix.%name%(%args%);
})
`,t_=`
(function %name%S(value) {
    for (var i = 0; i < this.rows; i++) {
        for (var j = 0; j < this.columns; j++) {
            this.set(i, j, %method%(this.get(i, j), value));
        }
    }
    return this;
})
`,a_=`
(function %name%M(matrix) {
    matrix = this.constructor.checkMatrix(matrix);
    if (this.rows !== matrix.rows ||
        this.columns !== matrix.columns) {
        throw new RangeError('Matrices dimensions must be equal');
    }
    for (var i = 0; i < this.rows; i++) {
        for (var j = 0; j < this.columns; j++) {
            this.set(i, j, %method%(this.get(i, j), matrix.get(i, j)));
        }
    }
    return this;
})
`,i_=`
(function %name%(value) {
    if (typeof value === 'number') return this.%name%S(value);
    return this.%name%M(value);
})
`,o_=[['+','add'],['-','sub','subtract'],['*','mul','multiply'],['/','div','divide'],['%','mod','modulus'],['&','and'],['|','or'],['^','xor'],['<<','leftShift'],['>>','signPropagatingRightShift'],['>>>','rightShift','zeroFillRightShift']],r_=eval,s_;for(var l_ of o_){var d_=r_(Nb(Hb,{name:l_[1],op:l_[0]})),h_=r_(Nb(Wb,{name:l_[1]+'S',op:l_[0]})),m_=r_(Nb(Zb,{name:l_[1]+'M',op:l_[0]})),g_=r_(Nb(Qb,{name:l_[1]}));for(s_=1;s_<l_.length;s_++)Gb.prototype[l_[s_]]=d_,Gb.prototype[l_[s_]+'S']=h_,Gb.prototype[l_[s_]+'M']=m_,Gb[l_[s_]]=g_}var c_=[['~','not']];['abs','acos','acosh','asin','asinh','atan','atanh','cbrt','ceil','clz32','cos','cosh','exp','expm1','floor','fround','log','log1p','log10','log2','round','sign','sin','sinh','sqrt','tan','tanh','trunc'].forEach(function(I_){c_.push(['Math.'+I_,I_])});for(var u_ of c_){var p_=r_(Nb(Kb,{name:u_[1],method:u_[0]})),f_=r_(Nb(Jb,{name:u_[1]}));for(s_=1;s_<u_.length;s_++)Gb.prototype[u_[s_]]=p_,Gb[u_[s_]]=f_}var b_=[['Math.pow',1,'pow']];for(var w_ of b_){var x_='arg0';for(s_=1;s_<w_[1];s_++)x_+=`, arg${s_}`;if(1!==w_[1]){var y_=r_(Nb($b,{name:w_[2],method:w_[0],args:x_})),k_=r_(Nb(e_,{name:w_[2],args:x_}));for(s_=2;s_<w_.length;s_++)Gb.prototype[w_[s_]]=y_,Gb[w_[s_]]=k_}else{var v_={name:w_[2],args:x_,method:w_[0]},D_=r_(Nb(i_,v_)),j_=r_(Nb(t_,v_)),M_=r_(Nb(a_,v_)),S_=r_(Nb(e_,v_));for(s_=2;s_<w_.length;s_++)Gb.prototype[w_[s_]]=D_,Gb.prototype[w_[s_]+'M']=M_,Gb.prototype[w_[s_]+'S']=j_,Gb[w_[s_]]=S_}}return Gb}function ht(Xb){if(!(this instanceof ht))return new ht(Xb);Xb=ad.checkMatrix(Xb);var Ob=Xb.clone(),Nb=Xb.rows,Gb=Xb.columns,Hb=Array(Gb),Wb,Zb,Qb,Kb;for(Qb=0;Qb<Gb;Qb++){var Jb=0;for(Wb=Qb;Wb<Nb;Wb++)Jb=Te(Jb,Ob[Wb][Qb]);if(0!==Jb){for(0>Ob[Qb][Qb]&&(Jb=-Jb),Wb=Qb;Wb<Nb;Wb++)Ob[Wb][Qb]/=Jb;for(Ob[Qb][Qb]+=1,Zb=Qb+1;Zb<Gb;Zb++){for(Kb=0,Wb=Qb;Wb<Nb;Wb++)Kb+=Ob[Wb][Qb]*Ob[Wb][Zb];for(Kb=-Kb/Ob[Qb][Qb],Wb=Qb;Wb<Nb;Wb++)Ob[Wb][Zb]+=Kb*Ob[Wb][Qb]}}Hb[Qb]=-Jb}this.QR=Ob,this.Rdiag=Hb}function gt(Xb,Ob){return Xb=ad.checkMatrix(Xb),Ob=ad.checkMatrix(Ob),Xb.isSquare()?new Ee(Xb).solve(Ob):new ht(Xb).solve(Ob)}function ct(Xb,Ob){if(Ob=Object.assign({},nd,Ob),!(this instanceof ct))return new ct(Xb,Ob);if(Xb=ad.checkMatrix(Xb),!Xb.isSquare())throw new Error('Matrix is not a square matrix');var Nb=Xb.columns,Gb=Ve(Nb,Nb,0),Hb=Array(Nb),Wb=Array(Nb),Zb=Xb,Jb=!1,Qb,Kb;if(Jb=!!Ob.assumeSymmetric||Xb.isSymmetric(),Jb){for(Qb=0;Qb<Nb;Qb++)for(Kb=0;Kb<Nb;Kb++)Gb[Qb][Kb]=Zb.get(Qb,Kb);ut(Nb,Wb,Hb,Gb),pt(Nb,Wb,Hb,Gb)}else{var $b=Ve(Nb,Nb,0),e_=Array(Nb);for(Kb=0;Kb<Nb;Kb++)for(Qb=0;Qb<Nb;Qb++)$b[Qb][Kb]=Zb.get(Qb,Kb);bt(Nb,$b,e_,Gb),_t(Nb,Wb,Hb,Gb,$b)}this.n=Nb,this.e=Wb,this.d=Hb,this.V=Gb}function ut(Xb,Ob,Nb,Gb){var Hb,Wb,Zb,Qb,Kb,Jb,$b,e_;for(Kb=0;Kb<Xb;Kb++)Nb[Kb]=Gb[Xb-1][Kb];for(Qb=Xb-1;0<Qb;Qb--){for(e_=0,Zb=0,Jb=0;Jb<Qb;Jb++)e_+=_Mathabs(Nb[Jb]);if(0===e_)for(Ob[Qb]=Nb[Qb-1],Kb=0;Kb<Qb;Kb++)Nb[Kb]=Gb[Qb-1][Kb],Gb[Qb][Kb]=0,Gb[Kb][Qb]=0;else{for(Jb=0;Jb<Qb;Jb++)Nb[Jb]/=e_,Zb+=Nb[Jb]*Nb[Jb];for(Hb=Nb[Qb-1],Wb=_Mathsqrt(Zb),0<Hb&&(Wb=-Wb),Ob[Qb]=e_*Wb,Zb-=Hb*Wb,Nb[Qb-1]=Hb-Wb,Kb=0;Kb<Qb;Kb++)Ob[Kb]=0;for(Kb=0;Kb<Qb;Kb++){for(Hb=Nb[Kb],Gb[Kb][Qb]=Hb,Wb=Ob[Kb]+Gb[Kb][Kb]*Hb,Jb=Kb+1;Jb<=Qb-1;Jb++)Wb+=Gb[Jb][Kb]*Nb[Jb],Ob[Jb]+=Gb[Jb][Kb]*Hb;Ob[Kb]=Wb}for(Hb=0,Kb=0;Kb<Qb;Kb++)Ob[Kb]/=Zb,Hb+=Ob[Kb]*Nb[Kb];for($b=Hb/(Zb+Zb),Kb=0;Kb<Qb;Kb++)Ob[Kb]-=$b*Nb[Kb];for(Kb=0;Kb<Qb;Kb++){for(Hb=Nb[Kb],Wb=Ob[Kb],Jb=Kb;Jb<=Qb-1;Jb++)Gb[Jb][Kb]-=Hb*Ob[Jb]+Wb*Nb[Jb];Nb[Kb]=Gb[Qb-1][Kb],Gb[Qb][Kb]=0}}Nb[Qb]=Zb}for(Qb=0;Qb<Xb-1;Qb++){if(Gb[Xb-1][Qb]=Gb[Qb][Qb],Gb[Qb][Qb]=1,Zb=Nb[Qb+1],0!==Zb){for(Jb=0;Jb<=Qb;Jb++)Nb[Jb]=Gb[Jb][Qb+1]/Zb;for(Kb=0;Kb<=Qb;Kb++){for(Wb=0,Jb=0;Jb<=Qb;Jb++)Wb+=Gb[Jb][Qb+1]*Gb[Jb][Kb];for(Jb=0;Jb<=Qb;Jb++)Gb[Jb][Kb]-=Wb*Nb[Jb]}}for(Jb=0;Jb<=Qb;Jb++)Gb[Jb][Qb+1]=0}for(Kb=0;Kb<Xb;Kb++)Nb[Kb]=Gb[Xb-1][Kb],Gb[Xb-1][Kb]=0;Gb[Xb-1][Xb-1]=1,Ob[0]=0}function pt(Xb,Ob,Nb,Gb){var Hb,Wb,Zb,Qb,Kb,Jb,$b,e_,t_,a_,i_,n_,o_,s_,r_,l_,d_;for(Zb=1;Zb<Xb;Zb++)Ob[Zb-1]=Ob[Zb];Ob[Xb-1]=0;var h_=0,m_=0,g_=2.220446049250313e-16;for(Jb=0;Jb<Xb;Jb++){for(m_=_Mathmax(m_,_Mathabs(Nb[Jb])+_Mathabs(Ob[Jb])),$b=Jb;$b<Xb&&!(_Mathabs(Ob[$b])<=g_*m_);)$b++;if($b>Jb){d_=0;do{for(++d_,Hb=Nb[Jb],e_=(Nb[Jb+1]-Hb)/(2*Ob[Jb]),t_=Te(e_,1),0>e_&&(t_=-t_),Nb[Jb]=Ob[Jb]/(e_+t_),Nb[Jb+1]=Ob[Jb]*(e_+t_),a_=Nb[Jb+1],Wb=Hb-Nb[Jb],Zb=Jb+2;Zb<Xb;Zb++)Nb[Zb]-=Wb;for(h_+=Wb,e_=Nb[$b],i_=1,n_=i_,o_=i_,s_=Ob[Jb+1],r_=0,l_=0,Zb=$b-1;Zb>=Jb;Zb--)for(o_=n_,n_=i_,l_=r_,Hb=i_*Ob[Zb],Wb=i_*e_,t_=Te(e_,Ob[Zb]),Ob[Zb+1]=r_*t_,r_=Ob[Zb]/t_,i_=e_/t_,e_=i_*Nb[Zb]-r_*Hb,Nb[Zb+1]=Wb+r_*(i_*Hb+r_*Nb[Zb]),Kb=0;Kb<Xb;Kb++)Wb=Gb[Kb][Zb+1],Gb[Kb][Zb+1]=r_*Gb[Kb][Zb]+i_*Wb,Gb[Kb][Zb]=i_*Gb[Kb][Zb]-r_*Wb;e_=-r_*l_*o_*s_*Ob[Jb]/a_,Ob[Jb]=r_*e_,Nb[Jb]=i_*e_}while(_Mathabs(Ob[Jb])>g_*m_)}Nb[Jb]+=h_,Ob[Jb]=0}for(Zb=0;Zb<Xb-1;Zb++){for(Kb=Zb,e_=Nb[Zb],Qb=Zb+1;Qb<Xb;Qb++)Nb[Qb]<e_&&(Kb=Qb,e_=Nb[Qb]);if(Kb!==Zb)for(Nb[Kb]=Nb[Zb],Nb[Zb]=e_,Qb=0;Qb<Xb;Qb++)e_=Gb[Qb][Zb],Gb[Qb][Zb]=Gb[Qb][Kb],Gb[Qb][Kb]=e_}}function bt(Xb,Ob,Nb,Gb){var Hb=0,Wb=Xb-1,Zb,Qb,Kb,Jb,$b,e_,t_;for(e_=Hb+1;e_<=Wb-1;e_++){for(t_=0,Jb=e_;Jb<=Wb;Jb++)t_+=_Mathabs(Ob[Jb][e_-1]);if(0!==t_){for(Kb=0,Jb=Wb;Jb>=e_;Jb--)Nb[Jb]=Ob[Jb][e_-1]/t_,Kb+=Nb[Jb]*Nb[Jb];for(Qb=_Mathsqrt(Kb),0<Nb[e_]&&(Qb=-Qb),Kb-=Nb[e_]*Qb,Nb[e_]-=Qb,$b=e_;$b<Xb;$b++){for(Zb=0,Jb=Wb;Jb>=e_;Jb--)Zb+=Nb[Jb]*Ob[Jb][$b];for(Zb/=Kb,Jb=e_;Jb<=Wb;Jb++)Ob[Jb][$b]-=Zb*Nb[Jb]}for(Jb=0;Jb<=Wb;Jb++){for(Zb=0,$b=Wb;$b>=e_;$b--)Zb+=Nb[$b]*Ob[Jb][$b];for(Zb/=Kb,$b=e_;$b<=Wb;$b++)Ob[Jb][$b]-=Zb*Nb[$b]}Nb[e_]=t_*Nb[e_],Ob[e_][e_-1]=t_*Qb}}for(Jb=0;Jb<Xb;Jb++)for($b=0;$b<Xb;$b++)Gb[Jb][$b]=Jb===$b?1:0;for(e_=Wb-1;e_>=Hb+1;e_--)if(0!==Ob[e_][e_-1]){for(Jb=e_+1;Jb<=Wb;Jb++)Nb[Jb]=Ob[Jb][e_-1];for($b=e_;$b<=Wb;$b++){for(Qb=0,Jb=e_;Jb<=Wb;Jb++)Qb+=Nb[Jb]*Gb[Jb][$b];for(Qb=Qb/Nb[e_]/Ob[e_][e_-1],Jb=e_;Jb<=Wb;Jb++)Gb[Jb][$b]+=Qb*Nb[Jb]}}}function _t(Xb,Ob,Nb,Gb,Hb){var Wb=Xb-1,Zb=0,Qb=Xb-1,Kb=2.220446049250313e-16,Jb=0,$b=0,e_=0,t_=0,a_=0,i_=0,n_=0,o_=0,s_,r_,l_,d_,h_,m_,g_,c_,u_,p_,f_,b_,w_,x_,y_;for(s_=0;s_<Xb;s_++)for((s_<Zb||s_>Qb)&&(Nb[s_]=Hb[s_][s_],Ob[s_]=0),r_=_Mathmax(s_-1,0);r_<Xb;r_++)$b+=_Mathabs(Hb[s_][r_]);for(;Wb>=Zb;){for(d_=Wb;d_>Zb&&(i_=_Mathabs(Hb[d_-1][d_-1])+_Mathabs(Hb[d_][d_]),0===i_&&(i_=$b),!(_Mathabs(Hb[d_][d_-1])<Kb*i_));)d_--;if(d_===Wb)Hb[Wb][Wb]+=Jb,Nb[Wb]=Hb[Wb][Wb],Ob[Wb]=0,Wb--,o_=0;else if(d_===Wb-1){if(g_=Hb[Wb][Wb-1]*Hb[Wb-1][Wb],e_=(Hb[Wb-1][Wb-1]-Hb[Wb][Wb])/2,t_=e_*e_+g_,n_=_Mathsqrt(_Mathabs(t_)),Hb[Wb][Wb]+=Jb,Hb[Wb-1][Wb-1]=Hb[Wb-1][Wb-1]+Jb,c_=Hb[Wb][Wb],0<=t_){for(n_=0<=e_?e_+n_:e_-n_,Nb[Wb-1]=c_+n_,Nb[Wb]=Nb[Wb-1],0!==n_&&(Nb[Wb]=c_-g_/n_),Ob[Wb-1]=0,Ob[Wb]=0,c_=Hb[Wb][Wb-1],i_=_Mathabs(c_)+_Mathabs(n_),e_=c_/i_,t_=n_/i_,a_=_Mathsqrt(e_*e_+t_*t_),e_/=a_,t_/=a_,r_=Wb-1;r_<Xb;r_++)n_=Hb[Wb-1][r_],Hb[Wb-1][r_]=t_*n_+e_*Hb[Wb][r_],Hb[Wb][r_]=t_*Hb[Wb][r_]-e_*n_;for(s_=0;s_<=Wb;s_++)n_=Hb[s_][Wb-1],Hb[s_][Wb-1]=t_*n_+e_*Hb[s_][Wb],Hb[s_][Wb]=t_*Hb[s_][Wb]-e_*n_;for(s_=Zb;s_<=Qb;s_++)n_=Gb[s_][Wb-1],Gb[s_][Wb-1]=t_*n_+e_*Gb[s_][Wb],Gb[s_][Wb]=t_*Gb[s_][Wb]-e_*n_}else Nb[Wb-1]=c_+e_,Nb[Wb]=c_+e_,Ob[Wb-1]=n_,Ob[Wb]=-n_;Wb-=2,o_=0}else{if(c_=Hb[Wb][Wb],u_=0,g_=0,d_<Wb&&(u_=Hb[Wb-1][Wb-1],g_=Hb[Wb][Wb-1]*Hb[Wb-1][Wb]),10==o_){for(Jb+=c_,s_=Zb;s_<=Wb;s_++)Hb[s_][s_]-=c_;i_=_Mathabs(Hb[Wb][Wb-1])+_Mathabs(Hb[Wb-1][Wb-2]),c_=u_=0.75*i_,g_=-0.4375*i_*i_}if(30==o_&&(i_=(u_-c_)/2,i_=i_*i_+g_,0<i_)){for(i_=_Mathsqrt(i_),u_<c_&&(i_=-i_),i_=c_-g_/((u_-c_)/2+i_),s_=Zb;s_<=Wb;s_++)Hb[s_][s_]-=i_;Jb+=i_,c_=u_=g_=0.964}for(++o_,h_=Wb-2;h_>=d_&&(n_=Hb[h_][h_],a_=c_-n_,i_=u_-n_,e_=(a_*i_-g_)/Hb[h_+1][h_]+Hb[h_][h_+1],t_=Hb[h_+1][h_+1]-n_-a_-i_,a_=Hb[h_+2][h_+1],i_=_Mathabs(e_)+_Mathabs(t_)+_Mathabs(a_),e_/=i_,t_/=i_,a_/=i_,h_!==d_)&&!(_Mathabs(Hb[h_][h_-1])*(_Mathabs(t_)+_Mathabs(a_))<Kb*(_Mathabs(e_)*(_Mathabs(Hb[h_-1][h_-1])+_Mathabs(n_)+_Mathabs(Hb[h_+1][h_+1]))));)h_--;for(s_=h_+2;s_<=Wb;s_++)Hb[s_][s_-2]=0,s_>h_+2&&(Hb[s_][s_-3]=0);for(l_=h_;l_<=Wb-1&&(x_=l_!==Wb-1,l_!==h_&&(e_=Hb[l_][l_-1],t_=Hb[l_+1][l_-1],a_=x_?Hb[l_+2][l_-1]:0,c_=_Mathabs(e_)+_Mathabs(t_)+_Mathabs(a_),0!==c_&&(e_/=c_,t_/=c_,a_/=c_)),0!==c_);l_++)if(i_=_Mathsqrt(e_*e_+t_*t_+a_*a_),0>e_&&(i_=-i_),0!==i_){for(l_===h_?d_!==h_&&(Hb[l_][l_-1]=-Hb[l_][l_-1]):Hb[l_][l_-1]=-i_*c_,e_+=i_,c_=e_/i_,u_=t_/i_,n_=a_/i_,t_/=e_,a_/=e_,r_=l_;r_<Xb;r_++)e_=Hb[l_][r_]+t_*Hb[l_+1][r_],x_&&(e_+=a_*Hb[l_+2][r_],Hb[l_+2][r_]=Hb[l_+2][r_]-e_*n_),Hb[l_][r_]-=e_*c_,Hb[l_+1][r_]=Hb[l_+1][r_]-e_*u_;for(s_=0;s_<=_Mathmin(Wb,l_+3);s_++)e_=c_*Hb[s_][l_]+u_*Hb[s_][l_+1],x_&&(e_+=n_*Hb[s_][l_+2],Hb[s_][l_+2]=Hb[s_][l_+2]-e_*a_),Hb[s_][l_]-=e_,Hb[s_][l_+1]=Hb[s_][l_+1]-e_*t_;for(s_=Zb;s_<=Qb;s_++)e_=c_*Gb[s_][l_]+u_*Gb[s_][l_+1],x_&&(e_+=n_*Gb[s_][l_+2],Gb[s_][l_+2]=Gb[s_][l_+2]-e_*a_),Gb[s_][l_]-=e_,Gb[s_][l_+1]=Gb[s_][l_+1]-e_*t_}}}if(0!==$b){for(Wb=Xb-1;0<=Wb;Wb--)if(e_=Nb[Wb],t_=Ob[Wb],0===t_)for(d_=Wb,Hb[Wb][Wb]=1,s_=Wb-1;0<=s_;s_--){for(g_=Hb[s_][s_]-e_,a_=0,r_=d_;r_<=Wb;r_++)a_+=Hb[s_][r_]*Hb[r_][Wb];if(0>Ob[s_])n_=g_,i_=a_;else if(d_=s_,0===Ob[s_]?Hb[s_][Wb]=0===g_?-a_/(Kb*$b):-a_/g_:(c_=Hb[s_][s_+1],u_=Hb[s_+1][s_],t_=(Nb[s_]-e_)*(Nb[s_]-e_)+Ob[s_]*Ob[s_],m_=(c_*i_-n_*a_)/t_,Hb[s_][Wb]=m_,Hb[s_+1][Wb]=_Mathabs(c_)>_Mathabs(n_)?(-a_-g_*m_)/c_:(-i_-u_*m_)/n_),m_=_Mathabs(Hb[s_][Wb]),1<Kb*m_*m_)for(r_=s_;r_<=Wb;r_++)Hb[r_][Wb]/=m_}else if(0>t_)for(d_=Wb-1,_Mathabs(Hb[Wb][Wb-1])>_Mathabs(Hb[Wb-1][Wb])?(Hb[Wb-1][Wb-1]=t_/Hb[Wb][Wb-1],Hb[Wb-1][Wb]=-(Hb[Wb][Wb]-e_)/Hb[Wb][Wb-1]):(y_=wt(0,-Hb[Wb-1][Wb],Hb[Wb-1][Wb-1]-e_,t_),Hb[Wb-1][Wb-1]=y_[0],Hb[Wb-1][Wb]=y_[1]),Hb[Wb][Wb-1]=0,Hb[Wb][Wb]=1,s_=Wb-2;0<=s_;s_--){for(p_=0,f_=0,r_=d_;r_<=Wb;r_++)p_+=Hb[s_][r_]*Hb[r_][Wb-1],f_+=Hb[s_][r_]*Hb[r_][Wb];if(g_=Hb[s_][s_]-e_,0>Ob[s_])n_=g_,a_=p_,i_=f_;else if(d_=s_,0===Ob[s_]?(y_=wt(-p_,-f_,g_,t_),Hb[s_][Wb-1]=y_[0],Hb[s_][Wb]=y_[1]):(c_=Hb[s_][s_+1],u_=Hb[s_+1][s_],b_=(Nb[s_]-e_)*(Nb[s_]-e_)+Ob[s_]*Ob[s_]-t_*t_,w_=2*(Nb[s_]-e_)*t_,0===b_&&0===w_&&(b_=Kb*$b*(_Mathabs(g_)+_Mathabs(t_)+_Mathabs(c_)+_Mathabs(u_)+_Mathabs(n_))),y_=wt(c_*a_-n_*p_+t_*f_,c_*i_-n_*f_-t_*p_,b_,w_),Hb[s_][Wb-1]=y_[0],Hb[s_][Wb]=y_[1],_Mathabs(c_)>_Mathabs(n_)+_Mathabs(t_)?(Hb[s_+1][Wb-1]=(-p_-g_*Hb[s_][Wb-1]+t_*Hb[s_][Wb])/c_,Hb[s_+1][Wb]=(-f_-g_*Hb[s_][Wb]-t_*Hb[s_][Wb-1])/c_):(y_=wt(-a_-u_*Hb[s_][Wb-1],-i_-u_*Hb[s_][Wb],n_,t_),Hb[s_+1][Wb-1]=y_[0],Hb[s_+1][Wb]=y_[1])),m_=_Mathmax(_Mathabs(Hb[s_][Wb-1]),_Mathabs(Hb[s_][Wb])),1<Kb*m_*m_)for(r_=s_;r_<=Wb;r_++)Hb[r_][Wb-1]=Hb[r_][Wb-1]/m_,Hb[r_][Wb]/=m_}for(s_=0;s_<Xb;s_++)if(s_<Zb||s_>Qb)for(r_=s_;r_<Xb;r_++)Gb[s_][r_]=Hb[s_][r_];for(r_=Xb-1;r_>=Zb;r_--)for(s_=Zb;s_<=Qb;s_++){for(n_=0,l_=Zb;l_<=_Mathmin(r_,Qb);l_++)n_+=Gb[s_][l_]*Hb[l_][r_];Gb[s_][r_]=n_}}}function wt(Xb,Ob,Nb,Gb){var Hb,Wb;return _Mathabs(Nb)>_Mathabs(Gb)?(Hb=Gb/Nb,Wb=Nb+Hb*Gb,[(Xb+Hb*Ob)/Wb,(Ob-Hb*Xb)/Wb]):(Hb=Nb/Gb,Wb=Gb+Hb*Nb,[(Hb*Xb+Ob)/Wb,(Hb*Ob-Xb)/Wb])}function xt(Xb){if(!(this instanceof xt))return new xt(Xb);if(Xb=ad.checkMatrix(Xb),!Xb.isSymmetric())throw new Error('Matrix is not symmetric');var Ob=Xb,Nb=Ob.rows,Gb=new ad(Nb,Nb),Hb=!0,Wb,Zb,Qb;for(Zb=0;Zb<Nb;Zb++){var Kb=Gb[Zb],Jb=0;for(Qb=0;Qb<Zb;Qb++){var $b=Gb[Qb],e_=0;for(Wb=0;Wb<Qb;Wb++)e_+=$b[Wb]*Kb[Wb];Kb[Qb]=e_=(Ob[Zb][Qb]-e_)/Gb[Qb][Qb],Jb+=e_*e_}for(Jb=Ob[Zb][Zb]-Jb,Hb&=0<Jb,Gb[Zb][Zb]=_Mathsqrt(_Mathmax(Jb,0)),Qb=Zb+1;Qb<Nb;Qb++)Gb[Zb][Qb]=0}if(!Hb)throw new Error('Matrix is not positive definite');this.L=Gb}function yt(Xb,Ob){for(var Nb=0,Gb=0;Gb<Xb.length;Gb++)Nb+=(Xb[Gb]-Ob[Gb])*(Xb[Gb]-Ob[Gb]);return Nb}function kt(Xb,Ob){return _Mathsqrt(yt(Xb,Ob))}function vt(Xb,Ob){for(var Nb=Xb.clone(),Gb=0;Gb<Xb.rows;++Gb)Nb[Gb][0]=_Mathpow(Nb[Gb][0],Ob);return Nb}function Dt(Xb,Ob){this[Xb][Ob]=_Mathabs(this[Xb][Ob])}function jt(Xb,Ob,Nb){for(var Gb=new Dh(Xb,Ob,Nb),Hb=Array(this.size),Wb=0;Wb<this.width;Wb++)for(var Zb=0;Zb<this.height;Zb++)Hb[Zb*this.width+Wb]=[Wb,Zb];for(var Qb=Gb.predict(Hb),Kb=Cb.createFrom(this),Jb=0;Jb<this.size;Jb++)Kb.data[Jb]=_Mathmin(this.maxValue,_Mathmax(0,Qb[Jb][0]));return Kb}function Mt(Xb={}){var Ob=Xb.x,Nb=void 0===Ob?0:Ob,Gb=Xb.y,Hb=void 0===Gb?0:Gb,Wb=Xb.width,Zb=void 0===Wb?this.width-Nb:Wb,Qb=Xb.height,Kb=void 0===Qb?this.height-Hb:Qb;if(this.checkProcessable('max',{bitDepth:[8,16]}),Nb=_Mathround(Nb),Hb=_Mathround(Hb),Zb=_Mathround(Zb),Kb=_Mathround(Kb),Nb>this.width-1||Hb>this.height-1)throw new RangeError(`crop: origin (x:${Nb}, y:${Hb}) out of range (${this.width-1}; ${this.height-1})`);if(0>=Zb||0>=Kb)throw new RangeError(`crop: width and height (width:${Zb}; height:${Kb}) must be positive numbers`);if(0>Nb||0>Hb)throw new RangeError(`crop: x and y (x:${Nb}, y:${Hb}) must be positive numbers`);if(Zb>this.width-Nb||Kb>this.height-Hb)throw new RangeError(`crop: (x: ${Nb}, y:${Hb}, width:${Zb}, height:${Kb}) size is out of range`);for(var Jb=Cb.createFrom(this,{width:Zb,height:Kb,position:[Nb,Hb]}),$b=Zb*this.channels,e_=Hb+Kb,t_=0,a_=Nb*this.channels,i_=Hb;i_<e_;i_++)for(var n_=i_*this.width*this.channels+a_,o_=n_+$b;n_<o_;n_++)Jb.data[t_++]=this.data[n_];return Jb}function St(Xb={}){this.checkProcessable('cropAlpha',{alpha:1});var Ob=Xb.threshold,Nb=void 0===Ob?this.maxValue:Ob,Gb=It(this,Nb,this.components);if(-1===Gb)throw new Error('Could not find new dimensions. Threshold may be too high.');var Hb=Pt(this,Nb,this.components,Gb),Wb=Ct(this,Nb,this.components,Gb),Zb=Bt(this,Nb,this.components,Gb,Hb,Wb);return this.crop({x:Gb,y:Hb,width:Zb-Gb+1,height:Wb-Hb+1})}function It(Xb,Ob,Nb){for(var Gb=0;Gb<Xb.width;Gb++)for(var Hb=0;Hb<Xb.height;Hb++)if(Xb.getValueXY(Gb,Hb,Nb)>=Ob)return Gb;return-1}function Pt(Xb,Ob,Nb,Gb){for(var Hb=0;Hb<Xb.height;Hb++)for(var Wb=Gb;Wb<Xb.width;Wb++)if(Xb.getValueXY(Wb,Hb,Nb)>=Ob)return Hb;return-1}function Ct(Xb,Ob,Nb,Gb){for(var Hb=Xb.height-1;0<=Hb;Hb--)for(var Wb=Gb;Wb<Xb.width;Wb++)if(Xb.getValueXY(Wb,Hb,Nb)>=Ob)return Hb;return-1}function Bt(Xb,Ob,Nb,Gb,Hb,Wb){for(var Zb=Xb.width-1;Zb>=Gb;Zb--)for(var Qb=Hb;Qb<=Wb;Qb++)if(Xb.getValueXY(Zb,Qb,Nb)>=Ob)return Zb;return-1}function At(Xb,Ob,Nb){var Gb=this.width/Ob,Hb=this.height/Nb;if(1<this.bitDepth)for(var Wb=0,Zb;Wb<Ob;Wb++){Zb=_Mathfloor((Wb+0.5)*Gb);for(var Qb=0,Kb;Qb<Nb;Qb++){Kb=_Mathfloor((Qb+0.5)*Hb);for(var Jb=0;Jb<this.channels;Jb++)Xb.setValueXY(Wb,Qb,Jb,this.getValueXY(Zb,Kb,Jb))}}else for(var $b=0,e_;$b<Ob;$b++){e_=_Mathfloor(($b+0.5)*Gb);for(var t_=0,a_;t_<Nb;t_++)a_=_Mathfloor((t_+0.5)*Hb),this.getBitXY(e_,a_)&&Xb.setBitXY($b,t_)}}function Rt(Xb){if('string'==typeof Xb){var Ob=Xb[Xb.length-1];Xb=parseFloat(Xb),'%'===Ob&&(Xb/=100)}return Xb}function zt(Xb,Ob){if(!Ob)throw Error('getThreshold : the maxValue should be specified');if('string'==typeof Xb){var Nb=Xb[Xb.length-1];if('%'!==Nb)throw Error('getThreshold : if the value is a string it must finish by %');return parseFloat(Xb)/100*Ob}if('number'==typeof Xb)return 1>Xb?Xb*Ob:Xb;throw Error('getThreshold : the value is not valid')}function Lt(Xb,Ob,Nb){Xb=Rt(Xb);var Gb=_Mathround(Xb*Ob),Hb=_Mathround(Xb*Nb);return 0>=Gb&&(Gb=1),0>=Hb&&(Hb=1),{width:Gb,height:Hb}}function Et(Xb={}){var Ob=Xb.factor,Nb=void 0===Ob?1:Ob,Gb=Xb.algorithm,Hb=void 0===Gb?'nearestNeighbor':Gb,Wb=Xb.preserveAspectRatio,Zb=void 0===Wb||Wb,Qb=Xb.width,Kb=Xb.height;Qb||(Kb&&Zb?Qb=_Mathround(Kb*(this.width/this.height)):Qb=this.width),Kb||(Zb?Kb=_Mathround(Qb*(this.height/this.width)):Kb=this.height);var Jb=Lt(Nb,Qb,Kb);if(Qb=Jb.width,Kb=Jb.height,Qb===this.width&&Kb===this.height){var $b=this.clone();return $b.position=[0,0],$b}var e_=_Mathround((this.width-Qb)/2),t_=_Mathround((this.height-Kb)/2),a_=Cb.createFrom(this,{width:Qb,height:Kb,position:[e_,t_]});switch(Hb.toLowerCase()){case'nearestneighbor':case'nearestneighbour':At.call(this,a_,Qb,Kb);break;default:throw new Error('Unsupported scale algorithm: '+Hb);}return a_}function Tt(){this.checkProcessable('hsv',{bitDepth:[8,16],alpha:[0,1],colorModel:[Xr]});for(var Xb=Cb.createFrom(this,{colorModel:Nr}),Ob=0,Nb=this.data,Gb=0;Gb<Nb.length;Gb+=this.channels){var Hb=Nb[Gb],Wb=Nb[Gb+1],Zb=Nb[Gb+2],Qb=_Mathmin(Hb,Wb,Zb),Kb=_Mathmax(Hb,Wb,Zb),Jb=Kb-Qb,$b=0,e_=0===Kb?0:Jb/Kb;if(Kb!==Qb){switch(Kb){case Hb:$b=(Wb-Zb)/Jb+(Wb<Zb?6:0);break;case Wb:$b=(Zb-Hb)/Jb+2;break;case Zb:$b=(Hb-Wb)/Jb+4;break;default:throw new Error('unreachable');}$b/=6}Xb.data[Ob++]=$b*this.maxValue,Xb.data[Ob++]=e_*this.maxValue,Xb.data[Ob++]=Kb,this.alpha&&(Xb.data[Ob++]=Nb[Gb+3])}return Xb}function Vt(){this.checkProcessable('hsl',{bitDepth:[8,16],alpha:[0,1],colorModel:[Xr]});for(var Xb=Cb.createFrom(this,{colorModel:Or}),Ob=_Mathfloor(this.maxValue/2),Nb=0,Gb=this.data,Hb=0;Hb<Gb.length;Hb+=this.channels){var Wb=Gb[Hb],Zb=Gb[Hb+1],Qb=Gb[Hb+2],Kb=_Mathmax(Wb,Zb,Qb),Jb=_Mathmin(Wb,Zb,Qb),$b=0,e_=0,t_=(Kb+Jb)/2;if(Kb!==Jb){var a_=Kb-Jb;switch(e_=t_>Ob?a_/(2-Kb-Jb):a_/(Kb+Jb),Kb){case Wb:$b=(Zb-Qb)/a_+(Zb<Qb?6:0);break;case Zb:$b=(Qb-Wb)/a_+2;break;case Qb:$b=(Wb-Zb)/a_+4;break;default:throw new Error('unreachable');}$b/=6}Xb.data[Nb++]=$b*this.maxValue,Xb.data[Nb++]=e_*this.maxValue,Xb.data[Nb++]=t_,this.alpha&&(Xb.data[Nb++]=Gb[Hb+3])}return Xb}function Yt(){this.checkProcessable('cmyk',{bitDepth:[8,16],alpha:[0,1],colorModel:[Xr]});for(var Xb=Cb.createFrom(this,{components:4,colorModel:Gr}),Ob=0,Nb=this.data,Gb=0;Gb<Nb.length;Gb+=this.channels){var Hb=Nb[Gb],Wb=Nb[Gb+1],Zb=Nb[Gb+2],Qb=_Mathmin(this.maxValue-Hb,this.maxValue-Wb,this.maxValue-Zb),Kb=(this.maxValue-Hb-Qb)/(1-Qb/this.maxValue),Jb=(this.maxValue-Wb-Qb)/(1-Qb/this.maxValue),$b=(this.maxValue-Zb-Qb)/(1-Qb/this.maxValue);Xb.data[Ob++]=Kb,Xb.data[Ob++]=Jb,Xb.data[Ob++]=$b,Xb.data[Ob++]=Qb,this.alpha&&(Xb.data[Ob++]=Nb[Gb+3])}return Xb}function Ft(){return new Cb(this.width,this.height,this.getRGBAData(),{kind:'RGBA',parent:this})}function Ut(Xb={}){var Ob=Xb.algorithm,Nb=void 0===Ob?'luma709':Ob,Gb=Xb.keepAlpha,Hb=void 0!==Gb&&Gb,Wb=Xb.mergeAlpha,Zb=void 0===Wb||Wb,Qb=Xb.allowGrey,Jb={bitDepth:[8,16],alpha:[0,1]};void 0!==Qb&&Qb||(Jb.colorModel=[Xr],Jb.components=[3]),this.checkProcessable('grey',Jb),1===this.components&&(Nb='red'),Hb&=this.alpha,Zb&=this.alpha,Hb&&(Zb=!1);var $b=Cb.createFrom(this,{components:1,alpha:Hb,colorModel:null}),e_=jh[Nb.toLowerCase()];if(!e_)throw new Error('Unsupported grey algorithm: '+Nb);for(var t_=0,a_=0;a_<this.data.length;a_+=this.channels)Zb?$b.data[t_++]=e_(this.data,a_,this)*this.data[a_+this.components]/this.maxValue:($b.data[t_++]=e_(this.data,a_,this),$b.alpha&&($b.data[t_++]=this.data[a_+this.components]));return $b}function Ot(Xb){for(var Ob=!1,Nb=0,Gb=1;Gb<Xb.length-1;Gb++)if(Xb[Gb-1]<Xb[Gb]&&Xb[Gb+1]<Xb[Gb]&&(Nb++,2<Nb))return!1;return 2==Nb&&(Ob=!0),Ob}function Qt(Xb,Ob){for(var Nb=0,Gb=0;Gb<=Ob;Gb++)Nb+=Xb[Gb];return Nb}function Kt(Xb,Ob){for(var Nb=0,Gb=0;Gb<=Ob;Gb++)Nb+=Gb*Xb[Gb];return Nb}function Jt(Xb,Ob){for(var Nb=0,Gb=0;Gb<=Ob;Gb++)Nb+=Gb*Gb*Xb[Gb];return Nb}function ea(Xb){for(var Ob=Array(Xb.length),Nb=1;Nb<Xb.length-1;Nb++)Ob[Nb]=(Xb[Nb-1]+Xb[Nb]+Xb[Nb+1])/3;return Ob[0]=(Xb[0]+Xb[1])/3,Ob[Xb.length-1]=(Xb[Xb.length-2]+Xb[Xb.length-1])/3,Ob}function ta(Xb,Ob){for(var Nb=void 0,Gb=1;Gb<Ob;Gb++)if(Xb[Gb-1]>Xb[Gb]&&Xb[Gb+1]>=Xb[Gb]){Nb=Gb;break}return Nb}function aa(Xb){for(var Ob=Xb.length,Nb=!1,Gb=0,Hb=1;Hb<Ob-1;Hb++)if(Xb[Hb-1]<Xb[Hb]&&Xb[Hb+1]<Xb[Hb]&&(Gb++,2<Gb))return!1;return 2==Gb&&(Nb=!0),Nb}function la(Xb,Ob){for(var Nb=0,Gb=0;Gb<=Ob;Gb++)Nb+=Xb[Gb];return Nb}function ca(Xb={}){var Ob=Xb.algorithm,Nb=void 0===Ob?'threshold':Ob,Gb=Xb.threshold,Hb=void 0===Gb?0.5:Gb,Wb=Xb.useAlpha,Qb=Xb.invert,Kb=void 0!==Qb&&Qb;if(this.checkProcessable('mask',{components:1,bitDepth:[8,16]}),'threshold'===Nb)Hb=zt(Hb,this.maxValue);else{var Jb=Sh[Nb.toLowerCase()];if(Jb){var $b=this.getHistogram();Hb=Jb($b,this.size)}else throw new Error('mask transform unknown algorithm: '+Nb)}var e_=new Cb(this.width,this.height,{kind:'BINARY',parent:this}),t_=0;if(this.alpha&&(void 0===Wb||Wb))for(var a_=0,i_;a_<this.data.length;a_+=this.channels)i_=this.data[a_]+(this.maxValue-this.data[a_])*(this.maxValue-this.data[a_+1])/this.maxValue,(Kb&&i_<=Hb||!Kb&&i_>=Hb)&&e_.setBit(t_),t_++;else for(var n_=0;n_<this.data.length;n_+=this.channels)(Kb&&this.data[n_]<=Hb||!Kb&&this.data[n_]>=Hb)&&e_.setBit(t_),t_++;return e_}function ua(Xb,Ob,Nb,Gb){for(var Hb=Xb.width,Wb=Xb.height,Zb=Ob.width,Qb=Xb.channels,Kb=0;Kb<Hb;Kb++)for(var Jb=0;Jb<Wb;Jb++)for(var $b=0;$b<Qb;$b++){var e_=(Jb*Hb+Kb)*Qb+$b,t_=((Gb+Jb)*Zb+Nb+Kb)*Qb+$b;Ob.data[t_]=Xb.data[e_]}}function fa(Xb={}){var Ob=Xb.size,Nb=void 0===Ob?0:Ob,Gb=Xb.algorithm,Hb=void 0===Gb?'copy':Gb,Wb=Xb.color;if(this.checkProcessable('pad',{bitDepth:[8,16]}),'set'===Hb){if(Wb.length!==this.channels)throw new Error('pad: the color array must have the same length as the number of channels. Here: '+this.channels);for(var Zb=0;Zb<Wb.length;Zb++)0===Wb[Zb]&&(Wb[Zb]=1e-3)}else Wb=vl(this.channels,null);Array.isArray(Nb)||(Nb=[Nb,Nb]);var Qb=this.width+2*Nb[0],Kb=this.height+2*Nb[1],Jb=this.channels,$b=Cb.createFrom(this,{width:Qb,height:Kb});ua(this,$b,Nb[0],Nb[1]);for(var e_=Nb[0];e_<Qb-Nb[0];e_++)for(var t_=0,a_;t_<Jb;t_++){a_=Wb[t_]||$b.data[(Nb[1]*Qb+e_)*Jb+t_];for(var i_=0;i_<Nb[1];i_++)$b.data[(i_*Qb+e_)*Jb+t_]=a_;a_=Wb[t_]||$b.data[((Kb-Nb[1]-1)*Qb+e_)*Jb+t_];for(var n_=Kb-Nb[1];n_<Kb;n_++)$b.data[(n_*Qb+e_)*Jb+t_]=a_}for(var o_=0;o_<Kb;o_++)for(var s_=0,r_;s_<Jb;s_++){r_=Wb[s_]||$b.data[(o_*Qb+Nb[0])*Jb+s_];for(var l_=0;l_<Nb[0];l_++)$b.data[(o_*Qb+l_)*Jb+s_]=r_;r_=Wb[s_]||$b.data[(o_*Qb+Qb-Nb[0]-1)*Jb+s_];for(var d_=Qb-Nb[0];d_<Qb;d_++)$b.data[(o_*Qb+d_)*Jb+s_]=r_}return $b}function ba(Xb=8){if(this.checkProcessable('colorDepth',{bitDepth:[8,16]}),![8,16].includes(Xb))throw Error('You need to specify the new colorDepth as 8 or 16');if(this.bitDepth===Xb)return this.clone();var Ob=Cb.createFrom(this,{bitDepth:Xb});if(8===Xb)for(var Nb=0;Nb<this.data.length;Nb++)Ob.data[Nb]=this.data[Nb]>>8;else for(var Gb=0;Gb<this.data.length;Gb++)Ob.data[Gb]=this.data[Gb]<<8|this.data[Gb];return Ob}function _a(Xb,Ob={}){var Nb=Ob.interpolation,Gb=void 0===Nb?'none':Nb,Hb=Ob.width,Wb=void 0===Hb?this.width:Hb,Zb=Ob.height,Qb=void 0===Zb?this.height:Zb,Kb=Xb*_MathPI/180,Jb=_Mathfloor(_Mathabs(Wb*_Mathcos(Kb))+_Mathabs(Qb*_Mathsin(Kb))),$b=_Mathfloor(_Mathabs(Qb*_Mathcos(Kb))+_Mathabs(Wb*_Mathsin(Kb))),e_=Cb.createFrom(this,{width:Jb,height:$b}),t_=_Mathcos(-Kb),a_=_Mathsin(-Kb),i_=Jb/2,n_=$b/2;0==Jb%2?(i_-=0.5,0==$b%2?n_-=0.5:n_=_Mathfloor(n_)):(i_=_Mathfloor(i_),0==$b%2?n_-=0.5:n_=_Mathfloor(n_));var o_=_Mathfloor(Wb/2-i_),s_=_Mathfloor(Qb/2-n_);if('bilinear'===Gb){for(var r_=this.width*this.channels,l_=0;l_<Jb;l_+=1)for(var d_=0;d_<$b;d_+=1)for(var h_=(l_-i_)*t_-(d_-n_)*a_+i_+o_,m_=(d_-n_)*t_+(l_-i_)*a_+n_+s_,g_=0|h_,c_=0|m_,u_=h_-g_,p_=m_-c_,f_=0;f_<this.channels;f_++)if(0>h_||h_>=Wb||0>m_||m_>=Qb)this.alpha?e_.setValueXY(l_,d_,f_,this.alpha):e_.setValueXY(l_,d_,f_,this.maxValue);else{var b_=(c_*this.width+g_)*this.channels+f_,w_=this.data[b_],x_=this.data[b_+this.channels],y_=this.data[b_+r_],k_=this.data[b_+r_+this.channels];e_.setValueXY(l_,d_,f_,0|w_+u_*(x_-w_)+p_*(y_-w_)+u_*p_*(w_-x_-y_+k_))}}else for(var D_=0;D_<Jb;D_+=1)for(var j_=0;j_<$b;j_+=1)for(var M_=0;M_<this.channels;M_++){var S_=_Mathround((D_-i_)*t_-(j_-n_)*a_+i_)+o_,I_=_Mathround((j_-n_)*t_+(D_-i_)*a_+n_)+s_;0>S_||S_>=Wb||0>I_||I_>=Qb?this.alpha?e_.setValueXY(D_,j_,M_,this.alpha):e_.setValueXY(D_,j_,M_,this.maxValue):e_.setValueXY(D_,j_,M_,this.getValueXY(S_,I_,M_))}return e_}function wa(Xb,Ob){if('number'!=typeof Xb)throw new TypeError('angle must be a number');switch(0>Xb&&(Xb=360*_Mathceil(-Xb/360)+Xb),Xb%360){case 0:return this.clone();case 90:return ya.call(this);case 180:return ka.call(this);case 270:return xa.call(this);default:return _a.call(this,Xb,Ob);}}function xa(){for(var Xb=Cb.createFrom(this,{width:this.height,height:this.width}),Ob=Xb.height-1,Nb=0;Nb<this.height;Nb++)for(var Gb=0;Gb<this.width;Gb++)for(var Hb=0;Hb<this.channels;Hb++)Xb.setValueXY(Nb,Ob-Gb,Hb,this.getValueXY(Gb,Nb,Hb));return Xb}function ya(){for(var Xb=Cb.createFrom(this,{width:this.height,height:this.width}),Ob=Xb.width-1,Nb=0;Nb<this.height;Nb++)for(var Gb=0;Gb<this.width;Gb++)for(var Hb=0;Hb<this.channels;Hb++)Xb.setValueXY(Ob-Nb,Gb,Hb,this.getValueXY(Gb,Nb,Hb));return Xb}function ka(){for(var Xb=Cb.createFrom(this),Ob=Xb.width-1,Nb=Xb.height-1,Gb=0;Gb<this.height;Gb++)for(var Hb=0;Hb<this.width;Hb++)for(var Wb=0;Wb<this.channels;Wb++)Xb.setValueXY(Ob-Hb,Nb-Gb,Wb,this.getValueXY(Hb,Gb,Wb));return Xb}function va(Xb={}){var Ob=Xb.size,Nb=void 0===Ob?0:Ob,Gb=Xb.algorithm,Hb=void 0===Gb?'copy':Gb,Wb=Xb.color;if(this.checkProcessable('setBorder',{bitDepth:[8,16,32,64]}),'set'===Hb){if(Wb.length!==this.channels)throw new Error('setBorder: the color array must have the same length as the number of channels. Here: '+this.channels);for(var Zb=0;Zb<Wb.length;Zb++)0===Wb[Zb]&&(Wb[Zb]=1e-3)}else Wb=vl(this.channels,null);Array.isArray(Nb)||(Nb=[Nb,Nb]);for(var Qb=Nb[0],Kb=Nb[1],Jb=this.channels,$b=Qb;$b<this.width-Qb;$b++)for(var e_=0,t_;e_<Jb;e_++){t_=Wb[e_]||this.data[($b+this.width*Kb)*Jb+e_];for(var a_=0;a_<Kb;a_++)this.data[(a_*this.width+$b)*Jb+e_]=t_;t_=Wb[e_]||this.data[($b+this.width*(this.height-Kb-1))*Jb+e_];for(var i_=this.height-Kb;i_<this.height;i_++)this.data[(i_*this.width+$b)*Jb+e_]=t_}for(var n_=0;n_<this.height;n_++)for(var o_=0,s_;o_<Jb;o_++){s_=Wb[o_]||this.data[(n_*this.width+Qb)*Jb+o_];for(var r_=0;r_<Qb;r_++)this.data[(n_*this.width+r_)*Jb+o_]=s_;s_=Wb[o_]||this.data[(n_*this.width+this.width-Qb-1)*Jb+o_];for(var l_=this.width-Qb;l_<this.width;l_++)this.data[(n_*this.width+l_)*Jb+o_]=s_}return this}function Da(Xb={}){var Ob=Xb.algorithm,Nb=void 0===Ob?'matchToPrevious':Ob,Gb=Xb.ignoreBorder,Hb=void 0===Gb?[0,0]:Gb;this.checkProcessable('matchAndCrop',{bitDepth:[8,16]});var Zb=this[0],Qb=[];Qb[0]={position:[0,0],image:this[0]};for(var Kb=[0,0],Jb=1,$b;Jb<this.length;Jb++)$b=Zb.getBestMatch(this[Jb],{border:Hb}),Qb[Jb]={position:[$b[0]+Kb[0],$b[1]+Kb[1]],image:this[Jb]},'matchToPrevious'===Nb&&(Kb[0]+=$b[0],Kb[1]+=$b[1],Zb=this[Jb]);for(var e_=0,t_=0,a_=0,i_=0,n_=0,o_;n_<Qb.length;n_++)o_=Qb[n_],o_.position[0]>e_&&(e_=o_.position[0]),o_.position[0]<t_&&(t_=o_.position[0]),o_.position[1]>a_&&(a_=o_.position[1]),o_.position[1]<i_&&(i_=o_.position[1]);t_=0-t_,i_=0-i_;for(var s_=0,r_;s_<Qb.length;s_++)r_=Qb[s_],r_.crop=r_.image.crop({x:e_-r_.position[0],y:a_-r_.position[1],width:Zb.width-t_-e_,height:Zb.height-i_-a_});for(var l_=[],d_=0;d_<Qb.length;d_++)l_[d_]=Qb[d_].crop;return new Oh(l_)}function ja(){this.checkProcessable('min',{bitDepth:[8,16]});for(var Xb=this[0].min,Ob=1;Ob<this.length;Ob++)for(var Nb=0;Nb<Xb.length;Nb++)Xb[Nb]=_Mathmin(Xb[Nb],this[Ob].min[Nb]);return Xb}function Ma(){this.checkProcessable('min',{bitDepth:[8,16]});for(var Xb=this[0].max,Ob=1;Ob<this.length;Ob++)for(var Nb=0;Nb<Xb.length;Nb++)Xb[Nb]=_Mathmax(Xb[Nb],this[Ob].max[Nb]);return Xb}function Sa(Xb){var Ob=Xb.reduce((Zb,Qb)=>Zb+Qb);if(0===Ob)throw new Error('unreachable');for(var Nb=0,Gb=0,Hb=Ob/2,Wb;;){if(0<Xb[Nb]){if(void 0!=Wb)return(Wb+Nb)/2;if(Gb+=Xb[Nb],Gb>Hb)return Nb;Gb===Hb&&(Wb=Nb)}Nb++}}function Ia(Xb){for(var Ob=0,Nb=0,Gb=0;Gb<Xb.length;Gb++)Ob+=Xb[Gb],Nb+=Xb[Gb]*Gb;return 0===Ob?0:Nb/Ob}function Pa(){this.checkProcessable('median',{bitDepth:[8,16]});for(var Xb=this.getHistograms({maxSlots:this[0].maxValue+1}),Ob=Array(Xb.length),Nb=0,Gb;Nb<Xb.length;Nb++)Gb=Xb[Nb],Ob[Nb]=Sa(Gb);return Ob}function Ca(Xb){this.checkProcessable('min',{bitDepth:[8,16]});for(var Ob=this[0].getHistogram(Xb),Nb=1,Gb;Nb<this.length;Nb++){Gb=this[Nb].getHistogram(Xb);for(var Hb=0;Hb<Ob.length;Hb++)Ob[Hb]+=Gb[Hb]}return Ob}function Ba(Xb){this.checkProcessable('min',{bitDepth:[8,16]});for(var Ob=this[0].getHistograms(Xb),Nb=Ob[0].length,Gb=1,Hb;Gb<this.length;Gb++){Hb=this[Gb].getHistograms(Xb);for(var Wb=0;Wb<Ob.length;Wb++)for(var Zb=0;Zb<Nb;Zb++)Ob[Wb][Zb]+=Hb[Wb][Zb]}return Ob}function Aa(){this.checkProcessable('average',{bitDepth:[8,16]});for(var Xb=new Uint32Array(this[0].data.length),Ob=0,Nb;Ob<this.length;Ob++){Nb=this[Ob];for(var Gb=0;Gb<this[0].data.length;Gb++)Xb[Gb]+=Nb.data[Gb]}for(var Hb=Cb.createFrom(this[0]),Wb=Hb.data,Zb=0;Zb<this[0].data.length;Zb++)Wb[Zb]=Xb[Zb]/this.length;return Hb}function za(Xb={}){var Ob=Xb.preserveAlpha;if(this.checkProcessable('split',{bitDepth:[8,16]}),1===this.components)return new Oh([this.clone()]);var Gb=new Oh,Hb=this.data;if(this.alpha&&(void 0===Ob||Ob))for(var Wb=0;Wb<this.components;Wb++){for(var Zb=Cb.createFrom(this,{components:1,alpha:!0,colorModel:null}),Qb=0,Kb=0;Kb<Hb.length;Kb+=this.channels)Zb.data[Qb++]=Hb[Kb+Wb],Zb.data[Qb++]=Hb[Kb+this.components];Gb.push(Zb)}else for(var Jb=0;Jb<this.channels;Jb++){for(var $b=Cb.createFrom(this,{components:1,alpha:!1,colorModel:null}),e_=0,t_=0;t_<Hb.length;t_+=this.channels)$b.data[e_++]=Hb[t_+Jb];Gb.push($b)}return Gb}function La(Xb,Ob={}){var Nb=Ob.keepAlpha,Gb=void 0!==Nb&&Nb,Hb=Ob.mergeAlpha,Wb=void 0!==Hb&&Hb;Gb&=this.alpha,Wb&=this.alpha,this.checkProcessable('getChannel',{bitDepth:[8,16]}),Xb=ae(this,Xb);for(var Zb=Cb.createFrom(this,{components:1,alpha:Gb,colorModel:null}),Qb=0,Kb=0;Kb<this.data.length;Kb+=this.channels)Wb?Zb.data[Qb++]=this.data[Kb+Xb]*this.data[Kb+this.components]/this.maxValue:(Zb.data[Qb++]=this.data[Kb+Xb],Gb&&(Zb.data[Qb++]=this.data[Kb+this.components]));return Zb}function Ea(Xb=Ta,Ob={}){var Nb=Ob.mergeAlpha,Gb=void 0!==Nb&&Nb,Hb=Ob.keepAlpha,Wb=void 0!==Hb&&Hb;Gb&=this.alpha,Wb&=this.alpha,this.checkProcessable('combineChannels',{bitDepth:[8,16]});for(var Zb=Cb.createFrom(this,{components:1,alpha:Wb,colorModel:null}),Qb=0,Kb=0,Jb;Kb<this.size;Kb++)Jb=Xb(this.getPixel(Kb)),Gb?Zb.data[Qb++]=Jb*this.data[Kb*this.channels+this.components]/this.maxValue:(Zb.data[Qb++]=Jb,Wb&&(Zb.data[Qb++]=this.data[Kb*this.channels+this.components]));return Zb}function Ta(Xb){return(Xb[0]+Xb[1]+Xb[2])/3}function Va(Xb,Ob){if(this.checkProcessable('setChannel',{bitDepth:[8,16]}),Ob.checkProcessable('setChannel (image parameter check)',{bitDepth:[this.bitDepth],alpha:[0],components:[1]}),Ob.width!==this.width||Ob.height!==this.height)throw new Error('Images must have exactly the same width and height');Xb=ae(this,Xb);for(var Nb=Xb,Gb=0;Gb<Ob.data.length;Gb++)this.data[Nb]=Ob.data[Gb],Nb+=this.channels;return this}function Ya(Xb,Ob={}){var Nb=Ob.shift,Gb=void 0===Nb?[0,0]:Nb,Hb=Ob.average,Wb=Ob.channels,Zb=Ob.defaultAlpha,Qb=Ob.normalize,Kb=Ob.border,Jb=void 0===Kb?[0,0]:Kb;if(this.checkProcessable('getSimilarity',{bitDepth:[8,16]}),Array.isArray(Jb)||(Jb=[Jb,Jb]),Wb=$(this,{channels:Wb,defaultAlpha:Zb}),this.bitDepth!==Xb.bitDepth)throw new Error('Both images must have the same bitDepth');if(this.channels!==Xb.channels)throw new Error('Both images must have the same number of channels');if(this.colorModel!==Xb.colorModel)throw new Error('Both images must have the same colorModel');'undefined'==typeof Hb&&(Hb=!0);for(var $b=_Mathmax(Jb[0],-Gb[0]),e_=_Mathmin(this.width-Jb[0],this.width-Gb[0]),t_=_Mathmax(Jb[1],-Gb[1]),a_=_Mathmin(this.height-Jb[1],this.height-Gb[1]),i_=vl(Wb.length,0),n_=0;n_<Wb.length;n_++){var o_=Wb[n_],s_=Qb?this.sum[o_]:_Mathmax(this.sum[o_],Xb.sum[o_]),r_=Qb?Xb.sum[o_]:_Mathmax(this.sum[o_],Xb.sum[o_]);if(0!==s_&&0!==r_)for(var l_=$b;l_<e_;l_++)for(var d_=t_;d_<a_;d_++){var h_=l_*this.multiplierX+d_*this.multiplierY+o_,m_=h_+Gb[0]*this.multiplierX+Gb[1]*this.multiplierY;i_[n_]+=_Mathmin(this.data[h_]/s_,Xb.data[m_]/r_)}}return Hb?i_.reduce((g_,c_)=>g_+c_)/i_.length:i_}function Fa(Xb={}){var Ob=Xb.sampling,Nb=void 0===Ob?[10,10]:Ob,Gb=Xb.painted,Wb=Xb.mask;this.checkProcessable('getPixelsGrid',{bitDepth:[8,16],channels:1}),Array.isArray(Nb)||(Nb=[Nb,Nb]);for(var Zb=Nb[0],Qb=Nb[1],Kb=Zb*Qb,Jb=Array(Kb),$b=Array(Kb),e_=this.width/Zb,t_=this.height/Qb,a_=_Mathfloor(e_/2),i_=0,n_=0,o_;n_<Zb;n_++){o_=_Mathfloor(t_/2);for(var s_=0;s_<Qb;s_++){var r_=_Mathround(a_),l_=_Mathround(o_);(!Wb||Wb.getBitXY(r_,l_))&&(Jb[i_]=[r_,l_],$b[i_]=this.getPixelXY(r_,l_),i_++),o_+=t_}a_+=e_}Jb.length=i_,$b.length=i_;var d_={xyS:Jb,zS:$b};return void 0!==Gb&&Gb&&(d_.painted=this.rgba8().paintPoints(Jb)),d_}function Ua(Xb,Ob,Nb){for(var Gb=Array(Xb),Hb=0;Hb<Xb;Hb++)Gb[Hb]=Array(Ob);if(Nb)for(var Wb=0;Wb<Xb;Wb++)for(var Zb=0;Zb<Ob;Zb++)Gb[Wb][Zb]=Nb;return Gb.width=Xb,Gb.height=Ob,Gb.__proto__=Ua.prototype,Gb}function qa(Xb,Ob={}){var Nb=Ob.border;if(this.checkProcessable('getChannel',{bitDepth:[8,16]}),this.bitDepth!==Xb.bitDepth)throw new Error('Both images must have the same bitDepth');if(this.channels!==Xb.channels)throw new Error('Both images must have the same number of channels');if(this.colorModel!==Xb.colorModel)throw new Error('Both images must have the same colorModel');for(var Gb=new Ua(Xb.width,Xb.height,-Infinity),Hb=_Mathfloor(Xb.width/2),Wb=_Mathfloor(Xb.height/2),Zb=Hb,Qb=Wb,Kb=!1,Jb;!Kb;){Jb=Gb.localSearch(Hb,Wb,-Infinity);for(var $b=0;$b<Jb.length;$b++){var e_=Jb[$b],t_=this.getSimilarity(Xb,{border:Nb,shift:[Zb-e_[0],Qb-e_[1]]});Gb[e_[0]][e_[1]]=t_}var a_=Gb.localMax(Hb,Wb);a_.position[0]!==Hb||a_.position[1]!==Wb?(Hb=a_.position[0],Wb=a_.position[1]):Kb=!0}return[Hb-Zb,Wb-Qb]}function Xa(Xb,Ob=0){this.checkProcessable('getRow',{bitDepth:[8,16]}),this.checkRow(Xb),this.checkChannel(Ob);for(var Nb=Array(this.width),Gb=0,Hb=Xb*this.width*this.channels+Ob,Wb=Hb+this.width*this.channels,Zb=Hb;Zb<Wb;Zb+=this.channels)Nb[Gb++]=this.data[Zb];return Nb}function Oa(Xb,Ob=0){this.checkProcessable('getColumn',{bitDepth:[8,16]}),this.checkColumn(Xb),this.checkChannel(Ob);for(var Nb=Array(this.height),Gb=0,Hb=this.width*this.channels,Wb=Ob+Xb*this.channels;Wb<this.data.length;Wb+=Hb)Nb[Gb++]=this.data[Wb];return Nb}function Na(Xb={}){var Ob=Xb.channel;if(this.checkProcessable('getMatrix',{bitDepth:[8,16]}),void 0===Ob){if(1<this.components)throw new RangeError('You need to define the channel for an image that contains more than one channel');Ob=0}for(var Nb=new ad(this.height,this.width),Gb=0;Gb<this.height;Gb++)for(var Hb=0;Hb<this.width;Hb++)Nb.set(Gb,Hb,this.getValueXY(Hb,Gb,Ob));return Nb}function Ga(Xb,Ob={}){var Nb=Ob.channel;if(this.checkProcessable('getMatrix',{bitDepth:[8,16]}),void 0===Nb){if(1<this.components)throw new RangeError('You need to define the channel for an image that contains more than one channel');Nb=0}if(!Xb.length||!Xb[0].length||this.width!==Xb.columns||this.height!==Xb.rows)throw new RangeError('The size of the matrix must be equal to the size of the image');for(var Gb=0;Gb<this.height;Gb++)for(var Hb=0;Hb<this.width;Hb++)this.setValueXY(Hb,Gb,Nb,Xb.get(Gb,Hb))}function Ha(){this.checkProcessable('getPixelsArray',{bitDepth:[8,16,32]});for(var Xb=Array(this.size),Ob=0,Nb=0,Gb;Nb<this.data.length;Nb+=this.channels){Gb=Array(this.components);for(var Hb=0;Hb<this.components;Hb++)Gb[Hb]=this.data[Nb+Hb];Xb[Ob++]=Gb}return Xb}function Wa(Xb){for(var Ob=this,Nb=Ob.getClosestCommonParent(Xb),Gb=Ob.getRelativePosition(Nb,{defaultFurther:!0}),Hb=Za(Ob,Gb),Wb=Xb.getRelativePosition(Nb,{defaultFurther:!0}),Zb=Za(Xb,Wb),Qb=Qa(Hb,Zb),Kb={whitePixelsMask1:[],whitePixelsMask2:[],commonWhitePixels:[]},Jb=0;Jb<Qb.length;Jb++){var $b=Qb[Jb],e_=[$b[0]-Gb[0],$b[1]-Gb[1]],t_=[$b[0]-Wb[0],$b[1]-Wb[1]],a_=Ob.getBitXY(e_[0],e_[1]),i_=Xb.getBitXY(t_[0],t_[1]);1===a_&&1===i_&&Kb.commonWhitePixels.push($b)}for(var n_=0;n_<Hb.length;n_++){var o_=void 0,s_=void 0;0!==n_&&(o_=_Mathfloor(n_/(Ob.width-1)),s_=n_%(Ob.width-1)),1===Ob.getBitXY(o_,s_)&&Kb.whitePixelsMask1.push(Hb[n_])}for(var r_=0;r_<Zb.length;r_++){var l_=0,d_=0;0!==r_&&(l_=_Mathfloor(r_/(Xb.width-1)),d_=r_%(Xb.width-1)),1===Xb.getBitXY(l_,d_)&&Kb.whitePixelsMask2.push(Zb[r_])}return Kb}function Za(Xb,Ob){for(var Nb=[],Gb=0;Gb<Xb.height;Gb++)for(var Hb=0,Wb;Hb<Xb.width;Hb++)Wb=[Gb,Hb],Nb.push([Wb[0]+Ob[0],Wb[1]+Ob[1]]);return Nb}function Qa(Xb,Ob){for(var Nb=0,Gb=0,Hb=[];Nb<Xb.length&&Gb<Ob.length;)Xb[Nb][0]===Ob[Gb][0]&&Xb[Nb][1]===Ob[Gb][1]?(Hb.push(Xb[Nb]),Nb++,Gb++):Xb[Nb][0]<Ob[Gb][0]||Xb[Nb][0]===Ob[Gb][0]&&Xb[Nb][1]<Ob[Gb][1]?Nb++:Gb++;return Hb}function Ka(Xb){var Ob=Ja(this),Nb=Ja(Xb),Gb;if(Gb=Ob>=Nb?$a(this,Ob):$a(Xb,Nb),0===Ob||0===Nb)return Gb;for(var Hb=this,Wb=Xb;Ob!==Nb;)if(Ob>Nb){if(Hb=Hb.parent,void 0===Hb)return Gb;--Ob}else{if(Wb=Wb.parent,void 0===Wb)return Gb;--Nb}for(;Hb!==Wb&&void 0!==typeof Hb&&void 0!==typeof Wb;)if(Hb=Hb.parent,Wb=Wb.parent,void 0===Hb||void 0===Wb)return Gb;return Hb===Wb?Hb:Gb}function Ja(Xb){for(var Ob=0,Nb=Xb;null!=Nb.parent;)Nb=Nb.parent,Ob++;return Ob}function $a(Xb,Ob){for(var Nb=Xb;0<Ob;)Nb=Nb.parent,--Ob;return Nb}function ti(Xb){var Ob=am[Xb.toLowerCase()];return Ob?{r:Ob[0],g:Ob[1],b:Ob[2],a:100}:void 0}function ai(Xb){if(0==Xb.indexOf('rgb(')){Xb=Xb.match(/rgb\(([^)]+)\)/)[1];var Ob=Xb.split(/ *, */).map(Number);return{r:Ob[0],g:Ob[1],b:Ob[2],a:100}}}function ni(Xb){if(0===Xb.indexOf('rgba(')){Xb=Xb.match(/rgba\(([^)]+)\)/)[1];var Ob=Xb.split(/ *, */).map(Number);return{r:Ob[0],g:Ob[1],b:Ob[2],a:100*Ob[3]}}}function oi(Xb){if('#'===Xb[0]&&7===Xb.length)return{r:parseInt(Xb.slice(1,3),16),g:parseInt(Xb.slice(3,5),16),b:parseInt(Xb.slice(5,7),16),a:100}}function si(Xb){if('#'===Xb[0]&&4===Xb.length)return{r:parseInt(Xb[1]+Xb[1],16),g:parseInt(Xb[2]+Xb[2],16),b:parseInt(Xb[3]+Xb[3],16),a:100}}function ri(Xb){if(0===Xb.indexOf('hsl(')){Xb=Xb.match(/hsl\(([^)]+)\)/)[1];var Ob=Xb.split(/ *, */),Nb=parseInt(Ob[0],10),Gb=parseInt(Ob[1],10),Hb=parseInt(Ob[2],10),Wb=tm(Nb,Gb,Hb);return Wb.a=100,Wb}}function di(Xb){if(0===Xb.indexOf('hsla(')){Xb=Xb.match(/hsla\(([^)]+)\)/)[1];var Ob=Xb.split(/ *, */),Nb=parseInt(Ob[0],10),Gb=parseInt(Ob[1],10),Hb=parseInt(Ob[2],10),Wb=parseInt(100*Ob[3],10),Zb=tm(Nb,Gb,Hb);return Zb.a=Wb,Zb}}function hi(Xb){var Ob=sm(Xb);return[Ob.r,Ob.g,Ob.b,_Mathround(255*Ob.a/100)]}function mi(Xb,Ob,Nb){return 0>Nb&&(Nb+=1),1<Nb&&(Nb-=1),Nb<1/6?Xb+6*(Ob-Xb)*Nb:Nb<1/2?Ob:Nb<2/3?Xb+6*((Ob-Xb)*(2/3-Nb)):Xb}function gi(Xb,Ob,Nb){var Gb,Hb,Wb,Zb,Qb,Kb;return Ob/=100,Nb/=100,0===Ob?Zb=Qb=Kb=255*Nb:(Hb=0.5>=Nb?Nb*(Ob+1):Nb+Ob-Nb*Ob,Gb=2*Nb-Hb,Wb=Xb/360,Zb=mi(Gb,Hb,Wb+1/3),Qb=mi(Gb,Hb,Wb),Kb=mi(Gb,Hb,Wb-1/3)),{r:Zb,g:Qb,b:Kb}}function ci(Xb){for(var Ob=Array(Xb),Nb=0,Gb=0;360>Gb;Gb+=360/Xb){Nb++;var Hb=gi(Gb,100,30+15*(Nb%4));Ob[Nb-1]=[_Mathround(255*Hb.r),_Mathround(255*Hb.g),_Mathround(255*Hb.b)]}return Ob}function ui(){return[_Mathfloor(256*Math.random()),_Mathfloor(256*Math.random()),_Mathfloor(256*Math.random())]}function pi(Xb,Ob={}){var Nb=Ob.color,Gb=void 0===Nb?'red':Nb,Hb=Ob.colors,Wb=Ob.alpha,Zb=void 0===Wb?255:Wb,Qb=Ob.randomColors,Jb=Ob.distinctColors,e_=Ob.labels,t_=void 0===e_?[]:e_,a_=Ob.labelsPosition,i_=void 0===a_?[]:a_,n_=Ob.labelColor,o_=void 0===n_?'blue':n_,s_=Ob.labelFont,r_=void 0===s_?'12px Helvetica':s_;this.checkProcessable('paintMasks',{channels:[3,4],bitDepth:[8,16],colorModel:Xr}),Gb&&!Array.isArray(Gb)&&(Gb=hi(Gb)),Hb&&(Hb=Hb.map(function(w_){return Array.isArray(w_)?w_:hi(w_)})),Array.isArray(Xb)||(Xb=[Xb]),void 0!==Jb&&Jb&&(Hb=ci(Xb.length));for(var l_=0,d_;l_<Xb.length;l_++){d_=Xb[l_],Hb?Gb=Hb[l_%Hb.length]:void 0!==Qb&&Qb&&(Gb=ui());for(var h_=0;h_<d_.width;h_++)for(var m_=0;m_<d_.height;m_++)if(d_.getBitXY(h_,m_))for(var g_=0;g_<_Mathmin(this.components,Gb.length);g_++)if(255===Zb)this.setValueXY(h_+d_.position[0],m_+d_.position[1],g_,Gb[g_]);else{var c_=this.getValueXY(h_+d_.position[0],m_+d_.position[1],g_);c_=_Mathround((c_*(255-Zb)+Gb[g_]*Zb)/255),this.setValueXY(h_+d_.position[0],m_+d_.position[1],g_,c_)}}if(Array.isArray(t_)&&0<t_.length){var u_=this.getCanvas({originalData:!0}),p_=u_.getContext('2d');p_.fillStyle=o_,p_.font=r_;for(var f_=0,b_;f_<_Mathmin(Xb.length,t_.length);f_++)b_=i_[f_]?i_[f_]:Xb[f_].position,p_.fillText(t_[f_],b_[0],b_[1]);this.setData(p_.getImageData(0,0,this.width,this.height).data)}return this}function fi(Xb,Ob,Nb={}){var Gb=Nb.color,Hb=void 0===Gb?'blue':Gb,Wb=Nb.colors,Zb=Nb.font,Qb=void 0===Zb?'12px Helvetica':Zb,Kb=Nb.rotate,Jb=void 0===Kb?0:Kb;if(this.checkProcessable('paintMasks',{channels:[3,4],bitDepth:[8,16],colorModel:Xr}),!Array.isArray(Xb))throw Error('paintLabels: labels must be an array');if(!Array.isArray(Ob))throw Error('paintLabels: positions must be an array');if(Hb&&!Array.isArray(Hb)&&(Hb=hi(Hb)),Wb=Wb?Wb.map(function(n_){return Array.isArray(n_)?n_:hi(n_)}):[Hb],Xb.length!==Ob.length)throw Error('paintLabels: positions and labels must be arrays from the same size');Array.isArray(Qb)||(Qb=[Qb]),Array.isArray(Jb)||(Jb=[Jb]);for(var $b=this.getCanvas({originalData:!0}),e_=$b.getContext('2d'),t_=0;t_<Xb.length;t_++){e_.save();var a_=Wb[t_%Wb.length];e_.fillStyle=`rgba(${a_[0]},${a_[1]},${a_[2]},${a_[3]/this.maxValue})`,e_.font=Qb[t_%Qb.length];var i_=Ob[t_];e_.translate(i_[0],i_[1]),e_.rotate(Jb[t_%Jb.length]/180*_MathPI),e_.fillText(Xb[t_],0,0),e_.restore()}return this.setData(e_.getImageData(0,0,this.width,this.height).data),this}function bi(Xb,Ob,Nb){var Gb=ad.zeros(Ob,Xb);if(Nb.filled)for(var Hb=0;Hb<Ob;Hb++)for(var Wb=0;Wb<Xb;Wb++)Gb.set(Hb,Wb,1);else{for(var Zb of[0,Ob-1])for(var Qb=0;Qb<Xb;Qb++)Gb.set(Zb,Qb,1);for(var Kb=0;Kb<Ob;Kb++)for(var Jb of[0,Xb-1])Gb.set(Kb,Jb,1)}return Gb}function ki(Xb,Ob,Nb){var Gb=ad.zeros(Ob,Xb,Nb),Hb=1-Ob%2,Wb=1-Xb%2,Zb=_Mathfloor((Xb-1)/2),Qb=_Mathfloor((Ob-1)/2),Kb=Zb*Zb,Jb=Qb*Qb;if(Nb.filled)for(var $b=0,e_;$b<=Qb;$b++){e_=_Mathfloor(_Mathsqrt(Kb-Kb*$b*$b/Jb));for(var t_=Zb-e_;t_<=Zb;t_++)Gb.set(Qb-$b,t_,1),Gb.set(Qb+$b+Hb,t_,1),Gb.set(Qb-$b,Xb-t_-1,1),Gb.set(Qb+$b+Hb,Xb-t_-1,1)}else{for(var a_=0;a_<=Qb;a_++){var i_=_Mathfloor(_Mathsqrt(Kb-Kb*a_*a_/Jb)),n_=Zb-i_;Gb.set(Qb-a_,n_,1),Gb.set(Qb+a_+Hb,n_,1),Gb.set(Qb-a_,Xb-n_-1,1),Gb.set(Qb+a_+Hb,Xb-n_-1,1)}for(var o_=0;o_<=Zb;o_++){var s_=_Mathfloor(_Mathsqrt(Jb-Jb*o_*o_/Kb)),r_=Qb-s_;Gb.set(r_,Zb-o_,1),Gb.set(r_,Zb+o_+Wb,1),Gb.set(Ob-r_-1,Zb-o_,1),Gb.set(Ob-r_-1,Zb+o_+Wb,1)}}return Gb}function Di(Xb,Ob,Nb){if(!Nb.filled)throw new Error('Non filled triangle is not implemented');for(var Gb=ad.zeros(Ob,Xb,Nb),Hb=0,Wb;Hb<Ob;Hb++){Wb=_Mathfloor((1-Hb/Ob)*Xb/2);for(var Zb=Wb;Zb<Xb-Wb;Zb++)Gb.set(Hb,Zb,1)}return Gb}function ji(Xb,Ob={}){var Nb=Ob.color,Gb=void 0===Nb?[this.maxValue,0,0]:Nb,Hb=Ob.shape;this.checkProcessable('paintPoints',{bitDepth:[8,16]});for(var Wb=new hm(Hb).getPoints(),Zb=_Mathmin(this.channels,Gb.length),Qb=0;Qb<Xb.length;Qb++)for(var Kb=Xb[Qb][0],Jb=Xb[Qb][1],$b=0;$b<Wb.length;$b++){var e_=Wb[$b][0],t_=Wb[$b][1];if(0<=Kb+e_&&0<=Jb+t_&&Kb+e_<this.width&&Jb+t_<this.height)for(var a_=(Kb+e_+(Jb+t_)*this.width)*this.channels,i_=0;i_<Zb;i_++)this.data[a_+i_]=Gb[i_]}return this}function Mi(Xb,Ob={}){var Nb=Ob.color,Gb=void 0===Nb?[this.maxValue,0,0]:Nb;this.checkProcessable('paintPoints',{bitDepth:[8,16]});for(var Hb=_Mathmin(this.channels,Gb.length),Wb=0;Wb<Xb.length;Wb++)for(var Zb=Xb[Wb],Qb=Xb[(Wb+1)%Xb.length],Kb=Qb[0]-Zb[0],Jb=Qb[1]-Zb[1],$b=_Mathmax(_Mathabs(Kb),_Mathabs(Jb)),a_=Zb[0],i_=Zb[1],n_=0;n_<=$b;n_++){var o_=_Mathround(a_),s_=_Mathround(i_);if(0<=o_&&0<=s_&&o_<this.width&&s_<this.height)for(var r_=(o_+s_*this.width)*this.channels,l_=0;l_<Hb;l_++)this.data[r_+l_]=Gb[l_];a_+=Kb/$b,i_+=Jb/$b}return this}function Si(Xb,Ob={}){var Nb=Ob.position;if(this.checkProcessable('extract',{bitDepth:[1,8,16]}),!Nb&&(Nb=Xb.getRelativePosition(this),!Nb))throw new Error('extract : can not extract an image because the relative position can not be determined, try to specify manually the position as an array of 2 elements [x,y].');if(1<this.bitDepth){for(var Gb=Cb.createFrom(this,{width:Xb.width,height:Xb.height,alpha:1,position:Nb,parent:this}),Hb=0;Hb<Xb.width;Hb++)for(var Wb=0;Wb<Xb.height;Wb++){for(var Zb=0,Qb;Zb<this.channels;Zb++)Qb=this.getValueXY(Hb+Nb[0],Wb+Nb[1],Zb),Gb.setValueXY(Hb,Wb,Zb,Qb);Xb.getBitXY(Hb,Wb)||Gb.setValueXY(Hb,Wb,this.components,0)}return Gb}for(var Kb=Cb.createFrom(this,{width:Xb.width,height:Xb.height,position:Nb,parent:this}),Jb=0;Jb<Xb.height;Jb++)for(var $b=0;$b<Xb.width;$b++)Xb.getBitXY($b,Jb)&&this.getBitXY($b+Nb[0],Jb+Nb[1])&&Kb.setBitXY($b,Jb);return Kb}function Ii(Xb={}){var Ob=Xb.x,Nb=void 0===Ob?0:Ob,Gb=Xb.y,Hb=void 0===Gb?0:Gb,Wb=Xb.inPlace,Qb=void 0===Wb||Wb?this:Cb.createFrom(this);if(this.checkProcessable('floodFill',{bitDepth:1}),1===this.bitDepth){var Kb=this.getBitXY(Nb,Hb);if(Kb)return Qb;var Jb=new mm;for(Jb.push(new Pi(Nb,Hb));0<Jb.length;){var $b=Jb.shift();Qb.setBitXY($b.x,$b.y);for(var e_=$b.x+1;e_<this.width&&!Qb.getBitXY(e_,$b.y)&&!this.getBitXY(e_,$b.y);e_++)Qb.setBitXY(e_,$b.y),$b.y+1<this.height&&!this.getBitXY(e_,$b.y+1)&&Jb.push(new Pi(e_,$b.y+1)),0<=$b.y-1&&!this.getBitXY(e_,$b.y-1)&&Jb.push(new Pi(e_,$b.y-1));for(var t_=$b.x-1;0<=t_&&!Qb.getBitXY(t_,$b.y)&&!this.getBitXY(t_,$b.y);t_++)Qb.setBitXY(t_,$b.y),$b.y+1<this.height&&!this.getBitXY(t_,$b.y+1)&&Jb.push(new Pi(t_,$b.y+1)),0<=$b.y-1&&!this.getBitXY(t_,$b.y-1)&&Jb.push(new Pi(t_,$b.y-1))}}return Qb}function Pi(Xb,Ob){this.x=Xb,this.y=Ob}function Ci(Xb={}){var Ob=Xb.maxSlots,Nb=void 0===Ob?256:Ob,Gb=Xb.channel,Hb=Xb.useAlpha;if(this.checkProcessable('getHistogram',{bitDepth:[1,8,16]}),void 0===Gb){if(1<this.components)throw new RangeError('You need to define the channel for an image that contains more than one channel');Gb=0}return Ai.call(this,Gb,{useAlpha:void 0===Hb||Hb,maxSlots:Nb})}function Bi(Xb={}){var Ob=Xb.maxSlots,Nb=void 0===Ob?256:Ob,Gb=Xb.useAlpha,Hb=void 0===Gb||Gb;this.checkProcessable('getHistograms',{bitDepth:[8,16]});for(var Wb=Array(Hb?this.components:this.channels),Zb=0;Zb<Wb.length;Zb++)Wb[Zb]=Ai.call(this,Zb,{useAlpha:Hb,maxSlots:Nb});return Wb}function Ai(Xb,Ob){var Nb=Ob.useAlpha,Gb=Ob.maxSlots;if(1===this.bitDepth){for(var Hb=[0,0],Wb=0;Wb<this.height;Wb++)for(var Zb=0,Qb;Zb<this.width;Zb++)Qb=this.getBitXY(Wb,Zb),0===Qb?Hb[0]+=1:1===Qb&&(Hb[1]+=1);return Hb}var Kb=Math.log2(Gb);if(!ul(Kb))throw new RangeError('maxSlots must be a power of 2, for example: 64, 256, 1024');var Jb=0;this.bitDepth>Kb&&(Jb=this.bitDepth-Kb);var $b=this.data,e_=vl(_Mathpow(2,_Mathmin(this.bitDepth,Kb)),0);if(Nb&&this.alpha)for(var t_=this.channels-Xb-1,a_=Xb;a_<$b.length;a_+=this.channels)e_[$b[a_]>>Jb]+=$b[a_+t_]/this.maxValue;else for(var i_=Xb;i_<$b.length;i_+=this.channels)e_[$b[i_]>>Jb]++;return e_}function Ri(Xb={}){var Ob=Xb.useAlpha,Gb=Xb.nbSlots,Hb=void 0===Gb?512:Gb;this.checkProcessable('getColorHistogram',{bitDepth:[8,16],components:[3]});var Wb=_Mathlog(Hb)/2.0794415416798357;if(Wb!==_Mathfloor(Wb))throw new RangeError('nbSlots must be a power of 8. Usually 8, 64, 512 or 4096');for(var Zb=this.bitDepth-Wb,Qb=this.data,Kb=vl(_Mathpow(8,Wb),0),Jb=_Mathpow(2,2*Wb),$b=_Mathpow(2,Wb),e_=0,t_;e_<Qb.length;e_+=this.channels)t_=(Qb[e_]>>Zb)*Jb+(Qb[e_+1]>>Zb)*$b+(Qb[e_+2]>>Zb),(void 0===Ob||Ob)&&this.alpha?Kb[t_]+=Qb[e_+this.channels-1]/this.maxValue:Kb[t_]++;return Kb}function zi(){this.checkProcessable('min',{bitDepth:[8,16]});for(var Xb=vl(this.channels,+Infinity),Ob=0;Ob<this.data.length;Ob+=this.channels)for(var Nb=0;Nb<this.channels;Nb++)this.data[Ob+Nb]<Xb[Nb]&&(Xb[Nb]=this.data[Ob+Nb]);return Xb}function Li(){this.checkProcessable('max',{bitDepth:[8,16]});for(var Xb=vl(this.channels,-Infinity),Ob=0;Ob<this.data.length;Ob+=this.channels)for(var Nb=0;Nb<this.channels;Nb++)this.data[Ob+Nb]>Xb[Nb]&&(Xb[Nb]=this.data[Ob+Nb]);return Xb}function Ei(){this.checkProcessable('sum',{bitDepth:[8,16]});for(var Xb=vl(this.channels,0),Ob=0;Ob<this.data.length;Ob+=this.channels)for(var Nb=0;Nb<this.channels;Nb++)Xb[Nb]+=this.data[Ob+Nb];return Xb}function Ti(Xb=0,Ob=0){this.checkProcessable('getMoment',{bitDepth:[1]});for(var Nb=0,Gb=0;Gb<this.width;Gb++)for(var Hb=0;Hb<this.height;Hb++)1===this.getBitXY(Gb,Hb)&&(Nb+=Gb**Xb*Hb**Ob);return Nb}function Vi(Xb={}){var Ob=Xb.mask,Nb=Xb.region,Gb=void 0===Nb?3:Nb,Hb=Xb.removeClosePoints,Wb=void 0===Hb?0:Hb,Zb=Xb.invert,Qb=void 0!==Zb&&Zb,Kb=Xb.maxEquals,Jb=void 0===Kb?2:Kb,$b=this;this.checkProcessable('localMaxima',{bitDepth:[8,16],components:1}),Gb*=4;for(var e_=Qb?0:1,t_=[1,0,-1,0,1,1,-1,-1,2,0,-2,0,2,2,-2,-2],a_=[0,1,0,-1,1,-1,1,-1,0,2,0,-2,2,-2,2,-2],i_=8>=Gb?1:2,n_=[],o_=i_;o_<$b.height-i_;o_++)for(var s_=i_;s_<$b.width-i_;s_++)if(!(Ob&&Ob.getBitXY(s_,o_)!==e_)){for(var r_=0,l_=0,d_=$b.data[s_+o_*$b.width],h_=0;h_<Gb;h_++)Qb?$b.data[s_+t_[h_]+(o_+a_[h_])*$b.width]>d_&&r_++:$b.data[s_+t_[h_]+(o_+a_[h_])*$b.width]<d_&&r_++,$b.data[s_+t_[h_]+(o_+a_[h_])*$b.width]===d_&&l_++;r_+l_===Gb&&l_<=Jb&&n_.push([s_,o_])}if(0<Wb)for(var m_=0;m_<n_.length;m_++)for(var g_=m_+1;g_<n_.length;g_++)_Mathsqrt(_Mathpow(n_[m_][0]-n_[g_][0],2)+_Mathpow(n_[m_][1]-n_[g_][1],2))<Wb&&(n_[m_][0]=n_[m_][0]+n_[g_][0]>>1,n_[m_][1]=n_[m_][1]+n_[g_][1]>>1,n_.splice(g_,1),g_--);return n_}function Yi(){for(var Xb=this.getHistograms({maxSlots:this.maxValue+1}),Ob=Array(Xb.length),Nb=0,Gb;Nb<Xb.length;Nb++)Gb=Xb[Nb],Ob[Nb]=Ia(Gb);return Ob}function Fi(){for(var Xb=this.getHistograms({maxSlots:this.maxValue+1}),Ob=Array(Xb.length),Nb=0,Gb;Nb<Xb.length;Nb++)Gb=Xb[Nb],Ob[Nb]=Sa(Gb);return Ob}function Ui(){this.checkProcessable('points',{bitDepth:[1]});for(var Xb=Array(this.size),Ob=0,Nb=0;Nb<this.width;Nb++)for(var Gb=0;Gb<this.height;Gb++)1===this.getBitXY(Nb,Gb)&&(Xb[Ob++]=[Nb,Gb]);return Xb.length=Ob,Xb}function qi(Xb,Ob={}){if(this===Xb)return[0,0];for(var Nb=[0,0],Gb=this;Gb;){if(Gb===Xb)return Nb;Gb.position&&(Nb[0]+=Gb.position[0],Nb[1]+=Gb.position[1]),Gb=Gb.parent}return!!Ob.defaultFurther&&Nb}function Xi(){return this.checkProcessable('getSvd',{bitDepth:[1]}),Ye(this.points)}function Oi(Xb={}){var Ob=Xb.alpha,Nb=void 0===Ob?1:Ob;this.checkProcessable('countAlphaPixels',{bitDepth:[8,16],alpha:1});var Gb=0;if(void 0!==Nb){for(var Hb=this.components;Hb<this.data.length;Hb+=this.channels)this.data[Hb]===Nb&&Gb++;return Gb}return this.size}function Ni(Xb,Ob={}){Ob.sorted||Xb.sort(Hi);const Nb=Xb.length,Gb=Array(2*Nb);for(var Hb=0,Wb=0;Wb<Nb;Wb++){const Qb=Xb[Wb];for(;2<=Hb&&0>=Gi(Gb[Hb-2],Gb[Hb-1],Qb);)Hb--;Gb[Hb++]=Qb}const Zb=Hb+1;for(Wb=Nb-2;0<=Wb;Wb--){const Qb=Xb[Wb];for(;Hb>=Zb&&0>=Gi(Gb[Hb-2],Gb[Hb-1],Qb);)Hb--;Gb[Hb++]=Qb}return Gb.slice(0,Hb-1)}function Gi(Xb,Ob,Nb){return(Ob[1]-Xb[1])*(Nb[0]-Xb[0])-(Ob[0]-Xb[0])*(Nb[1]-Xb[1])}function Hi(Xb,Ob){return Xb[0]===Ob[0]?Xb[1]-Ob[1]:Xb[0]-Ob[0]}function Wi(){var Xb=this;Xb.checkProcessable('monotoneChainConvexHull',{bitDepth:1});var Ob=Xb.getPoints();return Ni(Ob,{sorted:!0})}function Zi(Xb,Ob){return[Xb[0]-Ob[0],Xb[1]-Ob[1]]}function Qi(Xb){var Ob=_Mathsqrt(Xb[0]**2+Xb[1]**2);return[Xb[0]/Ob,Xb[1]/Ob]}function Ki(Xb,Ob,Nb){void 0===Nb&&(Nb=Array(Ob.length));for(var Gb=_Mathcos(Xb),Hb=_Mathsin(Xb),Wb=0;Wb<Nb.length;++Wb)Nb[Wb]=[Gb*Ob[Wb][0]-Hb*Ob[Wb][1],Hb*Ob[Wb][0]+Gb*Ob[Wb][1]];return Nb}function Ji(Xb={}){for(var Ob=Xb.originalPoints,Nb=void 0===Ob?Wi.call(this):Ob,Gb=Array(Nb.length),Hb=+Infinity,Wb=0,Zb=void 0,Qb=0,Kb;Qb<Gb.length;Qb++){Kb=$i(Nb[Qb],Nb[(Qb+1)%Gb.length]),Ki(-Kb,Nb,Gb);for(var Jb=Gb[Qb][0],$b=Gb[Qb][1],e_=Gb[(Qb+1)%Gb.length][0],t_=Gb[(Qb+1)%Gb.length][1],a_=!0,i_=0,n_=0,o_=0,s_=0;s_<Gb.length;s_++){var r_=Gb[s_][0],l_=Gb[s_][1],d_=(r_-Jb)/(e_-Jb);!0==a_?(a_=!1,i_=d_,n_=d_):(d_<i_&&(i_=d_),d_>n_&&(n_=d_));var h_=(-(e_-Jb)*l_+e_*$b-t_*Jb)/(e_-Jb);_Mathabs(h_)>_Mathabs(o_)&&(o_=h_)}var m_=[Jb+i_*(e_-Jb),$b],g_=[Jb+n_*(e_-Jb),$b],c_=_Mathabs(o_*(i_-n_)*(e_-Jb));c_<Hb&&(Wb=Kb,Hb=c_,Zb=[m_,g_,[g_[0],g_[1]-o_],[m_[0],m_[1]-o_]])}return Ki(Wb,Zb,Zb),Zb}function $i(Xb,Ob){var Nb=Zi(Ob,Xb),Gb=Qi(Nb),Hb=Math.acos(Gb[0]);return 0>Gb[1]?-Hb:Hb}function tn(Xb){for(var Ob=Xb.data,Nb=[1,0,-1,0],Gb=[0,1,0,-1],Hb=Xb.minMax,Wb=-Hb.min,Zb=Hb.max+Wb,Qb=[],Kb=0;Kb<=Zb;Kb++)Qb.push(Object.create(null));for(var Jb=0;Jb<Xb.width;Jb++)for(var $b=0;$b<Xb.height;$b++){var e_=Jb+$b*Xb.width,t_=Ob[e_];if(0!==t_){for(var a_=Object.create(null),i_=!1,n_=0;4>n_;n_++){var o_=Jb+Nb[n_],s_=$b+Gb[n_];if(0<=o_&&0<=s_&&o_<Xb.width&&s_<Xb.height){var r_=Ob[o_+s_*Xb.width];t_!==r_&&(i_=!0,0!==r_&&void 0===a_[r_]&&(a_[r_]=!0,Qb[r_+Wb][t_]?Qb[r_+Wb][t_]++:Qb[r_+Wb][t_]=1))}else i_=!0}i_&&(Qb[t_+Wb][t_]?Qb[t_+Wb][t_]++:Qb[t_+Wb][t_]=1)}}for(var l_={},d_=0;d_<Qb.length;d_++)0<Object.keys(Qb[d_]).length&&(l_[d_-Wb]=Qb[d_]);return l_}function an(Xb={}){var Ob=Xb.algorithm,Nb=void 0===Ob?'commonBorderLength':Ob,Gb=Xb.minCommonBorderLength,Hb=void 0===Gb?5:Gb,Wb=Xb.maxCommonBorderLength,Zb=void 0===Wb?100:Wb,Qb=Xb.minCommonBorderRatio,Kb=void 0===Qb?0.3:Qb,Jb=Xb.maxCommonBorderRatio,$b=void 0===Jb?1:Jb,e_=function(j_,M_,S_){return j_[S_]>=Hb&&j_[S_]<=Zb};'function'==typeof Nb&&(e_=Nb),'commonborderratio'===Nb.toLowerCase()&&(e_=function(j_,M_,S_){var I_=_Mathmin(j_[S_]/j_[M_],1);return I_>=Kb&&I_<=$b});var t_=this,a_=t_.commonBorderLength,i_={},n_={};for(var o_ of Object.keys(a_)){var s_=a_[o_],r_=Object.keys(s_);for(var l_ of r_)if(l_!==o_&&e_(s_,o_,l_)){var d_=l_;n_[l_]&&(d_=n_[l_]);var h_=o_;if(n_[o_]&&(h_=n_[o_]),+d_!==h_){var m_=_Mathmin(d_,h_),g_=_Mathmax(d_,h_);if(i_[m_]||(i_[m_]={}),i_[m_][g_]=!0,n_[g_]=m_,i_[g_]){for(var c_ of Object.keys(i_[g_]))i_[m_][c_]=!0,n_[c_]=m_;delete i_[g_]}}}}var u_=t_.minMax,p_=-u_.min,f_=u_.max+p_,b_=Array(f_+1).fill(0);for(var w_ of Object.keys(n_))b_[+w_+p_]=n_[w_];for(var x_=t_.data,y_=0,k_;y_<x_.length;y_++)if(k_=x_[y_],0!==k_){var v_=b_[k_+p_];0!==v_&&(x_[y_]=v_)}return t_.computed={},t_}function rn(Xb,Ob={}){function Nb(a_,i_){var n_=0,o_=0,s_=Xb.getBitXY(a_,i_),r_=s_?++Qb:--Kb;if(32767<Qb||-32768>Kb)throw new Error('Too many regions of interest');for(Jb[0]=a_,$b[0]=i_;n_<=o_;){var l_=Jb[n_&Wb],d_=$b[n_&Wb];if(Zb[d_*Xb.width+l_]=r_,0<l_&&0===Zb[d_*Xb.width+l_-1]&&Xb.getBitXY(l_-1,d_)===s_&&(o_++,Jb[o_&Wb]=l_-1,$b[o_&Wb]=d_,Zb[d_*Xb.width+l_-1]=-32768),0<d_&&0===Zb[(d_-1)*Xb.width+l_]&&Xb.getBitXY(l_,d_-1)===s_&&(o_++,Jb[o_&Wb]=l_,$b[o_&Wb]=d_-1,Zb[(d_-1)*Xb.width+l_]=-32768),l_<Xb.width-1&&0===Zb[d_*Xb.width+l_+1]&&Xb.getBitXY(l_+1,d_)===s_&&(o_++,Jb[o_&Wb]=l_+1,$b[o_&Wb]=d_,Zb[d_*Xb.width+l_+1]=-32768),d_<Xb.height-1&&0===Zb[(d_+1)*Xb.width+l_]&&Xb.getBitXY(l_,d_+1)===s_&&(o_++,Jb[o_&Wb]=l_,$b[o_&Wb]=d_+1,Zb[(d_+1)*Xb.width+l_]=-32768),Hb&&(0<l_&&0<d_&&0===Zb[(d_-1)*Xb.width+l_-1]&&Xb.getBitXY(l_-1,d_-1)===s_&&(o_++,Jb[o_&Wb]=l_-1,$b[o_&Wb]=d_-1,Zb[(d_-1)*Xb.width+l_-1]=-32768),l_<Xb.width-1&&0<d_&&0===Zb[(d_-1)*Xb.width+l_+1]&&Xb.getBitXY(l_+1,d_-1)===s_&&(o_++,Jb[o_&Wb]=l_+1,$b[o_&Wb]=d_-1,Zb[(d_-1)*Xb.width+l_+1]=-32768),0<l_&&d_<Xb.height-1&&0===Zb[(d_+1)*Xb.width+l_-1]&&Xb.getBitXY(l_-1,d_+1)===s_&&(o_++,Jb[o_&Wb]=l_-1,$b[o_&Wb]=d_+1,Zb[(d_+1)*Xb.width+l_-1]=-32768),l_<Xb.width-1&&d_<Xb.height-1&&0===Zb[(d_+1)*Xb.width+l_+1]&&Xb.getBitXY(l_+1,d_+1)===s_&&(o_++,Jb[o_&Wb]=l_+1,$b[o_&Wb]=d_+1,Zb[(d_+1)*Xb.width+l_+1]=-32768)),n_++,o_-n_>Wb)throw new Error('analyseMask can not finish, the array to manage internal data is not big enough.You could improve mask by changing MAX_ARRAY')}}for(var Gb=Ob.allowCorners,Hb=void 0!==Gb&&Gb,Wb=65535,Zb=new Int16Array(Xb.size),Qb=0,Kb=0,Jb=new Uint16Array(Wb+1),$b=new Uint16Array(Wb+1),e_=0;e_<Xb.width;e_++)for(var t_=0;t_<Xb.height;t_++)0===Zb[t_*Xb.width+e_]&&Nb(e_,t_);return new um(Xb,Zb)}function ln(Xb){this.value=Xb,this.parent=null,this.rank=0}function dn(Xb,Ob={}){var Nb=Ob.allowCorners,Hb=4;void 0!==Nb&&Nb&&(Hb=8);var Wb,Zb,Qb;if(8==Hb)Wb=xm,Zb=ym,Qb=km;else if(4==Hb)Wb=bm,Zb=_m,Qb=wm;else throw new RangeError('unsupported neighbours count: '+Hb);for(var Kb=Xb.size,Jb=Xb.width,$b=Xb.height,e_=Array(Kb),t_=new Uint32Array(Kb),a_=new fm,i_=1,n_=0;n_<$b;n_++)for(var o_=0,s_;o_<Jb;o_++)if(s_=o_+n_*Jb,Xb.getBit(s_)){for(var r_=null,l_=0;l_<Qb.length;l_++){var d_=o_+Wb[l_],h_=n_+Zb[l_];if(0<=d_&&0<=h_&&d_<Jb&&h_<$b){var g_=e_[d_+h_*Jb];g_?(Qb[l_]=g_,(!r_||Qb[l_].value<r_.value)&&(r_=Qb[l_])):Qb[l_]=null}}if(!r_)e_[s_]=a_.add(i_++);else{e_[s_]=r_;for(var c_=0;c_<Qb.length;c_++)Qb[c_]&&Qb[c_]!==r_&&a_.union(r_,Qb[c_])}}for(var u_=0;u_<$b;u_++)for(var p_=0,f_;p_<Jb;p_++)f_=p_+u_*Jb,Xb.getBit(f_)&&(t_[f_]=a_.find(e_[f_]).value);return new um(Xb,t_)}function hn(Xb={}){function Ob({maxima:w_=!0}){for(var x_=1;x_<$b.height-1;x_++)for(var y_=1,k_;y_<$b.width-1;y_++)if(k_=y_+x_*$b.width,0===o_[k_]){var v_=w_?$b.data[k_]:-$b.data[y_+x_*$b.width];if($b.data[x_*$b.width+y_-1]>v_)continue;if($b.data[x_*$b.width+y_+1]>v_)continue;if($b.data[(x_-1)*$b.width+y_]>v_)continue;if($b.data[(x_+1)*$b.width+y_]>v_)continue;if(Wb){if($b.data[(x_-1)*$b.width+y_-1]>v_)continue;if($b.data[(x_-1)*$b.width+y_+1]>v_)continue;if($b.data[(x_+1)*$b.width+y_-1]>v_)continue;if($b.data[(x_+1)*$b.width+y_+1]>v_)continue}n_[k_]=w_?++a_:--i_;var D_=Nb(y_,x_,e_);D_||(w_?--a_:++i_)}}function Nb(w_,x_){var y_=m_;u_=0,p_=1,g_[0]=w_,c_[0]=x_;for(var k_=!0;u_<p_;){var v_=g_[u_&r_],D_=c_[u_&r_];k_&=Gb(v_,D_,e_),u_++}if(!k_){for(var j_=0;j_<p_;j_++){var M_=g_[j_&r_],S_=c_[j_&r_],I_=S_*$b.width+M_;n_[I_]=0}m_=y_}return k_}function Gb(w_,x_,y_){for(var k_=n_[x_*$b.width+w_],v_=$b.data[x_*$b.width+w_],D_=x_-1;D_<=x_+1;D_++)for(var j_=w_-1,M_;j_<=w_+1;j_++)if(M_=D_*$b.width+j_,0===o_[M_])switch(o_[M_]=1,s_[M_]=$b.data[M_]-v_,y_){case e_:if(0===s_[M_]){if(0===j_||0===D_||j_===$b.width-1||D_===$b.height-1)return!1;n_[M_]=k_,g_[p_&r_]=j_,c_[p_&r_]=D_,p_++}else{if(0<s_[M_])return!1;Qb||(n_[M_]=k_,l_[m_&r_]=j_,d_[m_&r_]=D_,m_++)}break;case t_:0>=s_[M_]&&(n_[M_]=k_,l_[m_&r_]=j_,d_[m_&r_]=D_,m_++);break;default:throw new Error('unreachable');}return!0}var Hb=Xb.allowCorner,Wb=void 0===Hb||Hb,Zb=Xb.onlyTop,Qb=void 0!==Zb&&Zb,Kb=Xb.invert,$b=this;$b.checkProcessable('fromMaxima',{components:[1]});var e_=1,t_=2,a_=0,i_=0,n_=new Int16Array($b.size),o_=new Int8Array($b.size),s_=new Float32Array($b.size),r_=1048575,l_=new Uint16Array(r_+1),d_=new Uint16Array(r_+1),h_=0,m_=0,g_=new Uint16Array(r_+1),c_=new Uint16Array(r_+1),u_=0,p_=0;for(Ob($b,{maxima:!(void 0!==Kb&&Kb)});h_<m_;){var f_=l_[h_&r_],b_=d_[h_&r_];Gb(f_,b_,t_),h_++}return new um($b,n_)}function mn(Xb={}){var Ob=Xb.points,Nb=Xb.mask,Gb=Xb.image,Hb=Xb.fillMaxValue,Wb=void 0===Hb?this.maxValue:Hb,Zb=Xb.invert,Qb=void 0!==Zb&&Zb,Kb=Gb||this;Kb.checkProcessable('fromWaterShed',{bitDepth:[8,16],components:1}),Qb=!Qb,Ob||(Ob=Kb.getLocalMaxima({invert:Qb,mask:Nb}));for(var Jb=Qb?0:1,$b=new Int16Array(Kb.size),e_=Kb.width,t_=Kb.height,a_=new vm({comparator:(c_,u_)=>c_[2]-u_[2],strategy:vm.BinaryHeapStrategy}),i_=0,n_;i_<Ob.length;i_++){n_=Ob[i_][0]+Ob[i_][1]*e_,$b[n_]=i_+1;var o_=Kb.data[n_];(Qb&&o_<=Wb||!Qb&&o_>=Wb)&&a_.queue([Ob[i_][0],Ob[i_][1],o_])}for(;0<a_.length;)for(var s_=a_.dequeue(),r_=s_[0]+s_[1]*e_,l_=0;4>l_;l_++){var d_=s_[0]+Dm[l_],h_=s_[1]+jm[l_];if(0<=d_&&0<=h_&&d_<e_&&h_<t_){var m_=d_+h_*e_;if(!Nb||Nb.getBit(m_)===Jb){var g_=Kb.data[m_];(Qb&&g_<=Wb||!Qb&&g_>=Wb)&&0===$b[m_]&&($b[m_]=$b[r_],a_.queue([s_[0]+Dm[l_],s_[1]+jm[l_],g_]))}}}return new um(Kb,$b)}function gn(Xb,Ob={}){for(var Nb=new hm(Ob),Gb=new Int16Array(this.size),Hb=0,Wb=Nb.getPoints(),Zb=0;Zb<Xb.length;Zb++){Hb++;for(var Qb=Xb[Zb][0],Kb=Xb[Zb][1],Jb=0;Jb<Wb.length;Jb++){var $b=Wb[Jb][0],e_=Wb[Jb][1];0<=Qb+$b&&0<=Kb+e_&&Qb+$b<this.width&&Kb+e_<this.height&&(Gb[Qb+$b+(Kb+e_)*this.width]=Hb)}}return new um(this,Gb)}function cn(Xb){for(var Ob=Xb.map,Nb=Ob.data,Gb=new Set,Hb=new Map,Wb=new Set,Zb=[1,0,-1,0],Qb=[0,1,0,-1],Kb=Xb.minX;Kb<=Xb.maxX;Kb++)for(var Jb=Xb.minY,$b;Jb<=Xb.maxY;Jb++)if($b=Kb+Jb*Ob.width,Nb[$b]===Xb.id)for(var e_=0;4>e_;e_++){var t_=Kb+Zb[e_],a_=Jb+Qb[e_];if(0<=t_&&0<=a_&&t_<Ob.width&&a_<Ob.height){var i_=t_+a_*Ob.width;if(Nb[i_]!==Xb.id&&!Wb.has(i_)){Wb.add(i_),Gb.add(Nb[i_]);var n_=Hb.get(Nb[i_]);n_?Hb.set(Nb[i_],++n_):Hb.set(Nb[i_],1)}}}var o_=Array.from(Gb),s_=o_.map(function(r_){return Hb.get(r_)});return{ids:o_,lengths:s_}}function un(Xb){var Ob=new Set,Nb=Xb.map,Gb=Nb.data;for(var Hb of[0,Xb.height-1])for(var Wb=0,Zb;Wb<Xb.width;Wb++){if(Zb=(Hb+Xb.minY)*Nb.width+Wb+Xb.minX,0<Wb-Xb.minX&&Gb[Zb]===Xb.id&&Gb[Zb-1]!==Xb.id){var Qb=Gb[Zb-1];Ob.add(Qb)}if(1<Nb.width-Wb-Xb.minX&&Gb[Zb]===Xb.id&&Gb[Zb+1]!==Xb.id){var Kb=Gb[Zb+1];Ob.add(Kb)}}for(var Jb of[0,Xb.width-1])for(var $b=0,e_;$b<Xb.height;$b++){if(e_=($b+Xb.minY)*Nb.width+Jb+Xb.minX,0<$b-Xb.minY&&Gb[e_]===Xb.id&&Gb[e_-Nb.width]!==Xb.id){var t_=Gb[e_-Nb.width];Ob.add(t_)}if(1<Nb.height-$b-Xb.minY&&Gb[e_]===Xb.id&&Gb[e_+Nb.width]!==Xb.id){var a_=Gb[e_+Nb.width];Ob.add(a_)}}return Array.from(Ob)}function pn(Xb){var Ob=0,Nb=Xb.map,Gb=Nb.data,Hb=[0];1<Xb.height&&(Hb[1]=Xb.height-1);for(var Wb of Hb)for(var Zb=1,Qb;Zb<Xb.width-1;Zb++)Qb=(Wb+Xb.minY)*Nb.width+Zb+Xb.minX,Gb[Qb]===Xb.id&&Ob++;var Kb=[0];1<Xb.width&&(Kb[1]=Xb.width-1);for(var Jb of Kb)for(var $b=0,e_;$b<Xb.height;$b++)e_=($b+Xb.minY)*Nb.width+Jb+Xb.minX,Gb[e_]===Xb.id&&Ob++;return Ob}function bn(Xb){for(var Ob=0,Nb=Xb.map,Gb=Nb.data,Hb=1;Hb<Xb.width-1;Hb++)for(var Wb=1,Zb;Wb<Xb.height-1;Wb++)Zb=(Wb+Xb.minY)*Nb.width+Hb+Xb.minX,Gb[Zb]===Xb.id&&(Gb[Zb-1]!==Xb.id||Gb[Zb+1]!==Xb.id||Gb[Zb-Nb.width]!==Xb.id||Gb[Zb+Nb.width]!==Xb.id)&&Ob++;return Ob+Xb.box}function wn(Xb){for(var Ob=0,Nb=Xb.map,Gb=Nb.data,Hb=1;Hb<Xb.width-1;Hb++)for(var Wb=1,Zb;Wb<Xb.height-1;Wb++)Zb=(Wb+Xb.minY)*Nb.width+Hb+Xb.minX,Gb[Zb]===Xb.id&&(Xb.externalIDs.includes(Gb[Zb-1])||Xb.externalIDs.includes(Gb[Zb+1])||Xb.externalIDs.includes(Gb[Zb-Nb.width])||Xb.externalIDs.includes(Gb[Zb+Nb.width]))&&Ob++;return Ob+Xb.box}function xn(Xb){var Ob=[Xb.id],Nb=Xb.map,Gb=Nb.data;if(2<Xb.height)for(var Hb=0,Wb;Hb<Xb.width;Hb++)if(Wb=Xb.minY*Nb.width+Hb+Xb.minX,Ob.includes(Gb[Wb])){var Zb=Gb[Wb+Nb.width];Ob.includes(Zb)||Xb.boxIDs.includes(Zb)||Ob.push(Zb)}for(var Qb=[,,,,],Kb=1;Kb<Xb.width-1;Kb++)for(var Jb=1,$b;Jb<Xb.height-1;Jb++)if($b=(Jb+Xb.minY)*Nb.width+Kb+Xb.minX,Ob.includes(Gb[$b])){Qb[0]=Gb[$b-1],Qb[1]=Gb[$b+1],Qb[2]=Gb[$b-Nb.width],Qb[3]=Gb[$b+Nb.width];for(var e_=0,t_;4>e_;e_++)t_=Qb[e_],Ob.includes(t_)||Xb.boxIDs.includes(t_)||Ob.push(t_)}return Ob}function yn(Xb,Ob,Nb,Gb,Hb){for(var Wb={id:[],surface:[],roiSurfaceCovered:[],same:0,opposite:0,total:0},Zb=0;Zb<Nb.length;Zb++){var Qb=Nb[Zb],Kb=Qb[0],Jb=Qb[1],$b=Kb+Xb+(Jb+Ob)*Gb.width,e_=Gb.data[$b];(0<e_||0>e_)&&(Wb.id.includes(e_)?Wb.surface[Wb.id.indexOf(e_)]+=1:(Wb.id.push(e_),Wb.surface.push(1)))}for(var t_=0,a_;t_<Wb.id.length;t_++)a_=_Mathsign(Wb.id[t_]),a_===Hb?Wb.same+=Wb.surface[t_]:Wb.opposite+=Wb.surface[t_],Wb.roiSurfaceCovered[t_]=Wb.surface[t_]/Nb.length;return Wb.total=Wb.opposite+Wb.same,Wb}function kn(Xb){Lm||(Lm=new Cb(1,1));var Ob=zm.get(Xb);return Ob||(Ob=new Em(Xb),zm.set(Xb,Ob)),Ob}function vn(Xb){return kn(Xb).canWrite()}function Dn(Xb){return Xb.includes('/')||(Xb='image/'+Xb),Xb}function jn(Xb){for(var Ob=Xb.length;0<=--Ob;)Xb[Ob]=0}function Mn(Xb,Ob,Nb,Gb,Hb){this.static_tree=Xb,this.extra_bits=Ob,this.extra_base=Nb,this.elems=Gb,this.max_length=Hb,this.has_stree=Xb&&Xb.length}function Sn(Xb,Ob){this.dyn_tree=Xb,this.max_code=0,this.stat_desc=Ob}function In(Xb){return 256>Xb?bg[Xb]:bg[256+(Xb>>>7)]}function Pn(Xb,Ob){Xb.pending_buf[Xb.pending++]=255&Ob,Xb.pending_buf[Xb.pending++]=255&Ob>>>8}function Cn(Xb,Ob,Nb){Xb.bi_valid>ng-Nb?(Xb.bi_buf|=65535&Ob<<Xb.bi_valid,Pn(Xb,Xb.bi_buf),Xb.bi_buf=Ob>>ng-Xb.bi_valid,Xb.bi_valid+=Nb-ng):(Xb.bi_buf|=65535&Ob<<Xb.bi_valid,Xb.bi_valid+=Nb)}function Bn(Xb,Ob,Nb){Cn(Xb,Nb[2*Ob],Nb[2*Ob+1])}function An(Xb,Ob){var Nb=0;do Nb|=1&Xb,Xb>>>=1,Nb<<=1;while(0<--Ob);return Nb>>>1}function Rn(Xb){16===Xb.bi_valid?(Pn(Xb,Xb.bi_buf),Xb.bi_buf=0,Xb.bi_valid=0):8<=Xb.bi_valid&&(Xb.pending_buf[Xb.pending++]=255&Xb.bi_buf,Xb.bi_buf>>=8,Xb.bi_valid-=8)}function zn(Xb,Ob){var Nb=Ob.dyn_tree,Gb=Ob.max_code,Hb=Ob.stat_desc.static_tree,Wb=Ob.stat_desc.has_stree,Zb=Ob.stat_desc.extra_bits,Qb=Ob.stat_desc.extra_base,Kb=Ob.stat_desc.max_length,n_=0,Jb,$b,e_,t_,a_,i_;for(t_=0;t_<=ig;t_++)Xb.bl_count[t_]=0;for(Nb[2*Xb.heap[Xb.heap_max]+1]=0,Jb=Xb.heap_max+1;Jb<ag;Jb++)($b=Xb.heap[Jb],t_=Nb[2*Nb[2*$b+1]+1]+1,t_>Kb&&(t_=Kb,n_++),Nb[2*$b+1]=t_,!($b>Gb))&&(Xb.bl_count[t_]++,a_=0,$b>=Qb&&(a_=Zb[$b-Qb]),i_=Nb[2*$b],Xb.opt_len+=i_*(t_+a_),Wb&&(Xb.static_len+=i_*(Hb[2*$b+1]+a_)));if(0!=n_){do{for(t_=Kb-1;0===Xb.bl_count[t_];)t_--;Xb.bl_count[t_]--,Xb.bl_count[t_+1]+=2,Xb.bl_count[Kb]--,n_-=2}while(0<n_);for(t_=Kb;0!==t_;t_--)for($b=Xb.bl_count[t_];0!==$b;)(e_=Xb.heap[--Jb],!(e_>Gb))&&(Nb[2*e_+1]!==t_&&(Xb.opt_len+=(t_-Nb[2*e_+1])*Nb[2*e_],Nb[2*e_+1]=t_),$b--)}}function Ln(Xb,Ob,Nb){var Gb=Array(ig+1),Hb=0,Wb,Zb;for(Wb=1;Wb<=ig;Wb++)Gb[Wb]=Hb=Hb+Nb[Wb-1]<<1;for(Zb=0;Zb<=Ob;Zb++){var Qb=Xb[2*Zb+1];0!==Qb&&(Xb[2*Zb]=An(Gb[Qb]++,Qb))}}function En(){var Wb=Array(ig+1),Xb,Ob,Nb,Gb,Hb;for(Nb=0,Gb=0;Gb<Km-1;Gb++)for(wg[Gb]=Nb,Xb=0;Xb<1<<hg[Gb];Xb++)_g[Nb++]=Gb;for(_g[Nb-1]=Gb,Hb=0,Gb=0;16>Gb;Gb++)for(xg[Gb]=Hb,Xb=0;Xb<1<<mg[Gb];Xb++)bg[Hb++]=Gb;for(Hb>>=7;Gb<eg;Gb++)for(xg[Gb]=Hb<<7,Xb=0;Xb<1<<mg[Gb]-7;Xb++)bg[256+Hb++]=Gb;for(Ob=0;Ob<=ig;Ob++)Wb[Ob]=0;for(Xb=0;143>=Xb;)pg[2*Xb+1]=8,Xb++,Wb[8]++;for(;255>=Xb;)pg[2*Xb+1]=9,Xb++,Wb[9]++;for(;279>=Xb;)pg[2*Xb+1]=7,Xb++,Wb[7]++;for(;287>=Xb;)pg[2*Xb+1]=8,Xb++,Wb[8]++;for(Ln(pg,$m+1,Wb),Xb=0;Xb<eg;Xb++)fg[2*Xb+1]=5,fg[2*Xb]=An(Xb,5);yg=new Mn(pg,hg,Jm+1,$m,ig),kg=new Mn(fg,mg,0,eg,ig),vg=new Mn([],gg,0,tg,og)}function Tn(Xb){var Ob;for(Ob=0;Ob<$m;Ob++)Xb.dyn_ltree[2*Ob]=0;for(Ob=0;Ob<eg;Ob++)Xb.dyn_dtree[2*Ob]=0;for(Ob=0;Ob<tg;Ob++)Xb.bl_tree[2*Ob]=0;Xb.dyn_ltree[2*sg]=1,Xb.opt_len=Xb.static_len=0,Xb.last_lit=Xb.matches=0}function Vn(Xb){8<Xb.bi_valid?Pn(Xb,Xb.bi_buf):0<Xb.bi_valid&&(Xb.pending_buf[Xb.pending++]=Xb.bi_buf),Xb.bi_buf=0,Xb.bi_valid=0}function Yn(Xb,Ob,Nb,Gb){Vn(Xb),Gb&&(Pn(Xb,Nb),Pn(Xb,~Nb)),Um.arraySet(Xb.pending_buf,Xb.window,Ob,Nb,Xb.pending),Xb.pending+=Nb}function Fn(Xb,Ob,Nb,Gb){var Hb=2*Ob,Wb=2*Nb;return Xb[Hb]<Xb[Wb]||Xb[Hb]===Xb[Wb]&&Gb[Ob]<=Gb[Nb]}function Un(Xb,Ob,Nb){for(var Gb=Xb.heap[Nb],Hb=Nb<<1;Hb<=Xb.heap_len&&(Hb<Xb.heap_len&&Fn(Ob,Xb.heap[Hb+1],Xb.heap[Hb],Xb.depth)&&Hb++,!Fn(Ob,Gb,Xb.heap[Hb],Xb.depth));)Xb.heap[Nb]=Xb.heap[Hb],Nb=Hb,Hb<<=1;Xb.heap[Nb]=Gb}function qn(Xb,Ob,Nb){var Wb=0,Gb,Hb,Zb,Qb;if(0!==Xb.last_lit)do Gb=Xb.pending_buf[Xb.d_buf+2*Wb]<<8|Xb.pending_buf[Xb.d_buf+2*Wb+1],Hb=Xb.pending_buf[Xb.l_buf+Wb],Wb++,0===Gb?Bn(Xb,Hb,Ob):(Zb=_g[Hb],Bn(Xb,Zb+Jm+1,Ob),Qb=hg[Zb],0!==Qb&&(Hb-=wg[Zb],Cn(Xb,Hb,Qb)),Gb--,Zb=In(Gb),Bn(Xb,Zb,Nb),Qb=mg[Zb],0!==Qb&&(Gb-=xg[Zb],Cn(Xb,Gb,Qb)));while(Wb<Xb.last_lit);Bn(Xb,sg,Ob)}function Xn(Xb,Ob){var Nb=Ob.dyn_tree,Gb=Ob.stat_desc.static_tree,Hb=Ob.stat_desc.has_stree,Wb=Ob.stat_desc.elems,Kb=-1,Zb,Qb,Jb;for(Xb.heap_len=0,Xb.heap_max=ag,Zb=0;Zb<Wb;Zb++)0===Nb[2*Zb]?Nb[2*Zb+1]=0:(Xb.heap[++Xb.heap_len]=Kb=Zb,Xb.depth[Zb]=0);for(;2>Xb.heap_len;)Jb=Xb.heap[++Xb.heap_len]=2>Kb?++Kb:0,Nb[2*Jb]=1,Xb.depth[Jb]=0,Xb.opt_len--,Hb&&(Xb.static_len-=Gb[2*Jb+1]);for(Ob.max_code=Kb,Zb=Xb.heap_len>>1;1<=Zb;Zb--)Un(Xb,Nb,Zb);Jb=Wb;do Zb=Xb.heap[1],Xb.heap[1]=Xb.heap[Xb.heap_len--],Un(Xb,Nb,1),Qb=Xb.heap[1],Xb.heap[--Xb.heap_max]=Zb,Xb.heap[--Xb.heap_max]=Qb,Nb[2*Jb]=Nb[2*Zb]+Nb[2*Qb],Xb.depth[Jb]=(Xb.depth[Zb]>=Xb.depth[Qb]?Xb.depth[Zb]:Xb.depth[Qb])+1,Nb[2*Zb+1]=Nb[2*Qb+1]=Jb,Xb.heap[1]=Jb++,Un(Xb,Nb,1);while(2<=Xb.heap_len);Xb.heap[--Xb.heap_max]=Xb.heap[1],zn(Xb,Ob),Ln(Nb,Kb,Xb.bl_count)}function On(Xb,Ob,Nb){var Hb=-1,Zb=Ob[1],Qb=0,Kb=7,Jb=4,Gb,Wb;for(0===Zb&&(Kb=138,Jb=3),Ob[2*(Nb+1)+1]=65535,Gb=0;Gb<=Nb;Gb++){if(Wb=Zb,Zb=Ob[2*(Gb+1)+1],++Qb<Kb&&Wb===Zb)continue;else Qb<Jb?Xb.bl_tree[2*Wb]+=Qb:0===Wb?10>=Qb?Xb.bl_tree[2*lg]++:Xb.bl_tree[2*dg]++:(Wb!==Hb&&Xb.bl_tree[2*Wb]++,Xb.bl_tree[2*rg]++);Qb=0,Hb=Wb,0===Zb?(Kb=138,Jb=3):Wb===Zb?(Kb=6,Jb=3):(Kb=7,Jb=4)}}function Nn(Xb,Ob,Nb){var Hb=-1,Zb=Ob[1],Qb=0,Kb=7,Jb=4,Gb,Wb;for(0===Zb&&(Kb=138,Jb=3),Gb=0;Gb<=Nb;Gb++){if(Wb=Zb,Zb=Ob[2*(Gb+1)+1],++Qb<Kb&&Wb===Zb)continue;else if(Qb<Jb)do Bn(Xb,Wb,Xb.bl_tree);while(0!=--Qb);else 0===Wb?10>=Qb?(Bn(Xb,lg,Xb.bl_tree),Cn(Xb,Qb-3,3)):(Bn(Xb,dg,Xb.bl_tree),Cn(Xb,Qb-11,7)):(Wb!==Hb&&(Bn(Xb,Wb,Xb.bl_tree),Qb--),Bn(Xb,rg,Xb.bl_tree),Cn(Xb,Qb-3,2));Qb=0,Hb=Wb,0===Zb?(Kb=138,Jb=3):Wb===Zb?(Kb=6,Jb=3):(Kb=7,Jb=4)}}function Gn(Xb){var Ob;for(On(Xb,Xb.dyn_ltree,Xb.l_desc.max_code),On(Xb,Xb.dyn_dtree,Xb.d_desc.max_code),Xn(Xb,Xb.bl_desc),Ob=tg-1;3<=Ob&&0===Xb.bl_tree[2*cg[Ob]+1];Ob--);return Xb.opt_len+=3*(Ob+1)+5+5+4,Ob}function Hn(Xb,Ob,Nb,Gb){var Hb;for(Cn(Xb,Ob-257,5),Cn(Xb,Nb-1,5),Cn(Xb,Gb-4,4),Hb=0;Hb<Gb;Hb++)Cn(Xb,Xb.bl_tree[2*cg[Hb]+1],3);Nn(Xb,Xb.dyn_ltree,Ob-1),Nn(Xb,Xb.dyn_dtree,Nb-1)}function Wn(Xb){var Ob=4093624447,Nb;for(Nb=0;31>=Nb;Nb++,Ob>>>=1)if(1&Ob&&0!==Xb.dyn_ltree[2*Nb])return Xm;if(0!==Xb.dyn_ltree[18]||0!==Xb.dyn_ltree[20]||0!==Xb.dyn_ltree[26])return Om;for(Nb=32;Nb<Jm;Nb++)if(0!==Xb.dyn_ltree[2*Nb])return Om;return Xm}function Qn(Xb,Ob,Nb,Gb){Cn(Xb,(Gm<<1)+(Gb?1:0),3),Yn(Xb,Ob,Nb,!0)}function oo(Xb,Ob){return Xb.msg=zg[Ob],Ob}function so(Xb){return(Xb<<1)-(4<Xb?9:0)}function ro(Xb){for(var Ob=Xb.length;0<=--Ob;)Xb[Ob]=0}function lo(Xb){var Ob=Xb.state,Nb=Ob.pending;Nb>Xb.avail_out&&(Nb=Xb.avail_out),0===Nb||(Um.arraySet(Xb.output,Ob.pending_buf,Ob.pending_out,Nb,Xb.next_out),Xb.next_out+=Nb,Ob.pending_out+=Nb,Xb.total_out+=Nb,Xb.avail_out-=Nb,Ob.pending-=Nb,0===Ob.pending&&(Ob.pending_out=0))}function ho(Xb,Ob){Cg._tr_flush_block(Xb,0<=Xb.block_start?Xb.block_start:-1,Xb.strstart-Xb.block_start,Ob),Xb.block_start=Xb.strstart,lo(Xb.strm)}function mo(Xb,Ob){Xb.pending_buf[Xb.pending++]=Ob}function go(Xb,Ob){Xb.pending_buf[Xb.pending++]=255&Ob>>>8,Xb.pending_buf[Xb.pending++]=255&Ob}function co(Xb,Ob,Nb,Gb){var Hb=Xb.avail_in;return(Hb>Gb&&(Hb=Gb),0===Hb)?0:(Xb.avail_in-=Hb,Um.arraySet(Ob,Xb.input,Xb.next_in,Hb,Nb),1===Xb.state.wrap?Xb.adler=Bg(Xb.adler,Ob,Hb,Nb):2===Xb.state.wrap&&(Xb.adler=Rg(Xb.adler,Ob,Hb,Nb)),Xb.next_in+=Hb,Xb.total_in+=Hb,Hb)}function uo(Xb,Ob){var Nb=Xb.max_chain_length,Gb=Xb.strstart,Zb=Xb.prev_length,Qb=Xb.nice_match,Kb=Xb.strstart>Xb.w_size-uc?Xb.strstart-(Xb.w_size-uc):0,Jb=Xb.window,$b=Xb.w_mask,e_=Xb.prev,t_=Xb.strstart+cc,a_=Jb[Gb+Zb-1],i_=Jb[Gb+Zb],Hb,Wb;Xb.prev_length>=Xb.good_match&&(Nb>>=2),Qb>Xb.lookahead&&(Qb=Xb.lookahead);do{if(Hb=Ob,Jb[Hb+Zb]!==i_||Jb[Hb+Zb-1]!==a_||Jb[Hb]!==Jb[Gb]||Jb[++Hb]!==Jb[Gb+1])continue;Gb+=2,Hb++;do;while(Jb[++Gb]===Jb[++Hb]&&Jb[++Gb]===Jb[++Hb]&&Jb[++Gb]===Jb[++Hb]&&Jb[++Gb]===Jb[++Hb]&&Jb[++Gb]===Jb[++Hb]&&Jb[++Gb]===Jb[++Hb]&&Jb[++Gb]===Jb[++Hb]&&Jb[++Gb]===Jb[++Hb]&&Gb<t_);if(Wb=cc-(t_-Gb),Gb=t_-cc,Wb>Zb){if(Xb.match_start=Ob,Zb=Wb,Wb>=Qb)break;a_=Jb[Gb+Zb-1],i_=Jb[Gb+Zb]}}while((Ob=e_[Ob&$b])>Kb&&0!=--Nb);return Zb<=Xb.lookahead?Zb:Xb.lookahead}function po(Xb){var Ob=Xb.w_size,Nb,Gb,Hb,Wb,Zb;do{if(Wb=Xb.window_size-Xb.lookahead-Xb.strstart,Xb.strstart>=Ob+(Ob-uc)){Um.arraySet(Xb.window,Xb.window,Ob,Ob,0),Xb.match_start-=Ob,Xb.strstart-=Ob,Xb.block_start-=Ob,Gb=Xb.hash_size,Nb=Gb;do Hb=Xb.head[--Nb],Xb.head[Nb]=Hb>=Ob?Hb-Ob:0;while(--Gb);Gb=Ob,Nb=Gb;do Hb=Xb.prev[--Nb],Xb.prev[Nb]=Hb>=Ob?Hb-Ob:0;while(--Gb);Wb+=Ob}if(0===Xb.strm.avail_in)break;if(Gb=co(Xb.strm,Xb.window,Xb.strstart+Xb.lookahead,Wb),Xb.lookahead+=Gb,Xb.lookahead+Xb.insert>=gc)for(Zb=Xb.strstart-Xb.insert,Xb.ins_h=Xb.window[Zb],Xb.ins_h=(Xb.ins_h<<Xb.hash_shift^Xb.window[Zb+1])&Xb.hash_mask;Xb.insert&&(Xb.ins_h=(Xb.ins_h<<Xb.hash_shift^Xb.window[Zb+gc-1])&Xb.hash_mask,Xb.prev[Zb&Xb.w_mask]=Xb.head[Xb.ins_h],Xb.head[Xb.ins_h]=Zb,Zb++,Xb.insert--,!(Xb.lookahead+Xb.insert<gc)););}while(Xb.lookahead<uc&&0!==Xb.strm.avail_in)}function bo(Xb,Ob){for(var Nb,Gb;;){if(Xb.lookahead<uc){if(po(Xb),Xb.lookahead<uc&&Ob===Lg)return jc;if(0===Xb.lookahead)break}if(Nb=0,Xb.lookahead>=gc&&(Xb.ins_h=(Xb.ins_h<<Xb.hash_shift^Xb.window[Xb.strstart+gc-1])&Xb.hash_mask,Nb=Xb.prev[Xb.strstart&Xb.w_mask]=Xb.head[Xb.ins_h],Xb.head[Xb.ins_h]=Xb.strstart),0!==Nb&&Xb.strstart-Nb<=Xb.w_size-uc&&(Xb.match_length=uo(Xb,Nb)),!(Xb.match_length>=gc))Gb=Cg._tr_tally(Xb,0,Xb.window[Xb.strstart]),Xb.lookahead--,Xb.strstart++;else if(Gb=Cg._tr_tally(Xb,Xb.strstart-Xb.match_start,Xb.match_length-gc),Xb.lookahead-=Xb.match_length,Xb.match_length<=Xb.max_lazy_match&&Xb.lookahead>=gc){Xb.match_length--;do Xb.strstart++,Xb.ins_h=(Xb.ins_h<<Xb.hash_shift^Xb.window[Xb.strstart+gc-1])&Xb.hash_mask,Nb=Xb.prev[Xb.strstart&Xb.w_mask]=Xb.head[Xb.ins_h],Xb.head[Xb.ins_h]=Xb.strstart;while(0!=--Xb.match_length);Xb.strstart++}else Xb.strstart+=Xb.match_length,Xb.match_length=0,Xb.ins_h=Xb.window[Xb.strstart],Xb.ins_h=(Xb.ins_h<<Xb.hash_shift^Xb.window[Xb.strstart+1])&Xb.hash_mask;if(Gb&&(ho(Xb,!1),0===Xb.strm.avail_out))return jc}return Xb.insert=Xb.strstart<gc-1?Xb.strstart:gc-1,Ob===Vg?(ho(Xb,!0),0===Xb.strm.avail_out?Sc:Ic):Xb.last_lit&&(ho(Xb,!1),0===Xb.strm.avail_out)?jc:Mc}function _o(Xb,Ob){for(var Nb,Gb,Hb;;){if(Xb.lookahead<uc){if(po(Xb),Xb.lookahead<uc&&Ob===Lg)return jc;if(0===Xb.lookahead)break}if(Nb=0,Xb.lookahead>=gc&&(Xb.ins_h=(Xb.ins_h<<Xb.hash_shift^Xb.window[Xb.strstart+gc-1])&Xb.hash_mask,Nb=Xb.prev[Xb.strstart&Xb.w_mask]=Xb.head[Xb.ins_h],Xb.head[Xb.ins_h]=Xb.strstart),Xb.prev_length=Xb.match_length,Xb.prev_match=Xb.match_start,Xb.match_length=gc-1,0!==Nb&&Xb.prev_length<Xb.max_lazy_match&&Xb.strstart-Nb<=Xb.w_size-uc&&(Xb.match_length=uo(Xb,Nb),5>=Xb.match_length&&(Xb.strategy===Gg||Xb.match_length===gc&&4096<Xb.strstart-Xb.match_start)&&(Xb.match_length=gc-1)),Xb.prev_length>=gc&&Xb.match_length<=Xb.prev_length){Hb=Xb.strstart+Xb.lookahead-gc,Gb=Cg._tr_tally(Xb,Xb.strstart-1-Xb.prev_match,Xb.prev_length-gc),Xb.lookahead-=Xb.prev_length-1,Xb.prev_length-=2;do++Xb.strstart<=Hb&&(Xb.ins_h=(Xb.ins_h<<Xb.hash_shift^Xb.window[Xb.strstart+gc-1])&Xb.hash_mask,Nb=Xb.prev[Xb.strstart&Xb.w_mask]=Xb.head[Xb.ins_h],Xb.head[Xb.ins_h]=Xb.strstart);while(0!=--Xb.prev_length);if(Xb.match_available=0,Xb.match_length=gc-1,Xb.strstart++,Gb&&(ho(Xb,!1),0===Xb.strm.avail_out))return jc}else if(!Xb.match_available)Xb.match_available=1,Xb.strstart++,Xb.lookahead--;else if(Gb=Cg._tr_tally(Xb,0,Xb.window[Xb.strstart-1]),Gb&&ho(Xb,!1),Xb.strstart++,Xb.lookahead--,0===Xb.strm.avail_out)return jc}return Xb.match_available&&(Gb=Cg._tr_tally(Xb,0,Xb.window[Xb.strstart-1]),Xb.match_available=0),Xb.insert=Xb.strstart<gc-1?Xb.strstart:gc-1,Ob===Vg?(ho(Xb,!0),0===Xb.strm.avail_out?Sc:Ic):Xb.last_lit&&(ho(Xb,!1),0===Xb.strm.avail_out)?jc:Mc}function wo(Xb,Ob){for(var Zb=Xb.window,Nb,Gb,Hb,Wb;;){if(Xb.lookahead<=cc){if(po(Xb),Xb.lookahead<=cc&&Ob===Lg)return jc;if(0===Xb.lookahead)break}if(Xb.match_length=0,Xb.lookahead>=gc&&0<Xb.strstart&&(Hb=Xb.strstart-1,Gb=Zb[Hb],Gb===Zb[++Hb]&&Gb===Zb[++Hb]&&Gb===Zb[++Hb])){Wb=Xb.strstart+cc;do;while(Gb===Zb[++Hb]&&Gb===Zb[++Hb]&&Gb===Zb[++Hb]&&Gb===Zb[++Hb]&&Gb===Zb[++Hb]&&Gb===Zb[++Hb]&&Gb===Zb[++Hb]&&Gb===Zb[++Hb]&&Hb<Wb);Xb.match_length=cc-(Wb-Hb),Xb.match_length>Xb.lookahead&&(Xb.match_length=Xb.lookahead)}if(Xb.match_length>=gc?(Nb=Cg._tr_tally(Xb,1,Xb.match_length-gc),Xb.lookahead-=Xb.match_length,Xb.strstart+=Xb.match_length,Xb.match_length=0):(Nb=Cg._tr_tally(Xb,0,Xb.window[Xb.strstart]),Xb.lookahead--,Xb.strstart++),Nb&&(ho(Xb,!1),0===Xb.strm.avail_out))return jc}return Xb.insert=0,Ob===Vg?(ho(Xb,!0),0===Xb.strm.avail_out?Sc:Ic):Xb.last_lit&&(ho(Xb,!1),0===Xb.strm.avail_out)?jc:Mc}function xo(Xb,Ob){for(var Nb;;){if(0===Xb.lookahead&&(po(Xb),0===Xb.lookahead)){if(Ob===Lg)return jc;break}if(Xb.match_length=0,Nb=Cg._tr_tally(Xb,0,Xb.window[Xb.strstart]),Xb.lookahead--,Xb.strstart++,Nb&&(ho(Xb,!1),0===Xb.strm.avail_out))return jc}return Xb.insert=0,Ob===Vg?(ho(Xb,!0),0===Xb.strm.avail_out?Sc:Ic):Xb.last_lit&&(ho(Xb,!1),0===Xb.strm.avail_out)?jc:Mc}function yo(Xb,Ob,Nb,Gb,Hb){this.good_length=Xb,this.max_lazy=Ob,this.nice_length=Nb,this.max_chain=Gb,this.func=Hb}function ko(Xb){Xb.window_size=2*Xb.w_size,ro(Xb.head),Xb.max_lazy_match=Cc[Xb.level].max_lazy,Xb.good_match=Cc[Xb.level].good_length,Xb.nice_match=Cc[Xb.level].nice_length,Xb.max_chain_length=Cc[Xb.level].max_chain,Xb.strstart=0,Xb.block_start=0,Xb.lookahead=0,Xb.insert=0,Xb.match_length=Xb.prev_length=gc-1,Xb.match_available=0,Xb.ins_h=0}function vo(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Jg,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Um.Buf16(2*hc),this.dyn_dtree=new Um.Buf16(2*(2*sc+1)),this.bl_tree=new Um.Buf16(2*(2*rc+1)),ro(this.dyn_ltree),ro(this.dyn_dtree),ro(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Um.Buf16(mc+1),this.heap=new Um.Buf16(2*oc+1),ro(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Um.Buf16(2*oc+1),ro(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Do(Xb){var Ob;return Xb&&Xb.state?(Xb.total_in=Xb.total_out=0,Xb.data_type=Kg,Ob=Xb.state,Ob.pending=0,Ob.pending_out=0,0>Ob.wrap&&(Ob.wrap=-Ob.wrap),Ob.status=Ob.wrap?bc:vc,Xb.adler=2===Ob.wrap?0:1,Ob.last_flush=Lg,Cg._tr_init(Ob),Fg):oo(Xb,qg)}function jo(Xb){var Ob=Do(Xb);return Ob===Fg&&ko(Xb.state),Ob}function So(Xb,Ob,Nb,Gb,Hb,Wb){if(!Xb)return qg;var Zb=1;if(Ob===Ng&&(Ob=6),0>Gb?(Zb=0,Gb=-Gb):15<Gb&&(Zb=2,Gb-=16),1>Hb||Hb>$g||Nb!==Jg||8>Gb||15<Gb||0>Ob||9<Ob||0>Wb||Wb>Zg)return oo(Xb,qg);8===Gb&&(Gb=9);var Qb=new vo;return Xb.state=Qb,Qb.strm=Xb,Qb.wrap=Zb,Qb.gzhead=null,Qb.w_bits=Gb,Qb.w_size=1<<Qb.w_bits,Qb.w_mask=Qb.w_size-1,Qb.hash_bits=Hb+7,Qb.hash_size=1<<Qb.hash_bits,Qb.hash_mask=Qb.hash_size-1,Qb.hash_shift=~~((Qb.hash_bits+gc-1)/gc),Qb.window=new Um.Buf8(2*Qb.w_size),Qb.head=new Um.Buf16(Qb.hash_size),Qb.prev=new Um.Buf16(Qb.w_size),Qb.lit_bufsize=1<<Hb+6,Qb.pending_buf_size=4*Qb.lit_bufsize,Qb.pending_buf=new Um.Buf8(Qb.pending_buf_size),Qb.d_buf=1*Qb.lit_bufsize,Qb.l_buf=3*Qb.lit_bufsize,Qb.level=Ob,Qb.strategy=Wb,Qb.method=Nb,jo(Xb)}function Ao(Xb,Ob){if(65537>Ob&&(Xb.subarray&&qc||!Xb.subarray&&Uc))return _StringfromCharCode.apply(null,Um.shrinkBuf(Xb,Ob));for(var Nb='',Gb=0;Gb<Ob;Gb++)Nb+=_StringfromCharCode(Xb[Gb]);return Nb}function zo(Xb){if(!(this instanceof zo))return new zo(Xb);this.options=Um.assign({level:ou,method:ru,chunkSize:16384,windowBits:15,memLevel:8,strategy:su,to:''},Xb||{});var Ob=this.options;Ob.raw&&0<Ob.windowBits?Ob.windowBits=-Ob.windowBits:Ob.gzip&&0<Ob.windowBits&&16>Ob.windowBits&&(Ob.windowBits+=16),this.err=0,this.msg='',this.ended=!1,this.chunks=[],this.strm=new Kc,this.strm.avail_out=0;var Nb=Fc.deflateInit2(this.strm,Ob.level,Ob.method,Ob.windowBits,Ob.memLevel,Ob.strategy);if(Nb!==tu)throw new Error(zg[Nb]);if(Ob.header&&Fc.deflateSetHeader(this.strm,Ob.header),Ob.dictionary){var Gb;if(Gb='string'==typeof Ob.dictionary?Qc.string2buf(Ob.dictionary):'[object ArrayBuffer]'===Jc.call(Ob.dictionary)?new Uint8Array(Ob.dictionary):Ob.dictionary,Nb=Fc.deflateSetDictionary(this.strm,Gb),Nb!==tu)throw new Error(zg[Nb]);this._dict_set=!0}}function Lo(Xb,Ob){var Nb=new zo(Ob);if(Nb.push(Xb,!0),Nb.err)throw Nb.msg||zg[Nb.err];return Nb.result}function Vo(Xb){return(255&Xb>>>24)+(65280&Xb>>>8)+((65280&Xb)<<8)+((255&Xb)<<24)}function Yo(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Um.Buf16(320),this.work=new Um.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function Fo(Xb){var Ob;return Xb&&Xb.state?(Ob=Xb.state,Xb.total_in=Xb.total_out=Ob.total=0,Xb.msg='',Ob.wrap&&(Xb.adler=1&Ob.wrap),Ob.mode=Xu,Ob.last=0,Ob.havedict=0,Ob.dmax=32768,Ob.head=null,Ob.hold=0,Ob.bits=0,Ob.lencode=Ob.lendyn=new Um.Buf32(Mp),Ob.distcode=Ob.distdyn=new Um.Buf32(Sp),Ob.sane=1,Ob.back=-1,Lu):Vu}function Uo(Xb){var Ob;return Xb&&Xb.state?(Ob=Xb.state,Ob.wsize=0,Ob.whave=0,Ob.wnext=0,Fo(Xb)):Vu}function qo(Xb,Ob){var Nb,Gb;return Xb&&Xb.state?(Gb=Xb.state,0>Ob?(Nb=0,Ob=-Ob):(Nb=(Ob>>4)+1,48>Ob&&(Ob&=15)),Ob&&(8>Ob||15<Ob))?Vu:(null!==Gb.window&&Gb.wbits!==Ob&&(Gb.window=null),Gb.wrap=Nb,Gb.wbits=Ob,Uo(Xb)):Vu}function Xo(Xb,Ob){var Nb,Gb;return Xb?(Gb=new Yo,Xb.state=Gb,Gb.window=null,Nb=qo(Xb,Ob),Nb!==Lu&&(Xb.state=null),Nb):Vu}function No(Xb){if(Cp){var Ob;for(Bp=new Um.Buf32(512),Ap=new Um.Buf32(32),Ob=0;144>Ob;)Xb.lens[Ob++]=8;for(;256>Ob;)Xb.lens[Ob++]=9;for(;280>Ob;)Xb.lens[Ob++]=7;for(;288>Ob;)Xb.lens[Ob++]=8;for(Iu(Cu,Xb.lens,0,288,Bp,0,Xb.work,{bits:9}),Ob=0;32>Ob;)Xb.lens[Ob++]=5;Iu(Bu,Xb.lens,0,32,Ap,0,Xb.work,{bits:5}),Cp=!1}Xb.lencode=Bp,Xb.lenbits=9,Xb.distcode=Ap,Xb.distbits=5}function Go(Xb,Ob,Nb,Gb){var Wb=Xb.state,Hb;return null===Wb.window&&(Wb.wsize=1<<Wb.wbits,Wb.wnext=0,Wb.whave=0,Wb.window=new Um.Buf8(Wb.wsize)),Gb>=Wb.wsize?(Um.arraySet(Wb.window,Ob,Nb-Wb.wsize,Wb.wsize,0),Wb.wnext=0,Wb.whave=Wb.wsize):(Hb=Wb.wsize-Wb.wnext,Hb>Gb&&(Hb=Gb),Um.arraySet(Wb.window,Ob,Nb-Gb,Hb,Wb.wnext),Gb-=Hb,Gb?(Um.arraySet(Wb.window,Ob,Nb-Gb,Gb,0),Wb.wnext=Gb,Wb.whave=Wb.wsize):(Wb.wnext+=Hb,Wb.wnext===Wb.wsize&&(Wb.wnext=0),Wb.whave<Wb.wsize&&(Wb.whave+=Hb))),0}function Jo(Xb){if(!(this instanceof Jo))return new Jo(Xb);this.options=Um.assign({chunkSize:16384,windowBits:0,to:''},Xb||{});var Ob=this.options;Ob.raw&&0<=Ob.windowBits&&16>Ob.windowBits&&(Ob.windowBits=-Ob.windowBits,0===Ob.windowBits&&(Ob.windowBits=-15)),0<=Ob.windowBits&&16>Ob.windowBits&&!(Xb&&Xb.windowBits)&&(Ob.windowBits+=32),15<Ob.windowBits&&48>Ob.windowBits&&0==(15&Ob.windowBits)&&(Ob.windowBits|=15),this.err=0,this.msg='',this.ended=!1,this.chunks=[],this.strm=new Kc,this.strm.avail_out=0;var Nb=Xp.inflateInit2(this.strm,Ob.windowBits);if(Nb!==Op.Z_OK)throw new Error(zg[Nb]);this.header=new Np,Xp.inflateGetHeader(this.strm,this.header)}function $o(Xb,Ob){var Nb=new Jo(Ob);if(Nb.push(Xb,!0),Nb.err)throw Nb.msg||zg[Nb.err];return Nb.result}function ts(Xb,Ob,Nb){for(var Gb=0;Gb<Nb;Gb++)Ob[Gb]=Xb[Gb]}function as(Xb,Ob,Nb,Gb){for(var Hb=0;Hb<Gb;Hb++)Ob[Hb]=Xb[Hb];for(;Hb<Nb;Hb++)Ob[Hb]=255&Xb[Hb]+Ob[Hb-Gb]}function is(Xb,Ob,Nb,Gb){var Hb=0;if(0===Nb.length)for(;Hb<Gb;Hb++)Ob[Hb]=Xb[Hb];else for(;Hb<Gb;Hb++)Ob[Hb]=255&Xb[Hb]+Nb[Hb]}function ns(Xb,Ob,Nb,Gb,Hb){var Wb=0;if(0===Nb.length){for(;Wb<Hb;Wb++)Ob[Wb]=Xb[Wb];for(;Wb<Gb;Wb++)Ob[Wb]=255&Xb[Wb]+(Ob[Wb-Hb]>>1)}else{for(;Wb<Hb;Wb++)Ob[Wb]=255&Xb[Wb]+(Nb[Wb]>>1);for(;Wb<Gb;Wb++)Ob[Wb]=255&Xb[Wb]+(Ob[Wb-Hb]+Nb[Wb]>>1)}}function os(Xb,Ob,Nb,Gb,Hb){var Wb=0;if(0===Nb.length){for(;Wb<Hb;Wb++)Ob[Wb]=Xb[Wb];for(;Wb<Gb;Wb++)Ob[Wb]=255&Xb[Wb]+Ob[Wb-Hb]}else{for(;Wb<Hb;Wb++)Ob[Wb]=255&Xb[Wb]+Nb[Wb];for(;Wb<Gb;Wb++)Ob[Wb]=255&Xb[Wb]+ss(Ob[Wb-Hb],Nb[Wb],Nb[Wb-Hb])}}function ss(Xb,Ob,Nb){var Gb=Xb+Ob-Nb,Hb=_Mathabs(Gb-Xb),Wb=_Mathabs(Gb-Ob),Zb=_Mathabs(Gb-Nb);return Hb<=Wb&&Hb<=Zb?Xb:Wb<=Zb?Ob:Nb}function rs(Xb){return'number'==typeof Xb?[Xb]:Xb}function ls(Xb,Ob){if(1===Ob)return Xb.readUint8();for(var Nb=new Uint8Array(Ob),Gb=0;Gb<Ob;Gb++)Nb[Gb]=Xb.readUint8();return Nb}function ys(Xb,Ob,Nb,Gb){return 8===Nb?new Uint8Array(Xb*Ob):16===Nb?new Uint16Array(Xb*Ob):32===Nb&&3===Gb?new Float32Array(Xb*Ob):Ms('bit depth / sample format',Nb+' / '+Gb)}function vs(Xb,Ob,Nb,Gb){for(var Hb=0;Hb<Gb;Hb++)Xb[Nb++]=Ob.getUint8(Hb);return Nb}function Ds(Xb,Ob,Nb,Gb,Hb){for(var Wb=0;Wb<2*Gb;Wb+=2)Xb[Nb++]=Ob.getUint16(Wb,Hb);return Nb}function js(Xb,Ob,Nb,Gb,Hb){for(var Wb=0;Wb<4*Gb;Wb+=4)Xb[Nb++]=Ob.getFloat32(Wb,Hb);return Nb}function Ms(Xb,Ob){throw new Error('Unsupported '+Xb+': '+Ob)}function Ss(Xb){if(Xb.length){const Nb=Xb;Xb=Nb[0];for(var Ob=0;Ob<Nb.length;Ob++)Nb[Ob]!==Xb&&Ms('bit depth',Nb)}return Xb}function Ps(Xb){var Nb=Xb.length,Gb='',Ob;for(Ob=0;Ob<Nb;Ob+=3)Gb+=qf[Xb[Ob]>>2],Gb+=qf[(3&Xb[Ob])<<4|Xb[Ob+1]>>4],Gb+=qf[(15&Xb[Ob+1])<<2|Xb[Ob+2]>>6],Gb+=qf[63&Xb[Ob+2]];return 2==Nb%3?Gb=Gb.substring(0,Gb.length-1)+'=':1==Nb%3&&(Gb=Gb.substring(0,Gb.length-2)+'=='),Gb}function Cs(Xb){var Ob=0.75*Xb.length,Nb=Xb.length,Gb=0,Hb,Wb,Zb,Qb;'='===Xb[Xb.length-1]&&(Ob--,'='===Xb[Xb.length-2]&&Ob--);for(var Kb=new Uint8Array(Ob),Jb=0;Jb<Nb;Jb+=4)Hb=Xf[Xb.charCodeAt(Jb)],Wb=Xf[Xb.charCodeAt(Jb+1)],Zb=Xf[Xb.charCodeAt(Jb+2)],Qb=Xf[Xb.charCodeAt(Jb+3)],Kb[Gb++]=Hb<<2|Wb>>4,Kb[Gb++]=(15&Wb)<<4|Zb>>2,Kb[Gb++]=(3&Zb)<<6|63&Qb;return Kb}function Bs(Xb){return(255&Xb)<<8|255&Xb>>8}function As(Xb,Ob){if('string'==typeof Xb)return zs(Xb,Ob);if(Xb instanceof ArrayBuffer)return Promise.resolve(Rs(new Uint8Array(Xb),Ob));if(Xb.buffer)return Promise.resolve(Rs(Xb,Ob));throw new Error('argument to "load" must be a string or buffer.')}function Rs(Xb,Ob,Nb){function Gb(Qb,Kb){if(!Qb)throw new Error(`This kind of image (${Hb}) can only be loaded from URL.`);return Fs(Qb,Kb)}var Hb=Uf(Xb);if(Hb)switch(Hb.ext){case'png':return Es(Xb);case'jpg':{var Wb=Vf(Xb),Zb;return Wb.exif&&(Zb=Vs(Wb.exif)),Gb(Nb,{meta:Zb})}case'tif':return Ts(Xb);}return Gb(Nb)}function zs(Xb,Ob){var Nb=Xb.slice(0,64).match(Nf),Gb;return Gb=Nb?Promise.resolve(Cs(Xb.slice(Nb[0].length))):L(Xb,Ob),Gb.then((Hb)=>{var Wb=new Uint8Array(Hb);return Rs(Wb,Ob,Xb)})}function Es(Xb){var Ob=new lf(Xb),Nb=Ob.decode(),Gb=Nb.bitDepth,Hb=Nb.data.buffer,Wb;if(8===Gb)Wb=new Uint8ClampedArray(Hb);else if(16===Gb){Wb=new Uint16Array(Hb);for(var Zb=0;Zb<Wb.length;Zb++)Wb[Zb]=Bs(Wb[Zb])}var Qb=Nb.colourType,Jb=0,Kb;switch(Qb){case 0:Kb=1;break;case 2:Kb=3;break;case 4:Kb=1,Jb=1;break;case 6:Kb=3,Jb=1;break;default:throw new Error(`Unexpected colourType: ${Qb}`);}return new Cb(Nb.width,Nb.height,Wb,{components:Kb,alpha:Jb,bitDepth:Gb})}function Ts(Xb){var Ob=Lf(Xb);return 1===Ob.length?Ys(Ob[0]):new Oh(Ob.map(Ys))}function Vs(Xb){var Ob={tiff:Xb};return Xb.exif&&(Ob.exif=Xb.exif),Xb.gps&&(Ob.gps=Xb.gps),Ob}function Ys(Xb){return new Cb(Xb.width,Xb.height,Xb.data,{components:1,alpha:0,colorModel:null,bitDepth:Xb.bitsPerSample.length?Xb.bitsPerSample[0]:Xb.bitsPerSample,meta:Vs(Xb)})}function Fs(Xb,Ob){return Ob=Ob||{},new Promise(function(Nb,Gb){var Hb=new Kr;P(Xb)&&(Hb.crossOrigin='Anonymous'),Hb.onload=function(){var Wb=Hb.width,Zb=Hb.height,Qb=new R(Wb,Zb),Kb=Qb.getContext('2d');Kb.drawImage(Hb,0,0,Wb,Zb);var Jb=Kb.getImageData(0,0,Wb,Zb).data;Nb(new Cb(Wb,Zb,Jb,Ob))},Hb.onerror=function(){Gb(new Error('Could not load '+Xb))},Hb.src=Xb})}function Us(Xb){for(var Ob=0,Nb;Ob<Xb.length;Ob++)if(Nb=Xb[Ob],Nb.buffer instanceof ArrayBuffer){var Gb=Nb.buffer;if(Nb.byteLength!==Gb.byteLength){var Hb=new Uint8Array(Nb.byteLength);Hb.set(new Uint8Array(Gb,Nb.byteOffset,Nb.byteLength)),Gb=Hb.buffer}Xb[Ob]=Gb}}function qs(Xb,Ob){Ob=Ob||{};var Nb=new Gf;Us(Xb);for(var Gb=0;Gb<Xb.length;Gb++)Nb.append(Xb[Gb]);return Ob.type?Nb.getBlob(Ob.type):Nb.getBlob()}function Xs(Xb,Ob){return Us(Xb),new Blob(Xb,Ob||{})}function Os(){ib=!0;for(var Nb=nb.length,Xb,Ob;Nb;){for(Ob=nb,nb=[],Xb=-1;++Xb<Nb;)Ob[Xb]();Nb=nb.length}ib=!1}function Gs(){}function Hs(Xb){if('function'!=typeof Xb)throw new TypeError('resolver must be a function');this.state=db,this.queue=[],this.outcome=void 0,Xb!==Gs&&Ks(this,Xb)}function Ws(Xb,Ob,Nb){this.promise=Xb,'function'==typeof Ob&&(this.onFulfilled=Ob,this.callFulfilled=this.otherCallFulfilled),'function'==typeof Nb&&(this.onRejected=Nb,this.callRejected=this.otherCallRejected)}function Zs(Xb,Ob,Nb){ob(function(){var Gb;try{Gb=Ob(Nb)}catch(Hb){return sb.reject(Xb,Hb)}Gb===Xb?sb.reject(Xb,new TypeError('Cannot resolve promise with itself')):sb.resolve(Xb,Gb)})}function Qs(Xb){var Ob=Xb&&Xb.then;if(Xb&&('object'==typeof Xb||'function'==typeof Xb)&&'function'==typeof Ob)return function(){Ob.apply(Xb,arguments)}}function Ks(Xb,Ob){function Nb(Qb){Wb||(Wb=!0,sb.reject(Xb,Qb))}function Gb(Qb){Wb||(Wb=!0,sb.resolve(Xb,Qb))}var Wb=!1,Zb=Js(function(){Ob(Gb,Nb)});'error'===Zb.status&&Nb(Zb.value)}function Js(Xb,Ob){var Nb={};try{Nb.value=Xb(Ob),Nb.status='success'}catch(Gb){Nb.status='error',Nb.value=Gb}return Nb}function nr(Xb){for(var Ob=Xb.length,Nb=new ArrayBuffer(Ob),Gb=new Uint8Array(Nb),Hb=-1;++Hb<Ob;)Gb[Hb]=Xb.charCodeAt(Hb);return Nb}function or(Xb){for(var Ob='',Nb=new Uint8Array(Xb),Gb=Nb.byteLength,Hb=-1;++Hb<Gb;)Ob+=_StringfromCharCode(Nb[Hb]);return Ob}function sr(Xb,Ob){return new mb(function(Nb,Gb){var Hb=new Image;Ob&&(Hb.crossOrigin=Ob),Hb.onload=function(){Nb(Hb)},Hb.onerror=Gb,Hb.src=Xb})}function rr(Xb){var Ob=document.createElement('canvas');Ob.width=Xb.width,Ob.height=Xb.height;var Nb=Ob.getContext('2d');return Nb.drawImage(Xb,0,0,Xb.width,Xb.height,0,0,Xb.width,Xb.height),Ob}function lr(Xb,Ob){return Ob=Ob||{},'string'==typeof Ob&&(Ob={type:Ob}),new Qf(Xb,Ob)}function mr(Xb){return new mb(function(Ob,Nb){var Gb=new FileReader,Hb='function'==typeof Gb.readAsBinaryString;Gb.onloadend=function(Wb){var Zb=Wb.target.result||'';return Hb?Ob(Zb):void Ob(or(Zb))},Gb.onerror=Nb,Hb?Gb.readAsBinaryString(Xb):Gb.readAsArrayBuffer(Xb)})}function gr(Xb,Ob){return mb.resolve().then(function(){var Nb=[nr(atob(Xb))];return Ob?lr(Nb,{type:Ob}):lr(Nb)})}function pr(Xb){return mb.resolve().then(function(){var Ob=Xb.match(/data:([^;]+)/)[1],Nb=Xb.replace(/^[^,]+,/,''),Gb=nr(atob(Nb));return lr([Gb],{type:Ob})})}function br(Xb,Ob,Nb){return mb.resolve().then(function(){return'function'==typeof Xb.toBlob?new mb(function(Gb){Xb.toBlob(Gb,Ob,Nb)}):pr(Xb.toDataURL(Ob,Nb))})}function jr(Xb,Ob){const Nb=4*_Mathfloor((Ob.bitDepth*Ob.width+31)/32),Gb=_Mathceil(Ob.bitDepth*Ob.width/8),Wb=Ob.bitDepth*Ob.width%8,Zb=0==Wb?0:8-Wb,Qb=Nb*Ob.height;var Kb,Jb;const $b=new yb(Ob.data);let e_=0,t_=0,a_=8;Xb.mark(),Jb=$b.readUint8();for(var i_=Ob.height-1;0<=i_;i_--){const o_=0===i_;Xb.reset(),Xb.skip(i_*Nb);for(var n_=0;n_<Gb;n_++){const s_=n_===Gb-1;t_<=Zb&&s_?(Xb.writeByte(Jb<<t_),(0==Zb||Zb==t_)&&!o_&&(Kb=Jb,Jb=$b.readByte())):0==t_?(Kb=Jb,Jb=$b.readUint8(),Xb.writeByte(Kb)):(Kb=Jb,Jb=$b.readUint8(),Xb.writeByte(Kb<<t_&vb[t_]|Jb>>a_)),s_?(e_+=Wb||8,Xb.skip(Nb-Gb),t_=e_%8,a_=8-t_):e_+=8}}Nb>Gb&&(Xb.reset(),Xb.skip(Qb-1),Xb.writeUint8(0))}function Mr(Xb,Ob){8<Ob.bitDepth||Xb.writeUint32(0).writeUint32(16777215)}function Sr(Xb,Ob){Xb.writeChars('BM'),Xb.writeInt32(Xb._lastWrittenByte),Xb.writeUint16(0),Xb.writeUint16(0),Xb.writeUint32(Ob)}function Ir(Xb,Ob){Xb.writeUint32(124).writeInt32(Ob.width).writeInt32(Ob.height).writeUint16(1).writeUint16(Ob.bitDepth).writeUint32(kb.BITMAPV5HEADER.Compression.BI_RGB).writeUint32(Ob.width*Ob.height*Ob.bitDepth).writeInt32(0).writeInt32(0).writeUint32(_Mathpow(2,Ob.bitDepth)).writeUint32(_Mathpow(2,Ob.bitDepth)).writeUint32(4278190080).writeUint32(16711680).writeUint32(65280).writeUint32(255).writeUint32(kb.BITMAPV5HEADER.LogicalColorSpace.LCS_sRGB).skip(36).skip(12).writeUint32(kb.BITMAPV5HEADER.GamutMappingIntent.LCS_GM_IMAGES).skip(12)}function Cr(Xb,Ob){if('string'!=typeof Xb&&'function'!=typeof Xb)throw new TypeError('func argument must be a function');if(void 0===Ob&&(Ob={}),'object'!=typeof Ob||null===Ob)throw new TypeError('options argument must be an object');this._workerCode=Xb.toString(),this._numWorkers=void 0===Ob.maxWorkers||'auto'===Ob.maxWorkers?_Mathmin(Eb-1,1):0<Ob.maxWorkers?_Mathmin(Ob.maxWorkers,Eb):Eb,this._workers=new Map,this._timeout=Ob.timeout||0,this._terminateOnError=!!Ob.terminateOnError;var Nb=Ob.deps;'string'==typeof Nb&&(Nb=[Nb]),Array.isArray(Nb)||(Nb=void 0),this._id=0,this._terminated=!1,this._working=0,this._waiting=[],this._init(Nb)}function Ar(Xb,Ob,Nb){return Xb.post('data',[Ob,Nb]).then(function(Gb){for(var Hb in Gb)Gb[Hb]=new Cb(Gb[Hb]);return Gb})}var Lr='BINARY',Yr='RGBA',Xr='RGB',Or='HSL',Nr='HSV',Gr='CMYK',Hr='GREY',Wr={};Wr[Lr]={components:1,alpha:0,bitDepth:1,colorModel:Hr},Wr['GREYA']={components:1,alpha:1,bitDepth:8,colorModel:Hr},Wr['GREY']={components:1,alpha:0,bitDepth:8,colorModel:Hr},Wr[Yr]={components:3,alpha:1,bitDepth:8,colorModel:Xr},Wr['RGB']={components:3,alpha:0,bitDepth:8,colorModel:Xr},Wr['CMYK']={components:4,alpha:0,bitDepth:8,colorModel:Gr},Wr['CMYKA']={components:4,alpha:1,bitDepth:8,colorModel:Gr};var Qr=self.ImageData,Kr=self.Image,Jr=self.location.origin,$r=Number.isNaN||function(Xb){return Xb!==Xb},tl=function(Xb,Ob){return de(Xb),de(Ob),Xb-Ob},al='undefined'==typeof window?'undefined'==typeof global?'undefined'==typeof self?{}:self:global:window,il=ce(function(Xb,Ob){(function(){var Gb=Ob;var Hb={release:'0.3.0',date:'2013-03'};Gb.toString=function(){return'version '+Hb.release+', released '+Hb.date};for(var Wb=0,Zb=null,Qb=null,Kb={init:function(e_){if(0!==e_&&0==(e_&e_-1))Wb=e_,Kb._initArray(),Kb._makeBitReversalTable(),Kb._makeCosSinTable();else throw new Error('init: radix-2 required')},fft1d:function(e_,t_){Kb.fft(e_,t_,1)},ifft1d:function(e_,t_){var a_=1/Wb;Kb.fft(e_,t_,-1);for(var i_=0;i_<Wb;i_++)e_[i_]*=a_,t_[i_]*=a_},bt1d:function(e_,t_){Kb.fft(e_,t_,-1)},fft2d:function(e_,t_){for(var a_=[],i_=[],n_=0,o_=0;o_<Wb;o_++){n_=o_*Wb;for(var s_=0;s_<Wb;s_++)a_[s_]=e_[s_+n_],i_[s_]=t_[s_+n_];Kb.fft1d(a_,i_);for(var r_=0;r_<Wb;r_++)e_[r_+n_]=a_[r_],t_[r_+n_]=i_[r_]}for(var l_=0;l_<Wb;l_++){for(var d_=0;d_<Wb;d_++)n_=l_+d_*Wb,a_[d_]=e_[n_],i_[d_]=t_[n_];Kb.fft1d(a_,i_);for(var h_=0;h_<Wb;h_++)n_=l_+h_*Wb,e_[n_]=a_[h_],t_[n_]=i_[h_]}},ifft2d:function(e_,t_){for(var a_=[],i_=[],n_=0,o_=0;o_<Wb;o_++){n_=o_*Wb;for(var s_=0;s_<Wb;s_++)a_[s_]=e_[s_+n_],i_[s_]=t_[s_+n_];Kb.ifft1d(a_,i_);for(var r_=0;r_<Wb;r_++)e_[r_+n_]=a_[r_],t_[r_+n_]=i_[r_]}for(var l_=0;l_<Wb;l_++){for(var d_=0;d_<Wb;d_++)n_=l_+d_*Wb,a_[d_]=e_[n_],i_[d_]=t_[n_];Kb.ifft1d(a_,i_);for(var h_=0;h_<Wb;h_++)n_=l_+h_*Wb,e_[n_]=a_[h_],t_[n_]=i_[h_]}},fft:function(e_,t_,a_){for(var g_=Wb>>2,c_=0,i_,n_,o_,s_,r_,l_,d_,h_,m_;c_<Wb;c_++)s_=Zb[c_],c_<s_&&(r_=e_[c_],e_[c_]=e_[s_],e_[s_]=r_,r_=t_[c_],t_[c_]=t_[s_],t_[s_]=r_);for(var u_=1;u_<Wb;u_<<=1){n_=0,i_=Wb/(u_<<1);for(var p_=0;p_<u_;p_++){l_=Qb[n_+g_],d_=a_*Qb[n_];for(var f_=p_;f_<Wb;f_+=u_<<1)o_=f_+u_,h_=l_*e_[o_]+d_*t_[o_],m_=l_*t_[o_]-d_*e_[o_],e_[o_]=e_[f_]-h_,e_[f_]+=h_,t_[o_]=t_[f_]-m_,t_[f_]+=m_;n_+=i_}}},_initArray:function(){Zb='undefined'==typeof Uint32Array?[]:new Uint32Array(Wb),Qb='undefined'==typeof Float64Array?[]:new Float64Array(1.25*Wb)},_paddingZero:function(){},_makeBitReversalTable:function(){var e_=0,t_=0,a_=0;for(Zb[0]=0;++e_<Wb;){for(a_=Wb>>1;a_<=t_;)t_-=a_,a_>>=1;t_+=a_,Zb[e_]=t_}},_makeCosSinTable:function(){var e_=Wb>>1,t_=Wb>>2,a_=Wb>>3,n_=_Mathsin(_MathPI/Wb),o_=2*n_*n_,s_=_Mathsqrt(o_*(2-o_)),r_=Qb[t_]=1,l_=Qb[0]=0;n_=2*o_;for(var d_=1;d_<a_;d_++)r_-=o_,o_+=n_*r_,l_+=s_,s_-=n_*l_,Qb[d_]=l_,Qb[t_-d_]=r_;0!=a_&&(Qb[a_]=0.7071067811865476);for(var h_=0;h_<t_;h_++)Qb[e_-h_]=Qb[h_];for(var m_=0;m_<e_+t_;m_++)Qb[m_+e_]=-Qb[m_]}},Jb=['init','fft1d','ifft1d','fft2d','ifft2d'],$b=0;$b<Jb.length;$b++)Gb[Jb[$b]]=Kb[Jb[$b]];return Gb.bt=Kb.bt1d,Gb.fft=Kb.fft1d,Gb.ifft=Kb.ifft1d,Gb}).call(al)}),dl={FFTUtils:{DEBUG:!1,ifft2DArray:function(Xb,Ob,Nb){var Gb=Array(Ob*Nb),Hb=Ob/2,Wb=2*(Nb-1);il.init(Hb);for(var Zb={re:Array(Hb),im:Array(Hb)},Qb=0;Qb<Nb;Qb++){for(var Kb=Hb-1;0<=Kb;Kb--)Zb.re[Kb]=Xb[2*Kb*Nb+Qb],Zb.im[Kb]=Xb[(2*Kb+1)*Nb+Qb];il.bt(Zb.re,Zb.im);for(var Kb=Hb-1;0<=Kb;Kb--)Gb[2*Kb*Nb+Qb]=Zb.re[Kb],Gb[(2*Kb+1)*Nb+Qb]=Zb.im[Kb]}var Jb=Array(Hb*Wb);il.init(Wb);for(var $b={re:Array(Wb),im:Array(Wb)},Kb=0;Kb<Ob;Kb+=2){$b.re[0]=Gb[Kb*Nb],$b.im[0]=Gb[(Kb+1)*Nb];for(var Qb=1;Qb<Nb;Qb++)$b.re[Qb]=Gb[Kb*Nb+Qb],$b.im[Qb]=Gb[(Kb+1)*Nb+Qb],$b.re[Wb-Qb]=Gb[Kb*Nb+Qb],$b.im[Wb-Qb]=-Gb[(Kb+1)*Nb+Qb];il.bt($b.re,$b.im);for(var t_=Kb/2*Wb,Qb=Wb-1;0<=Qb;Qb--)Jb[t_+Qb]=$b.re[Qb]/(Wb*Hb)}return Jb},fft2DArray:function(Xb,Ob,Nb){var Hb=Object.assign({},{inplace:!0}),Wb=Nb/2+1,Zb=2*Ob,Qb=Array(Zb*Wb);il.init(Nb);for(var Kb={re:Array(Nb),im:Array(Nb)},Jb={re:Array(Nb),im:Array(Nb)},$b={re:Array(Nb),im:Array(Nb)},o_=0,e_,t_,a_,i_,n_;o_<Ob/2;o_++){e_=2*o_*Nb,Kb.re=Xb.slice(e_,e_+Nb),e_=(2*o_+1)*Nb,Kb.im=Xb.slice(e_,e_+Nb),il.fft1d(Kb.re,Kb.im),this.reconstructTwoRealFFT(Kb,Jb,$b),t_=4*o_*Wb,a_=(4*o_+1)*Wb,i_=(4*o_+2)*Wb,n_=(4*o_+3)*Wb;for(var s_=Wb-1;0<=s_;s_--)Qb[t_+s_]=Jb.re[s_],Qb[a_+s_]=Jb.im[s_],Qb[i_+s_]=$b.re[s_],Qb[n_+s_]=$b.im[s_]}Jb=null,$b=null;var r_=Array(Zb*Wb);il.init(Ob);for(var l_={re:Array(Ob),im:Array(Ob)},d_=Wb-1;0<=d_;d_--){for(var o_=Ob-1;0<=o_;o_--)l_.re[o_]=Qb[2*o_*Wb+d_],l_.im[o_]=Qb[(2*o_+1)*Wb+d_],isNaN(l_.re[o_])&&(l_.re[o_]=0),isNaN(l_.im[o_])&&(l_.im[o_]=0);il.fft1d(l_.re,l_.im);for(var o_=Ob-1;0<=o_;o_--)r_[2*o_*Wb+d_]=l_.re[o_],r_[(2*o_+1)*Wb+d_]=l_.im[o_]}return r_},reconstructTwoRealFFT:function(Xb,Ob,Nb){var Gb=Xb.re.length;Ob.re[0]=Xb.re[0],Ob.im[0]=0,Nb.re[0]=Xb.im[0],Nb.im[0]=0;for(var Jb=Gb/2,Hb,Wb,Zb,Qb,Kb;0<Jb;Jb--)Kb=Gb-Jb,Hb=0.5*(Xb.re[Jb]-Xb.re[Kb]),Wb=0.5*(Xb.re[Jb]+Xb.re[Kb]),Zb=0.5*(Xb.im[Jb]-Xb.im[Kb]),Qb=0.5*(Xb.im[Jb]+Xb.im[Kb]),Ob.re[Jb]=Wb,Ob.im[Jb]=Zb,Ob.re[Kb]=Wb,Ob.im[Kb]=-Zb,Nb.re[Jb]=Qb,Nb.im[Jb]=-Hb,Nb.re[Kb]=Qb,Nb.im[Kb]=Hb},convolute2DI:function(Xb,Ob,Nb,Gb){for(var Zb=0,Hb,Wb;Zb<Nb/2;Zb++)for(var Qb=0;Qb<Gb;Qb++)Hb=Xb[2*Zb*Gb+Qb]*Ob[2*Zb*Gb+Qb]-Xb[(2*Zb+1)*Gb+Qb]*Ob[(2*Zb+1)*Gb+Qb],Wb=Xb[2*Zb*Gb+Qb]*Ob[(2*Zb+1)*Gb+Qb]+Xb[(2*Zb+1)*Gb+Qb]*Ob[2*Zb*Gb+Qb],Xb[2*Zb*Gb+Qb]=Hb,Xb[(2*Zb+1)*Gb+Qb]=Wb},convolute:function(Xb,Ob,Nb,Gb){for(var Wb=Array(Gb*Nb),Zb=0;Zb<Nb*Gb;Zb++)Wb[Zb]=Xb[Zb];Wb=this.fft2DArray(Wb,Nb,Gb);for(var Qb=Ob.length,Kb=Ob[0].length,Jb=Array(Gb*Nb),Zb=0;Zb<Gb*Nb;Zb++)Jb[Zb]=0;for(var t_=_Mathfloor((Qb-1)/2),a_=_Mathfloor((Kb-1)/2),i_=0,$b,e_;i_<Qb;i_++){$b=(i_-t_+Nb)%Nb;for(var n_=0;n_<Kb;n_++)e_=(n_-a_+Gb)%Gb,Jb[$b*Gb+e_]=Ob[i_][n_]}Jb=this.fft2DArray(Jb,Nb,Gb);var o_=2*Nb,s_=Gb/2+1;return this.convolute2DI(Wb,Jb,o_,s_),this.ifft2DArray(Wb,o_,s_)},toRadix2:function(Xb,Ob,Nb){var Qb=Nb,Kb=Ob,Jb=0,$b=0,Gb,Hb,Wb,Zb;if(0===Nb||0!=(Nb&Nb-1)){for(Qb=0;0!=Nb>>++Qb;);Qb=1<<Qb,$b=Qb-Nb}if(0===Ob||0!=(Ob&Ob-1)){for(Kb=0;0!=Ob>>++Kb;);Kb=1<<Kb,Jb=(Kb-Ob)*Qb}if(Kb==Ob&&Qb==Nb)return{data:Xb,rows:Ob,cols:Nb};var e_=Array(Kb*Qb),t_=_Mathfloor((Kb-Ob)/2)-Ob,a_=_Mathfloor((Qb-Nb)/2)-Nb;for(Gb=0;Gb<Kb;Gb++)for(Wb=Gb*Qb,Zb=(Gb-t_)%Ob*Nb,Hb=0;Hb<Qb;Hb++)e_[Wb+Hb]=Xb[Zb+(Hb-a_)%Nb];return{data:e_,rows:Kb,cols:Qb}},crop:function(Xb,Ob,Nb,Gb,Hb,Wb){if(Ob==Gb&&Nb==Hb)return Xb;var Zb=Object.assign({},Wb),Qb=Array(Hb*Gb),Kb=_Mathfloor((Ob-Gb)/2),Jb=_Mathfloor((Nb-Hb)/2),$b,e_,t_,a_;for(t_=0;t_<Gb;t_++)for($b=t_*Hb,e_=(t_+Kb)*Nb,a_=0;a_<Hb;a_++)Qb[$b+a_]=Xb[e_+(a_+Jb)];return Qb}},FFT:il}.FFTUtils,hl={fft:function(Xb,Ob,Nb){var Gb=be(Xb),Hb=Gb.data,Wb=Object.assign({normalize:!1,divisor:1,rows:Gb.rows,cols:Gb.cols},Nb),Zb,Qb;if(Wb.rows&&Wb.cols)Zb=Wb.rows,Qb=Wb.cols;else throw new Error('Invalid number of rows or columns '+Zb+' '+Qb);var Kb=Wb.divisor,e_=Ob.length,t_=Ob[0].length,Jb,$b;if(Wb.normalize)for(Kb=0,Jb=0;Jb<e_;Jb++)for($b=0;$b<t_;$b++)Kb+=Ob[Jb][$b];if(0===Kb)throw new RangeError('convolution: The divisor is equal to zero');var a_=dl.toRadix2(Hb,Zb,Qb),i_=dl.convolute(a_.data,Ob,a_.rows,a_.cols);if(i_=dl.crop(i_,a_.rows,a_.cols,Zb,Qb),0!=Kb&&1!=Kb)for(Jb=0;Jb<i_.length;Jb++)i_[Jb]/=Kb;return i_},direct:function(Xb,Ob,Nb){var Gb=be(Xb),Hb=Gb.data,Wb=Object.assign({normalize:!1,divisor:1,rows:Gb.rows,cols:Gb.cols},Nb),Zb,Qb;if(Wb.rows&&Wb.cols)Zb=Wb.rows,Qb=Wb.cols;else throw new Error('Invalid number of rows or columns '+Zb+' '+Qb);var Kb=Wb.divisor,Jb=Ob.length,$b=Ob[0].length,e_,t_,a_,i_,n_,o_,s_,r_,l_;if(Wb.normalize)for(Kb=0,e_=0;e_<Jb;e_++)for(t_=0;t_<$b;t_++)Kb+=Ob[e_][t_];if(0===Kb)throw new RangeError('convolution: The divisor is equal to zero');var d_=Array(Zb*Qb),h_=_Mathfloor(Jb/2),m_=_Mathfloor($b/2);for(i_=0;i_<Zb;i_++)for(a_=0;a_<Qb;a_++){for(o_=0,t_=0;t_<Jb;t_++)for(e_=0;e_<$b;e_++)s_=Ob[Jb-t_-1][$b-e_-1],r_=(i_+t_-h_+Zb)%Zb,l_=(a_+e_-m_+Qb)%Qb,n_=r_*Qb+l_,o_+=Hb[n_]*s_;n_=i_*Qb+a_,d_[n_]=o_/Kb}return d_},kernelFactory:{LoG:function(Xb,Ob,Nb){var Gb=1e3;Nb&&Nb.factor&&(Gb=Nb.factor);var Hb=Array(Ob),Wb,Zb,Qb,Kb;Gb*=-1;var $b=(Ob-1)/2;for(Wb=0;Wb<Ob;Wb++)for(Hb[Wb]=Array(Ob),Kb=(Wb-$b)*(Wb-$b),Zb=0;Zb<Ob;Zb++)Qb=-((Zb-$b)*(Zb-$b)+Kb)/(2*Xb*Xb),Hb[Wb][Zb]=_Mathround(Gb*(1+Qb)*_Mathexp(Qb));return Hb}},matrix2Array:be},ml=hl.direct,gl=hl.fft,cl=_NumberisFinite||function(Xb){return!('number'!=typeof Xb||$r(Xb)||Xb===Infinity||Xb===-Infinity)},ul=_NumberisInteger||function(Xb){return'number'==typeof Xb&&cl(Xb)&&_Mathfloor(Xb)===Xb},bl=[[-1,0,1],[-2,0,2],[-1,0,1]],_l=[[-1,-2,-1],[0,0,0],[1,2,1]],vl=function(Xb,Ob){Xb=Xb||0;for(var Nb=Array(Xb),Gb=0;Gb<Xb;Gb++)Nb[Gb]=Ob;return Nb},Dl=Object.prototype.toString,jl=function(Ob){return'Array'===Dl.call(Ob).substr(-6,5)},Sl={maybeToPrecision:function(Ob,Nb){return 0>Ob?(Ob=-1*Ob,Nb?'- '+Ob.toPrecision(Nb):'- '+Ob.toString()):Nb?Ob.toPrecision(Nb):Ob.toString()}};var Pl=class{predict(Xb){var Ob;if(Array.isArray(Xb)){Ob=Array(Xb.length);for(var Nb=0;Nb<Xb.length;Nb++)Ob[Nb]=this._predict(Xb[Nb])}else if(_NumberisFinite(Xb))Ob=this._predict(Xb);else throw new TypeError('x must be a number or array');return Ob}_predict(){throw new Error('_compute not implemented')}train(){}toString(){return''}toLaTeX(){return''}modelQuality(Xb,Ob){let Nb=Xb.length;var Gb=Array(Nb);for(let t_=0;t_<Nb;t_++)Gb[t_]=this._predict(Xb[t_]);var Hb=0,Wb=0,Zb=0,Qb=0,Kb=0,Jb=0,$b=0;for(let t_=0;t_<Nb;t_++)Hb+=Gb[t_],Wb+=Ob[t_],Kb+=Gb[t_]*Gb[t_],Jb+=Ob[t_]*Ob[t_],$b+=Gb[t_]*Ob[t_],0!==Ob[t_]&&(Zb+=(Ob[t_]-Gb[t_])*(Ob[t_]-Gb[t_])/Ob[t_]),Qb=(Ob[t_]-Gb[t_])*(Ob[t_]-Gb[t_]);var e_=(Nb*$b-Hb*Wb)/_Mathsqrt((Nb*Kb-Hb*Hb)*(Nb*Jb-Wb*Wb));return{r:e_,r2:e_*e_,chi2:Zb,rmsd:Qb*Qb/Nb}}},Cl=Sl.maybeToPrecision;class Bl extends Pl{constructor(Xb,Ob,Nb){if(Nb=Nb||{},super(),!0===Xb)this.slope=Ob.slope,this.intercept=Ob.intercept,this.quality=Ob.quality||{},Ob.quality.r&&(this.quality.r=Ob.quality.r,this.quality.r2=Ob.quality.r2),Ob.quality.chi2&&(this.quality.chi2=Ob.quality.chi2);else{var Gb=Xb.length;if(Gb!==Ob.length)throw new RangeError('input and output array have a different length');for(var Hb=0,Wb=0,Zb=0,Qb=0,Kb=0;Kb<Gb;Kb++)Hb+=Xb[Kb],Wb+=Ob[Kb],Zb+=Xb[Kb]*Xb[Kb],Qb+=Xb[Kb]*Ob[Kb];var Jb=Gb*Qb-Hb*Wb;this.slope=Jb/(Gb*Zb-Hb*Hb),this.intercept=1/Gb*Wb-this.slope*(1/Gb)*Hb,this.coefficients=[this.intercept,this.slope],Nb.computeQuality&&(this.quality=this.modelQuality(Xb,Ob))}}toJSON(){var Xb={name:'simpleLinearRegression',slope:this.slope,intercept:this.intercept};return this.quality&&(Xb.quality=this.quality),Xb}_predict(Xb){return this.slope*Xb+this.intercept}computeX(Xb){return(Xb-this.intercept)/this.slope}toString(Xb){var Ob='f(x) = ';if(this.slope){var Nb=Cl(this.slope,Xb);if(Ob+=(1e-5>_Mathabs(Nb-1)?'':Nb+' * ')+'x',this.intercept){var Gb=_Mathabs(this.intercept),Hb=Gb===this.intercept?'+':'-';Ob+=' '+Hb+' '+Cl(Gb,Xb)}}else Ob+=Cl(this.intercept,Xb);return Ob}toLaTeX(Xb){return this.toString(Xb)}static load(Xb){if('simpleLinearRegression'!==Xb.name)throw new TypeError('not a SLR model');return new Bl(!0,Xb)}}var Al=Bl;Symbol.species||(Symbol.species=Symbol.for('@@species')),Ee.prototype={isSingular:function(){for(var Xb=this.LU,Ob=Xb.columns,Nb=0;Nb<Ob;Nb++)if(0===Xb[Nb][Nb])return!0;return!1},get determinant(){var Xb=this.LU;if(!Xb.isSquare())throw new Error('Matrix must be square');for(var Ob=this.pivotSign,Nb=Xb.columns,Gb=0;Gb<Nb;Gb++)Ob*=Xb[Gb][Gb];return Ob},get lowerTriangularMatrix(){for(var Xb=this.LU,Ob=Xb.rows,Nb=Xb.columns,Gb=new ad(Ob,Nb),Hb=0;Hb<Ob;Hb++)for(var Wb=0;Wb<Nb;Wb++)Gb[Hb][Wb]=Hb>Wb?Xb[Hb][Wb]:Hb===Wb?1:0;return Gb},get upperTriangularMatrix(){for(var Xb=this.LU,Ob=Xb.rows,Nb=Xb.columns,Gb=new ad(Ob,Nb),Hb=0;Hb<Ob;Hb++)for(var Wb=0;Wb<Nb;Wb++)Gb[Hb][Wb]=Hb<=Wb?Xb[Hb][Wb]:0;return Gb},get pivotPermutationVector(){return this.pivotVector.slice()},solve:function(Xb){Xb=ad.checkMatrix(Xb);var Ob=this.LU,Nb=Ob.rows;if(Nb!==Xb.rows)throw new Error('Invalid matrix dimensions');if(this.isSingular())throw new Error('LU matrix is singular');var Gb=Xb.columns,Hb=Xb.subMatrixRow(this.pivotVector,0,Gb-1),Wb=Ob.columns,Zb,Qb,Kb;for(Kb=0;Kb<Wb;Kb++)for(Zb=Kb+1;Zb<Wb;Zb++)for(Qb=0;Qb<Gb;Qb++)Hb[Zb][Qb]-=Hb[Kb][Qb]*Ob[Zb][Kb];for(Kb=Wb-1;0<=Kb;Kb--){for(Qb=0;Qb<Gb;Qb++)Hb[Kb][Qb]/=Ob[Kb][Kb];for(Zb=0;Zb<Kb;Zb++)for(Qb=0;Qb<Gb;Qb++)Hb[Zb][Qb]-=Hb[Kb][Qb]*Ob[Zb][Kb]}return Hb}},Ye.prototype={get condition(){return this.s[0]/this.s[_Mathmin(this.m,this.n)-1]},get norm2(){return this.s[0]},get rank(){for(var Ob=_Mathmax(this.m,this.n)*this.s[0]*2.220446049250313e-16,Nb=0,Gb=this.s,Hb=0,Wb=Gb.length;Hb<Wb;Hb++)Gb[Hb]>Ob&&Nb++;return Nb},get diagonal(){return this.s},get threshold(){return 2.220446049250313e-16/2*_Mathmax(this.m,this.n)*this.s[0]},get leftSingularVectors(){return ad.isMatrix(this.U)||(this.U=new ad(this.U)),this.U},get rightSingularVectors(){return ad.isMatrix(this.V)||(this.V=new ad(this.V)),this.V},get diagonalMatrix(){return ad.diag(this.s)},solve:function(Xb){var Nb=this.threshold,Gb=this.s.length,Hb=ad.zeros(Gb,Gb),Wb;for(Wb=0;Wb<Gb;Wb++)Hb[Wb][Wb]=_Mathabs(this.s[Wb])<=Nb?0:1/this.s[Wb];var Zb=this.U,Qb=this.rightSingularVectors,Kb=Qb.mmul(Hb),Jb=Qb.rows,$b=Zb.length,e_=ad.zeros(Jb,$b),t_,a_,i_;for(Wb=0;Wb<Jb;Wb++)for(t_=0;t_<$b;t_++){for(i_=0,a_=0;a_<Gb;a_++)i_+=Kb[Wb][a_]*Zb[t_][a_];e_[Wb][t_]=i_}return e_.mmul(Xb)},solveForDiagonal:function(Xb){return this.solve(ad.diag(Xb))},inverse:function(){var Xb=this.V,Ob=this.threshold,Nb=Xb.length,Gb=Xb[0].length,Hb=new ad(Nb,this.s.length),Wb,Zb;for(Wb=0;Wb<Nb;Wb++)for(Zb=0;Zb<Gb;Zb++)Hb[Wb][Zb]=_Mathabs(this.s[Zb])>Ob?Xb[Wb][Zb]/this.s[Zb]:0;var Qb=this.U,Kb=Qb.length,Jb=Qb[0].length,$b=new ad(Nb,Kb),e_,t_;for(Wb=0;Wb<Nb;Wb++)for(Zb=0;Zb<Kb;Zb++){for(t_=0,e_=0;e_<Jb;e_++)t_+=Hb[Wb][e_]*Qb[Zb][e_];$b[Wb][Zb]=t_}return $b}};var Rl=ce(function(Xb,Ob){'use strict';function Nb(Gb,Hb){return Gb-Hb}Ob.sum=function(Hb){for(var Gb=0,Wb=0;Wb<Hb.length;Wb++)Gb+=Hb[Wb];return Gb},Ob.max=function(Hb){for(var Gb=Hb[0],Wb=Hb.length,Zb=1;Zb<Wb;Zb++)Hb[Zb]>Gb&&(Gb=Hb[Zb]);return Gb},Ob.min=function(Hb){for(var Gb=Hb[0],Wb=Hb.length,Zb=1;Zb<Wb;Zb++)Hb[Zb]<Gb&&(Gb=Hb[Zb]);return Gb},Ob.minMax=function(Hb){for(var Wb=Hb[0],Zb=Hb[0],Qb=Hb.length,Kb=1;Kb<Qb;Kb++)Hb[Kb]<Wb&&(Wb=Hb[Kb]),Hb[Kb]>Zb&&(Zb=Hb[Kb]);return{min:Wb,max:Zb}},Ob.arithmeticMean=function(Hb){for(var Wb=0,Zb=Hb.length,Qb=0;Qb<Zb;Qb++)Wb+=Hb[Qb];return Wb/Zb},Ob.mean=Ob.arithmeticMean,Ob.geometricMean=function(Hb){for(var Wb=1,Zb=Hb.length,Qb=0;Qb<Zb;Qb++)Wb*=Hb[Qb];return _Mathpow(Wb,1/Zb)},Ob.logMean=function(Hb){for(var Wb=0,Zb=Hb.length,Qb=0;Qb<Zb;Qb++)Wb+=_Mathlog(Hb[Qb]);return Wb/Zb},Ob.grandMean=function(Hb,Wb){for(var Zb=0,Qb=0,Kb=Hb.length,Jb=0;Jb<Kb;Jb++)Zb+=Wb[Jb]*Hb[Jb],Qb+=Wb[Jb];return Zb/Qb},Ob.truncatedMean=function(Hb,Wb,Zb){void 0===Zb&&(Zb=!1),Zb||(Hb=[].concat(Hb).sort(Nb));for(var Qb=Hb.length,Kb=_Mathfloor(Qb*Wb),Jb=0,$b=Kb;$b<Qb-Kb;$b++)Jb+=Hb[$b];return Jb/(Qb-2*Kb)},Ob.harmonicMean=function(Hb){for(var Wb=0,Zb=Hb.length,Qb=0;Qb<Zb;Qb++){if(0===Hb[Qb])throw new RangeError('value at index '+Qb+'is zero');Wb+=1/Hb[Qb]}return Zb/Wb},Ob.contraHarmonicMean=function(Hb){for(var Wb=0,Zb=0,Qb=Hb.length,Kb=0;Kb<Qb;Kb++)Wb+=Hb[Kb]*Hb[Kb],Zb+=Hb[Kb];if(0>Zb)throw new RangeError('sum of values is negative');return Wb/Zb},Ob.median=function(Hb,Wb){void 0===Wb&&(Wb=!1),Wb||(Hb=[].concat(Hb).sort(Nb));var Zb=Hb.length,Qb=_Mathfloor(Zb/2);return 0==Zb%2?0.5*(Hb[Qb-1]+Hb[Qb]):Hb[Qb]},Ob.variance=function(Hb,Wb){void 0===Wb&&(Wb=!0);for(var Zb=Ob.mean(Hb),Qb=0,Kb=Hb.length,Jb=0,$b;Jb<Kb;Jb++)$b=Hb[Jb]-Zb,Qb+=$b*$b;return Wb?Qb/(Kb-1):Qb/Kb},Ob.standardDeviation=function(Hb,Wb){return _Mathsqrt(Ob.variance(Hb,Wb))},Ob.standardError=function(Hb){return Ob.standardDeviation(Hb)/_Mathsqrt(Hb.length)},Ob.robustMeanAndStdev=function(Hb){var Wb=0,Zb=0,Qb=Hb.length,Kb=0;for(Kb=0;Kb<Qb;Kb++)Wb+=Hb[Kb];Wb/=Qb;var Jb=Array(Qb);for(Kb=0;Kb<Qb;Kb++)Jb[Kb]=_Mathabs(Hb[Kb]-Wb);return Jb.sort(Nb),Zb=1==Qb%2?Jb[(Qb-1)/2]/0.6745:0.5*(Jb[Qb/2]+Jb[Qb/2-1])/0.6745,{mean:Wb,stdev:Zb}},Ob.quartiles=function(Hb,Wb){'undefined'==typeof Wb&&(Wb=!1),Wb||(Hb=[].concat(Hb).sort(Nb));var Zb=Hb.length/4,Qb=Hb[_Mathceil(Zb)-1],Kb=Ob.median(Hb,!0),Jb=Hb[_Mathceil(3*Zb)-1];return{q1:Qb,q2:Kb,q3:Jb}},Ob.pooledStandardDeviation=function(Hb,Wb){return _Mathsqrt(Ob.pooledVariance(Hb,Wb))},Ob.pooledVariance=function(Hb,Wb){'undefined'==typeof Wb&&(Wb=!0);for(var Zb=0,Qb=0,Kb=Hb.length,Jb=0;Jb<Kb;Jb++){var $b=Hb[Jb],e_=Ob.variance($b);Zb+=($b.length-1)*e_,Qb+=Wb?$b.length-1:$b.length}return Zb/Qb},Ob.mode=function(Hb){var Wb=Hb.length,Zb=Array(Wb),Qb;for(Qb=0;Qb<Wb;Qb++)Zb[Qb]=0;var Kb=Array(Wb),Jb=0;for(Qb=0;Qb<Wb;Qb++){var $b=Kb.indexOf(Hb[Qb]);0<=$b?Zb[$b]++:(Kb[Jb]=Hb[Qb],Zb[Jb]=1,Jb++)}var e_=0,t_=0;for(Qb=0;Qb<Jb;Qb++)Zb[Qb]>e_&&(e_=Zb[Qb],t_=Qb);return Kb[t_]},Ob.covariance=function(Hb,Wb,Zb){'undefined'==typeof Zb&&(Zb=!0);var Qb=Ob.mean(Hb),Kb=Ob.mean(Wb);if(Hb.length!==Wb.length)throw'Vectors do not have the same dimensions';for(var Jb=0,$b=Hb.length,e_=0;e_<$b;e_++){var t_=Hb[e_]-Qb,a_=Wb[e_]-Kb;Jb+=t_*a_}return Zb?Jb/($b-1):Jb/$b},Ob.skewness=function(Hb,Wb){'undefined'==typeof Wb&&(Wb=!0);for(var Zb=Ob.mean(Hb),Qb=0,Kb=0,Jb=Hb.length,$b=0,e_;$b<Jb;$b++)e_=Hb[$b]-Zb,Qb+=e_*e_,Kb+=e_*e_*e_;var t_=Qb/Jb,a_=Kb/Jb,i_=a_/_Mathpow(t_,3/2);if(Wb){var n_=_Mathsqrt(Jb*(Jb-1));return n_/(Jb-2)*i_}return i_},Ob.kurtosis=function(Hb,Wb){'undefined'==typeof Wb&&(Wb=!0);for(var Zb=Ob.mean(Hb),Qb=Hb.length,Kb=0,Jb=0,$b=0,e_;$b<Qb;$b++)e_=Hb[$b]-Zb,Kb+=e_*e_,Jb+=e_*e_*e_*e_;var t_=Kb/Qb,a_=Jb/Qb;if(Wb){var i_=Kb/(Qb-1),o_=Jb/(i_*i_);return Qb*(Qb+1)/((Qb-1)*(Qb-2)*(Qb-3))*o_-3*((Qb-1)*(Qb-1)/((Qb-2)*(Qb-3)))}return a_/(t_*t_)-3},Ob.entropy=function(Hb,Wb){'undefined'==typeof Wb&&(Wb=0);for(var Zb=0,Qb=Hb.length,Kb=0;Kb<Qb;Kb++)Zb+=Hb[Kb]*_Mathlog(Hb[Kb]+Wb);return-Zb},Ob.weightedMean=function(Hb,Wb){for(var Zb=0,Qb=Hb.length,Kb=0;Kb<Qb;Kb++)Zb+=Hb[Kb]*Wb[Kb];return Zb},Ob.weightedStandardDeviation=function(Hb,Wb){return _Mathsqrt(Ob.weightedVariance(Hb,Wb))},Ob.weightedVariance=function(Hb,Wb){for(var Zb=Ob.weightedMean(Hb,Wb),Qb=0,Kb=Hb.length,Jb=0,$b=0,e_=0;e_<Kb;e_++){var t_=Hb[e_]-Zb,a_=Wb[e_];Qb+=a_*(t_*t_),$b+=a_,Jb+=a_*a_}return Qb*($b/($b*$b-Jb))},Ob.center=function(Hb,Wb){'undefined'==typeof Wb&&(Wb=!1);var Zb=Hb;Wb||(Zb=[].concat(Hb));for(var Qb=Ob.mean(Zb),Kb=Zb.length,Jb=0;Jb<Kb;Jb++)Zb[Jb]-=Qb},Ob.standardize=function(Hb,Wb,Zb){'undefined'==typeof Wb&&(Wb=Ob.standardDeviation(Hb)),'undefined'==typeof Zb&&(Zb=!1);for(var Qb=Hb.length,Kb=Zb?Hb:Array(Qb),Jb=0;Jb<Qb;Jb++)Kb[Jb]=Hb[Jb]/Wb;return Kb},Ob.cumulativeSum=function(Hb){var Wb=Hb.length,Zb=Array(Wb);Zb[0]=Hb[0];for(var Qb=1;Qb<Wb;Qb++)Zb[Qb]=Zb[Qb-1]+Hb[Qb];return Zb}}),zl=ce(function(Xb,Ob){'use strict';function Nb(Gb,Hb){return Gb-Hb}Ob.max=function(Hb){for(var Gb=-Infinity,Wb=0;Wb<Hb.length;Wb++)for(var Zb=0;Zb<Hb[Wb].length;Zb++)Hb[Wb][Zb]>Gb&&(Gb=Hb[Wb][Zb]);return Gb},Ob.min=function(Hb){for(var Gb=Infinity,Wb=0;Wb<Hb.length;Wb++)for(var Zb=0;Zb<Hb[Wb].length;Zb++)Hb[Wb][Zb]<Gb&&(Gb=Hb[Wb][Zb]);return Gb},Ob.minMax=function(Hb){for(var Wb=Infinity,Zb=-Infinity,Qb=0;Qb<Hb.length;Qb++)for(var Kb=0;Kb<Hb[Qb].length;Kb++)Hb[Qb][Kb]<Wb&&(Wb=Hb[Qb][Kb]),Hb[Qb][Kb]>Zb&&(Zb=Hb[Qb][Kb]);return{min:Wb,max:Zb}},Ob.entropy=function(Hb,Wb){'undefined'==typeof Wb&&(Wb=0);for(var Zb=0,Qb=Hb.length,Kb=Hb[0].length,Jb=0;Jb<Qb;Jb++)for(var $b=0;$b<Kb;$b++)Zb+=Hb[Jb][$b]*_Mathlog(Hb[Jb][$b]+Wb);return-Zb},Ob.mean=function(Hb,Wb){'undefined'==typeof Wb&&(Wb=0);var Zb=Hb.length,Qb=Hb[0].length,Kb,Jb,$b,e_;if(-1===Wb){for(Kb=[0],Jb=Zb*Qb,$b=0;$b<Zb;$b++)for(e_=0;e_<Qb;e_++)Kb[0]+=Hb[$b][e_];Kb[0]/=Jb}else if(0===Wb)for(Kb=Array(Qb),Jb=Zb,e_=0;e_<Qb;e_++){for(Kb[e_]=0,$b=0;$b<Zb;$b++)Kb[e_]+=Hb[$b][e_];Kb[e_]/=Jb}else if(1===Wb)for(Kb=Array(Zb),Jb=Qb,e_=0;e_<Zb;e_++){for(Kb[e_]=0,$b=0;$b<Qb;$b++)Kb[e_]+=Hb[e_][$b];Kb[e_]/=Jb}else throw new Error('Invalid dimension');return Kb},Ob.sum=function(Hb,Wb){'undefined'==typeof Wb&&(Wb=0);var Zb=Hb.length,Qb=Hb[0].length,Kb,Jb,$b;if(-1===Wb)for(Kb=[0],Jb=0;Jb<Zb;Jb++)for($b=0;$b<Qb;$b++)Kb[0]+=Hb[Jb][$b];else if(0===Wb)for(Kb=Array(Qb),$b=0;$b<Qb;$b++)for(Kb[$b]=0,Jb=0;Jb<Zb;Jb++)Kb[$b]+=Hb[Jb][$b];else if(1===Wb)for(Kb=Array(Zb),$b=0;$b<Zb;$b++)for(Kb[$b]=0,Jb=0;Jb<Qb;Jb++)Kb[$b]+=Hb[$b][Jb];else throw new Error('Invalid dimension');return Kb},Ob.product=function(Hb,Wb){'undefined'==typeof Wb&&(Wb=0);var Zb=Hb.length,Qb=Hb[0].length,Kb,Jb,$b;if(-1===Wb)for(Kb=[1],Jb=0;Jb<Zb;Jb++)for($b=0;$b<Qb;$b++)Kb[0]*=Hb[Jb][$b];else if(0===Wb)for(Kb=Array(Qb),$b=0;$b<Qb;$b++)for(Kb[$b]=1,Jb=0;Jb<Zb;Jb++)Kb[$b]*=Hb[Jb][$b];else if(1===Wb)for(Kb=Array(Zb),$b=0;$b<Zb;$b++)for(Kb[$b]=1,Jb=0;Jb<Qb;Jb++)Kb[$b]*=Hb[$b][Jb];else throw new Error('Invalid dimension');return Kb},Ob.standardDeviation=function(Hb,Wb,Zb){for(var Qb=Ob.variance(Hb,Wb,Zb),Kb=Qb.length,Jb=0;Jb<Kb;Jb++)Qb[Jb]=_Mathsqrt(Qb[Jb]);return Qb},Ob.variance=function(Hb,Wb,Zb){'undefined'==typeof Zb&&(Zb=!0),Wb=Wb||Ob.mean(Hb);var Qb=Hb.length;if(0===Qb)return[];for(var Kb=Hb[0].length,Jb=Array(Kb),$b=0;$b<Kb;$b++){for(var e_=0,t_=0,a_=0,i_=0;i_<Qb;i_++)a_=Hb[i_][$b]-Wb[$b],e_+=a_,t_+=a_*a_;Jb[$b]=Zb?(t_-e_*e_/Qb)/(Qb-1):(t_-e_*e_/Qb)/Qb}return Jb},Ob.median=function(Hb){for(var Wb=Hb.length,Zb=Hb[0].length,Qb=Array(Zb),Kb=0,Jb;Kb<Zb;Kb++){Jb=Array(Wb);for(var $b=0;$b<Wb;$b++)Jb[$b]=Hb[$b][Kb];Jb.sort(Nb);var e_=Jb.length;Qb[Kb]=0==e_%2?0.5*(Jb[e_/2]+Jb[e_/2-1]):Jb[_Mathfloor(e_/2)]}return Qb},Ob.mode=function(Hb){var Wb=Hb.length,Zb=Hb[0].length,Qb=Array(Zb),Kb,Jb;for(Kb=0;Kb<Zb;Kb++){for(var $b=Array(Wb),e_=0;e_<Wb;e_++)$b[e_]=0;var t_=Array(Wb),a_=0;for(Jb=0;Jb<Wb;Jb++){var i_=t_.indexOf(Hb[Jb][Kb]);0<=i_?$b[i_]++:(t_[a_]=Hb[Jb][Kb],$b[a_]=1,a_++)}var n_=0,o_=0;for(Jb=0;Jb<a_;Jb++)$b[Jb]>n_&&(n_=$b[Jb],o_=Jb);Qb[Kb]=t_[o_]}return Qb},Ob.skewness=function(Hb,Wb){'undefined'==typeof Wb&&(Wb=!0);for(var Zb=Ob.mean(Hb),Qb=Hb.length,Kb=Zb.length,Jb=Array(Kb),$b=0;$b<Kb;$b++){for(var e_=0,t_=0,a_=0,i_;a_<Qb;a_++)i_=Hb[a_][$b]-Zb[$b],e_+=i_*i_,t_+=i_*i_*i_;var n_=e_/Qb,o_=t_/Qb,s_=o_/_Mathpow(n_,3/2);if(Wb){var r_=_Mathsqrt(Qb*(Qb-1));Jb[$b]=r_/(Qb-2)*s_}else Jb[$b]=s_}return Jb},Ob.kurtosis=function(Hb,Wb){'undefined'==typeof Wb&&(Wb=!0);for(var Zb=Ob.mean(Hb),Qb=Hb.length,Kb=Hb[0].length,Jb=Array(Kb),$b=0;$b<Kb;$b++){for(var e_=0,t_=0,a_=0,i_;a_<Qb;a_++)i_=Hb[a_][$b]-Zb[$b],e_+=i_*i_,t_+=i_*i_*i_*i_;var n_=e_/Qb,o_=t_/Qb;if(Wb){var s_=e_/(Qb-1),l_=t_/(s_*s_);Jb[$b]=Qb*(Qb+1)/((Qb-1)*(Qb-2)*(Qb-3))*l_-3*((Qb-1)*(Qb-1)/((Qb-2)*(Qb-3)))}else Jb[$b]=o_/(n_*n_)-3}return Jb},Ob.standardError=function(Hb){for(var Wb=Hb.length,Zb=Ob.standardDeviation(Hb),Qb=Zb.length,Kb=Array(Qb),Jb=_Mathsqrt(Wb),$b=0;$b<Qb;$b++)Kb[$b]=Zb[$b]/Jb;return Kb},Ob.covariance=function(Hb,Wb){return Ob.scatter(Hb,void 0,Wb)},Ob.scatter=function(Hb,Wb,Zb){'undefined'==typeof Zb&&(Zb=0),'undefined'==typeof Wb&&(0===Zb?Wb=Hb.length-1:1===Zb&&(Wb=Hb[0].length-1));var Qb=Ob.mean(Hb,Zb),Kb=Hb.length;if(0===Kb)return[[]];var Jb=Hb[0].length,$b,e_,t_,a_,i_;if(0===Zb){for($b=Array(Jb),e_=0;e_<Jb;e_++)$b[e_]=Array(Jb);for(e_=0;e_<Jb;e_++)for(t_=e_;t_<Jb;t_++){for(a_=0,i_=0;i_<Kb;i_++)a_+=(Hb[i_][t_]-Qb[t_])*(Hb[i_][e_]-Qb[e_]);a_/=Wb,$b[e_][t_]=a_,$b[t_][e_]=a_}}else if(1===Zb){for($b=Array(Kb),e_=0;e_<Kb;e_++)$b[e_]=Array(Kb);for(e_=0;e_<Kb;e_++)for(t_=e_;t_<Kb;t_++){for(a_=0,i_=0;i_<Jb;i_++)a_+=(Hb[t_][i_]-Qb[t_])*(Hb[e_][i_]-Qb[e_]);a_/=Wb,$b[e_][t_]=a_,$b[t_][e_]=a_}}else throw new Error('Invalid dimension');return $b},Ob.correlation=function(Hb){var Wb=Ob.mean(Hb),Zb=Ob.standardDeviation(Hb,!0,Wb),Qb=Ob.zScores(Hb,Wb,Zb),Kb=Hb.length,Jb=Hb[0].length,t_=Array(Jb),$b,e_;for($b=0;$b<Jb;$b++)t_[$b]=Array(Jb);for($b=0;$b<Jb;$b++)for(e_=$b;e_<Jb;e_++){for(var a_=0,i_=0,n_=Qb.length;i_<n_;i_++)a_+=Qb[i_][e_]*Qb[i_][$b];a_/=Kb-1,t_[$b][e_]=a_,t_[e_][$b]=a_}return t_},Ob.zScores=function(Hb,Wb,Zb){return Wb=Wb||Ob.mean(Hb),'undefined'==typeof Zb&&(Zb=Ob.standardDeviation(Hb,!0,Wb)),Ob.standardize(Ob.center(Hb,Wb,!1),Zb,!0)},Ob.center=function(Hb,Wb,Zb){Wb=Wb||Ob.mean(Hb);var Qb=Hb,Kb=Hb.length,Jb,$b,e_;if(!Zb)for(Qb=Array(Kb),Jb=0;Jb<Kb;Jb++)Qb[Jb]=Array(Hb[Jb].length);for(Jb=0;Jb<Kb;Jb++){var t_=Qb[Jb];for($b=0,e_=t_.length;$b<e_;$b++)t_[$b]=Hb[Jb][$b]-Wb[$b]}return Qb},Ob.standardize=function(Hb,Wb,Zb){'undefined'==typeof Wb&&(Wb=Ob.standardDeviation(Hb));var Qb=Hb,Kb=Hb.length,Jb,$b,e_;if(!Zb)for(Qb=Array(Kb),Jb=0;Jb<Kb;Jb++)Qb[Jb]=Array(Hb[Jb].length);for(Jb=0;Jb<Kb;Jb++){var t_=Qb[Jb],a_=Hb[Jb];for($b=0,e_=t_.length;$b<e_;$b++)0===Wb[$b]||isNaN(Wb[$b])||(t_[$b]=a_[$b]/Wb[$b])}return Qb},Ob.weightedVariance=function(Hb,Wb){var Zb=Ob.mean(Hb),Qb=Hb.length;if(0===Qb)return[];for(var Kb=Hb[0].length,Jb=Array(Kb),$b=0;$b<Kb;$b++){for(var e_=0,t_=0,a_=0,i_=0;i_<Qb;i_++){var n_=Hb[i_][$b]-Zb[$b],o_=Wb[i_];e_+=o_*(n_*n_),a_+=o_,t_+=o_*o_}Jb[$b]=e_*(a_/(a_*a_-t_))}return Jb},Ob.weightedMean=function(Hb,Wb,Zb){'undefined'==typeof Zb&&(Zb=0);var Qb=Hb.length;if(0===Qb)return[];var Kb=Hb[0].length,Jb,$b,e_,t_,a_,i_;if(0===Zb){for(Jb=Array(Kb),$b=0;$b<Kb;$b++)Jb[$b]=0;for($b=0;$b<Qb;$b++)for(i_=Hb[$b],a_=Wb[$b],t_=0;t_<Kb;t_++)Jb[t_]+=i_[t_]*a_}else if(1===Zb){for(Jb=Array(Qb),$b=0;$b<Qb;$b++)Jb[$b]=0;for(t_=0;t_<Qb;t_++)for(i_=Hb[t_],a_=Wb[t_],$b=0;$b<Kb;$b++)Jb[t_]+=i_[$b]*a_}else throw new Error('Invalid dimension');var n_=Rl.sum(Wb);if(0!==n_)for($b=0,e_=Jb.length;$b<e_;$b++)Jb[$b]/=n_;return Jb},Ob.weightedCovariance=function(Hb,Wb,Zb,Qb){Qb=Qb||0,Zb=Zb||Ob.weightedMean(Hb,Wb,Qb);for(var Kb=0,Jb=0,$b=0,e_=Wb.length;$b<e_;$b++)Kb+=Wb[$b],Jb+=Wb[$b]*Wb[$b];var t_=Kb/(Kb*Kb-Jb);return Ob.weightedScatter(Hb,Wb,Zb,t_,Qb)},Ob.weightedScatter=function(Hb,Wb,Zb,Qb,Kb){Kb=Kb||0,Zb=Zb||Ob.weightedMean(Hb,Wb,Kb),'undefined'==typeof Qb&&(Qb=1);var Jb=Hb.length;if(0===Jb)return[[]];var $b=Hb[0].length,e_,t_,a_,i_,n_;if(0===Kb){for(e_=Array($b),t_=0;t_<$b;t_++)e_[t_]=Array($b);for(t_=0;t_<$b;t_++)for(a_=t_;a_<$b;a_++){for(n_=0,i_=0;i_<Jb;i_++)n_+=Wb[i_]*(Hb[i_][a_]-Zb[a_])*(Hb[i_][t_]-Zb[t_]);e_[t_][a_]=n_*Qb,e_[a_][t_]=n_*Qb}}else if(1===Kb){for(e_=Array(Jb),t_=0;t_<Jb;t_++)e_[t_]=Array(Jb);for(t_=0;t_<Jb;t_++)for(a_=t_;a_<Jb;a_++){for(n_=0,i_=0;i_<$b;i_++)n_+=Wb[i_]*(Hb[a_][i_]-Zb[a_])*(Hb[t_][i_]-Zb[t_]);e_[t_][a_]=n_*Qb,e_[a_][t_]=n_*Qb}}else throw new Error('Invalid dimension');return e_}}),Tl={array:Rl,matrix:zl};const Vl=Tl.array;var Yl={coordArrayToPoints:function(Xb,Ob){if(0!=Xb.length%Ob)throw new RangeError('Dimensions number must be accordance with the size of the array.');for(var Nb=Xb.length/Ob,Gb=Array(Nb),Hb=0,Wb=0,Zb;Wb<Xb.length;Wb+=Ob){Zb=Array(Ob);for(var Qb=0;Qb<Ob;++Qb)Zb[Qb]=Xb[Wb+Qb];Gb[Hb]=Zb,Hb++}return Gb},coordArrayToCoordMatrix:function(Xb,Ob){if(0!=Xb.length%Ob)throw new RangeError('Dimensions number must be accordance with the size of the array.');for(var Nb=Array(Ob),Gb=Xb.length/Ob,Hb=0;Hb<Nb.length;Hb++)Nb[Hb]=Array(Gb);for(Hb=0;Hb<Xb.length;Hb+=Ob)for(var Wb=0,Zb;Wb<Ob;++Wb)Zb=_Mathfloor(Hb/Ob),Nb[Wb][Zb]=Xb[Hb+Wb];return Nb},coordMatrixToCoordArray:function(Xb){for(var Ob=Array(Xb.length*Xb[0].length),Nb=0,Gb=0;Gb<Xb[0].length;++Gb)for(var Hb=0;Hb<Xb.length;++Hb)Ob[Nb]=Xb[Hb][Gb],++Nb;return Ob},coordMatrixToPoints:Xe,pointsToCoordArray:function(Xb){for(var Ob=Array(Xb.length*Xb[0].length),Nb=0,Gb=0;Gb<Xb.length;++Gb)for(var Hb=0;Hb<Xb[0].length;++Hb)Ob[Nb]=Xb[Gb][Hb],++Nb;return Ob},pointsToCoordMatrix:Xe,applyDotProduct:function(Xb,Ob){var Nb,Gb;Xb.length<=Ob.length?(Gb=Xb,Nb=Ob):(Gb=Ob,Nb=Xb);for(var Hb=Nb.length-Gb.length+1,Wb=Array(Hb),Zb=0,Qb;Zb<Hb;++Zb){Qb=0;for(var Kb=0;Kb<Gb.length;++Kb)Qb+=Gb[Kb]*Nb[Zb+Kb];Wb[Zb]=Qb}return Wb},scale:function(Xb,Ob){var Nb=Ob.inPlace?Xb:Array(Xb.length);const Gb=Ob.max,Hb=Ob.min;if('number'==typeof Gb){if('number'==typeof Hb)for(var Wb=Vl.minMax(Xb),Zb=(Gb-Hb)/(Wb.max-Wb.min),Qb=0;Qb<Nb.length;Qb++)Nb[Qb]=(Xb[Qb]-Wb.min)*Zb+Hb;else for(var Kb=Vl.max(Xb),Zb=Gb/Kb,Qb=0;Qb<Nb.length;Qb++)Nb[Qb]=Xb[Qb]*Zb;}else if('number'==typeof Hb)for(var Kb=Vl.min(Xb),Zb=Hb/Kb,Qb=0;Qb<Nb.length;Qb++)Nb[Qb]=Xb[Qb]*Zb;return Nb}},ql={getEquallySpacedData:function(Xb,Ob,Nb){1<Xb.length&&Xb[0]>Xb[1]&&(Xb=Xb.slice().reverse(),Ob=Ob.slice().reverse());var Gb=Xb.length;if(Gb!==Ob.length)throw new RangeError('the x and y vector doesn\'t have the same size.');void 0===Nb&&(Nb={});var Hb=void 0===Nb.from?Xb[0]:Nb.from;if(isNaN(Hb)||!isFinite(Hb))throw new RangeError('\'From\' value must be a number');var Wb=void 0===Nb.to?Xb[Xb.length-1]:Nb.to;if(isNaN(Wb)||!isFinite(Wb))throw new RangeError('\'To\' value must be a number');var Zb=Hb>Wb;if(Zb){var Qb=Hb;Hb=Wb,Wb=Qb}var Kb=void 0===Nb.numberOfPoints?100:Nb.numberOfPoints;if(isNaN(Kb)||!isFinite(Kb))throw new RangeError('\'Number of points\' value must be a number');if(1>Kb)throw new RangeError('the number of point must be higher than 1');var Jb='slot'===Nb.variant?'slot':'smooth',$b='slot'==Jb?Ze(Xb,Ob,Hb,Wb,Kb):We(Xb,Ob,Hb,Wb,Kb);return Zb?$b.reverse():$b},integral:Qe},Ol=Tl.array,Nl={SNV:function(Xb){for(var Ob=Ol.mean(Xb),Nb=Ol.standardDeviation(Xb),Gb=Xb.slice(),Hb=0;Hb<Xb.length;Hb++)Gb[Hb]=(Gb[Hb]-Ob)/Nb;return Gb}},Gl=ce(function(Xb,Ob){Xb.exports=Ob=Yl,Ob.getEquallySpacedData=ql.getEquallySpacedData,Ob.SNV=Nl.SNV}),Hl=Gl.scale;class Wl extends dt(){constructor(Xb,Ob,Nb){super(),this.matrix=Xb,this.rows=Ob,this.columns=Nb}static get[Symbol.species](){return ad}}class Zl extends Wl{constructor(Xb){super(Xb,Xb.columns,Xb.rows)}set(Xb,Ob,Nb){return this.matrix.set(Ob,Xb,Nb),this}get(Xb,Ob){return this.matrix.get(Ob,Xb)}}class Ql extends Wl{constructor(Xb,Ob){super(Xb,1,Xb.columns),this.row=Ob}set(Xb,Ob,Nb){return this.matrix.set(this.row,Ob,Nb),this}get(Xb,Ob){return this.matrix.get(this.row,Ob)}}class Kl extends Wl{constructor(Xb,Ob,Nb,Gb,Hb){ot(Xb,Ob,Nb,Gb,Hb),super(Xb,Nb-Ob+1,Hb-Gb+1),this.startRow=Ob,this.startColumn=Gb}set(Xb,Ob,Nb){return this.matrix.set(this.startRow+Xb,this.startColumn+Ob,Nb),this}get(Xb,Ob){return this.matrix.get(this.startRow+Xb,this.startColumn+Ob)}}class Jl extends Wl{constructor(Xb,Ob,Nb){var Gb=nt(Xb,Ob,Nb);super(Xb,Gb.row.length,Gb.column.length),this.rowIndices=Gb.row,this.columnIndices=Gb.column}set(Xb,Ob,Nb){return this.matrix.set(this.rowIndices[Xb],this.columnIndices[Ob],Nb),this}get(Xb,Ob){return this.matrix.get(this.rowIndices[Xb],this.columnIndices[Ob])}}class $l extends Wl{constructor(Xb,Ob){super(Xb,Xb.rows,1),this.column=Ob}set(Xb,Ob,Nb){return this.matrix.set(Xb,this.column,Nb),this}get(Xb){return this.matrix.get(Xb,this.column)}}class ed extends Wl{constructor(Xb){super(Xb,Xb.rows,Xb.columns)}set(Xb,Ob,Nb){return this.matrix.set(this.rows-Xb-1,Ob,Nb),this}get(Xb,Ob){return this.matrix.get(this.rows-Xb-1,Ob)}}class td extends Wl{constructor(Xb){super(Xb,Xb.rows,Xb.columns)}set(Xb,Ob,Nb){return this.matrix.set(Xb,this.columns-Ob-1,Nb),this}get(Xb,Ob){return this.matrix.get(Xb,this.columns-Ob-1)}}class ad extends dt(Array){constructor(Xb,Ob){var Nb;if(1===arguments.length&&'number'==typeof Xb)return Array(Xb);if(ad.isMatrix(Xb))return Xb.clone();if(_NumberisInteger(Xb)&&0<Xb){if(super(Xb),_NumberisInteger(Ob)&&0<Ob)for(Nb=0;Nb<Xb;Nb++)this[Nb]=Array(Ob);else throw new TypeError('nColumns must be a positive integer');}else if(Array.isArray(Xb)){const Gb=Xb;if(Xb=Gb.length,Ob=Gb[0].length,'number'!=typeof Ob||0===Ob)throw new TypeError('Data must be a 2D array with at least one element');for(super(Xb),Nb=0;Nb<Xb;Nb++){if(Gb[Nb].length!==Ob)throw new RangeError('Inconsistent array dimensions');this[Nb]=[].concat(Gb[Nb])}}else throw new TypeError('First argument must be a positive number or an array');return this.rows=Xb,this.columns=Ob,this}set(Xb,Ob,Nb){return this[Xb][Ob]=Nb,this}get(Xb,Ob){return this[Xb][Ob]}clone(){for(var Xb=new this.constructor[Symbol.species](this.rows,this.columns),Ob=0;Ob<this.rows;Ob++)for(var Nb=0;Nb<this.columns;Nb++)Xb.set(Ob,Nb,this.get(Ob,Nb));return Xb}removeRow(Xb){if(Je(this,Xb),1===this.rows)throw new RangeError('A matrix cannot have less than one row');return this.splice(Xb,1),this.rows-=1,this}addRow(Xb,Ob){return void 0===Ob&&(Ob=Xb,Xb=this.rows),Je(this,Xb,!0),Ob=et(this,Ob,!0),this.splice(Xb,0,Ob),this.rows+=1,this}removeColumn(Xb){if($e(this,Xb),1===this.columns)throw new RangeError('A matrix cannot have less than one column');for(var Ob=0;Ob<this.rows;Ob++)this[Ob].splice(Xb,1);return this.columns-=1,this}addColumn(Xb,Ob){'undefined'==typeof Ob&&(Ob=Xb,Xb=this.columns),$e(this,Xb,!0),Ob=at(this,Ob);for(var Nb=0;Nb<this.rows;Nb++)this[Nb].splice(Xb,0,Ob[Nb]);return this.columns+=1,this}}ht.prototype={solve:function(Xb){Xb=ad.checkMatrix(Xb);var Ob=this.QR,Nb=Ob.rows;if(Xb.rows!==Nb)throw new Error('Matrix row dimensions must agree');if(!this.isFullRank())throw new Error('Matrix is rank deficient');var Gb=Xb.columns,Hb=Xb.clone(),Wb=Ob.columns,Zb,Qb,Kb,Jb;for(Kb=0;Kb<Wb;Kb++)for(Qb=0;Qb<Gb;Qb++){for(Jb=0,Zb=Kb;Zb<Nb;Zb++)Jb+=Ob[Zb][Kb]*Hb[Zb][Qb];for(Jb=-Jb/Ob[Kb][Kb],Zb=Kb;Zb<Nb;Zb++)Hb[Zb][Qb]+=Jb*Ob[Zb][Kb]}for(Kb=Wb-1;0<=Kb;Kb--){for(Qb=0;Qb<Gb;Qb++)Hb[Kb][Qb]/=this.Rdiag[Kb];for(Zb=0;Zb<Kb;Zb++)for(Qb=0;Qb<Gb;Qb++)Hb[Zb][Qb]-=Hb[Kb][Qb]*Ob[Zb][Kb]}return Hb.subMatrix(0,Wb-1,0,Gb-1)},isFullRank:function(){for(var Xb=this.QR.columns,Ob=0;Ob<Xb;Ob++)if(0===this.Rdiag[Ob])return!1;return!0},get upperTriangularMatrix(){var Xb=this.QR,Ob=Xb.columns,Nb=new ad(Ob,Ob),Gb,Hb;for(Gb=0;Gb<Ob;Gb++)for(Hb=0;Hb<Ob;Hb++)Nb[Gb][Hb]=Gb<Hb?Xb[Gb][Hb]:Gb===Hb?this.Rdiag[Gb]:0;return Nb},get orthogonalMatrix(){var Xb=this.QR,Ob=Xb.rows,Nb=Xb.columns,Gb=new ad(Ob,Nb),Hb,Wb,Zb,Qb;for(Zb=Nb-1;0<=Zb;Zb--){for(Hb=0;Hb<Ob;Hb++)Gb[Hb][Zb]=0;for(Gb[Zb][Zb]=1,Wb=Zb;Wb<Nb;Wb++)if(0!==Xb[Zb][Zb]){for(Qb=0,Hb=Zb;Hb<Ob;Hb++)Qb+=Xb[Hb][Zb]*Gb[Hb][Wb];for(Qb=-Qb/Xb[Zb][Zb],Hb=Zb;Hb<Ob;Hb++)Gb[Hb][Wb]+=Qb*Xb[Hb][Zb]}}return Gb}};const nd={assumeSymmetric:!1};ct.prototype={get realEigenvalues(){return this.d},get imaginaryEigenvalues(){return this.e},get eigenvectorMatrix(){return ad.isMatrix(this.V)||(this.V=new ad(this.V)),this.V},get diagonalMatrix(){var Xb=this.n,Ob=this.e,Nb=this.d,Gb=new ad(Xb,Xb),Hb,Wb;for(Hb=0;Hb<Xb;Hb++){for(Wb=0;Wb<Xb;Wb++)Gb[Hb][Wb]=0;Gb[Hb][Hb]=Nb[Hb],0<Ob[Hb]?Gb[Hb][Hb+1]=Ob[Hb]:0>Ob[Hb]&&(Gb[Hb][Hb-1]=Ob[Hb])}return Gb}},xt.prototype={get lowerTriangularMatrix(){return this.L},solve:function(Xb){Xb=ad.checkMatrix(Xb);var Ob=this.L,Nb=Ob.rows;if(Xb.rows!==Nb)throw new Error('Matrix dimensions do not match');var Gb=Xb.columns,Hb=Xb.clone(),Wb,Zb,Qb;for(Qb=0;Qb<Nb;Qb++)for(Zb=0;Zb<Gb;Zb++){for(Wb=0;Wb<Qb;Wb++)Hb[Qb][Zb]-=Hb[Wb][Zb]*Ob[Qb][Wb];Hb[Qb][Zb]/=Ob[Qb][Qb]}for(Qb=Nb-1;0<=Qb;Qb--)for(Zb=0;Zb<Gb;Zb++){for(Wb=Qb+1;Wb<Nb;Wb++)Hb[Qb][Zb]-=Hb[Wb][Zb]*Ob[Wb][Qb];Hb[Qb][Zb]/=Ob[Qb][Qb]}return Hb}};var od=Object.freeze({default:ad,Matrix:ad,abstractMatrix:dt,solve:gt,inverse:function(Xb){return Xb=ad.checkMatrix(Xb),gt(Xb,ad.eye(Xb.rows))},SingularValueDecomposition:Ye,SVD:Ye,EigenvalueDecomposition:ct,EVD:ct,CholeskyDecomposition:xt,CHO:xt,LuDecomposition:Ee,LU:Ee,QrDecomposition:ht,QR:ht}),sd=od&&ad||od;const rd=Sl.maybeToPrecision,ld=sd.Matrix,dd=sd.solve;class hd extends Pl{constructor(Xb,Ob,Nb,Gb){super();if(!0===Xb)this.coefficients=Ob.coefficients,this.powers=Ob.powers,this.M=Ob.M,Ob.quality&&(this.quality=Ob.quality);else{var Wb=Xb.length;if(Wb!==Ob.length)throw new RangeError('input and output array have a different length');let a_;if(Array.isArray(Nb))a_=Nb,Nb=a_.length;else for(Nb++,a_=Array(Nb),Kb=0;Kb<Nb;Kb++)a_[Kb]=Kb;var Zb=new ld(Wb,Nb),Qb=new ld([Ob]),Kb,Jb;for(Kb=0;Kb<Nb;Kb++)for(Jb=0;Jb<Wb;Jb++)Zb[Jb][Kb]=0===a_[Kb]?1:_Mathpow(Xb[Jb],a_[Kb]);var $b=Zb.transposeView(),e_=$b.mmul(Zb),t_=$b.mmul(Qb.transposeView());this.coefficients=dd(e_,t_).to1DArray(),this.powers=a_,this.M=Nb-1,(Gb||{}).computeQuality&&(this.quality=this.modelQuality(Xb,Ob))}}_predict(Xb){for(var Ob=0,Nb=0;Nb<this.powers.length;Nb++)Ob+=this.coefficients[Nb]*_Mathpow(Xb,this.powers[Nb]);return Ob}toJSON(){var Xb={name:'polynomialRegression',coefficients:this.coefficients,powers:this.powers,M:this.M};return this.quality&&(Xb.quality=this.quality),Xb}toString(Xb){return this._toFormula(Xb,!1)}toLaTeX(Xb){return this._toFormula(Xb,!0)}_toFormula(Xb,Ob){var Nb='^',Gb='',Hb=' * ';Ob&&(Nb='^{',Gb='}',Hb='');for(var Wb='',Qb=0,Zb;Qb<this.coefficients.length;Qb++)Zb='',0!==this.coefficients[Qb]&&(Zb=0===this.powers[Qb]?rd(this.coefficients[Qb],Xb):1===this.powers[Qb]?rd(this.coefficients[Qb],Xb)+Hb+'x':rd(this.coefficients[Qb],Xb)+Hb+'x'+Nb+this.powers[Qb]+Gb,0<this.coefficients[Qb]&&Qb!==this.coefficients.length-1?Zb=' + '+Zb:Qb!==this.coefficients.length-1&&(Zb=' '+Zb)),Wb=Zb+Wb;return' + '===Wb.charAt(0)&&(Wb=Wb.slice(1)),'f(x) = '+Wb}static load(Xb){if('polynomialRegression'!==Xb.name)throw new TypeError('not a polynomial regression model');return new hd(!0,Xb)}}var md=hd;const gd=Sl.maybeToPrecision;class ud extends Pl{constructor(Xb,Ob,Nb,Gb){super();if(!0===Xb)this.A=Ob.A,this.M=Ob.M,Ob.quality&&(this.quality=Ob.quality);else{var Wb=Xb.length;if(Wb!==Ob.length)throw new RangeError('input and output array have a different length');var Zb=new md(Xb,Ob,[Nb],{computeCoefficient:!0});this.A=Zb.coefficients[0],this.M=Nb,(Gb||{}).computeQuality&&(this.quality=this.modelQuality(Xb,Ob))}}_predict(Xb){return this.A*_Mathpow(Xb,this.M)}toJSON(){var Xb={name:'potentialRegression',A:this.A,M:this.M};return this.quality&&(Xb.quality=this.quality),Xb}toString(Xb){return'f(x) = '+gd(this.A,Xb)+' * x^'+this.M}toLaTeX(Xb){return 0<=this.M?'f(x) = '+gd(this.A,Xb)+'x^{'+this.M+'}':'f(x) = \\frac{'+gd(this.A,Xb)+'}{x^{'+-this.M+'}}'}static load(Xb){if('potentialRegression'!==Xb.name)throw new TypeError('not a potential regression model');return new ud(!0,Xb)}}const fd=Sl.maybeToPrecision;class bd extends Pl{constructor(Xb,Ob,Nb){super();if(!0===Xb)this.A=Ob.A,this.C=Ob.C,Ob.quality&&(this.quality=Ob.quality);else{var Hb=Xb.length;if(Hb!==Ob.length)throw new RangeError('input and output array have a different length');for(var Wb=Array(Hb),Zb=0;Zb<Hb;Zb++)Wb[Zb]=_Mathlog(Ob[Zb]);var Qb=new Al(Xb,Wb,{computeCoefficient:!1});this.A=Qb.slope,this.C=_Mathexp(Qb.intercept),(Nb||{}).computeQuality&&(this.quality=this.modelQuality(Xb,Ob))}}_predict(Xb){return this.C*_Mathexp(Xb*this.A)}toJSON(){var Xb={name:'expRegression',A:this.A,C:this.C};return this.quality&&(Xb.quality=this.quality),Xb}toString(Xb){return'f(x) = '+fd(this.C,Xb)+' * exp('+fd(this.A,Xb)+' * x)'}toLaTeX(Xb){return 0<=this.A?'f(x) = '+fd(this.C,Xb)+'e^{'+fd(this.A,Xb)+'x}':'f(x) = \\frac{'+fd(this.C,Xb)+'}{e^{'+fd(-this.A,Xb)+'x}}'}static load(Xb){if('expRegression'!==Xb.name)throw new TypeError('not a exp regression model');return new bd(!0,Xb)}}const wd=Sl.maybeToPrecision;class xd extends Pl{constructor(Xb,Ob,Nb){super();if(!0===Xb)this.A=Ob.A,this.B=Ob.B,this.quality=Ob.quality||{},Ob.quality.r&&(this.quality.r=Ob.quality.r,this.quality.r2=Ob.quality.r2),Ob.quality.chi2&&(this.quality.chi2=Ob.quality.chi2);else{var Hb=Xb.length;if(Hb!==Ob.length)throw new RangeError('input and output array have a different length');for(var Wb=Array(Hb),Zb=Array(Hb),Qb=0;Qb<Hb;Qb++)Wb[Qb]=_Mathlog(Xb[Qb]),Zb[Qb]=_Mathlog(Ob[Qb]);var Kb=new Al(Wb,Zb,{computeCoefficient:!1});this.A=_Mathexp(Kb.intercept),this.B=Kb.slope,(Nb||{}).computeQuality&&(this.quality=this.modelQuality(Xb,Ob))}}_predict(Xb){return this.A*_Mathpow(Xb,this.B)}toJSON(){var Xb={name:'powerRegression',A:this.A,B:this.B};return this.quality&&(Xb.quality=this.quality),Xb}toString(Xb){return'f(x) = '+wd(this.A,Xb)+' * x^'+wd(this.B,Xb)}toLaTeX(Xb){return 0<=this.B?'f(x) = '+wd(this.A,Xb)+'x^{'+wd(this.B,Xb)+'}':'f(x) = \\frac{'+wd(this.A,Xb)+'}{x^{'+wd(-this.B,Xb)+'}}'}static load(Xb){if('powerRegression'!==Xb.name)throw new TypeError('not a power regression model');return new xd(!0,Xb)}}var kd=kt;kt.squared=yt;const vd=kd.squared,Dd={sigma:1};var Md=class{constructor(Xb){Xb=Object.assign({},Dd,Xb),this.sigma=Xb.sigma,this.divisor=2*Xb.sigma*Xb.sigma}compute(Xb,Ob){const Nb=vd(Xb,Ob);return _Mathexp(-Nb/this.divisor)}};const Sd={degree:1,constant:1,scale:1};var Pd=class{constructor(Xb){Xb=Object.assign({},Sd,Xb),this.degree=Xb.degree,this.constant=Xb.constant,this.scale=Xb.scale}compute(Xb,Ob){for(var Nb=0,Gb=0;Gb<Xb.length;Gb++)Nb+=Xb[Gb]*Ob[Gb];return _Mathpow(this.scale*Nb+this.constant,this.degree)}};const Cd={sigma:1,degree:1};const Rd=kd.squared,zd={sigma:1};const Td={sigma:1};var Ud=class{compute(Xb,Ob){for(var Nb=_Mathmin(Xb.length,Ob.length),Gb=0,Hb=0;Hb<Nb;++Hb)Gb+=_Mathmin(Xb[Hb],Ob[Hb]);return Gb}};const qd={sigma:1};const Nd=kd.squared,Gd={constant:1};const Zd=kd.squared,Qd={constant:1};const $d={alpha:0.01,constant:-Math.E};var th=class{constructor(Xb){Xb=Object.assign({},$d,Xb),this.alpha=Xb.alpha,this.constant=Xb.constant}compute(Xb,Ob){for(var Nb=0,Gb=0;Gb<Xb.length;Gb++)Nb+=Xb[Gb]*Ob[Gb];return Math.tanh(this.alpha*Nb+this.constant)}};const ah=sd.Matrix,nh={gaussian:Md,rbf:Md,polynomial:Pd,poly:Pd,anova:class{constructor(Xb){Xb=Object.assign({},Cd,Xb),this.sigma=Xb.sigma,this.degree=Xb.degree}compute(Xb,Ob){for(var Nb=0,Gb=_Mathmin(Xb.length,Ob.length),Hb=1;Hb<=Gb;++Hb)Nb+=_Mathpow(_Mathexp(-this.sigma*_Mathpow(_Mathpow(Xb[Hb-1],Hb)-_Mathpow(Ob[Hb-1],Hb),2)),this.degree);return Nb}},cauchy:class{constructor(Xb){Xb=Object.assign({},zd,Xb),this.sigma=Xb.sigma}compute(Xb,Ob){return 1/(1+Rd(Xb,Ob)/(this.sigma*this.sigma))}},exponential:class{constructor(Xb){Xb=Object.assign({},Td,Xb),this.sigma=Xb.sigma,this.divisor=2*Xb.sigma*Xb.sigma}compute(Xb,Ob){const Nb=kd(Xb,Ob);return _Mathexp(-Nb/this.divisor)}},histogram:Ud,min:Ud,laplacian:class{constructor(Xb){Xb=Object.assign({},qd,Xb),this.sigma=Xb.sigma}compute(Xb,Ob){const Nb=kd(Xb,Ob);return _Mathexp(-Nb/this.sigma)}},multiquadratic:class{constructor(Xb){Xb=Object.assign({},Gd,Xb),this.constant=Xb.constant}compute(Xb,Ob){return _Mathsqrt(Nd(Xb,Ob)+this.constant*this.constant)}},rational:class{constructor(Xb){Xb=Object.assign({},Qd,Xb),this.constant=Xb.constant}compute(Xb,Ob){const Nb=Zd(Xb,Ob);return 1-Nb/(Nb+this.constant)}},sigmoid:th,mlp:th};var sh=class{constructor(Xb,Ob){if(this.kernelType=Xb,'linear'!==Xb)if('string'==typeof Xb){Xb=Xb.toLowerCase();var Nb=nh[Xb];if(Nb)this.kernelFunction=new Nb(Ob);else throw new Error('unsupported kernel type: '+Xb)}else if('object'==typeof Xb&&'function'==typeof Xb.compute)this.kernelFunction=Xb;else throw new TypeError('first argument must be a valid kernel type or instance')}compute(Xb,Ob){if(void 0===Ob&&(Ob=Xb),'linear'===this.kernelType){var Nb=new ah(Xb);return Nb.mmul(new ah(Ob).transposeView())}const Gb=new ah(Xb.length,Ob.length);var Hb,Wb;if(Xb===Ob)for(Hb=0;Hb<Xb.length;Hb++)for(Wb=Hb;Wb<Xb.length;Wb++)Gb[Hb][Wb]=Gb[Wb][Hb]=this.kernelFunction.compute(Xb[Hb],Xb[Wb]);else for(Hb=0;Hb<Xb.length;Hb++)for(Wb=0;Wb<Ob.length;Wb++)Gb[Hb][Wb]=this.kernelFunction.compute(Xb[Hb],Ob[Wb]);return Gb}};const rh=sd.Matrix,lh=sd.solve,dh={lambda:0.1,kernelType:'gaussian',kernelOptions:{},computeCoefficient:!1};class mh extends Pl{constructor(Xb,Ob,Nb){if(super(),!0===Xb)this.alpha=Ob.alpha,this.inputs=Ob.inputs,this.kernelType=Ob.kernelType,this.kernelOptions=Ob.kernelOptions,this.kernel=new sh(Ob.kernelType,Ob.kernelOptions),Ob.quality&&(this.quality=Ob.quality);else{Nb=Object.assign({},dh,Nb);const Gb=new sh(Nb.kernelType,Nb.kernelOptions),Hb=Gb.compute(Xb),Wb=Xb.length;Hb.add(rh.eye(Wb,Wb).mul(Nb.lambda)),this.alpha=lh(Hb,Ob),this.inputs=Xb,this.kernelType=Nb.kernelType,this.kernelOptions=Nb.kernelOptions,this.kernel=Gb,Nb.computeQuality&&(this.quality=this.modelQuality(Xb,Ob))}}_predict(Xb){return this.kernel.compute([Xb],this.inputs).mmul(this.alpha)[0]}toJSON(){var Xb={name:'kernelRidgeRegression',alpha:this.alpha,inputs:this.inputs,kernelType:this.kernelType,kernelOptions:this.kernelOptions};return this.quality&&(Xb.quality=this.quality),Xb}static load(Xb){if('kernelRidgeRegression'!==Xb.name)throw new TypeError('not a KRR model');return new mh(!0,Xb)}}const ch=sd.Matrix,uh=sd.SVD,ph={order:2};class fh extends Pl{constructor(Xb,Ob,Nb){super(),!0===Xb?(this.coefficients=ch.columnVector(Ob.coefficients),this.order=Ob.order,Ob.r&&(this.r=Ob.r,this.r2=Ob.r2),Ob.chi2&&(this.chi2=Ob.chi2)):(Nb=Object.assign({},ph,Nb),this.order=Nb.order,this.coefficients=[],this.X=Xb,this.y=Ob,this.train(this.X,this.y,Nb),Nb.computeQuality&&(this.quality=this.modelQuality(Xb,Ob)))}train(Xb,Ob){if(ch.isMatrix(Xb)||(Xb=new ch(Xb)),ch.isMatrix(Ob)||(Ob=ch.columnVector(Ob)),Ob.rows!==Xb.rows&&(Ob=Ob.transpose()),2!==Xb.columns)throw new RangeError('You give X with '+Xb.columns+' columns and it must be 2');if(Xb.rows!==Ob.rows)throw new RangeError('X and y must have the same rows');var Nb=Xb.rows,Gb=(this.order+2)*(this.order+1)/2;this.coefficients=Array(Gb);var Hb=Xb.getColumnVector(0),Wb=Xb.getColumnVector(1),Zb=1/Hb.clone().apply(Dt).max(),Qb=1/Wb.clone().apply(Dt).max(),Kb=1/Ob.clone().apply(Dt).max();Hb.mulColumn(0,Zb),Wb.mulColumn(0,Qb),Ob.mulColumn(0,Kb);for(var Jb=new ch(Nb,Gb),$b=0,e_=0,t_;e_<=this.order;++e_){t_=this.order-e_;for(var a_=0,i_;a_<=t_;++a_)i_=vt(Hb,e_).mulColumnVector(vt(Wb,a_)),Jb.setColumn($b,i_),$b++}var n_=new uh(Jb.transpose(),{computeLeftSingularVectors:!0,computeRightSingularVectors:!0,autoTranspose:!1}),o_=ch.rowVector(n_.diagonal);o_=o_.apply(function(d_,h_){this[d_][h_]=1e-15<=this[d_][h_]?1/this[d_][h_]:0});var s_=ch.zeros(Nb,Gb);for(e_=0;e_<Gb;++e_)s_[e_][e_]=o_[0][e_];o_=s_;var r_=n_.rightSingularVectors,l_=n_.leftSingularVectors;for(this.coefficients=l_.mmul(o_.transpose()).mmul(r_.transpose()).mmul(Ob),$b=0,e_=0;e_<=Gb;++e_)for(t_=this.order-e_,a_=0;a_<=t_;++a_)this.coefficients[$b][0]=this.coefficients[$b][0]*_Mathpow(Zb,e_)*_Mathpow(Qb,a_)/Kb,$b++}_predict(Xb){for(var Ob=Xb[0],Nb=Xb[1],Gb=0,Hb=0,Wb=0;Wb<=this.order;Wb++)for(var Zb=0;Zb<=this.order-Wb;Zb++)Gb+=_Mathpow(Ob,Wb)*_Mathpow(Nb,Zb)*this.coefficients[Hb][0],Hb++;return Gb}toJSON(){var Xb={name:'polyfit2D',order:this.order,coefficients:this.coefficients};return this.quality&&(Xb.quality=this.quality),Xb}static load(Xb){if('polyfit2D'!==Xb.name)throw new TypeError('not a polyfit2D model');return new fh(!0,Xb)}}const wh=Sl.maybeToPrecision,xh=Rl.median;class yh extends Pl{constructor(Xb,Ob,Nb){if(Nb=Nb||{},super(),!0===Xb)this.slope=Ob.slope,this.intercept=Ob.intercept,this.quality=Object.assign({},Ob.quality,this.quality);else{let Gb=Xb.length;if(Gb!==Ob.length)throw new RangeError('Input and output array have a different length');let Hb=Array(Gb*Gb),Wb=0;for(let Kb=0;Kb<Gb;++Kb)for(let Jb=Kb+1;Jb<Gb;++Jb)Xb[Kb]!==Xb[Jb]&&(Hb[Wb++]=(Ob[Jb]-Ob[Kb])/(Xb[Jb]-Xb[Kb]));Hb.length=Wb;let Zb=xh(Hb),Qb=Array(Gb);for(let Kb=0;Kb<Gb;++Kb)Qb[Kb]=Ob[Kb]-Zb*Xb[Kb];this.slope=Zb,this.intercept=xh(Qb),this.coefficients=[this.intercept,this.slope],Nb.computeQuality&&(this.quality=this.modelQuality(Xb,Ob))}}toJSON(){var Xb={name:'TheilSenRegression',slope:this.slope,intercept:this.intercept};return this.quality&&(Xb.quality=this.quality),Xb}_predict(Xb){return this.slope*Xb+this.intercept}computeX(Xb){return(Xb-this.intercept)/this.slope}toString(Xb){var Ob='f(x) = ';if(this.slope){var Nb=wh(this.slope,Xb);if(Ob+=(1e-5>_Mathabs(Nb-1)?'':Nb+' * ')+'x',this.intercept){var Gb=_Mathabs(this.intercept),Hb=Gb===this.intercept?'+':'-';Ob+=' '+Hb+' '+wh(Gb,Xb)}}else Ob+=wh(this.intercept,Xb);return Ob}toLaTeX(Xb){return this.toString(Xb)}static load(Xb){if('TheilSenRegression'!==Xb.name)throw new TypeError('not a Theil-Sen model');return new yh(!0,Xb)}}var vh=ce(function(Xb,Ob){'use strict';Ob.SimpleLinearRegression=Ob.SLR=Al,Ob.NonLinearRegression=Ob.NLR={PolynomialRegression:md,PotentialRegression:ud,ExpRegression:bd,PowerRegression:xd},Ob.KernelRidgeRegression=Ob.KRR=mh,Ob.PolinomialFitting2D=fh,Ob.TheilSenRegression=yh}),Dh=vh.KernelRidgeRegression,jh={luma709(Xb,Ob){return 6966*Xb[Ob]+23436*Xb[Ob+1]+2366*Xb[Ob+2]>>15},luma601(Xb,Ob){return 9798*Xb[Ob]+19235*Xb[Ob+1]+3735*Xb[Ob+2]>>15},maximum(Xb,Ob){return _Mathmax(Xb[Ob],Xb[Ob+1],Xb[Ob+2])},minimum(Xb,Ob){return _Mathmin(Xb[Ob],Xb[Ob+1],Xb[Ob+2])},average(Xb,Ob){return(Xb[Ob]+Xb[Ob+1]+Xb[Ob+2])/3>>0},minmax(Xb,Ob){return(_Mathmax(Xb[Ob],Xb[Ob+1],Xb[Ob+2])+_Mathmin(Xb[Ob],Xb[Ob+1],Xb[Ob+2]))/2},red(Xb,Ob){return Xb[Ob]},green(Xb,Ob){return Xb[Ob+1]},blue(Xb,Ob){return Xb[Ob+2]},cyan(Xb,Ob,Nb){var Gb=jh.black(Xb,Ob,Nb);return(Nb.maxValue-Xb[0]-Gb)/(1-Gb/Nb.maxValue)>>0},magenta(Xb,Ob,Nb){var Gb=jh.black(Xb,Ob,Nb);return(Nb.maxValue-Xb[1]-Gb)/(1-Gb/Nb.maxValue)>>0},yellow(Xb,Ob,Nb){var Gb=jh.black(Xb,Ob,Nb);return(Nb.maxValue-Xb[2]-Gb)/(1-Gb/Nb.maxValue)>>0},black(Xb,Ob,Nb){return _Mathmin(Nb.maxValue-Xb[Ob],Nb.maxValue-Xb[Ob+1],Nb.maxValue-Xb[Ob+2])},hue(Xb,Ob,Nb){var Gb=jh.min(Xb,Ob),Hb=jh.max(Xb,Ob);if(Hb===Gb)return 0;var Wb=0,Zb=Hb-Gb;switch(Hb){case Xb[Ob]:Wb=(Xb[Ob+1]-Xb[Ob+2])/Zb+(Xb[Ob+1]<Xb[Ob+2]?6:0);break;case Xb[Ob+1]:Wb=(Xb[Ob+2]-Xb[Ob])/Zb+2;break;case Xb[Ob+2]:Wb=(Xb[Ob]-Xb[Ob+1])/Zb+4;break;default:throw new Error('unreachable');}return Wb/6*Nb.maxValue>>0},saturation(Xb,Ob,Nb){var Gb=jh.min(Xb,Ob),Hb=jh.max(Xb,Ob);return 0===Hb?0:(Hb-Gb)/Hb*Nb.maxValue},lightness(Xb,Ob){var Nb=jh.min(Xb,Ob),Gb=jh.max(Xb,Ob);return(Gb+Nb)/2}};Object.defineProperty(jh,'luminosity',{enumerable:!1,value:jh.lightness}),Object.defineProperty(jh,'luminance',{enumerable:!1,value:jh.lightness}),Object.defineProperty(jh,'min',{enumerable:!1,value:jh.minimum}),Object.defineProperty(jh,'max',{enumerable:!1,value:jh.maximum}),Object.defineProperty(jh,'brightness',{enumerable:!1,value:jh.maximum});var Mh=Object.keys(jh),Sh={huang:function(Xb){for(var Ob=0,Nb=0;Nb<Xb.length;Nb++)if(0!==Xb[Nb]){Ob=Nb;break}for(var Gb=Xb.length-1,Hb=Xb.length-1;Hb>=Ob;Hb--)if(0!==Xb[Hb]){Gb=Hb;break}for(var Wb=1/(Gb-Ob),Zb=Array(Xb.length),Qb=0,Kb=0,Jb=Ob;Jb<Xb.length;Jb++)Qb+=Jb*Xb[Jb],Kb+=Xb[Jb],Zb[Jb]=Qb/Kb;var $b=Array(Xb.length);Qb=Kb=0;for(var e_=Gb;0<e_;e_--)Qb+=e_*Xb[e_],Kb+=Xb[e_],$b[e_-1]=Qb/Kb;for(var t_=-1,a_=_NumberMAX_VALUE,i_=0;i_<Xb.length;i_++){for(var n_=0,o_=void 0,s_=0;s_<=i_;s_++)o_=1/(1+Wb*_Mathabs(s_-Zb[i_])),1e-6>o_||0.999999<o_||(n_+=Xb[s_]*(-o_*_Mathlog(o_)-(1-o_)*_Mathlog(1-o_)));for(var r_=i_+1;r_<Xb.length;r_++)o_=1/(1+Wb*_Mathabs(r_-$b[i_])),1e-6>o_||0.999999<o_||(n_+=Xb[r_]*(-o_*_Mathlog(o_)-(1-o_)*_Mathlog(1-o_)));n_<a_&&(a_=n_,t_=i_)}return t_},intermodes:function(Xb){for(var Ob=Xb.slice(),Nb=0;!Ot(Ob);){for(var Gb=0,Hb=0,Wb=Ob[0],Zb=0;Zb<Xb.length-1;Zb++)Gb=Hb,Hb=Wb,Wb=Ob[Zb+1],Ob[Zb]=(Gb+Hb+Wb)/3;if(Ob[Xb.length-1]=(Hb+Wb)/3,Nb++,1e4<Nb)throw new Error('Intermodes Threshold not found after 10000 iterations')}for(var Qb=0,Kb=1;Kb<Xb.length-1;Kb++)Ob[Kb-1]<Ob[Kb]&&Ob[Kb+1]<Ob[Kb]&&(Qb+=Kb);return _Mathfloor(Qb/2)},isodata:function(Xb){for(var Wb=0,Zb=1,Ob,Nb,Gb,Hb;Zb<Xb.length;Zb++)if(0<Xb[Zb]){Wb=Zb+1;break}for(;;){Ob=0,Gb=0;for(var Qb=0;Qb<Wb;Qb++)Gb+=Xb[Qb],Ob+=Xb[Qb]*Qb;Hb=0,Nb=0;for(var Kb=Wb+1;Kb<Xb.length;Kb++)Nb+=Xb[Kb],Hb+=Xb[Kb]*Kb;if(0<Gb&&0<Nb&&(Ob/=Gb,Hb/=Nb,Wb===_Mathround((Ob+Hb)/2)))break;if(Wb++,Wb>Xb.length-2)throw new Error('Threshold not found')}return Wb},li:function(Xb,Ob){var Nb,Gb,Hb,Wb,Zb,Qb,Kb,Jb,$b,e_,t_,a_;t_=0.5,e_=0;for(var i_=0;i_<Xb.length;i_++)e_+=i_*Xb[i_];e_/=Ob,Kb=e_;do{Qb=Kb,Nb=0|Qb+0.5,Gb=0,Wb=0;for(var n_=0;n_<=Nb;n_++)Gb+=n_*Xb[n_],Wb+=Xb[n_];Jb=0===Wb?0:Gb/Wb,Hb=0,Zb=0;for(var o_=Nb+1;o_<Xb.length;o_++)Hb+=o_*Xb[o_],Zb+=Xb[o_];$b=0===Zb?0:Hb/Zb,a_=(Jb-$b)/(_Mathlog(Jb)-_Mathlog($b)),Kb=a_<-_NumberEPSILON?0|a_-0.5:0|a_+0.5}while(_Mathabs(Kb-Qb)>t_);return Nb},maxentropy:function(Xb,Ob){for(var Nb=Array(Xb.length),Gb=0;Gb<Xb.length;Gb++)Nb[Gb]=Xb[Gb]/Ob;var Hb=Array(Xb.length),Wb=Array(Xb.length);Hb[0]=Nb[0],Wb[0]=1-Hb[0];for(var Zb=1;Zb<Xb.length;Zb++)Hb[Zb]=Hb[Zb-1]+Nb[Zb],Wb[Zb]=1-Hb[Zb];for(var Qb=0,Kb=0;Kb<Xb.length;Kb++)if(_Mathabs(Hb[Kb])>=_NumberEPSILON){Qb=Kb;break}for(var Jb=Xb.length-1,$b=Xb.length-1;$b>=Qb;$b--)if(_Mathabs(Wb[$b])>=_NumberEPSILON){Jb=$b;break}for(var e_=-1,t_=void 0,a_=_NumberMIN_VALUE,i_=void 0,n_=void 0,o_=Qb;o_<=Jb;o_++){i_=0;for(var s_=0;s_<=o_;s_++)0!==Xb[s_]&&(i_-=Nb[s_]/Hb[o_]*_Mathlog(Nb[s_]/Hb[o_]));n_=0;for(var r_=o_+1;r_<Xb.length;r_++)0!==Xb[r_]&&(n_-=Nb[r_]/Wb[o_]*_Mathlog(Nb[r_]/Wb[o_]));t_=i_+n_,a_<t_&&(a_=t_,e_=o_)}return e_},mean:function(Xb,Ob){for(var Nb=0,Gb=0;Gb<Xb.length;Gb++)Nb+=Gb*Xb[Gb];return _Mathfloor(Nb/Ob)},minerror:function(Xb,Ob){for(var Gb=-2,n_=0,o_=0,Nb,Hb,Wb,Zb,Qb,Kb,Jb,$b,e_,t_,a_,i_;o_<Xb.length;o_++)n_+=o_*Xb[o_];for(n_/=Ob,Nb=n_;Nb!==Gb;){var s_=Qt(Xb,Nb),r_=Qt(Xb,Xb.length-1),l_=Kt(Xb,Nb),d_=Kt(Xb,Xb.length-1),h_=Jt(Xb,Nb),m_=Jt(Xb,Xb.length-1);if(Hb=l_/s_,Wb=(d_-l_)/(r_-s_),Zb=s_/r_,Qb=(r_-s_)/r_,Kb=h_/s_-Hb*Hb,Jb=(m_-h_)/(r_-s_)-Wb*Wb,$b=1/Kb-1/Jb,e_=Hb/Kb-Wb/Jb,t_=Hb*Hb/Kb-Wb*Wb/Jb+Math.log10(Kb*(Qb*Qb)/(Jb*(Zb*Zb))),a_=e_*e_-$b*t_,0>a_)return Nb;Gb=Nb,i_=(e_+_Mathsqrt(a_))/$b,Nb=isNaN(i_)?Gb:_Mathfloor(i_)}return Nb},minimum:function(Xb){if(2>Xb.length)return 0;for(var Ob=0,Nb=-1,Gb=-1,Hb=Array(Xb.length),Wb=0;Wb<Xb.length;Wb++)Hb[Wb]=Xb[Wb],0<Xb[Wb]&&(Gb=Wb);for(;!aa(Hb);)if(Hb=ea(Hb),Ob++,1e4<Ob)return Nb;return Nb=ta(Hb,Gb),Nb},moments:function(Xb,Ob){for(var Nb=1,Gb=0,Hb=0,Wb=0,Zb=0,a_=-1,i_=Xb.length,n_=Array(i_),o_=0,Qb,Kb,Jb,$b,e_,t_;o_<i_;o_++)n_[o_]=Xb[o_]/Ob;for(var s_=0;s_<i_;s_++)Gb+=s_*n_[s_],Hb+=s_*s_*n_[s_],Wb+=s_*s_*s_*n_[s_];Kb=Nb*Hb-Gb*Gb,Jb=(-Hb*Hb+Gb*Wb)/Kb,$b=(Nb*-Wb+Hb*Gb)/Kb,e_=0.5*(-$b-_Mathsqrt($b*$b-4*Jb)),t_=0.5*(-$b+_Mathsqrt($b*$b-4*Jb)),Qb=(t_-Gb)/(t_-e_);for(var r_=0;r_<i_;r_++)if(Zb+=n_[r_],Zb>Qb){a_=r_;break}return a_},otsu:function(Xb,Ob){for(var Nb=0,Gb=0,Hb=0,Wb=0,Kb=0,Jb=0,$b=0,e_=1,Zb,Qb;e_<Xb.length;++e_)Nb+=e_*Xb[e_];for(var t_=1;t_<Xb.length;++t_)if(Hb+=Xb[t_],0!==Hb){if(Wb=Ob-Hb,0==Wb)break;Gb+=t_*Xb[t_],Zb=Gb/Hb,Qb=(Nb-Gb)/Wb,Jb=Hb*Wb*(Zb-Qb)*(Zb-Qb),Jb>=Kb&&($b=t_,Kb=Jb)}return $b},percentile:function(Xb){for(var Ob=-1,Gb=Array(Xb.length),Hb=la(Xb,Xb.length-1),Wb=1,Zb=0;Zb<Xb.length;Zb++)Gb[Zb]=_Mathabs(la(Xb,Zb)/Hb-0.5),Gb[Zb]<Wb&&(Wb=Gb[Zb],Ob=Zb);return Ob},renyientropy:function(Xb,Ob){for(var Wb=Array(Xb.length),Zb=Array(Xb.length),Qb=Array(Xb.length),Kb=0,Jb=0,$b=0,e_=0,t_=0,a_=0,n_=1/(1-0.5),s_=1/(1-2),r_=0,Nb,Gb,Hb;r_<Xb.length;r_++)Wb[r_]=Xb[r_]/Ob;Zb[0]=Wb[0],Qb[0]=1-Zb[0];for(var l_=1;l_<Xb.length;l_++)Zb[l_]=Zb[l_-1]+Wb[l_],Qb[l_]=1-Zb[l_];Gb=0;for(var d_=0;d_<Xb.length;d_++)if(_Mathabs(Zb[d_])>=_NumberEPSILON){Gb=d_;break}Hb=Xb.length-1;for(var h_=Xb.length-1;h_>=Gb;h_--)if(_Mathabs(Qb[h_])>=_NumberEPSILON){Hb=h_;break}for(var m_=Gb;m_<=Hb;m_++){for(var g_=0,c_=0,u_=0,p_=0;p_<=m_;p_++)0!==Xb[p_]&&(g_-=Wb[p_]/Zb[m_]*_Mathlog(Wb[p_]/Zb[m_])),c_+=_Mathsqrt(Wb[p_]/Zb[m_]),u_+=Wb[p_]*Wb[p_]/(Zb[m_]*Zb[m_]);for(var f_=0,b_=0,w_=0,x_=m_+1;x_<Xb.length;x_++)0!==Xb[x_]&&(f_-=Wb[x_]/Qb[m_]*_Mathlog(Wb[x_]/Qb[m_])),b_+=_Mathsqrt(Wb[x_]/Qb[m_]),w_+=Wb[x_]*Wb[x_]/(Qb[m_]*Qb[m_]);var y_=g_+f_,k_=n_*(0<c_*b_?_Mathlog(c_*b_):0),v_=s_*(0<u_*w_?_Mathlog(u_*w_):0);y_>e_&&(e_=y_,Kb=m_),k_>t_&&(t_=k_,Jb=m_),v_>a_&&(a_=v_,$b=m_)}var D_=[Kb,Jb,$b];D_.sort(tl);var j_=5>=_Mathabs(D_[0]-D_[1])?5>=_Mathabs(D_[1]-D_[2])?[1,2,1]:[0,1,3]:5>=_Mathabs(D_[1]-D_[2])?[3,1,0]:[1,2,1];var M_=Zb[D_[2]]-Zb[D_[0]];return Nb=_Mathround(D_[0]*(Zb[D_[0]]+0.25*M_*j_[0])+0.25*D_[1]*M_*j_[1]+D_[2]*(Qb[D_[2]]+0.25*M_*j_[2])),Nb},shanbhag:function(Xb,Ob){for(var Nb=Array(Xb.length),Gb=0;Gb<Xb.length;Gb++)Nb[Gb]=Xb[Gb]/Ob;var Hb=Array(Xb.length),Wb=Array(Xb.length);Hb[0]=Nb[0],Wb[0]=1-Hb[0];for(var Zb=1;Zb<Xb.length;Zb++)Hb[Zb]=Hb[Zb-1]+Nb[Zb],Wb[Zb]=1-Hb[Zb];for(var Qb=0,Kb=0;Kb<Xb.length;Kb++)if(_Mathabs(Hb[Kb])>=_NumberEPSILON){Qb=Kb;break}for(var Jb=Xb.length-1,$b=Xb.length-1;$b>=Qb;$b--)if(_Mathabs(Wb[$b])>=_NumberEPSILON){Jb=$b;break}for(var e_=-1,t_=_NumberMAX_VALUE,a_=void 0,i_=void 0,n_=void 0,o_=void 0,s_=Qb;s_<=Jb;s_++){n_=0,a_=0.5/Hb[s_];for(var r_=1;r_<=s_;r_++)n_-=Nb[r_]*_Mathlog(1-a_*Hb[r_-1]);n_*=a_,o_=0,a_=0.5/Wb[s_];for(var l_=s_+1;l_<Xb.length;l_++)o_-=Nb[l_]*_Mathlog(1-a_*Wb[l_]);o_*=a_,i_=_Mathabs(n_-o_),i_<t_&&(t_=i_,e_=s_)}return e_},triangle:function(Xb){for(var Ob=0,Nb=0,Gb=0,Hb=0,Wb=0;Wb<Xb.length;Wb++)if(0<Xb[Wb]){Ob=Wb;break}0<Ob&&Ob--;for(var Zb=Xb.length-1;0<Zb;Zb--)if(0<Xb[Zb]){Hb=Zb;break}Hb<Xb.length-1&&Hb++;for(var Qb=0;Qb<Xb.length;Qb++)Xb[Qb]>Nb&&(Gb=Qb,Nb=Xb[Qb]);var Kb=!1;if(Gb-Ob<Hb-Gb){Kb=!0;for(var Jb=0,$b=Xb.length-1,e_;Jb<$b;)e_=Xb[Jb],Xb[Jb]=Xb[$b],Xb[$b]=e_,Jb++,$b--;Ob=Xb.length-1-Hb,Gb=Xb.length-1-Gb}if(Ob===Gb)return Ob;var t_,a_,i_;t_=Xb[Gb],a_=Ob-Gb,i_=_Mathsqrt(t_*t_+a_*a_),t_/=i_,a_/=i_,i_=t_*Ob+a_*Xb[Ob];for(var n_=Ob,o_=0,s_=Ob+1,r_;s_<=Gb;s_++)r_=t_*s_+a_*Xb[s_]-i_,r_>o_&&(n_=s_,o_=r_);if(n_--,Kb){for(var l_=0,d_=Xb.length-1,h_;l_<d_;)h_=Xb[l_],Xb[l_]=Xb[d_],Xb[d_]=h_,l_++,d_--;return Xb.length-1-n_}return n_},yen:function(Xb,Ob){for(var Nb=Array(Xb.length),Gb=0;Gb<Xb.length;Gb++)Nb[Gb]=Xb[Gb]/Ob;var Hb=Array(Xb.length);Hb[0]=Nb[0];for(var Wb=1;Wb<Xb.length;Wb++)Hb[Wb]=Hb[Wb-1]+Nb[Wb];var Zb=Array(Xb.length);Zb[0]=Nb[0]*Nb[0];for(var Qb=1;Qb<Xb.length;Qb++)Zb[Qb]=Zb[Qb-1]+Nb[Qb]*Nb[Qb];var Kb=Array(Xb.length);Kb[Xb.length-1]=0;for(var Jb=Xb.length-2;0<=Jb;Jb--)Kb[Jb]=Kb[Jb+1]+Nb[Jb+1]*Nb[Jb+1];for(var $b=-1,e_=_NumberMIN_VALUE,t_=void 0,a_=0;a_<Xb.length;a_++)t_=-1*(0<Zb[a_]*Kb[a_]?_Mathlog(Zb[a_]*Kb[a_]):0)+2*(0<Hb[a_]*(1-Hb[a_])?_Mathlog(Hb[a_]*(1-Hb[a_])):0),t_>e_&&(e_=t_,$b=a_);return $b}},Ih=['threshold'].concat(Object.keys(Sh)),Ph='has-own',Ch='1.0.0',Bh='A safer .hasOwnProperty() - hasOwn(name, obj)',Ah='index.js',Rh={test:'make test'},zh='Aaron Heckmann <aaron.heckmann+github@gmail.com>',Lh='MIT',Eh={type:'git',url:'git://github.com/pebble/has-own.git'},Th='https://github.com/pebble/has-own/',Vh={mocha:'^1.21.0'},Yh={name:Ph,version:Ch,description:Bh,main:Ah,scripts:Rh,author:zh,license:Lh,repository:Eh,homepage:Th,devDependencies:Vh},Fh=Object.freeze({name:Ph,version:Ch,description:Bh,main:Ah,scripts:Rh,author:zh,license:Lh,repository:Eh,homepage:Th,devDependencies:Vh,default:Yh}),qh=ce(function(Xb,Ob){var Nb=Object.prototype.hasOwnProperty;Xb.exports=Ob=function(Hb,Wb){return Nb.call(Wb,Hb)},Ob.version=(Fh&&Yh||Fh).version}),Xh={configurable:!0,enumerable:!1,get:void 0};class Oh extends Array{constructor(Xb){if(Array.isArray(Xb)){super(Xb.length);for(var Ob=0;Ob<Xb.length;Ob++)this[Ob]=Xb[Ob]}else'number'==typeof Xb?super(Xb):super();this.computed=null}static load(Xb){return Promise.all(Xb.map(Cb.load)).then((Ob)=>new Oh(Ob))}static extendMethod(Xb,Ob,Nb={}){var Gb=Nb.inPlace,Wb=Nb.returnThis,Qb=Nb.partialArgs,Kb=void 0===Qb?[]:Qb;return Oh.prototype[Xb]=void 0!==Gb&&Gb?function(...Jb){this.computed=null;var $b=Ob.apply(this,[...Kb,...Jb]);return void 0===Wb||Wb?this:$b}:function(...Jb){return Ob.apply(this,[...Kb,...Jb])},Oh}static extendProperty(Xb,Ob,Nb={}){var Gb=Nb.partialArgs,Hb=void 0===Gb?[]:Gb;return Xh.get=function(){if(null===this.computed)this.computed={};else if(qh(Xb,this.computed))return this.computed[Xb];var Wb=Ob.apply(this,Hb);return this.computed[Xb]=Wb,Wb},Object.defineProperty(Oh.prototype,Xb,Xh),Oh}checkProcessable(Xb,Ob={}){if('string'!=typeof Xb)throw new TypeError('checkProcessable requires as first parameter the processName (a string)');if(0===this.size)throw new TypeError('The process: '+Xb+' can not be applied on an empty stack');this[0].checkProcessable(Xb,Ob);for(var Nb=1;Nb<this.length;Nb++){if((void 0===Ob.sameSize||Ob.sameSize)&&this[0].width!==this[Nb].width)throw new TypeError('The process: '+Xb+' can not be applied if width is not identical in all images');if((void 0===Ob.sameSize||Ob.sameSize)&&this[0].height!==this[Nb].height)throw new TypeError('The process: '+Xb+' can not be applied if height is not identical in all images');if((void 0===Ob.sameAlpha||Ob.sameAlpha)&&this[0].alpha!==this[Nb].alpha)throw new TypeError('The process: '+Xb+' can not be applied if alpha is not identical in all images');if((void 0===Ob.sameBitDepth||Ob.sameBitDepth)&&this[0].bitDepth!==this[Nb].bitDepth)throw new TypeError('The process: '+Xb+' can not be applied if bitDepth is not identical in all images');if((void 0===Ob.sameColorModel||Ob.sameColorModel)&&this[0].colorModel!==this[Nb].colorModel)throw new TypeError('The process: '+Xb+' can not be applied if colorModel is not identical in all images');if((void 0===Ob.sameNumberChannels||Ob.sameNumberChannels)&&this[0].channels!==this[Nb].channels)throw new TypeError('The process: '+Xb+' can not be applied if channels is not identical in all images')}}}Array[Symbol.species]||(Oh.prototype.map=function(Xb,Ob){if('function'!=typeof Xb)throw new TypeError(Xb+' is not a function');for(var Nb=new Oh(this.length),Gb=0;Gb<this.length;Gb++)Nb[Gb]=Xb.call(Ob,this[Gb],Gb,this);return Nb}),function(Xb){Xb.extendMethod('matchAndCrop',Da),Xb.extendMethod('getMin',ja),Xb.extendMethod('getMax',Ma),Xb.extendMethod('getMedian',Pa),Xb.extendMethod('getHistogram',Ca),Xb.extendMethod('getHistograms',Ba),Xb.extendMethod('getAverage',Aa)}(Oh),Ua.prototype.localMin=function(Xb,Ob){for(var Nb=this[Xb][Ob],Gb=[Xb,Ob],Hb=_Mathmax(0,Xb-1);Hb<_Mathmin(this.length,Xb+2);Hb++)for(var Wb=_Mathmax(0,Ob-1);Wb<_Mathmin(this[0].length,Ob+2);Wb++)this[Hb][Wb]<Nb&&(Nb=this[Hb][Wb],Gb=[Hb,Wb]);return{position:Gb,value:Nb}},Ua.prototype.localMax=function(Xb,Ob){for(var Nb=this[Xb][Ob],Gb=[Xb,Ob],Hb=_Mathmax(0,Xb-1);Hb<_Mathmin(this.length,Xb+2);Hb++)for(var Wb=_Mathmax(0,Ob-1);Wb<_Mathmin(this[0].length,Ob+2);Wb++)this[Hb][Wb]>Nb&&(Nb=this[Hb][Wb],Gb=[Hb,Wb]);return{position:Gb,value:Nb}},Ua.prototype.localSearch=function(Xb,Ob,Nb){for(var Gb=[],Hb=_Mathmax(0,Xb-1);Hb<_Mathmin(this.length,Xb+2);Hb++)for(var Wb=_Mathmax(0,Ob-1);Wb<_Mathmin(this[0].length,Ob+2);Wb++)this[Hb][Wb]===Nb&&Gb.push([Hb,Wb]);return Gb};var Gh=function(Xb,Ob,Nb){var Ob=Ob/100,Nb=Nb/100,Gb=[],Hb=Nb*Ob,Wb=Xb/60,Zb=Hb*(1-_Mathabs(Wb%2-1)),Qb=Nb-Hb;switch(parseInt(Wb,10)){case 0:Gb=[Hb,Zb,0];break;case 1:Gb=[Zb,Hb,0];break;case 2:Gb=[0,Hb,Zb];break;case 3:Gb=[0,Zb,Hb];break;case 4:Gb=[Zb,0,Hb];break;case 5:Gb=[Hb,0,Zb];}return{r:_Mathround(255*(Gb[0]+Qb)),g:_Mathround(255*(Gb[1]+Qb)),b:_Mathround(255*(Gb[2]+Qb))}},Hh=function(Xb,Ob,Nb){function Gb(Hb){var Wb=Hb.toString(16);return 1===Wb.length?'0'+Wb:Wb}return[Gb(Xb),Gb(Ob),Gb(Nb)].join('')},Kh=function(Xb,Ob,Nb,Gb){return Gb/=100,{r:parseInt(255*(1-Gb)+Gb*Xb,10),g:parseInt(255*(1-Gb)+Gb*Ob,10),b:parseInt(255*(1-Gb)+Gb*Nb,10)}},$h=function(Xb,Ob,Nb){return Ob*=(50>Nb?Nb:100-Nb)/100,console.log('s',Ob),{h:Xb,s:100*(2*Ob/(Nb+Ob)),v:Nb+Ob}},tm=function(Xb,Ob,Nb){var Gb=$h(Xb,Ob,Nb);return Gh(Gb.h,Gb.s,Gb.v)},am={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,132,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,255,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,203],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[119,128,144],slategrey:[119,128,144],snow:[255,255,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,5]},sm={hex2rgb:function(Xb){return('#'===Xb[0]&&(Xb=Xb.substr(1)),6===Xb.length)?{r:parseInt(Xb.substr(0,2),16),g:parseInt(Xb.substr(2,2),16),b:parseInt(Xb.substr(4,2),16)}:3===Xb.length?{r:parseInt(Xb[0]+Xb[0],16),g:parseInt(Xb[1]+Xb[1],16),b:parseInt(Xb[2]+Xb[2],16)}:void 0},hsv2hex:function(Xb,Ob,Nb){var Gb=Gh(Xb,Ob,Nb);return Hh(Gb.r,Gb.g,Gb.b)},hsv2rgb:Gh,rgb2hex:Hh,rgb2hsv:function(Xb,Ob,Nb){var Zb=_Mathmax(Xb,Ob,Nb),Qb=_Mathmin(Xb,Ob,Nb),Kb=Zb-Qb,Gb,Hb,Wb;return 0==Kb?Gb=0:Xb===Zb?Gb=(Ob-Nb)/Kb%6:Ob===Zb?Gb=(Nb-Xb)/Kb+2:Nb===Zb&&(Gb=(Xb-Ob)/Kb+4),Gb=_Mathround(60*Gb),0>Gb&&(Gb+=360),Hb=_Mathround(100*(0===Zb?0:Kb/Zb)),Wb=_Mathround(100*(Zb/255)),{h:Gb,s:Hb,v:Wb}},rgba:function(Xb,Ob,Nb,Gb){return'rgba('+[Xb,Ob,Nb,Gb/100].join(',')+')'},rgba2rgb:Kh,rgba2hex:function(Xb,Ob,Nb,Gb){var Hb=Kh(Xb,Ob,Nb,Gb);return Hh(Hb.r,Hb.g,Hb.b)},hsl2hsv:$h,hsv2hsl:function(Xb,Ob,Nb){var Gb=(200-Ob)*Nb/100;return{h:Xb,s:Ob*Nb/(100>Gb?Gb:200-Gb),l:Gb/2}},hsl2rgb:tm,cssColor:function(Xb){return ti(Xb)||si(Xb)||oi(Xb)||ai(Xb)||ni(Xb)||ri(Xb)||di(Xb)}}.cssColor,lm=[[0,0,1,0,0],[0,0,1,0,0],[1,1,1,1,1],[0,0,1,0,0],[0,0,1,0,0]],dm=[[0,1,0],[1,1,1],[0,1,0]];class hm{constructor(Xb={}){var Ob=Xb.kind,Nb=void 0===Ob?'cross':Ob,Gb=Xb.shape,Hb=Xb.size,Wb=Xb.width,Zb=Xb.height,Qb=Xb.filled,Kb=void 0===Qb||Qb;if(Hb&&(Wb=Hb,Zb=Hb),Gb)switch(Gb.toLowerCase()){case'square':case'rectangle':this.matrix=bi(Wb,Zb,{filled:Kb});break;case'circle':case'ellipse':this.matrix=ki(Wb,Zb,{filled:Kb});break;case'triangle':this.matrix=Di(Wb,Zb,{filled:Kb});break;default:throw new Error(`Shape: unexpected shape: ${Gb}`);}else if(Nb)switch(Nb.toLowerCase()){case'cross':this.matrix=lm;break;case'smallcross':this.matrix=dm;break;default:throw new Error(`Shape: unexpected kind: ${Nb}`);}else throw new Error('Shape: expected a kind or a shape option');this.height=this.matrix.length,this.width=this.matrix[0].length,this.halfHeight=this.height/2>>0,this.halfWidth=this.width/2>>0}getPoints(){for(var Xb=this.matrix,Ob=[],Nb=0;Nb<Xb.length;Nb++)for(var Gb=0;Gb<Xb[0].length;Gb++)Xb[Nb][Gb]&&Ob.push([Gb-this.halfWidth,Nb-this.halfHeight]);return Ob}getMask(){for(var Xb=new Cb(this.width,this.height,{kind:Lr}),Ob=0;Ob<this.matrix.length;Ob++)for(var Nb=0;Nb<this.matrix[0].length;Nb++)this.matrix[Ob][Nb]&&Xb.setBitXY(Nb,Ob);return Xb}}var mm=ce(function(Xb){(function(){function Nb(Hb,Wb,Zb){this.next=Zb,Zb&&(Zb.prev=this),this.prev=Wb,Wb&&(Wb.next=this),this.data=Hb}function Gb(){return this instanceof Gb?void(this._head=null,this._tail=null,this.length=0):new Gb}Gb.prototype={push:function(Hb){this._tail=new Nb(Hb,this._tail,null),this._head||(this._head=this._tail),this.length++},pop:function(){if(0!==this.length){var Hb=this._tail;return this._tail=Hb.prev,Hb.prev&&(Hb.prev=this._tail.next=null),this.length--,1===this.length?this._head=this._tail:0===this.length&&(this._head=this._tail=null),Hb.data}},unshift:function(Hb){this._head=new Nb(Hb,null,this._head),this._tail||(this._tail=this._head),this.length++},shift:function(){if(0!==this.length){var Hb=this._head;return this._head=Hb.next,Hb.next&&(Hb.next=this._head.prev=null),this.length--,1===this.length?this._tail=this._head:0===this.length&&(this._head=this._tail=null),Hb.data}},item:function(Hb){0>Hb&&(Hb=this.length+Hb);for(var Wb=this._head;0<Hb--&&Wb;)Wb=Wb.next;return Wb?Wb.data:void 0},slice:function(Hb,Wb){if(Hb||(Hb=0),Wb||(Wb=this.length),0>Wb&&(Wb=this.length+Wb),0>Hb&&(Hb=this.length+Hb),Wb===Hb)return[];if(Wb<Hb)throw new Error('invalid offset: '+Hb+','+Wb+' (length='+this.length+')');for(var Zb=Wb-Hb,Qb=Array(Zb),Kb=0,Jb=this._head;0<Hb--&&Jb;)Jb=Jb.next;for(;Kb<Zb&&Jb;)Qb[Kb++]=Jb.data,Jb=Jb.next;return Qb},drop:function(){Gb.call(this)},forEach:function(Hb,Wb){for(var Zb=this._head,Qb=0,Kb=this.length;Qb<Kb&&Zb;)Hb.call(Wb||this,Zb.data,Qb,this),Zb=Zb.next,Qb++},map:function(Hb,Wb){var Zb=new Gb;return this.forEach(function(Qb,Kb,Jb){Zb.push(Hb.call(Wb||Jb,Qb,Kb,Jb))}),Zb},filter:function(Hb,Wb){var Zb=new Gb;return this.forEach(function(Qb,Kb,Jb){Hb.call(Wb||Jb,Qb,Kb,Jb)&&Zb.push(Qb)}),Zb},reduce:function(Hb,Wb,Zb){var Qb=0,Kb=this._head,Jb=this.length;for(Wb||(Qb=1,Wb=Kb&&Kb.data,Kb=Kb&&Kb.next);Qb<Jb&&Kb;)Wb=Hb.call(Zb||this,Wb,Kb.data,this),Qb++,Kb=Kb.next;return Wb}},Xb.exports=Gb})()}),gm={setBitXY(Xb,Ob){var Nb=Ob*this.width+Xb;this.data[Nb>>3]|=1<<7-(7&Nb)},clearBitXY(Xb,Ob){var Nb=Ob*this.width+Xb;this.data[Nb>>3]&=~(1<<7-(7&Nb))},toggleBitXY(Xb,Ob){var Nb=Ob*this.width+Xb;this.data[Nb>>3]^=1<<7-(7&Nb)},getBitXY(Xb,Ob){var Nb=Ob*this.width+Xb;return this.data[Nb>>3]&1<<7-(7&Nb)?1:0},setBit(Xb){this.data[Xb>>3]|=1<<7-(7&Xb)},clearBit(Xb){this.data[Xb>>3]&=~(1<<7-(7&Xb))},toggleBit(Xb){this.data[Xb>>3]^=1<<7-(7&Xb)},getBit(Xb){return this.data[Xb>>3]&1<<7-(7&Xb)?1:0}};class um{constructor(Xb,Ob){this.parent=Xb,this.width=Xb.width,this.height=Xb.height,this.data=Ob,this.negative=0,this.positive=0,this.computed={}}get total(){return this.negative+this.positive}get minMax(){if(this.computed.minMax)return this.computed.minMax;for(var Xb=Number.MAX_SAFE_INTEGER,Ob=Number.MIN_SAFE_INTEGER,Nb=0;Nb<this.data.length;Nb++)this.data[Nb]<Xb&&(Xb=this.data[Nb]),this.data[Nb]>Ob&&(Ob=this.data[Nb]);return this.computed.minMax={min:Xb,max:Ob}}get commonBorderLength(){return tn(this)}mergeRoi(Xb={}){return an.call(this,Xb)}rowsInfo(){for(var Xb=Array(this.height),Ob=0,Nb=0,Gb;Nb<this.data.length;Nb+=this.width){Gb={row:Ob,positivePixel:0,negativePixel:0,zeroPixel:0,positiveRoi:0,negativeRoi:0,medianChange:0},Xb[Ob++]=Gb;for(var Hb={},Wb={},Zb=[],Qb=this.data[Nb],Kb=0,Jb=Nb,$b;Jb<Nb+this.width;Jb++)$b=this.data[Jb],Qb!==$b&&(Qb=$b,Zb.push(Kb),Kb=0),Kb++,0<$b?(Gb.positivePixel++,!Hb[$b]&&(Hb[$b]=!0)):0>$b?(Gb.negativePixel++,!Wb[$b]&&(Wb[$b]=!0)):Gb.zeroPixel++;Zb.push(Kb),Gb.medianChange=Zb.sort((e_,t_)=>e_-t_)[_Mathfloor(Zb.length/2)],Gb.positiveRoiIDs=Object.keys(Hb),Gb.negativeRoiIDs=Object.keys(Wb),Gb.positiveRoi=Gb.positiveRoiIDs.length,Gb.negativeRoi=Gb.negativeRoiIDs.length}return Xb}colsInfo(){for(var Xb=Array(this.width),Ob=0,Nb=0,Gb;Nb<this.width;Nb++){Gb={col:Ob,positivePixel:0,negativePixel:0,zeroPixel:0,positiveRoi:0,negativeRoi:0,medianChange:0},Xb[Ob++]=Gb;for(var Hb={},Wb={},Zb=[],Qb=this.data[Nb],Kb=0,Jb=Nb,$b;Jb<Nb+this.data.length;Jb+=this.width)$b=this.data[Jb],Qb!==$b&&(Qb=$b,Zb.push(Kb),Kb=0),Kb++,0<$b?(Gb.positivePixel++,!Hb[$b]&&(Hb[$b]=!0)):0>$b?(Gb.negativePixel++,!Wb[$b]&&(Wb[$b]=!0)):Gb.zeroPixel++;Zb.push(Kb),Gb.medianChange=Zb.sort((e_,t_)=>e_-t_)[_Mathfloor(Zb.length/2)],Gb.positiveRoiIDs=Object.keys(Hb),Gb.negativeRoiIDs=Object.keys(Wb),Gb.positiveRoi=Gb.positiveRoiIDs.length,Gb.negativeRoi=Gb.negativeRoiIDs.length}return Xb}}var fm=class{constructor(){this.nodes=new Map}add(Xb){var Ob=this.nodes.get(Xb);return Ob||(Ob=new ln(Xb),this.nodes.set(Xb,Ob)),Ob}union(Xb,Ob){const Nb=this.find(Xb),Gb=this.find(Ob);Nb===Gb||(Nb.rank<Gb.rank?Nb.parent=Gb:Nb.rank>Gb.rank?Gb.parent=Nb:(Gb.parent=Nb,Nb.rank++))}find(Xb){for(var Ob=Xb;null!==Ob.parent;)Ob=Ob.parent;for(var Nb=Xb,Gb;null!==Nb.parent;)Gb=Nb,Nb=Nb.parent,Gb.parent=Ob;return Ob}connected(Xb,Ob){return this.find(Xb)===this.find(Ob)}},bm=[-1,0],_m=[0,-1],wm=[null,null],xm=[-1,-1,0,1],ym=[0,-1,-1,-1],km=[null,null,null,null],vm=ce(function(Xb){(function(Nb){Xb.exports=Nb()})(function(){return function Wb(Zb,Qb,Kb){function Jb(t_,a_){if(!Qb[t_]){if(!Zb[t_]){var i_='function'==typeof ge&&ge;if(!a_&&i_)return i_(t_,!0);if($b)return $b(t_,!0);var n_=new Error('Cannot find module \''+t_+'\'');throw n_.code='MODULE_NOT_FOUND',n_}var o_=Qb[t_]={exports:{}};Zb[t_][0].call(o_.exports,function(s_){var r_=Zb[t_][1][s_];return Jb(r_?r_:s_)},o_,o_.exports,Wb,Zb,Qb,Kb)}return Qb[t_].exports}for(var $b='function'==typeof ge&&ge,e_=0;e_<Kb.length;e_++)Jb(Kb[e_]);return Jb}({1:[function(Wb,Zb){var a_=function(n_,o_){function s_(){this.constructor=n_}for(var r_ in o_)i_.call(o_,r_)&&(n_[r_]=o_[r_]);return s_.prototype=o_.prototype,n_.prototype=new s_,n_.__super__=o_.prototype,n_},i_={}.hasOwnProperty,Kb,Jb,$b,e_,t_;Kb=Wb('./PriorityQueue/AbstractPriorityQueue'),Jb=Wb('./PriorityQueue/ArrayStrategy'),e_=Wb('./PriorityQueue/BinaryHeapStrategy'),$b=Wb('./PriorityQueue/BHeapStrategy'),t_=function(n_){function o_(s_){s_||(s_={}),s_.strategy||(s_.strategy=e_),s_.comparator||(s_.comparator=function(r_,l_){return(r_||0)-(l_||0)}),o_.__super__.constructor.call(this,s_)}return a_(o_,n_),o_}(Kb),t_.ArrayStrategy=Jb,t_.BinaryHeapStrategy=e_,t_.BHeapStrategy=$b,Zb.exports=t_},{'./PriorityQueue/AbstractPriorityQueue':2,'./PriorityQueue/ArrayStrategy':3,'./PriorityQueue/BHeapStrategy':4,'./PriorityQueue/BinaryHeapStrategy':5}],2:[function(Wb,Zb){var Kb;Zb.exports=Kb=function(){function Jb($b){var e_;if(null==(null==$b?void 0:$b.strategy))throw'Must pass options.strategy, a strategy';if(null==(null==$b?void 0:$b.comparator))throw'Must pass options.comparator, a comparator';this.priv=new $b.strategy($b),this.length=(null==$b||null==(e_=$b.initialValues)?void 0:e_.length)||0}return Jb.prototype.queue=function($b){return this.length++,this.priv.queue($b),void 0},Jb.prototype.dequeue=function(){if(!this.length)throw'Empty queue';return this.length--,this.priv.dequeue()},Jb.prototype.peek=function(){if(!this.length)throw'Empty queue';return this.priv.peek()},Jb.prototype.clear=function(){return this.length=0,this.priv.clear()},Jb}()},{}],3:[function(Wb,Zb){var Kb,Jb;Jb=function($b,e_,t_){var a_,i_,n_;for(i_=0,a_=$b.length;i_<a_;)n_=i_+a_>>>1,0<=t_($b[n_],e_)?i_=n_+1:a_=n_;return i_},Zb.exports=Kb=function(){function $b(e_){var t_;this.options=e_,this.comparator=this.options.comparator,this.data=(null==(t_=this.options.initialValues)?void 0:t_.slice(0))||[],this.data.sort(this.comparator).reverse()}return $b.prototype.queue=function(e_){var t_;return t_=Jb(this.data,e_,this.comparator),this.data.splice(t_,0,e_),void 0},$b.prototype.dequeue=function(){return this.data.pop()},$b.prototype.peek=function(){return this.data[this.data.length-1]},$b.prototype.clear=function(){return this.data.length=0,void 0},$b}()},{}],4:[function(Wb,Zb){var Kb;Zb.exports=Kb=function(){function Jb($b){var e_,t_,a_,i_,n_,o_,s_,r_,l_;for(this.comparator=(null==$b?void 0:$b.comparator)||function(d_,h_){return d_-h_},this.pageSize=(null==$b?void 0:$b.pageSize)||512,this.length=0,r_=0;1<<r_<this.pageSize;)r_+=1;if(1<<r_!==this.pageSize)throw'pageSize must be a power of two';for(this._shift=r_,this._emptyMemoryPageTemplate=e_=[],(t_=a_=0,o_=this.pageSize);0<=o_?a_<o_:a_>o_;t_=0<=o_?++a_:--a_)e_.push(null);if(this._memory=[],this._mask=this.pageSize-1,$b.initialValues)for(s_=$b.initialValues,i_=0,n_=s_.length;i_<n_;i_++)l_=s_[i_],this.queue(l_)}return Jb.prototype.queue=function($b){return this.length+=1,this._write(this.length,$b),this._bubbleUp(this.length,$b),void 0},Jb.prototype.dequeue=function(){var $b,e_;return $b=this._read(1),e_=this._read(this.length),this.length-=1,0<this.length&&(this._write(1,e_),this._bubbleDown(1,e_)),$b},Jb.prototype.peek=function(){return this._read(1)},Jb.prototype.clear=function(){return this.length=0,this._memory.length=0,void 0},Jb.prototype._write=function($b,e_){var t_;for(t_=$b>>this._shift;t_>=this._memory.length;)this._memory.push(this._emptyMemoryPageTemplate.slice(0));return this._memory[t_][$b&this._mask]=e_},Jb.prototype._read=function($b){return this._memory[$b>>this._shift][$b&this._mask]},Jb.prototype._bubbleUp=function($b,e_){var t_,a_,i_,n_;for(t_=this.comparator;1<$b&&(a_=$b&this._mask,$b<this.pageSize||3<a_?i_=$b&~this._mask|a_>>1:2>a_?(i_=$b-this.pageSize>>this._shift,i_+=i_&~(this._mask>>1),i_|=this.pageSize>>1):i_=$b-2,n_=this._read(i_),!(0>t_(n_,e_)));)this._write(i_,e_),this._write($b,n_),$b=i_},Jb.prototype._bubbleDown=function($b,e_){var t_,a_,i_,n_,o_;for(o_=this.comparator;$b<this.length;)if($b>this._mask&&!($b&this._mask-1)?t_=a_=$b+2:$b&this.pageSize>>1?(t_=($b&~this._mask)>>1,t_|=$b&this._mask>>1,t_=t_+1<<this._shift,a_=t_+1):(t_=$b+($b&this._mask),a_=t_+1),t_!==a_&&a_<=this.length){if(i_=this._read(t_),n_=this._read(a_),0>o_(i_,e_)&&0>=o_(i_,n_))this._write(t_,e_),this._write($b,i_),$b=t_;else if(0>o_(n_,e_))this._write(a_,e_),this._write($b,n_),$b=a_;else break;}else if(!(t_<=this.length))break;else if(i_=this._read(t_),0>o_(i_,e_))this._write(t_,e_),this._write($b,i_),$b=t_;else break},Jb}()},{}],5:[function(Wb,Zb){var Kb;Zb.exports=Kb=function(){function Jb($b){var e_;this.comparator=(null==$b?void 0:$b.comparator)||function(t_,a_){return t_-a_},this.length=0,this.data=(null==(e_=$b.initialValues)?void 0:e_.slice(0))||[],this._heapify()}return Jb.prototype._heapify=function(){var $b,e_,t_;if(0<this.data.length)for($b=e_=1,t_=this.data.length;1<=t_?e_<t_:e_>t_;$b=1<=t_?++e_:--e_)this._bubbleUp($b)},Jb.prototype.queue=function($b){return this.data.push($b),this._bubbleUp(this.data.length-1),void 0},Jb.prototype.dequeue=function(){var $b,e_;return e_=this.data[0],$b=this.data.pop(),0<this.data.length&&(this.data[0]=$b,this._bubbleDown(0)),e_},Jb.prototype.peek=function(){return this.data[0]},Jb.prototype.clear=function(){return this.length=0,this.data.length=0,void 0},Jb.prototype._bubbleUp=function($b){for(var e_,t_;0<$b&&(e_=$b-1>>>1,0>this.comparator(this.data[$b],this.data[e_]));)t_=this.data[e_],this.data[e_]=this.data[$b],this.data[$b]=t_,$b=e_},Jb.prototype._bubbleDown=function($b){var e_,t_,a_,i_,n_;for(e_=this.data.length-1;t_=($b<<1)+1,i_=t_+1,a_=$b,t_<=e_&&0>this.comparator(this.data[t_],this.data[a_])&&(a_=t_),i_<=e_&&0>this.comparator(this.data[i_],this.data[a_])&&(a_=i_),a_!==$b;)n_=this.data[a_],this.data[a_]=this.data[$b],this.data[$b]=n_,$b=a_},Jb}()},{}]},{},[1])(1)})}),Dm=[1,0,-1,0,1,1,-1,-1],jm=[0,1,0,-1,1,-1,1,-1],Mm=Object.prototype.hasOwnProperty,Sm=Object.prototype.toString,Im=function(Ob){return'function'==typeof Array.isArray?Array.isArray(Ob):'[object Array]'===Sm.call(Ob)},Pm=function(Ob){if(!Ob||'[object Object]'!==Sm.call(Ob))return!1;var Nb=Mm.call(Ob,'constructor'),Gb=Ob.constructor&&Ob.constructor.prototype&&Mm.call(Ob.constructor.prototype,'isPrototypeOf');if(Ob.constructor&&!Nb&&!Gb)return!1;for(var Hb in Ob);return'undefined'==typeof Hb||Mm.call(Ob,Hb)},Cm=function Xb(){var Qb=arguments[0],Kb=1,Jb=arguments.length,$b=!1,Ob,Nb,Gb,Hb,Wb,Zb;for('boolean'==typeof Qb&&($b=Qb,Qb=arguments[1]||{},Kb=2),(null==Qb||'object'!=typeof Qb&&'function'!=typeof Qb)&&(Qb={});Kb<Jb;++Kb)if(Ob=arguments[Kb],null!=Ob)for(Nb in Ob)Gb=Qb[Nb],Hb=Ob[Nb],Qb!==Hb&&($b&&Hb&&(Pm(Hb)||(Wb=Im(Hb)))?(Wb?(Wb=!1,Zb=Gb&&Im(Gb)?Gb:[]):Zb=Gb&&Pm(Gb)?Gb:{},Qb[Nb]=Xb($b,Zb,Hb)):'undefined'!=typeof Hb&&(Qb[Nb]=Hb));return Qb};class Bm{constructor(Xb,Ob){this.map=Xb,this.id=Ob,this.minX=_NumberPOSITIVE_INFINITY,this.maxX=_NumberNEGATIVE_INFINITY,this.minY=_NumberPOSITIVE_INFINITY,this.maxY=_NumberNEGATIVE_INFINITY,this.meanX=0,this.meanY=0,this.surface=0,this.computed={}}getMask(Xb={}){var Ob=Xb.scale,Nb=void 0===Ob?1:Ob,Gb=Xb.kind,Hb=void 0===Gb?'':Gb,Wb;return Wb='contour'===Hb?this.contourMask:'box'===Hb?this.boxMask:'filled'===Hb?this.filledMask:'center'===Hb?this.centerMask:this.mask,1>Nb&&(Wb=Wb.scale({factor:Nb}),Wb.parent=this.mask.parent,Wb.position[0]+=this.minX,Wb.position[1]+=this.minY),Wb}get mean(){throw new Error('Roi mean not implemented yet')}get center(){return this.computed.center?this.computed.center:this.computed.center=[this.width/2>>0,this.height/2>>0]}get ratio(){return this.width/this.height}get width(){return this.maxX-this.minX+1}get height(){return this.maxY-this.minY+1}_computExternalIDs(){var Xb=this.borderIDs,Ob=this.borderLengths;this.computed.externalIDs=[],this.computed.externalLengths=[];for(var Nb=this.internalIDs,Gb=0;Gb<Xb.length;Gb++)Nb.includes(Xb[Gb])||(this.computed.externalIDs.push(Xb[Gb]),this.computed.externalLengths.push(Ob[Gb]))}get externalIDs(){return this.computed.externalIDs?this.computed.externalIDs:(this._computExternalIDs(),this.computed.externalIDs)}get externalLengths(){return this.computed.externalLengths?this.computed.externalLengths:(this._computExternalIDs(),this.computed.externalLengths)}_computeBorderIDs(){var Xb=cn(this);this.computed.borderIDs=Xb.ids,this.computed.borderLengths=Xb.lengths}get borderIDs(){return this.computed.borderIDs?this.computed.borderIDs:(this._computeBorderIDs(),this.computed.borderIDs)}get borderLengths(){return this.computed.borderLengths?this.computed.borderLengths:(this._computeBorderIDs(),this.computed.borderLengths)}get boxIDs(){return this.computed.boxIDs?this.computed.boxIDs:this.computed.boxIDs=un(this)}get internalIDs(){return this.computed.internalIDs?this.computed.internalIDs:this.computed.internalIDs=xn(this)}get box(){return this.computed.box?this.computed.box:this.computed.box=pn(this)}get external(){return this.computed.external?this.computed.external:this.computed.external=wn(this)}get border(){return this.computed.border?this.computed.border:this.computed.border=bn(this)}get contourMask(){if(this.computed.contourMask)return this.computed.contourMask;for(var Xb=new Cb(this.width,this.height,{kind:Lr,position:[this.minX,this.minY],parent:this.map.parent}),Ob=0;Ob<this.width;Ob++)for(var Nb=0;Nb<this.height;Nb++)this.map.data[Ob+this.minX+(Nb+this.minY)*this.map.width]===this.id&&(0<Ob&&Ob<this.width-1&&0<Nb&&Nb<this.height-1?(this.map.data[Ob-1+this.minX+(Nb+this.minY)*this.map.width]!==this.id||this.map.data[Ob+1+this.minX+(Nb+this.minY)*this.map.width]!==this.id||this.map.data[Ob+this.minX+(Nb-1+this.minY)*this.map.width]!==this.id||this.map.data[Ob+this.minX+(Nb+1+this.minY)*this.map.width]!==this.id)&&Xb.setBitXY(Ob,Nb):Xb.setBitXY(Ob,Nb));return this.computed.contour=Xb}get boxMask(){if(this.computed.boxMask)return this.computed.boxMask;for(var Xb=new Cb(this.width,this.height,{kind:Lr,position:[this.minX,this.minY],parent:this.map.parent}),Ob=0;Ob<this.width;Ob++)Xb.setBitXY(Ob,0),Xb.setBitXY(Ob,this.height-1);for(var Nb=0;Nb<this.height;Nb++)Xb.setBitXY(0,Nb),Xb.setBitXY(this.width-1,Nb);return this.computed.boxMask=Xb}get mask(){if(this.computed.mask)return this.computed.mask;for(var Xb=new Cb(this.width,this.height,{kind:Lr,position:[this.minX,this.minY],parent:this.map.parent}),Ob=0;Ob<this.width;Ob++)for(var Nb=0;Nb<this.height;Nb++)this.map.data[Ob+this.minX+(Nb+this.minY)*this.map.width]===this.id&&Xb.setBitXY(Ob,Nb);return this.computed.mask=Xb}get filledMask(){if(this.computed.filledMask)return this.computed.filledMask;for(var Xb=new Cb(this.width,this.height,{kind:Lr,position:[this.minX,this.minY],parent:this.map.parent}),Ob=0;Ob<this.width;Ob++)for(var Nb=0,Gb;Nb<this.height;Nb++)Gb=Ob+this.minX+(Nb+this.minY)*this.map.width,this.internalIDs.includes(this.map.data[Gb])&&Xb.setBitXY(Ob,Nb);return this.computed.filledMask=Xb}get centerMask(){if(this.computed.centerMask)return this.computed.centerMask;var Xb=new hm({kind:'smallCross'}).getMask();return Xb.parent=this.map.parent,Xb.position=[this.minX+this.center[0]-1,this.minY+this.center[1]-1],this.computed.centerMask=Xb}get points(){if(this.computed.points)return this.computed.points;for(var Xb=[],Ob=0;Ob<this.height;Ob++)for(var Nb=0,Gb;Nb<this.width;Nb++)Gb=(Ob+this.minY)*this.map.width+Nb+this.minX,this.map.data[Gb]===this.id&&Xb.push([Nb,Ob]);return this.computed.points=Xb}get maxLengthPoints(){if(this.computed.maxLengthPoints)return this.computed.maxLengthPoints;for(var Xb=0,Ob=void 0,Nb=this.points,Gb=0;Gb<Nb.length;Gb++)for(var Hb=Gb+1,Wb;Hb<Nb.length;Hb++)Wb=_Mathpow(Nb[Gb][0]-Nb[Hb][0],2)+_Mathpow(Nb[Gb][1]-Nb[Hb][1],2),Wb>=Xb&&(Xb=Wb,Ob=[Nb[Gb],Nb[Hb]]);return this.computed.maxLengthPoints=Ob}get maxLength(){if(this.computed.maxLength)return this.computed.maxLength;var Xb=_Mathsqrt(_Mathpow(this.maxLengthPoints[0][0]-this.maxLengthPoints[1][0],2)+_Mathpow(this.maxLengthPoints[0][1]-this.maxLengthPoints[1][1],2));return this.computed.maxLength=Xb}get angle(){if(this.computed.angle)return this.computed.angle;var Xb=this.maxLengthPoints,Ob=180*-Math.atan2(Xb[0][1]-Xb[1][1],Xb[0][0]-Xb[1][0])/_MathPI;return this.computed.angle=Ob}toJSON(){return{id:this.id,minX:this.minX,maxX:this.maxX,minY:this.minY,maxY:this.maxY,meanX:this.meanX,meanY:this.meanY,height:this.height,width:this.width,surface:this.surface}}}class Am{constructor(Xb,Ob){this.roiMap=Xb,this.options=Ob,this.roi=this.createRoi()}createRoi(){var Xb=this.roiMap.data,Ob={};this.roiMap.positive=0,this.roiMap.negative=0;for(var Nb=0;Nb<Xb.length;Nb++)Xb[Nb]&&!Ob[Xb[Nb]]&&(Ob[Xb[Nb]]=!0,0<Xb[Nb]?this.roiMap.positive++:this.roiMap.negative++);var Gb={};for(var Hb in Ob)Gb[Hb]=new Bm(this.roiMap,1*Hb);for(var Wb=this.roiMap.width,Zb=this.roiMap.height,Qb=0;Qb<Zb;Qb++)for(var Kb=0,Jb;Kb<Wb;Kb++)if(Jb=Qb*Wb+Kb,0!==Xb[Jb]){var $b=Xb[Jb],e_=Gb[$b];Kb<e_.minX&&(e_.minX=Kb),Kb>e_.maxX&&(e_.maxX=Kb),Qb<e_.minY&&(e_.minY=Qb),Qb>e_.maxY&&(e_.maxY=Qb),e_.meanX+=Kb,e_.meanY+=Qb,e_.surface++}var t_=[];for(var a_ in Ob)Gb[a_].meanX/=Gb[a_].surface,Gb[a_].meanY/=Gb[a_].surface,t_.push(Gb[a_]);return t_}}class Rm{constructor(Xb,Ob={}){this._image=Xb,this._options=Ob,this._options.label||(this._options.label='default'),this._layers={},this._painted=null}fromMaxima(Xb={}){var Ob=Cm({},this._options,Xb),Nb=hn.call(this._image,Xb);this._layers[Ob.label]=new Am(Nb,Ob)}fromPoints(Xb,Ob={}){var Nb=Cm({},this._options,Ob),Gb=gn.call(this._image,Xb,Ob);return this._layers[Nb.label]=new Am(Gb,Nb),this}putMap(Xb,Ob={}){var Nb=new um(this._image,Xb),Gb=Cm({},this._options,Ob);return this._layers[Gb.label]=new Am(Nb,Gb),this}fromWaterShed(Xb={}){var Ob=Cm({},this._options,Xb),Nb=mn.call(this._image,Xb);this._layers[Ob.label]=new Am(Nb,Ob)}fromMask(Xb,Ob={}){var Nb=Cm({},this._options,Ob),Gb=rn.call(this._image,Xb,Ob);return this._layers[Nb.label]=new Am(Gb,Nb),this}fromMaskConnectedComponentLabelingAlgorithm(Xb,Ob={}){var Nb=Cm({},this._options,Ob),Gb=dn.call(this._image,Xb,Ob);return this._layers[Nb.label]=new Am(Gb,Nb),this}getMap(Xb={}){var Ob=Cm({},this._options,Xb);return this._assertLayerWithLabel(Ob.label),this._layers[Ob.label].roiMap}rowsInfo(Xb={}){return this.getMap(Xb).rowsInfo()}colsInfo(Xb={}){return this.getMap(Xb).rowsInfo()}getRoiIds(Xb={}){var Ob=this.getRois(Xb);if(Ob){for(var Nb=Array(Ob.length),Gb=0;Gb<Ob.length;Gb++)Nb[Gb]=Ob[Gb].id;return Nb}throw new Error('ROIs not found')}getRois(Xb={}){var Ob=Xb.label,Nb=void 0===Ob?this._options.label:Ob,Gb=Xb.positive,Wb=Xb.negative,Qb=Xb.minSurface,Kb=void 0===Qb?0:Qb,Jb=Xb.maxSurface,$b=void 0===Jb?_NumberPOSITIVE_INFINITY:Jb,e_=Xb.minWidth,t_=void 0===e_?0:e_,a_=Xb.maxWidth,i_=void 0===a_?_NumberPOSITIVE_INFINITY:a_,n_=Xb.minHeight,o_=void 0===n_?0:n_,s_=Xb.maxHeight,r_=void 0===s_?_NumberPOSITIVE_INFINITY:s_,l_=Xb.minRatio,d_=void 0===l_?0:l_,h_=Xb.maxRatio,m_=void 0===h_?_NumberPOSITIVE_INFINITY:h_;if(!this._layers[Nb])throw new Error('getRoi: This Roi layer ('+Nb+') does not exists.');for(var g_=this._layers[Nb].roi,c_=Array(g_.length),u_=0,p_=0,f_;p_<g_.length;p_++)f_=g_[p_],(0>f_.id&&(void 0===Wb||Wb)||0<f_.id&&(void 0===Gb||Gb))&&f_.surface>=Kb&&f_.surface<=$b&&f_.width>=t_&&f_.width<=i_&&f_.height>=o_&&f_.height<=r_&&f_.ratio>=d_&&f_.ratio<=m_&&(c_[u_++]=f_);return c_.length=u_,c_}getMasks(Xb={}){for(var Ob=this.getRois(Xb),Nb=Array(Ob.length),Gb=0;Gb<Ob.length;Gb++)Nb[Gb]=Ob[Gb].getMask(Xb);return Nb}getData(Xb={}){var Ob=Cm({},this._options,Xb);return this._assertLayerWithLabel(Ob.label),this._layers[Ob.label].roiMap.data}paint(Xb={}){var Ob=Xb.labelProperty;this._painted||(this._painted=this._image.rgba8());var Nb=this.getMasks(Xb);if(Ob){var Gb=this.getRois(Xb);Xb.labels=Gb.map((Hb)=>Hb[Ob]),Xb.labelsPosition=Gb.map((Hb)=>[Hb.meanX,Hb.meanY])}return this._painted.paintMasks(Nb,Xb),this._painted}getMask(Xb={}){for(var Ob=new Cb(this._image.width,this._image.height,{kind:'BINARY'}),Nb=this.getMasks(Xb),Gb=0,Hb;Gb<Nb.length;Gb++){Hb=Nb[Gb];for(var Wb=0;Wb<Hb.width;Wb++)for(var Zb=0;Zb<Hb.height;Zb++)Hb.getBitXY(Wb,Zb)&&Ob.setBitXY(Wb+Hb.position[0],Zb+Hb.position[1])}return Ob}resetPainted(Xb={}){var Ob=Xb.image;this._painted=Ob?this.image.rgba8():this._image.rgba8()}mergeRoi(Xb={}){var Ob=this.getMap(Xb);return Ob.mergeRoi(Xb),this.putMap(Ob.data,Xb),this}findCorrespondingRoi(Xb,Ob={}){for(var Nb=this.getRois(Ob),Gb=[],Hb=0;Hb<Nb.length;Hb++){var Wb=Nb[Hb],Zb=Wb.minX,Qb=Wb.minY,Kb=Wb.points,Jb=_Mathsign(Wb.id),$b=yn(Zb,Qb,Kb,Xb,Jb);Gb.push($b)}return Gb}_assertLayerWithLabel(Xb){if(!this._layers[Xb])throw new Error(`no layer with label ${Xb}`)}}var zm=new Map,Lm;class Em{constructor(Xb){this.type=Xb,this._canWrite=null}canWrite(){return null===this._canWrite&&(this._canWrite=Lm.toDataURL(this.type).startsWith('data:'+this.type)),this._canWrite}}const Tm=8192,Vm=[];var Fm=class{constructor(Xb,Ob){Ob=Ob||{},void 0===Xb&&(Xb=Tm),'number'==typeof Xb&&(Xb=new ArrayBuffer(Xb));let Nb=Xb.byteLength;const Gb=Ob.offset?Ob.offset>>>0:0;Xb.buffer&&(Nb=Xb.byteLength-Gb,Xb=Xb.byteLength===Xb.buffer.byteLength?Gb?Xb.buffer.slice(Gb):Xb.buffer:Xb.buffer.slice(Xb.byteOffset+Gb,Xb.byteOffset+Xb.byteLength)),this.buffer=Xb,this.length=Nb,this.byteLength=Nb,this.byteOffset=0,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer),this._increment=Nb||Tm,this._mark=0}available(Xb){return void 0===Xb&&(Xb=1),this.offset+Xb<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){this.littleEndian=!0}isBigEndian(){return!this.littleEndian}setBigEndian(){this.littleEndian=!1}skip(Xb){void 0===Xb&&(Xb=1),this.offset+=Xb}seek(Xb){this.offset=Xb}mark(){this._mark=this.offset}reset(){this.offset=this._mark}rewind(){this.offset=0}ensureAvailable(Xb){if(void 0===Xb&&(Xb=1),!this.available(Xb)){const Ob=this._increment+this._increment;this._increment=Ob;const Nb=this.length+Ob,Gb=new Uint8Array(Nb);Gb.set(new Uint8Array(this.buffer)),this.buffer=Gb.buffer,this.length=Nb,this._data=new DataView(this.buffer)}}readBoolean(){return 0!==this.readUint8()}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(Xb){void 0===Xb&&(Xb=1);for(var Ob=new Uint8Array(Xb),Nb=0;Nb<Xb;Nb++)Ob[Nb]=this.readByte();return Ob}readInt16(){var Xb=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,Xb}readUint16(){var Xb=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,Xb}readInt32(){var Xb=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,Xb}readUint32(){var Xb=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,Xb}readFloat32(){var Xb=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,Xb}readFloat64(){var Xb=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,Xb}readChar(){return _StringfromCharCode(this.readInt8())}readChars(Xb){void 0===Xb&&(Xb=1),Vm.length=Xb;for(var Ob=0;Ob<Xb;Ob++)Vm[Ob]=this.readChar();return Vm.join('')}writeBoolean(Xb){this.writeUint8(Xb?255:0)}writeInt8(Xb){this.ensureAvailable(1),this._data.setInt8(this.offset++,Xb)}writeUint8(Xb){this.ensureAvailable(1),this._data.setUint8(this.offset++,Xb)}writeByte(Xb){this.writeUint8(Xb)}writeBytes(Xb){this.ensureAvailable(Xb.length);for(var Ob=0;Ob<Xb.length;Ob++)this._data.setUint8(this.offset++,Xb[Ob])}writeInt16(Xb){this.ensureAvailable(2),this._data.setInt16(this.offset,Xb,this.littleEndian),this.offset+=2}writeUint16(Xb){this.ensureAvailable(2),this._data.setUint16(this.offset,Xb,this.littleEndian),this.offset+=2}writeInt32(Xb){this.ensureAvailable(4),this._data.setInt32(this.offset,Xb,this.littleEndian),this.offset+=4}writeUint32(Xb){this.ensureAvailable(4),this._data.setUint32(this.offset,Xb,this.littleEndian),this.offset+=4}writeFloat32(Xb){this.ensureAvailable(4),this._data.setFloat32(this.offset,Xb,this.littleEndian),this.offset+=4}writeFloat64(Xb){this.ensureAvailable(8),this._data.setFloat64(this.offset,Xb,this.littleEndian),this.offset+=8}writeChar(Xb){this.writeUint8(Xb.charCodeAt(0))}writeChars(Xb){for(var Ob=0;Ob<Xb.length;Ob++)this.writeUint8(Xb.charCodeAt(Ob))}toArray(){return new Uint8Array(this.buffer,0,this.offset)}},Um=ce(function(Xb,Ob){'use strict';var Nb='undefined'!=typeof Uint8Array&&'undefined'!=typeof Uint16Array&&'undefined'!=typeof Int32Array;Ob.assign=function(Wb){for(var Zb=Array.prototype.slice.call(arguments,1),Qb;Zb.length;)if(Qb=Zb.shift(),!!Qb){if('object'!=typeof Qb)throw new TypeError(Qb+'must be non-object');for(var Kb in Qb)Qb.hasOwnProperty(Kb)&&(Wb[Kb]=Qb[Kb])}return Wb},Ob.shrinkBuf=function(Wb,Zb){return Wb.length===Zb?Wb:Wb.subarray?Wb.subarray(0,Zb):(Wb.length=Zb,Wb)};var Gb={arraySet:function(Wb,Zb,Qb,Kb,Jb){if(Zb.subarray&&Wb.subarray)return void Wb.set(Zb.subarray(Qb,Qb+Kb),Jb);for(var $b=0;$b<Kb;$b++)Wb[Jb+$b]=Zb[Qb+$b]},flattenChunks:function(Wb){var Zb,Qb,Kb,Jb,$b,e_;for(Kb=0,Zb=0,Qb=Wb.length;Zb<Qb;Zb++)Kb+=Wb[Zb].length;for(e_=new Uint8Array(Kb),Jb=0,(Zb=0,Qb=Wb.length);Zb<Qb;Zb++)$b=Wb[Zb],e_.set($b,Jb),Jb+=$b.length;return e_}},Hb={arraySet:function(Wb,Zb,Qb,Kb,Jb){for(var $b=0;$b<Kb;$b++)Wb[Jb+$b]=Zb[Qb+$b]},flattenChunks:function(Wb){return[].concat.apply([],Wb)}};Ob.setTyped=function(Wb){Wb?(Ob.Buf8=Uint8Array,Ob.Buf16=Uint16Array,Ob.Buf32=Int32Array,Ob.assign(Ob,Gb)):(Ob.Buf8=Array,Ob.Buf16=Array,Ob.Buf32=Array,Ob.assign(Ob,Hb))},Ob.setTyped(Nb)}),Xm=0,Om=1,Gm=0,Hm=1,Km=29,Jm=256,$m=Jm+1+Km,eg=30,tg=19,ag=2*$m+1,ig=15,ng=16,og=7,sg=256,rg=16,lg=17,dg=18,hg=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],mg=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],gg=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],cg=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],pg=Array(2*($m+2));jn(pg);var fg=Array(2*eg);jn(fg);var bg=Array(512);jn(bg);var _g=Array(258-3+1);jn(_g);var wg=Array(Km);jn(wg);var xg=Array(eg);jn(xg);var Dg=!1,Cg={_tr_init:function(Xb){Dg||(En(),Dg=!0),Xb.l_desc=new Sn(Xb.dyn_ltree,yg),Xb.d_desc=new Sn(Xb.dyn_dtree,kg),Xb.bl_desc=new Sn(Xb.bl_tree,vg),Xb.bi_buf=0,Xb.bi_valid=0,Tn(Xb)},_tr_stored_block:Qn,_tr_flush_block:function(Xb,Ob,Nb,Gb){var Zb=0,Hb,Wb;0<Xb.level?(Xb.strm.data_type===2&&(Xb.strm.data_type=Wn(Xb)),Xn(Xb,Xb.l_desc),Xn(Xb,Xb.d_desc),Zb=Gn(Xb),Hb=Xb.opt_len+3+7>>>3,Wb=Xb.static_len+3+7>>>3,Wb<=Hb&&(Hb=Wb)):Hb=Wb=Nb+5,Nb+4<=Hb&&-1!==Ob?Qn(Xb,Ob,Nb,Gb):Xb.strategy===4||Wb===Hb?(Cn(Xb,(Hm<<1)+(Gb?1:0),3),qn(Xb,pg,fg)):(Cn(Xb,(2<<1)+(Gb?1:0),3),Hn(Xb,Xb.l_desc.max_code+1,Xb.d_desc.max_code+1,Zb+1),qn(Xb,Xb.dyn_ltree,Xb.dyn_dtree)),Tn(Xb),Gb&&Vn(Xb)},_tr_tally:function(Xb,Ob,Nb){return Xb.pending_buf[Xb.d_buf+2*Xb.last_lit]=255&Ob>>>8,Xb.pending_buf[Xb.d_buf+2*Xb.last_lit+1]=255&Ob,Xb.pending_buf[Xb.l_buf+Xb.last_lit]=255&Nb,Xb.last_lit++,0===Ob?Xb.dyn_ltree[2*Nb]++:(Xb.matches++,Ob--,Xb.dyn_ltree[2*(_g[Nb]+Jm+1)]++,Xb.dyn_dtree[2*In(Ob)]++),Xb.last_lit===Xb.lit_bufsize-1},_tr_align:function(Xb){Cn(Xb,Hm<<1,3),Bn(Xb,sg,pg),Rn(Xb)}},Bg=function(Xb,Ob,Nb,Gb){for(var Hb=0|65535&Xb,Wb=0|65535&Xb>>>16,Zb=0;0!==Nb;){Zb=2e3<Nb?2e3:Nb,Nb-=Zb;do Hb=0|Hb+Ob[Gb++],Wb=0|Wb+Hb;while(--Zb);Hb%=65521,Wb%=65521}return 0|(Hb|Wb<<16)},Ag=function(){for(var Ob=[],Nb=0,Xb;256>Nb;Nb++){Xb=Nb;for(var Gb=0;8>Gb;Gb++)Xb=1&Xb?3988292384^Xb>>>1:Xb>>>1;Ob[Nb]=Xb}return Ob}(),Rg=function(Xb,Ob,Nb,Gb){Xb^=-1;for(var Zb=Gb;Zb<Gb+Nb;Zb++)Xb=Xb>>>8^Ag[255&(Xb^Ob[Zb])];return-1^Xb},zg={0:'',1:'stream end',2:'need dictionary','-1':'file error','-2':'stream error','-3':'data error','-4':'insufficient memory','-5':'buffer error','-6':'incompatible version'},Lg=0,Vg=4,Yg=5,Fg=0,Ug=1,qg=-2,Og=-5,Ng=-1,Gg=1,Hg=2,Zg=4,Kg=2,Jg=8,$g=9,oc=256+1+29,sc=30,rc=19,hc=2*oc+1,mc=15,gc=3,cc=258,uc=cc+gc+1,bc=42,wc=69,xc=73,yc=91,kc=103,vc=113,Dc=666,jc=1,Mc=2,Sc=3,Ic=4,yg,kg,vg,Cc;Cc=[new yo(0,0,0,0,function(Xb,Ob){var Nb=65535;for(Nb>Xb.pending_buf_size-5&&(Nb=Xb.pending_buf_size-5);;){if(1>=Xb.lookahead){if(po(Xb),0===Xb.lookahead&&Ob===Lg)return jc;if(0===Xb.lookahead)break}Xb.strstart+=Xb.lookahead,Xb.lookahead=0;var Gb=Xb.block_start+Nb;if((0===Xb.strstart||Xb.strstart>=Gb)&&(Xb.lookahead=Xb.strstart-Gb,Xb.strstart=Gb,ho(Xb,!1),0===Xb.strm.avail_out))return jc;if(Xb.strstart-Xb.block_start>=Xb.w_size-uc&&(ho(Xb,!1),0===Xb.strm.avail_out))return jc}return Xb.insert=0,Ob===Vg?(ho(Xb,!0),0===Xb.strm.avail_out?Sc:Ic):Xb.strstart>Xb.block_start&&(ho(Xb,!1),0===Xb.strm.avail_out)?jc:jc}),new yo(4,4,8,4,bo),new yo(4,5,16,8,bo),new yo(4,6,32,32,bo),new yo(4,4,16,16,_o),new yo(8,16,32,32,_o),new yo(8,16,128,128,_o),new yo(8,32,128,256,_o),new yo(32,128,258,1024,_o),new yo(32,258,258,4096,_o)];var Fc={deflateInit:function(Xb,Ob){return So(Xb,Ob,Jg,15,8,0)},deflateInit2:So,deflateReset:jo,deflateResetKeep:Do,deflateSetHeader:function(Xb,Ob){return Xb&&Xb.state?2===Xb.state.wrap?(Xb.state.gzhead=Ob,Fg):qg:qg},deflate:function(Xb,Ob){var Nb,Gb,Hb,Wb;if(!Xb||!Xb.state||Ob>Yg||0>Ob)return Xb?oo(Xb,qg):qg;if(Gb=Xb.state,!Xb.output||!Xb.input&&0!==Xb.avail_in||Gb.status===Dc&&Ob!==Vg)return oo(Xb,0===Xb.avail_out?Og:qg);if(Gb.strm=Xb,Nb=Gb.last_flush,Gb.last_flush=Ob,Gb.status===bc)if(2===Gb.wrap)Xb.adler=0,mo(Gb,31),mo(Gb,139),mo(Gb,8),Gb.gzhead?(mo(Gb,(Gb.gzhead.text?1:0)+(Gb.gzhead.hcrc?2:0)+(Gb.gzhead.extra?4:0)+(Gb.gzhead.name?8:0)+(Gb.gzhead.comment?16:0)),mo(Gb,255&Gb.gzhead.time),mo(Gb,255&Gb.gzhead.time>>8),mo(Gb,255&Gb.gzhead.time>>16),mo(Gb,255&Gb.gzhead.time>>24),mo(Gb,9===Gb.level?2:Gb.strategy>=Hg||2>Gb.level?4:0),mo(Gb,255&Gb.gzhead.os),Gb.gzhead.extra&&Gb.gzhead.extra.length&&(mo(Gb,255&Gb.gzhead.extra.length),mo(Gb,255&Gb.gzhead.extra.length>>8)),Gb.gzhead.hcrc&&(Xb.adler=Rg(Xb.adler,Gb.pending_buf,Gb.pending,0)),Gb.gzindex=0,Gb.status=wc):(mo(Gb,0),mo(Gb,0),mo(Gb,0),mo(Gb,0),mo(Gb,0),mo(Gb,9===Gb.level?2:Gb.strategy>=Hg||2>Gb.level?4:0),mo(Gb,3),Gb.status=vc);else{var Zb=Jg+(Gb.w_bits-8<<4)<<8,Qb=-1;Qb=Gb.strategy>=Hg||2>Gb.level?0:6>Gb.level?1:6===Gb.level?2:3,Zb|=Qb<<6,0!==Gb.strstart&&(Zb|=32),Zb+=31-Zb%31,Gb.status=vc,go(Gb,Zb),0!==Gb.strstart&&(go(Gb,Xb.adler>>>16),go(Gb,65535&Xb.adler)),Xb.adler=1}if(Gb.status===wc)if(Gb.gzhead.extra){for(Hb=Gb.pending;Gb.gzindex<(65535&Gb.gzhead.extra.length)&&!(Gb.pending===Gb.pending_buf_size&&(Gb.gzhead.hcrc&&Gb.pending>Hb&&(Xb.adler=Rg(Xb.adler,Gb.pending_buf,Gb.pending-Hb,Hb)),lo(Xb),Hb=Gb.pending,Gb.pending===Gb.pending_buf_size));)mo(Gb,255&Gb.gzhead.extra[Gb.gzindex]),Gb.gzindex++;Gb.gzhead.hcrc&&Gb.pending>Hb&&(Xb.adler=Rg(Xb.adler,Gb.pending_buf,Gb.pending-Hb,Hb)),Gb.gzindex===Gb.gzhead.extra.length&&(Gb.gzindex=0,Gb.status=xc)}else Gb.status=xc;if(Gb.status===xc)if(Gb.gzhead.name){Hb=Gb.pending;do{if(Gb.pending===Gb.pending_buf_size&&(Gb.gzhead.hcrc&&Gb.pending>Hb&&(Xb.adler=Rg(Xb.adler,Gb.pending_buf,Gb.pending-Hb,Hb)),lo(Xb),Hb=Gb.pending,Gb.pending===Gb.pending_buf_size)){Wb=1;break}Wb=Gb.gzindex<Gb.gzhead.name.length?255&Gb.gzhead.name.charCodeAt(Gb.gzindex++):0,mo(Gb,Wb)}while(0!==Wb);Gb.gzhead.hcrc&&Gb.pending>Hb&&(Xb.adler=Rg(Xb.adler,Gb.pending_buf,Gb.pending-Hb,Hb)),0===Wb&&(Gb.gzindex=0,Gb.status=yc)}else Gb.status=yc;if(Gb.status===yc)if(Gb.gzhead.comment){Hb=Gb.pending;do{if(Gb.pending===Gb.pending_buf_size&&(Gb.gzhead.hcrc&&Gb.pending>Hb&&(Xb.adler=Rg(Xb.adler,Gb.pending_buf,Gb.pending-Hb,Hb)),lo(Xb),Hb=Gb.pending,Gb.pending===Gb.pending_buf_size)){Wb=1;break}Wb=Gb.gzindex<Gb.gzhead.comment.length?255&Gb.gzhead.comment.charCodeAt(Gb.gzindex++):0,mo(Gb,Wb)}while(0!==Wb);Gb.gzhead.hcrc&&Gb.pending>Hb&&(Xb.adler=Rg(Xb.adler,Gb.pending_buf,Gb.pending-Hb,Hb)),0===Wb&&(Gb.status=kc)}else Gb.status=kc;if(Gb.status===kc&&(Gb.gzhead.hcrc?(Gb.pending+2>Gb.pending_buf_size&&lo(Xb),Gb.pending+2<=Gb.pending_buf_size&&(mo(Gb,255&Xb.adler),mo(Gb,255&Xb.adler>>8),Xb.adler=0,Gb.status=vc)):Gb.status=vc),0!==Gb.pending){if(lo(Xb),0===Xb.avail_out)return Gb.last_flush=-1,Fg;}else if(0===Xb.avail_in&&so(Ob)<=so(Nb)&&Ob!==Vg)return oo(Xb,Og);if(Gb.status===Dc&&0!==Xb.avail_in)return oo(Xb,Og);if(0!==Xb.avail_in||0!==Gb.lookahead||Ob!==Lg&&Gb.status!==Dc){var Kb=Gb.strategy===Hg?xo(Gb,Ob):Gb.strategy===3?wo(Gb,Ob):Cc[Gb.level].func(Gb,Ob);if((Kb===Sc||Kb===Ic)&&(Gb.status=Dc),Kb===jc||Kb===Sc)return 0===Xb.avail_out&&(Gb.last_flush=-1),Fg;if(Kb===Mc&&(Ob===1?Cg._tr_align(Gb):Ob!==Yg&&(Cg._tr_stored_block(Gb,0,0,!1),Ob===3&&(ro(Gb.head),0===Gb.lookahead&&(Gb.strstart=0,Gb.block_start=0,Gb.insert=0))),lo(Xb),0===Xb.avail_out))return Gb.last_flush=-1,Fg}return Ob===Vg?0>=Gb.wrap?Ug:(2===Gb.wrap?(mo(Gb,255&Xb.adler),mo(Gb,255&Xb.adler>>8),mo(Gb,255&Xb.adler>>16),mo(Gb,255&Xb.adler>>24),mo(Gb,255&Xb.total_in),mo(Gb,255&Xb.total_in>>8),mo(Gb,255&Xb.total_in>>16),mo(Gb,255&Xb.total_in>>24)):(go(Gb,Xb.adler>>>16),go(Gb,65535&Xb.adler)),lo(Xb),0<Gb.wrap&&(Gb.wrap=-Gb.wrap),0===Gb.pending?Ug:Fg):Fg},deflateEnd:function(Xb){var Ob;return Xb&&Xb.state?(Ob=Xb.state.status,Ob!==bc&&Ob!==wc&&Ob!==xc&&Ob!==yc&&Ob!==kc&&Ob!==vc&&Ob!==Dc)?oo(Xb,qg):(Xb.state=null,Ob===vc?oo(Xb,-3):Fg):qg},deflateSetDictionary:function(Xb,Ob){var Nb=Ob.length,Gb,Hb,Wb,Zb,Qb,Kb,Jb,$b;if(!Xb||!Xb.state)return qg;if(Gb=Xb.state,Zb=Gb.wrap,2===Zb||1===Zb&&Gb.status!==bc||Gb.lookahead)return qg;for(1===Zb&&(Xb.adler=Bg(Xb.adler,Ob,Nb,0)),Gb.wrap=0,Nb>=Gb.w_size&&(0===Zb&&(ro(Gb.head),Gb.strstart=0,Gb.block_start=0,Gb.insert=0),$b=new Um.Buf8(Gb.w_size),Um.arraySet($b,Ob,Nb-Gb.w_size,Gb.w_size,0),Ob=$b,Nb=Gb.w_size),Qb=Xb.avail_in,Kb=Xb.next_in,Jb=Xb.input,Xb.avail_in=Nb,Xb.next_in=0,Xb.input=Ob,po(Gb);Gb.lookahead>=gc;){Hb=Gb.strstart,Wb=Gb.lookahead-(gc-1);do Gb.ins_h=(Gb.ins_h<<Gb.hash_shift^Gb.window[Hb+gc-1])&Gb.hash_mask,Gb.prev[Hb&Gb.w_mask]=Gb.head[Gb.ins_h],Gb.head[Gb.ins_h]=Hb,Hb++;while(--Wb);Gb.strstart=Hb,Gb.lookahead=gc-1,po(Gb)}return Gb.strstart+=Gb.lookahead,Gb.block_start=Gb.strstart,Gb.insert=Gb.lookahead,Gb.lookahead=0,Gb.match_length=Gb.prev_length=gc-1,Gb.match_available=0,Xb.next_in=Kb,Xb.input=Jb,Xb.avail_in=Qb,Gb.wrap=Zb,Fg},deflateInfo:'pako deflate (from Nodeca project)'},Uc=!0,qc=!0;try{_StringfromCharCode.apply(null,[0])}catch(Xb){Uc=!1}try{_StringfromCharCode.apply(null,new Uint8Array(1))}catch(Xb){qc=!1}for(var Xc=new Um.Buf8(256),Oc=0;256>Oc;Oc++)Xc[Oc]=252<=Oc?6:248<=Oc?5:240<=Oc?4:224<=Oc?3:192<=Oc?2:1;Xc[254]=Xc[254]=1;var Qc={string2buf:function(Xb){var Zb=Xb.length,Qb=0,Ob,Nb,Gb,Hb,Wb;for(Hb=0;Hb<Zb;Hb++)Nb=Xb.charCodeAt(Hb),55296==(64512&Nb)&&Hb+1<Zb&&(Gb=Xb.charCodeAt(Hb+1),56320==(64512&Gb)&&(Nb=65536+(Nb-55296<<10)+(Gb-56320),Hb++)),Qb+=128>Nb?1:2048>Nb?2:65536>Nb?3:4;for(Ob=new Um.Buf8(Qb),Wb=0,Hb=0;Wb<Qb;Hb++)Nb=Xb.charCodeAt(Hb),55296==(64512&Nb)&&Hb+1<Zb&&(Gb=Xb.charCodeAt(Hb+1),56320==(64512&Gb)&&(Nb=65536+(Nb-55296<<10)+(Gb-56320),Hb++)),128>Nb?Ob[Wb++]=Nb:2048>Nb?(Ob[Wb++]=192|Nb>>>6,Ob[Wb++]=128|63&Nb):65536>Nb?(Ob[Wb++]=224|Nb>>>12,Ob[Wb++]=128|63&Nb>>>6,Ob[Wb++]=128|63&Nb):(Ob[Wb++]=240|Nb>>>18,Ob[Wb++]=128|63&Nb>>>12,Ob[Wb++]=128|63&Nb>>>6,Ob[Wb++]=128|63&Nb);return Ob},buf2binstring:function(Xb){return Ao(Xb,Xb.length)},binstring2buf:function(Xb){for(var Ob=new Um.Buf8(Xb.length),Nb=0,Gb=Ob.length;Nb<Gb;Nb++)Ob[Nb]=Xb.charCodeAt(Nb);return Ob},buf2string:function(Xb,Ob){var Zb=Ob||Xb.length,Qb=Array(2*Zb),Nb,Gb,Hb,Wb;for(Gb=0,Nb=0;Nb<Zb;){if(Hb=Xb[Nb++],128>Hb){Qb[Gb++]=Hb;continue}if(Wb=Xc[Hb],4<Wb){Qb[Gb++]=65533,Nb+=Wb-1;continue}for(Hb&=2===Wb?31:3===Wb?15:7;1<Wb&&Nb<Zb;)Hb=Hb<<6|63&Xb[Nb++],Wb--;if(1<Wb){Qb[Gb++]=65533;continue}65536>Hb?Qb[Gb++]=Hb:(Hb-=65536,Qb[Gb++]=55296|1023&Hb>>10,Qb[Gb++]=56320|1023&Hb)}return Ao(Qb,Gb)},utf8border:function(Xb,Ob){var Nb;for(Ob=Ob||Xb.length,Ob>Xb.length&&(Ob=Xb.length),Nb=Ob-1;0<=Nb&&128==(192&Xb[Nb]);)Nb--;return 0>Nb?Ob:0===Nb?Ob:Nb+Xc[Xb[Nb]]>Ob?Nb:Ob}},Kc=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg='',this.state=null,this.data_type=2,this.adler=0},Jc=Object.prototype.toString,eu=4,tu=0,au=1,iu=2,ou=-1,su=0,ru=8;zo.prototype.push=function(Xb,Ob){var Nb=this.strm,Gb=this.options.chunkSize,Hb,Wb;if(this.ended)return!1;Wb=Ob===~~Ob?Ob:!0===Ob?eu:0,Nb.input='string'==typeof Xb?Qc.string2buf(Xb):'[object ArrayBuffer]'===Jc.call(Xb)?new Uint8Array(Xb):Xb,Nb.next_in=0,Nb.avail_in=Nb.input.length;do{if(0===Nb.avail_out&&(Nb.output=new Um.Buf8(Gb),Nb.next_out=0,Nb.avail_out=Gb),Hb=Fc.deflate(Nb,Wb),Hb!==au&&Hb!==tu)return this.onEnd(Hb),this.ended=!0,!1;(0===Nb.avail_out||0===Nb.avail_in&&(Wb===eu||Wb===iu))&&('string'===this.options.to?this.onData(Qc.buf2binstring(Um.shrinkBuf(Nb.output,Nb.next_out))):this.onData(Um.shrinkBuf(Nb.output,Nb.next_out)))}while((0<Nb.avail_in||0===Nb.avail_out)&&Hb!==au);return Wb===eu?(Hb=Fc.deflateEnd(this.strm),this.onEnd(Hb),this.ended=!0,Hb===tu):Wb!==iu||(this.onEnd(tu),Nb.avail_out=0,!0)},zo.prototype.onData=function(Xb){this.chunks.push(Xb)},zo.prototype.onEnd=function(Xb){Xb===tu&&('string'===this.options.to?this.result=this.chunks.join(''):this.result=Um.flattenChunks(this.chunks)),this.chunks=[],this.err=Xb,this.msg=this.strm.msg};var pu=30,bu=function(Ob,Nb){var Gb,Hb,Wb,Zb,Qb,Kb,Jb,$b,e_,t_,a_,i_,n_,o_,s_,r_,l_,d_,h_,m_,g_,c_,u_,p_,f_;Gb=Ob.state,Hb=Ob.next_in,p_=Ob.input,Wb=Hb+(Ob.avail_in-5),Zb=Ob.next_out,f_=Ob.output,Qb=Zb-(Nb-Ob.avail_out),Kb=Zb+(Ob.avail_out-257),Jb=Gb.dmax,$b=Gb.wsize,e_=Gb.whave,t_=Gb.wnext,a_=Gb.window,i_=Gb.hold,n_=Gb.bits,o_=Gb.lencode,s_=Gb.distcode,r_=(1<<Gb.lenbits)-1,l_=(1<<Gb.distbits)-1;top:do{15>n_&&(i_+=p_[Hb++]<<n_,n_+=8,i_+=p_[Hb++]<<n_,n_+=8),d_=o_[i_&r_];dolen:for(;;){if(h_=d_>>>24,i_>>>=h_,n_-=h_,h_=255&d_>>>16,0===h_)f_[Zb++]=65535&d_;else if(16&h_){m_=65535&d_,h_&=15,h_&&(n_<h_&&(i_+=p_[Hb++]<<n_,n_+=8),m_+=i_&(1<<h_)-1,i_>>>=h_,n_-=h_),15>n_&&(i_+=p_[Hb++]<<n_,n_+=8,i_+=p_[Hb++]<<n_,n_+=8),d_=s_[i_&l_];dodist:for(;;){if(h_=d_>>>24,i_>>>=h_,n_-=h_,h_=255&d_>>>16,16&h_){if(g_=65535&d_,h_&=15,n_<h_&&(i_+=p_[Hb++]<<n_,n_+=8,n_<h_&&(i_+=p_[Hb++]<<n_,n_+=8)),g_+=i_&(1<<h_)-1,g_>Jb){Ob.msg='invalid distance too far back',Gb.mode=pu;break top}if(i_>>>=h_,n_-=h_,h_=Zb-Qb,g_>h_){if(h_=g_-h_,h_>e_&&Gb.sane){Ob.msg='invalid distance too far back',Gb.mode=pu;break top}if(c_=0,u_=a_,0===t_){if(c_+=$b-h_,h_<m_){m_-=h_;do f_[Zb++]=a_[c_++];while(--h_);c_=Zb-g_,u_=f_}}else if(t_<h_){if(c_+=$b+t_-h_,h_-=t_,h_<m_){m_-=h_;do f_[Zb++]=a_[c_++];while(--h_);if(c_=0,t_<m_){h_=t_,m_-=h_;do f_[Zb++]=a_[c_++];while(--h_);c_=Zb-g_,u_=f_}}}else if(c_+=t_-h_,h_<m_){m_-=h_;do f_[Zb++]=a_[c_++];while(--h_);c_=Zb-g_,u_=f_}for(;2<m_;)f_[Zb++]=u_[c_++],f_[Zb++]=u_[c_++],f_[Zb++]=u_[c_++],m_-=3;m_&&(f_[Zb++]=u_[c_++],1<m_&&(f_[Zb++]=u_[c_++]))}else{c_=Zb-g_;do f_[Zb++]=f_[c_++],f_[Zb++]=f_[c_++],f_[Zb++]=f_[c_++],m_-=3;while(2<m_);m_&&(f_[Zb++]=f_[c_++],1<m_&&(f_[Zb++]=f_[c_++]))}}else if(0==(64&h_)){d_=s_[(65535&d_)+(i_&(1<<h_)-1)];continue dodist}else{Ob.msg='invalid distance code',Gb.mode=pu;break top}break}}else if(0==(64&h_)){d_=o_[(65535&d_)+(i_&(1<<h_)-1)];continue dolen}else if(32&h_){Gb.mode=12;break top}else{Ob.msg='invalid literal/length code',Gb.mode=pu;break top}break}}while(Hb<Wb&&Zb<Kb);return m_=n_>>3,Hb-=m_,n_-=m_<<3,i_&=(1<<n_)-1,Ob.next_in=Hb,Ob.next_out=Zb,Ob.avail_in=Hb<Wb?5+(Wb-Hb):5-(Hb-Wb),Ob.avail_out=Zb<Kb?257+(Kb-Zb):257-(Zb-Kb),Gb.hold=i_,void(Gb.bits=n_)},_u=15,wu=852,xu=592,yu=0,ku=1,vu=2,Du=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],ju=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],Mu=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],Su=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64],Iu=function(Ob,Nb,Gb,Hb,Wb,Zb,Qb,Kb){var Jb=Kb.bits,$b=0,e_=0,t_=0,a_=0,i_=0,n_=0,o_=0,s_=0,r_=0,l_=0,u_=null,p_=0,b_=new Um.Buf16(_u+1),w_=new Um.Buf16(_u+1),x_=null,y_=0,d_,h_,m_,g_,c_,f_,k_,v_,D_;for($b=0;$b<=_u;$b++)b_[$b]=0;for(e_=0;e_<Hb;e_++)b_[Nb[Gb+e_]]++;for(i_=Jb,a_=_u;1<=a_&&0===b_[a_];a_--);if(i_>a_&&(i_=a_),0==a_)return Wb[Zb++]=20971520,Wb[Zb++]=20971520,Kb.bits=1,0;for(t_=1;t_<a_&&0===b_[t_];t_++);for(i_<t_&&(i_=t_),s_=1,$b=1;$b<=_u;$b++)if(s_<<=1,s_-=b_[$b],0>s_)return-1;if(0<s_&&(Ob===yu||1!=a_))return-1;for(w_[1]=0,$b=1;$b<_u;$b++)w_[$b+1]=w_[$b]+b_[$b];for(e_=0;e_<Hb;e_++)0!==Nb[Gb+e_]&&(Qb[w_[Nb[Gb+e_]]++]=e_);if(Ob===yu?(u_=x_=Qb,f_=19):Ob===ku?(u_=Du,p_-=257,x_=ju,y_-=257,f_=256):(u_=Mu,x_=Su,f_=-1),l_=0,e_=0,$b=t_,c_=Zb,n_=i_,o_=0,m_=-1,r_=1<<i_,g_=r_-1,Ob===ku&&r_>wu||Ob===vu&&r_>xu)return 1;for(;;){k_=$b-o_,Qb[e_]<f_?(v_=0,D_=Qb[e_]):Qb[e_]>f_?(v_=x_[y_+Qb[e_]],D_=u_[p_+Qb[e_]]):(v_=96,D_=0),d_=1<<$b-o_,h_=1<<n_,t_=h_;do h_-=d_,Wb[c_+(l_>>o_)+h_]=0|(k_<<24|v_<<16|D_);while(0!==h_);for(d_=1<<$b-1;l_&d_;)d_>>=1;if(0===d_?l_=0:(l_&=d_-1,l_+=d_),e_++,0==--b_[$b]){if($b==a_)break;$b=Nb[Gb+Qb[e_]]}if($b>i_&&(l_&g_)!==m_){for(0==o_&&(o_=i_),c_+=t_,n_=$b-o_,s_=1<<n_;n_+o_<a_&&(s_-=b_[n_+o_],!(0>=s_));)n_++,s_<<=1;if(r_+=1<<n_,Ob===ku&&r_>wu||Ob===vu&&r_>xu)return 1;m_=l_&g_,Wb[m_]=0|(i_<<24|n_<<16|c_-Zb)}}return 0!==l_&&(Wb[c_+l_]=0|(4194304|$b-o_<<24)),Kb.bits=i_,0},Cu=1,Bu=2,Au=4,zu=6,Lu=0,Vu=-2,Yu=-3,Fu=-4,qu=8,Xu=1,Ou=2,Nu=3,Gu=4,Hu=5,Wu=6,Zu=7,Qu=8,Ku=9,Ju=10,$u=11,ep=12,tp=13,ap=14,np=15,lp=16,dp=17,hp=18,mp=19,gp=20,cp=21,up=22,fp=23,bp=24,_p=25,wp=26,xp=27,yp=28,kp=29,vp=30,Dp=31,Mp=852,Sp=592,Cp=!0,Xp={inflateReset:Uo,inflateReset2:qo,inflateResetKeep:Fo,inflateInit:function(Xb){return Xo(Xb,15)},inflateInit2:Xo,inflate:function(Xb,Ob){var o_=0,u_=new Um.Buf8(4),b_=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Nb,Gb,Hb,Wb,Zb,Qb,Kb,Jb,$b,e_,t_,a_,i_,n_,s_,r_,l_,d_,h_,m_,g_,c_,p_,f_;if(!Xb||!Xb.state||!Xb.output||!Xb.input&&0!==Xb.avail_in)return Vu;Nb=Xb.state,Nb.mode===ep&&(Nb.mode=tp),Zb=Xb.next_out,Hb=Xb.output,Kb=Xb.avail_out,Wb=Xb.next_in,Gb=Xb.input,Qb=Xb.avail_in,Jb=Nb.hold,$b=Nb.bits,e_=Qb,t_=Kb,c_=Lu;inf_leave:for(;;)switch(Nb.mode){case Xu:if(0===Nb.wrap){Nb.mode=tp;break}for(;16>$b;){if(0===Qb)break inf_leave;Qb--,Jb+=Gb[Wb++]<<$b,$b+=8}if(2&Nb.wrap&&35615===Jb){Nb.check=0,u_[0]=255&Jb,u_[1]=255&Jb>>>8,Nb.check=Rg(Nb.check,u_,2,0),Jb=0,$b=0,Nb.mode=Ou;break}if(Nb.flags=0,Nb.head&&(Nb.head.done=!1),!(1&Nb.wrap)||(((255&Jb)<<8)+(Jb>>8))%31){Xb.msg='incorrect header check',Nb.mode=vp;break}if((15&Jb)!=qu){Xb.msg='unknown compression method',Nb.mode=vp;break}if(Jb>>>=4,$b-=4,g_=(15&Jb)+8,0===Nb.wbits)Nb.wbits=g_;else if(g_>Nb.wbits){Xb.msg='invalid window size',Nb.mode=vp;break}Nb.dmax=1<<g_,Xb.adler=Nb.check=1,Nb.mode=512&Jb?Ju:ep,Jb=0,$b=0;break;case Ou:for(;16>$b;){if(0===Qb)break inf_leave;Qb--,Jb+=Gb[Wb++]<<$b,$b+=8}if(Nb.flags=Jb,(255&Nb.flags)!=qu){Xb.msg='unknown compression method',Nb.mode=vp;break}if(57344&Nb.flags){Xb.msg='unknown header flags set',Nb.mode=vp;break}Nb.head&&(Nb.head.text=1&Jb>>8),512&Nb.flags&&(u_[0]=255&Jb,u_[1]=255&Jb>>>8,Nb.check=Rg(Nb.check,u_,2,0)),Jb=0,$b=0,Nb.mode=Nu;case Nu:for(;32>$b;){if(0===Qb)break inf_leave;Qb--,Jb+=Gb[Wb++]<<$b,$b+=8}Nb.head&&(Nb.head.time=Jb),512&Nb.flags&&(u_[0]=255&Jb,u_[1]=255&Jb>>>8,u_[2]=255&Jb>>>16,u_[3]=255&Jb>>>24,Nb.check=Rg(Nb.check,u_,4,0)),Jb=0,$b=0,Nb.mode=Gu;case Gu:for(;16>$b;){if(0===Qb)break inf_leave;Qb--,Jb+=Gb[Wb++]<<$b,$b+=8}Nb.head&&(Nb.head.xflags=255&Jb,Nb.head.os=Jb>>8),512&Nb.flags&&(u_[0]=255&Jb,u_[1]=255&Jb>>>8,Nb.check=Rg(Nb.check,u_,2,0)),Jb=0,$b=0,Nb.mode=Hu;case Hu:if(1024&Nb.flags){for(;16>$b;){if(0===Qb)break inf_leave;Qb--,Jb+=Gb[Wb++]<<$b,$b+=8}Nb.length=Jb,Nb.head&&(Nb.head.extra_len=Jb),512&Nb.flags&&(u_[0]=255&Jb,u_[1]=255&Jb>>>8,Nb.check=Rg(Nb.check,u_,2,0)),Jb=0,$b=0}else Nb.head&&(Nb.head.extra=null);Nb.mode=Wu;case Wu:if(1024&Nb.flags&&(a_=Nb.length,a_>Qb&&(a_=Qb),a_&&(Nb.head&&(g_=Nb.head.extra_len-Nb.length,!Nb.head.extra&&(Nb.head.extra=Array(Nb.head.extra_len)),Um.arraySet(Nb.head.extra,Gb,Wb,a_,g_)),512&Nb.flags&&(Nb.check=Rg(Nb.check,Gb,a_,Wb)),Qb-=a_,Wb+=a_,Nb.length-=a_),Nb.length))break inf_leave;Nb.length=0,Nb.mode=Zu;case Zu:if(2048&Nb.flags){if(0===Qb)break inf_leave;a_=0;do g_=Gb[Wb+a_++],Nb.head&&g_&&65536>Nb.length&&(Nb.head.name+=_StringfromCharCode(g_));while(g_&&a_<Qb);if(512&Nb.flags&&(Nb.check=Rg(Nb.check,Gb,a_,Wb)),Qb-=a_,Wb+=a_,g_)break inf_leave}else Nb.head&&(Nb.head.name=null);Nb.length=0,Nb.mode=Qu;case Qu:if(4096&Nb.flags){if(0===Qb)break inf_leave;a_=0;do g_=Gb[Wb+a_++],Nb.head&&g_&&65536>Nb.length&&(Nb.head.comment+=_StringfromCharCode(g_));while(g_&&a_<Qb);if(512&Nb.flags&&(Nb.check=Rg(Nb.check,Gb,a_,Wb)),Qb-=a_,Wb+=a_,g_)break inf_leave}else Nb.head&&(Nb.head.comment=null);Nb.mode=Ku;case Ku:if(512&Nb.flags){for(;16>$b;){if(0===Qb)break inf_leave;Qb--,Jb+=Gb[Wb++]<<$b,$b+=8}if(Jb!==(65535&Nb.check)){Xb.msg='header crc mismatch',Nb.mode=vp;break}Jb=0,$b=0}Nb.head&&(Nb.head.hcrc=1&Nb.flags>>9,Nb.head.done=!0),Xb.adler=Nb.check=0,Nb.mode=ep;break;case Ju:for(;32>$b;){if(0===Qb)break inf_leave;Qb--,Jb+=Gb[Wb++]<<$b,$b+=8}Xb.adler=Nb.check=Vo(Jb),Jb=0,$b=0,Nb.mode=$u;case $u:if(0===Nb.havedict)return Xb.next_out=Zb,Xb.avail_out=Kb,Xb.next_in=Wb,Xb.avail_in=Qb,Nb.hold=Jb,Nb.bits=$b,2;Xb.adler=Nb.check=1,Nb.mode=ep;case ep:if(Ob===5||Ob===zu)break inf_leave;case tp:if(Nb.last){Jb>>>=7&$b,$b-=7&$b,Nb.mode=xp;break}for(;3>$b;){if(0===Qb)break inf_leave;Qb--,Jb+=Gb[Wb++]<<$b,$b+=8}switch(Nb.last=1&Jb,Jb>>>=1,$b-=1,3&Jb){case 0:Nb.mode=ap;break;case 1:if(No(Nb),Nb.mode=gp,Ob===zu){Jb>>>=2,$b-=2;break inf_leave}break;case 2:Nb.mode=dp;break;case 3:Xb.msg='invalid block type',Nb.mode=vp;}Jb>>>=2,$b-=2;break;case ap:for(Jb>>>=7&$b,$b-=7&$b;32>$b;){if(0===Qb)break inf_leave;Qb--,Jb+=Gb[Wb++]<<$b,$b+=8}if((65535&Jb)!=(65535^Jb>>>16)){Xb.msg='invalid stored block lengths',Nb.mode=vp;break}if(Nb.length=65535&Jb,Jb=0,$b=0,Nb.mode=np,Ob===zu)break inf_leave;case np:Nb.mode=lp;case lp:if(a_=Nb.length,a_){if(a_>Qb&&(a_=Qb),a_>Kb&&(a_=Kb),0===a_)break inf_leave;Um.arraySet(Hb,Gb,Wb,a_,Zb),Qb-=a_,Wb+=a_,Kb-=a_,Zb+=a_,Nb.length-=a_;break}Nb.mode=ep;break;case dp:for(;14>$b;){if(0===Qb)break inf_leave;Qb--,Jb+=Gb[Wb++]<<$b,$b+=8}if(Nb.nlen=(31&Jb)+257,Jb>>>=5,$b-=5,Nb.ndist=(31&Jb)+1,Jb>>>=5,$b-=5,Nb.ncode=(15&Jb)+4,Jb>>>=4,$b-=4,286<Nb.nlen||30<Nb.ndist){Xb.msg='too many length or distance symbols',Nb.mode=vp;break}Nb.have=0,Nb.mode=hp;case hp:for(;Nb.have<Nb.ncode;){for(;3>$b;){if(0===Qb)break inf_leave;Qb--,Jb+=Gb[Wb++]<<$b,$b+=8}Nb.lens[b_[Nb.have++]]=7&Jb,Jb>>>=3,$b-=3}for(;19>Nb.have;)Nb.lens[b_[Nb.have++]]=0;if(Nb.lencode=Nb.lendyn,Nb.lenbits=7,p_={bits:Nb.lenbits},c_=Iu(0,Nb.lens,0,19,Nb.lencode,0,Nb.work,p_),Nb.lenbits=p_.bits,c_){Xb.msg='invalid code lengths set',Nb.mode=vp;break}Nb.have=0,Nb.mode=mp;case mp:for(;Nb.have<Nb.nlen+Nb.ndist;){for(;;){if(o_=Nb.lencode[Jb&(1<<Nb.lenbits)-1],s_=o_>>>24,r_=255&o_>>>16,l_=65535&o_,s_<=$b)break;if(0===Qb)break inf_leave;Qb--,Jb+=Gb[Wb++]<<$b,$b+=8}if(16>l_)Jb>>>=s_,$b-=s_,Nb.lens[Nb.have++]=l_;else{if(16===l_){for(f_=s_+2;$b<f_;){if(0===Qb)break inf_leave;Qb--,Jb+=Gb[Wb++]<<$b,$b+=8}if(Jb>>>=s_,$b-=s_,0===Nb.have){Xb.msg='invalid bit length repeat',Nb.mode=vp;break}g_=Nb.lens[Nb.have-1],a_=3+(3&Jb),Jb>>>=2,$b-=2}else if(17===l_){for(f_=s_+3;$b<f_;){if(0===Qb)break inf_leave;Qb--,Jb+=Gb[Wb++]<<$b,$b+=8}Jb>>>=s_,$b-=s_,g_=0,a_=3+(7&Jb),Jb>>>=3,$b-=3}else{for(f_=s_+7;$b<f_;){if(0===Qb)break inf_leave;Qb--,Jb+=Gb[Wb++]<<$b,$b+=8}Jb>>>=s_,$b-=s_,g_=0,a_=11+(127&Jb),Jb>>>=7,$b-=7}if(Nb.have+a_>Nb.nlen+Nb.ndist){Xb.msg='invalid bit length repeat',Nb.mode=vp;break}for(;a_--;)Nb.lens[Nb.have++]=g_}}if(Nb.mode===vp)break;if(0===Nb.lens[256]){Xb.msg='invalid code -- missing end-of-block',Nb.mode=vp;break}if(Nb.lenbits=9,p_={bits:Nb.lenbits},c_=Iu(Cu,Nb.lens,0,Nb.nlen,Nb.lencode,0,Nb.work,p_),Nb.lenbits=p_.bits,c_){Xb.msg='invalid literal/lengths set',Nb.mode=vp;break}if(Nb.distbits=6,Nb.distcode=Nb.distdyn,p_={bits:Nb.distbits},c_=Iu(Bu,Nb.lens,Nb.nlen,Nb.ndist,Nb.distcode,0,Nb.work,p_),Nb.distbits=p_.bits,c_){Xb.msg='invalid distances set',Nb.mode=vp;break}if(Nb.mode=gp,Ob===zu)break inf_leave;case gp:Nb.mode=cp;case cp:if(6<=Qb&&258<=Kb){Xb.next_out=Zb,Xb.avail_out=Kb,Xb.next_in=Wb,Xb.avail_in=Qb,Nb.hold=Jb,Nb.bits=$b,bu(Xb,t_),Zb=Xb.next_out,Hb=Xb.output,Kb=Xb.avail_out,Wb=Xb.next_in,Gb=Xb.input,Qb=Xb.avail_in,Jb=Nb.hold,$b=Nb.bits,Nb.mode===ep&&(Nb.back=-1);break}for(Nb.back=0;;){if(o_=Nb.lencode[Jb&(1<<Nb.lenbits)-1],s_=o_>>>24,r_=255&o_>>>16,l_=65535&o_,s_<=$b)break;if(0===Qb)break inf_leave;Qb--,Jb+=Gb[Wb++]<<$b,$b+=8}if(r_&&0==(240&r_)){for(d_=s_,h_=r_,m_=l_;;){if(o_=Nb.lencode[m_+((Jb&(1<<d_+h_)-1)>>d_)],s_=o_>>>24,r_=255&o_>>>16,l_=65535&o_,d_+s_<=$b)break;if(0===Qb)break inf_leave;Qb--,Jb+=Gb[Wb++]<<$b,$b+=8}Jb>>>=d_,$b-=d_,Nb.back+=d_}if(Jb>>>=s_,$b-=s_,Nb.back+=s_,Nb.length=l_,0===r_){Nb.mode=wp;break}if(32&r_){Nb.back=-1,Nb.mode=ep;break}if(64&r_){Xb.msg='invalid literal/length code',Nb.mode=vp;break}Nb.extra=15&r_,Nb.mode=up;case up:if(Nb.extra){for(f_=Nb.extra;$b<f_;){if(0===Qb)break inf_leave;Qb--,Jb+=Gb[Wb++]<<$b,$b+=8}Nb.length+=Jb&(1<<Nb.extra)-1,Jb>>>=Nb.extra,$b-=Nb.extra,Nb.back+=Nb.extra}Nb.was=Nb.length,Nb.mode=fp;case fp:for(;;){if(o_=Nb.distcode[Jb&(1<<Nb.distbits)-1],s_=o_>>>24,r_=255&o_>>>16,l_=65535&o_,s_<=$b)break;if(0===Qb)break inf_leave;Qb--,Jb+=Gb[Wb++]<<$b,$b+=8}if(0==(240&r_)){for(d_=s_,h_=r_,m_=l_;;){if(o_=Nb.distcode[m_+((Jb&(1<<d_+h_)-1)>>d_)],s_=o_>>>24,r_=255&o_>>>16,l_=65535&o_,d_+s_<=$b)break;if(0===Qb)break inf_leave;Qb--,Jb+=Gb[Wb++]<<$b,$b+=8}Jb>>>=d_,$b-=d_,Nb.back+=d_}if(Jb>>>=s_,$b-=s_,Nb.back+=s_,64&r_){Xb.msg='invalid distance code',Nb.mode=vp;break}Nb.offset=l_,Nb.extra=15&r_,Nb.mode=bp;case bp:if(Nb.extra){for(f_=Nb.extra;$b<f_;){if(0===Qb)break inf_leave;Qb--,Jb+=Gb[Wb++]<<$b,$b+=8}Nb.offset+=Jb&(1<<Nb.extra)-1,Jb>>>=Nb.extra,$b-=Nb.extra,Nb.back+=Nb.extra}if(Nb.offset>Nb.dmax){Xb.msg='invalid distance too far back',Nb.mode=vp;break}Nb.mode=_p;case _p:if(0===Kb)break inf_leave;if(a_=t_-Kb,Nb.offset>a_){if(a_=Nb.offset-a_,a_>Nb.whave&&Nb.sane){Xb.msg='invalid distance too far back',Nb.mode=vp;break}a_>Nb.wnext?(a_-=Nb.wnext,i_=Nb.wsize-a_):i_=Nb.wnext-a_,a_>Nb.length&&(a_=Nb.length),n_=Nb.window}else n_=Hb,i_=Zb-Nb.offset,a_=Nb.length;a_>Kb&&(a_=Kb),Kb-=a_,Nb.length-=a_;do Hb[Zb++]=n_[i_++];while(--a_);0===Nb.length&&(Nb.mode=cp);break;case wp:if(0===Kb)break inf_leave;Hb[Zb++]=Nb.length,Kb--,Nb.mode=cp;break;case xp:if(Nb.wrap){for(;32>$b;){if(0===Qb)break inf_leave;Qb--,Jb|=Gb[Wb++]<<$b,$b+=8}if(t_-=Kb,Xb.total_out+=t_,Nb.total+=t_,t_&&(Xb.adler=Nb.check=Nb.flags?Rg(Nb.check,Hb,t_,Zb-t_):Bg(Nb.check,Hb,t_,Zb-t_)),t_=Kb,(Nb.flags?Jb:Vo(Jb))!==Nb.check){Xb.msg='incorrect data check',Nb.mode=vp;break}Jb=0,$b=0}Nb.mode=yp;case yp:if(Nb.wrap&&Nb.flags){for(;32>$b;){if(0===Qb)break inf_leave;Qb--,Jb+=Gb[Wb++]<<$b,$b+=8}if(Jb!==(4294967295&Nb.total)){Xb.msg='incorrect length check',Nb.mode=vp;break}Jb=0,$b=0}Nb.mode=kp;case kp:c_=1;break inf_leave;case vp:c_=Yu;break inf_leave;case Dp:return Fu;case 32:default:return Vu;}return(Xb.next_out=Zb,Xb.avail_out=Kb,Xb.next_in=Wb,Xb.avail_in=Qb,Nb.hold=Jb,Nb.bits=$b,(Nb.wsize||t_!==Xb.avail_out&&Nb.mode<vp&&(Nb.mode<xp||Ob!==Au))&&Go(Xb,Xb.output,Xb.next_out,t_-Xb.avail_out))?(Nb.mode=Dp,Fu):(e_-=Xb.avail_in,t_-=Xb.avail_out,Xb.total_in+=e_,Xb.total_out+=t_,Nb.total+=t_,Nb.wrap&&t_&&(Xb.adler=Nb.check=Nb.flags?Rg(Nb.check,Hb,t_,Xb.next_out-t_):Bg(Nb.check,Hb,t_,Xb.next_out-t_)),Xb.data_type=Nb.bits+(Nb.last?64:0)+(Nb.mode===ep?128:0)+(Nb.mode===gp||Nb.mode===np?256:0),(0===e_&&0===t_||Ob===Au)&&c_===Lu&&(c_=-5),c_)},inflateEnd:function(Xb){if(!Xb||!Xb.state)return Vu;var Ob=Xb.state;return Ob.window&&(Ob.window=null),Xb.state=null,Lu},inflateGetHeader:function(Xb,Ob){var Nb;return Xb&&Xb.state?(Nb=Xb.state,0==(2&Nb.wrap))?Vu:(Nb.head=Ob,Ob.done=!1,Lu):Vu},inflateSetDictionary:function(Xb,Ob){var Nb=Ob.length,Gb,Hb,Wb;return Xb&&Xb.state?(Gb=Xb.state,0!==Gb.wrap&&Gb.mode!==$u)?Vu:Gb.mode===$u&&(Hb=1,Hb=Bg(Hb,Ob,Nb,0),Hb!==Gb.check)?Yu:(Wb=Go(Xb,Ob,Nb,Nb),Wb)?(Gb.mode=Dp,Fu):(Gb.havedict=1,Lu):Vu},inflateInfo:'pako inflate (from Nodeca project)'},Op={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},Np=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name='',this.comment='',this.hcrc=0,this.done=!1},Gp=Object.prototype.toString,Bp,Ap;Jo.prototype.push=function(Xb,Ob){var Nb=this.strm,Gb=this.options.chunkSize,Hb=this.options.dictionary,e_=!1,Wb,Zb,Qb,Kb,Jb,$b;if(this.ended)return!1;Zb=Ob===~~Ob?Ob:!0===Ob?Op.Z_FINISH:Op.Z_NO_FLUSH,Nb.input='string'==typeof Xb?Qc.binstring2buf(Xb):'[object ArrayBuffer]'===Gp.call(Xb)?new Uint8Array(Xb):Xb,Nb.next_in=0,Nb.avail_in=Nb.input.length;do{if(0===Nb.avail_out&&(Nb.output=new Um.Buf8(Gb),Nb.next_out=0,Nb.avail_out=Gb),Wb=Xp.inflate(Nb,Op.Z_NO_FLUSH),Wb===Op.Z_NEED_DICT&&Hb&&($b='string'==typeof Hb?Qc.string2buf(Hb):'[object ArrayBuffer]'===Gp.call(Hb)?new Uint8Array(Hb):Hb,Wb=Xp.inflateSetDictionary(this.strm,$b)),Wb===Op.Z_BUF_ERROR&&!0==e_&&(Wb=Op.Z_OK,e_=!1),Wb!==Op.Z_STREAM_END&&Wb!==Op.Z_OK)return this.onEnd(Wb),this.ended=!0,!1;Nb.next_out&&(0===Nb.avail_out||Wb===Op.Z_STREAM_END||0===Nb.avail_in&&(Zb===Op.Z_FINISH||Zb===Op.Z_SYNC_FLUSH))&&('string'===this.options.to?(Qb=Qc.utf8border(Nb.output,Nb.next_out),Kb=Nb.next_out-Qb,Jb=Qc.buf2string(Nb.output,Qb),Nb.next_out=Kb,Nb.avail_out=Gb-Kb,Kb&&Um.arraySet(Nb.output,Nb.output,Qb,Kb,0),this.onData(Jb)):this.onData(Um.shrinkBuf(Nb.output,Nb.next_out))),0===Nb.avail_in&&0===Nb.avail_out&&(e_=!0)}while((0<Nb.avail_in||0===Nb.avail_out)&&Wb!==Op.Z_STREAM_END);return Wb===Op.Z_STREAM_END&&(Zb=Op.Z_FINISH),Zb===Op.Z_FINISH?(Wb=Xp.inflateEnd(this.strm),this.onEnd(Wb),this.ended=!0,Wb===Op.Z_OK):Zb!==Op.Z_SYNC_FLUSH||(this.onEnd(Op.Z_OK),Nb.avail_out=0,!0)},Jo.prototype.onData=function(Xb){this.chunks.push(Xb)},Jo.prototype.onEnd=function(Xb){Xb===Op.Z_OK&&('string'===this.options.to?this.result=this.chunks.join(''):this.result=Um.flattenChunks(this.chunks)),this.chunks=[],this.err=Xb,this.msg=this.strm.msg};var Jp=Um.assign,$p={};Jp($p,{Deflate:zo,deflate:Lo,deflateRaw:function(Xb,Ob){return Ob=Ob||{},Ob.raw=!0,Lo(Xb,Ob)},gzip:function(Xb,Ob){return Ob=Ob||{},Ob.gzip=!0,Lo(Xb,Ob)}},{Inflate:Jo,inflate:$o,inflateRaw:function(Xb,Ob){return Ob=Ob||{},Ob.raw=!0,$o(Xb,Ob)},ungzip:$o},Op);const tf=$p.Inflate,af=new Uint8Array(0),of=[137,80,78,71,13,10,26,10];var lf=class extends Fm{constructor(Xb){super(Xb),this._decoded=!1,this._inflator=new tf,this._png=null,this._end=!1,this.setBigEndian()}decode(){if(this._decoded)return this._png;for(this._png={tEXt:{}},this.decodeSignature();!this._end;)this.decodeChunk();return this.decodeImage(),this._png}decodeSignature(){for(var Xb=0;8>Xb;Xb++)if(this.readUint8()!==of[Xb])throw new Error(`Wrong PNG signature. Byte at ${Xb} should be ${of[Xb]}.`)}decodeChunk(){var Xb=this.readUint32(),Ob=this.readChars(4),Nb=this.offset;if('IHDR'===Ob?this.decodeIHDR():'PLTE'===Ob?this.decodePLTE(Xb):'IDAT'===Ob?this.decodeIDAT(Xb):'tEXt'===Ob?this.decodetEXt(Xb):'IEND'===Ob?this._end=!0:this.skip(Xb),this.offset-Nb!==Xb)throw new Error('Length mismatch while decoding chunk '+Ob);this.readUint32()}decodeIHDR(){var Xb=this._png;if(Xb.width=this.readUint32(),Xb.height=this.readUint32(),Xb.bitDepth=this.readUint8(),Xb.colourType=this.readUint8(),Xb.compressionMethod=this.readUint8(),Xb.filterMethod=this.readUint8(),Xb.interlaceMethod=this.readUint8(),0!==this._png.compressionMethod)throw new Error('Unsupported compression method: '+Xb.compressionMethod)}decodePLTE(Xb){if(0!=Xb%3)throw new RangeError('PLTE field length must be a multiple of 3. Got '+Xb);var Ob=Xb/3;this._hasPalette=!0;for(var Nb=this._palette=Array(Ob),Gb=0;Gb<Ob;Gb++)Nb[Gb]=[this.readUint8(),this.readUint8(),this.readUint8()]}decodeIDAT(Xb){this._inflator.push(new Uint8Array(this.buffer,this.offset,Xb)),this.skip(Xb)}decodetEXt(Xb){for(var Ob='',Nb;(Nb=this.readChar())!=='\0';)Ob+=Nb;this._png.tEXt[Ob]=this.readChars(Xb-Ob.length-1)}decodeImage(){if(this._inflator.push(af,!0),this._inflator.err)throw new Error('Error while decompressing the data');var Xb=this._inflator.result;if(this._inflator=null,0!==this._png.filterMethod)throw new Error('Filter method '+this._png.filterMethod+' not supported');if(0===this._png.interlaceMethod)this.decodeInterlaceNull(Xb);else throw new Error('Interlace method '+this._png.interlaceMethod+' not supported')}decodeInterlaceNull(Xb){var Ob;switch(this._png.colourType){case 0:Ob=1;break;case 2:Ob=3;break;case 3:if(!this._hasPalette)throw new Error('Missing palette');Ob=1;break;case 4:Ob=2;break;case 6:Ob=4;break;default:throw new Error('Unknown colour type: '+this._png.colourType);}const Nb=this._png.height,Gb=Ob*this._png.bitDepth/8,Hb=this._png.width*Gb,Wb=new Uint8Array(this._png.height*Hb);for(var Zb=af,Qb=0,$b=0,Kb,Jb;$b<Nb;$b++){switch(Kb=Xb.subarray(Qb+1,Qb+1+Hb),Jb=Wb.subarray($b*Hb,($b+1)*Hb),Xb[Qb]){case 0:ts(Kb,Jb,Hb);break;case 1:as(Kb,Jb,Hb,Gb);break;case 2:is(Kb,Jb,Zb,Hb);break;case 3:ns(Kb,Jb,Zb,Hb,Gb);break;case 4:os(Kb,Jb,Zb,Hb,Gb);break;default:throw new Error('Unsupported filter: '+Xb[Qb]);}Zb=Jb,Qb+=Hb+1}this._hasPalette&&(this._png.palette=this._palette),this._png.data=Wb}};const df={254:'NewSubfileType',255:'SubfileType',256:'ImageWidth',257:'ImageLength',258:'BitsPerSample',259:'Compression',262:'PhotometricInterpretation',263:'Threshholding',264:'CellWidth',265:'CellLength',266:'FillOrder',269:'DocumentName',270:'ImageDescription',271:'Make',272:'Model',273:'StripOffsets',274:'Orientation',277:'SamplesPerPixel',278:'RowsPerStrip',279:'StripByteCounts',280:'MinSampleValue',281:'MaxSampleValue',282:'XResolution',283:'YResolution',284:'PlanarConfiguration',285:'PageName',286:'XPosition',287:'YPosition',288:'FreeOffsets',289:'FreeByteCounts',290:'GrayResponseUnit',291:'GrayResponseCurve',292:'T4Options',293:'T6Options',296:'ResolutionUnit',297:'PageNumber',301:'TransferFunction',305:'Software',306:'DateTime',315:'Artist',316:'HostComputer',317:'Predictor',318:'WhitePoint',319:'PrimaryChromaticities',320:'ColorMap',321:'HalftoneHints',322:'TileWidth',323:'TileLength',324:'TileOffsets',325:'TileByteCounts',326:'BadFaxLines',327:'CleanFaxData',328:'ConsecutiveBadFaxLines',330:'SubIFDs',332:'InkSet',333:'InkNames',334:'NumberOfInks',336:'DotRange',337:'TargetPrinter',338:'ExtraSamples',339:'SampleFormat',340:'SMinSampleValue',341:'SMaxSampleValue',342:'TransferRange',343:'ClipPath',344:'XClipPathUnits',345:'YClipPathUnits',346:'Indexed',347:'JPEGTables',351:'OPIProxy',400:'GlobalParametersIFD',401:'ProfileType',402:'FaxProfile',403:'CodingMethods',404:'VersionYear',405:'ModeNumber',433:'Decode',434:'DefaultImageColor',512:'JPEGProc',513:'JPEGInterchangeFormat',514:'JPEGInterchangeFormatLength',515:'JPEGRestartInterval',517:'JPEGLosslessPredictors',518:'JPEGPointTransforms',519:'JPEGQTables',520:'JPEGDCTables',521:'JPEGACTables',529:'YCbCrCoefficients',530:'YCbCrSubSampling',531:'YCbCrPositioning',532:'ReferenceBlackWhite',559:'StripRowCounts',700:'XMP',32781:'ImageID',32932:'WangAnnotatio',33432:'Copyright',33445:'MDFileTag',33446:'MDScalePixel',33447:'MDColorTable',33448:'MDLabName',33449:'MDSampleInfo',33450:'MDPrepDate',33451:'MDPrepTime',33452:'MDFileUnits',33550:'ModelPixelScaleTag',33723:'IPTC',33918:'INGRPacketDataTag',33919:'INGRFlagRegisters',33920:'IrasBTransformationMatrix',33922:'ModelTiepointTag',34264:'ModelTransformationTag',34377:'Photoshop',34665:'ExifIFD',34675:'ICCProfile',34732:'ImageLayer',34735:'GeoKeyDirectoryTag',34736:'GeoDoubleParamsTag',34737:'GeoAsciiParamsTag',34853:'GPSIFD',34908:'HylaFAXFaxRecvParams',34909:'HylaFAXFaxSubAddress',34910:'HylaFAXFaxRecvTime',37724:'ImageSourceData',40965:'InteroperabilityIFD',42112:'GDAL_METADATA',42113:'GDAL_NODATA',50215:'OceScanjobDescription',50216:'OceApplicationSelector',50217:'OceIdentificationNumber',50218:'OceImageLogicCharacteristics',50706:'DNGVersion',50707:'DNGBackwardVersion',50708:'UniqueCameraModel',50709:'LocalizedCameraModel',50710:'CFAPlaneColor',50711:'CFALayout',50712:'LinearizationTable',50713:'BlackLevelRepeatDim',50714:'BlackLevel',50715:'BlackLevelDeltaH',50716:'BlackLevelDeltaV',50717:'WhiteLevel',50718:'DefaultScale',50719:'DefaultCropOrigin',50720:'DefaultCropSize',50721:'ColorMatrix1',50722:'ColorMatrix2',50723:'CameraCalibration1',50724:'CameraCalibration2',50725:'ReductionMatrix1',50726:'ReductionMatrix2',50727:'AnalogBalance',50728:'AsShotNeutral',50729:'AsShotWhiteXY',50730:'BaselineExposure',50731:'BaselineNoise',50732:'BaselineSharpness',50733:'BayerGreenSplit',50734:'LinearResponseLimit',50735:'CameraSerialNumber',50736:'LensInfo',50737:'ChromaBlurRadius',50738:'AntiAliasStrength',50740:'DNGPrivateData',50741:'MakerNoteSafety',50778:'CalibrationIlluminant1',50779:'CalibrationIlluminant2',50780:'BestQualityScale',50784:'AliasLayerMetadata'},hf={};for(var mf in df)hf[df[mf]]=mf;const cf={33434:'ExposureTime',33437:'FNumber',34850:'ExposureProgram',34852:'SpectralSensitivity',34855:'ISOSpeedRatings',34856:'OECF',34864:'SensitivityType',34865:'StandardOutputSensitivity',34866:'RecommendedExposureIndex',34867:'ISOSpeed',34868:'ISOSpeedLatitudeyyy',34869:'ISOSpeedLatitudezzz',36864:'ExifVersion',36867:'DateTimeOriginal',36868:'DateTimeDigitized',37121:'ComponentsConfiguration',37122:'CompressedBitsPerPixel',37377:'ShutterSpeedValue',37378:'ApertureValue',37379:'BrightnessValue',37380:'ExposureBiasValue',37381:'MaxApertureValue',37382:'SubjectDistance',37383:'MeteringMode',37384:'LightSource',37385:'Flash',37386:'FocalLength',37396:'SubjectArea',37500:'MakerNote',37510:'UserComment',37520:'SubsecTime',37521:'SubsecTimeOriginal',37522:'SubsecTimeDigitized',40960:'FlashpixVersion',40961:'ColorSpace',40962:'PixelXDimension',40963:'PixelYDimension',40964:'RelatedSoundFile',41483:'FlashEnergy',41484:'SpatialFrequencyResponse',41486:'FocalPlaneXResolution',41487:'FocalPlaneYResolution',41488:'FocalPlaneResolutionUnit',41492:'SubjectLocation',41493:'ExposureIndex',41495:'SensingMethod',41728:'FileSource',41729:'SceneType',41730:'CFAPattern',41985:'CustomRendered',41986:'ExposureMode',41987:'WhiteBalance',41988:'DigitalZoomRatio',41989:'FocalLengthIn35mmFilm',41990:'SceneCaptureType',41991:'GainControl',41992:'Contrast',41993:'Saturation',41994:'Sharpness',41995:'DeviceSettingDescription',41996:'SubjectDistanceRange',42016:'ImageUniqueID',42032:'CameraOwnerName',42033:'BodySerialNumber',42034:'LensSpecification',42035:'LensMake',42036:'LensModel',42037:'LensSerialNumber',42240:'Gamma'},uf={};for(var pf in cf)uf[cf[pf]]=pf;const bf={0:'GPSVersionID',1:'GPSLatitudeRef',2:'GPSLatitude',3:'GPSLongitudeRef',4:'GPSLongitude',5:'GPSAltitudeRef',6:'GPSAltitude',7:'GPSTimeStamp',8:'GPSSatellites',9:'GPSStatus',10:'GPSMeasureMode',11:'GPSDOP',12:'GPSSpeedRef',13:'GPSSpeed',14:'GPSTrackRef',15:'GPSTrack',16:'GPSImgDirectionRef',17:'GPSImgDirection',18:'GPSMapDatum',19:'GPSDestLatitudeRef',20:'GPSDestLatitude',21:'GPSDestLongitudeRef',22:'GPSDestLongitude',23:'GPSDestBearingRef',24:'GPSDestBearing',25:'GPSDestDistanceRef',26:'GPSDestDistance',27:'GPSProcessingMethod',28:'GPSAreaInformation',29:'GPSDateStamp',30:'GPSDifferential',31:'GPSHPositioningError'},_f={};for(var wf in bf)_f[bf[wf]]=wf;const yf={standard:{tagsById:df,tagsByName:hf},exif:{tagsById:cf,tagsByName:uf},gps:{tagsById:bf,tagsByName:_f}};class kf{constructor(Xb){if(!Xb)throw new Error('missing kind');this.data=null,this.fields=new Map,this.kind=Xb,this._map=null}get(Xb){if('number'==typeof Xb)return this.fields.get(Xb);if('string'==typeof Xb)return this.fields.get(yf[this.kind].tagsByName[Xb]);throw new Error('expected a number or string')}get map(){if(!this._map){this._map={};const Ob=yf[this.kind].tagsById;for(var Xb of this.fields.keys())Ob[Xb]&&(this._map[Ob[Xb]]=this.fields.get(Xb))}return this._map}}var vf=kf;const Df=/^(\d{4}):(\d{2}):(\d{2}) (\d{2}):(\d{2}):(\d{2})$/;class jf extends vf{constructor(){super('standard')}get size(){return this.width*this.height}get width(){return this.imageWidth}get height(){return this.imageLength}get components(){return this.samplesPerPixel}get date(){var Xb=new Date,Ob=Df.exec(this.dateTime);return Xb.setFullYear(Ob[1],Ob[2]-1,Ob[3]),Xb.setHours(Ob[4],Ob[5],Ob[6]),Xb}get newSubfileType(){return this.get(254)}get imageWidth(){return this.get(256)}get imageLength(){return this.get(257)}get bitsPerSample(){return this.get(258)}get compression(){return this.get(259)||1}get type(){return this.get(262)}get fillOrder(){return this.get(266)||1}get documentName(){return this.get(269)}get imageDescription(){return this.get(270)}get stripOffsets(){return rs(this.get(273))}get orientation(){return this.get(274)}get samplesPerPixel(){return this.get(277)}get rowsPerStrip(){return this.get(278)}get stripByteCounts(){return rs(this.get(279))}get minSampleValue(){return this.get(280)||0}get maxSampleValue(){return this.get(281)||_Mathpow(2,this.bitsPerSample)-1}get xResolution(){return this.get(282)}get yResolution(){return this.get(283)}get planarConfiguration(){return this.get(284)||1}get resolutionUnit(){return this.get(296)||2}get dateTime(){return this.get(306)}get predictor(){return this.get(317)||1}get sampleFormat(){return this.get(339)||1}get sMinSampleValue(){return this.get(340)||this.minSampleValue}get sMaxSampleValue(){return this.get(341)||this.maxSampleValue}}var Sf=new Map([[1,[1,ls]],[2,[1,function(Xb,Ob){for(var Nb=[],Gb='',Hb=0,Wb;Hb<Ob;Hb++)Wb=_StringfromCharCode(Xb.readUint8()),'\0'===Wb?(Nb.push(Gb),Gb=''):Gb+=Wb;return 1===Nb.length?Nb[0]:Nb}]],[3,[2,function(Xb,Ob){if(1===Ob)return Xb.readUint16();for(var Nb=new Uint16Array(Ob),Gb=0;Gb<Ob;Gb++)Nb[Gb]=Xb.readUint16();return Nb}]],[4,[4,function(Xb,Ob){if(1===Ob)return Xb.readUint32();for(var Nb=new Uint32Array(Ob),Gb=0;Gb<Ob;Gb++)Nb[Gb]=Xb.readUint32();return Nb}]],[5,[8,function(Xb,Ob){if(1===Ob)return Xb.readUint32()/Xb.readUint32();for(var Nb=Array(Ob),Gb=0;Gb<Ob;Gb++)Nb[Gb]=Xb.readUint32()/Xb.readUint32();return Nb}]],[6,[1,function(Xb,Ob){if(1===Ob)return Xb.readInt8();for(var Nb=new Int8Array(Ob),Gb=0;Gb<Ob;Gb++)Nb[Gb]=Xb.readInt8();return Nb}]],[7,[1,ls]],[8,[2,function(Xb,Ob){if(1===Ob)return Xb.readInt16();for(var Nb=new Int16Array(Ob),Gb=0;Gb<Ob;Gb++)Nb[Gb]=Xb.readInt16();return Nb}]],[9,[4,function(Xb,Ob){if(1===Ob)return Xb.readInt32();for(var Nb=new Int32Array(Ob),Gb=0;Gb<Ob;Gb++)Nb[Gb]=Xb.readInt32();return Nb}]],[10,[8,function(Xb,Ob){if(1===Ob)return Xb.readInt32()/Xb.readInt32();for(var Nb=Array(Ob),Gb=0;Gb<Ob;Gb++)Nb[Gb]=Xb.readInt32()/Xb.readInt32();return Nb}]],[11,[4,function(Xb,Ob){if(1===Ob)return Xb.readFloat32();for(var Nb=new Float32Array(Ob),Gb=0;Gb<Ob;Gb++)Nb[Gb]=Xb.readFloat32();return Nb}]],[12,[8,function(Xb,Ob){if(1===Ob)return Xb.readFloat64();for(var Nb=new Float64Array(Ob),Gb=0;Gb<Ob;Gb++)Nb[Gb]=Xb.readFloat64();return Nb}]]]),Cf={getByteLength:function(Xb,Ob){return Sf.get(Xb)[0]*Ob},readData:function(Xb,Ob,Nb){return Sf.get(Ob)[1](Xb,Nb)}};const Bf={ignoreImageData:!1,onlyFirst:!1};var Rf=class extends Fm{constructor(Xb,Ob){super(Xb,Ob),this._nextIFD=0}decode(Xb){Xb=Object.assign({},Bf,Xb);const Ob=[];for(this.decodeHeader();this._nextIFD;)if(Ob.push(this.decodeIFD(Xb)),Xb.onlyFirst)return Ob[0];return Ob}decodeHeader(){let Xb=this.readUint16();if(18761===Xb)this.setLittleEndian();else if(19789===Xb)this.setBigEndian();else throw new Error('invalid byte order: 0x'+Xb.toString(16));if(Xb=this.readUint16(),42!==Xb)throw new Error('not a TIFF file');this._nextIFD=this.readUint32()}decodeIFD(Xb){this.seek(this._nextIFD);var Ob=Xb.kind?new vf(Xb.kind):new jf;const Nb=this.readUint16();for(var Gb=0;Gb<Nb;Gb++)this.decodeIFDEntry(Ob);return Xb.ignoreImageData||this.decodeImageData(Ob),this._nextIFD=this.readUint32(),Ob}decodeIFDEntry(Xb){const Ob=this.offset,Nb=this.readUint16(),Gb=this.readUint16(),Hb=this.readUint32();if(1>Gb||12<Gb)return void this.skip(4);const Wb=Cf.getByteLength(Gb,Hb);4<Wb&&this.seek(this.readUint32());const Zb=Cf.readData(this,Gb,Hb);if(Xb.fields.set(Nb,Zb),34665===Nb||34853===Nb){let Qb=this.offset,Kb;34665===Nb?Kb='exif':34853===Nb&&(Kb='gps'),this._nextIFD=Zb,Xb[Kb]=this.decodeIFD({kind:Kb,ignoreImageData:!0}),this.offset=Qb}this.seek(Ob),this.skip(12)}decodeImageData(Xb){const Ob=Xb.orientation;switch(Ob&&1!==Ob&&Ms('orientation',Ob),Xb.type){case 1:case 2:this.readStripData(Xb);break;default:Ms('image type',Xb.type);}}readStripData(Xb){const Ob=Xb.width,Nb=Xb.height,Gb=Ss(Xb.bitsPerSample),Hb=Xb.sampleFormat;let Wb=Ob*Nb;const Zb=ys(Wb,1,Gb,Hb),Qb=Xb.compression,Kb=Xb.rowsPerStrip,Jb=Kb*Ob,$b=Xb.stripOffsets,e_=Xb.stripByteCounts;for(var t_=0,a_=0;a_<$b.length;a_++){var i_=this.getStripData(Qb,$b[a_],e_[a_]),n_=Wb>Jb?Jb:Wb;Wb-=n_,8===Gb?t_=vs(Zb,i_,t_,n_):16===Gb?t_=Ds(Zb,i_,t_,n_,this.isLittleEndian()):32===Gb&&3===Hb?t_=js(Zb,i_,t_,n_,this.isLittleEndian()):Ms('bitDepth',Gb)}Xb.data=Zb}getStripData(Xb,Ob,Nb){switch(Xb){case 1:return new DataView(this.buffer,Ob,Nb);case 2:case 32773:return Ms('Compression',Xb);default:throw new Error('invalid compression: '+Xb);}}},Lf=function(Ob,Nb){const Gb=new Rf(Ob,Nb);return Gb.decode(Nb)},Ef={decode:Lf},Vf=function(Xb){const Ob=new Fm(Xb),Nb={};Ob.setBigEndian();const Gb=Ob.readUint16();if(65496!==Gb)throw new Error('SOI marker not found. Not a valid JPEG file');const Hb=Ob.readUint16();if(65505===Hb){const Wb=Ob.readUint16(),Zb=Ob.readBytes(6);if(69===Zb[0]&&120===Zb[1]&&105===Zb[2]&&102===Zb[3]&&0===Zb[4]&&0===Zb[5]){const Qb=Ef.decode(Ob,{onlyFirst:!0,ignoreImageData:!0,offset:Ob.offset});Nb.exif=Qb}}return Nb},Yf=(Xb)=>{const Ob=new Uint8Array(Xb);if(!(Ob&&1<Ob.length))return null;const Nb=(Gb,Hb)=>{Hb=Object.assign({offset:0},Hb);for(let Wb=0;Wb<Gb.length;Wb++)if(Gb[Wb]!==Ob[Wb+Hb.offset])return!1;return!0};if(Nb([255,216,255]))return{ext:'jpg',mime:'image/jpeg'};if(Nb([137,80,78,71,13,10,26,10]))return{ext:'png',mime:'image/png'};if(Nb([71,73,70]))return{ext:'gif',mime:'image/gif'};if(Nb([87,69,66,80],{offset:8}))return{ext:'webp',mime:'image/webp'};if(Nb([70,76,73,70]))return{ext:'flif',mime:'image/flif'};if((Nb([73,73,42,0])||Nb([77,77,0,42]))&&Nb([67,82],{offset:8}))return{ext:'cr2',mime:'image/x-canon-cr2'};if(Nb([73,73,42,0])||Nb([77,77,0,42]))return{ext:'tif',mime:'image/tiff'};if(Nb([66,77]))return{ext:'bmp',mime:'image/bmp'};if(Nb([73,73,188]))return{ext:'jxr',mime:'image/vnd.ms-photo'};if(Nb([56,66,80,83]))return{ext:'psd',mime:'image/vnd.adobe.photoshop'};if(Nb([80,75,3,4])&&Nb([109,105,109,101,116,121,112,101,97,112,112,108,105,99,97,116,105,111,110,47,101,112,117,98,43,122,105,112],{offset:30}))return{ext:'epub',mime:'application/epub+zip'};if(Nb([80,75,3,4])&&Nb([77,69,84,65,45,73,78,70,47,109,111,122,105,108,108,97,46,114,115,97],{offset:30}))return{ext:'xpi',mime:'application/x-xpinstall'};if(Nb([80,75])&&(3===Ob[2]||5===Ob[2]||7===Ob[2])&&(4===Ob[3]||6===Ob[3]||8===Ob[3]))return{ext:'zip',mime:'application/zip'};if(Nb([117,115,116,97,114],{offset:257}))return{ext:'tar',mime:'application/x-tar'};if(Nb([82,97,114,33,26,7])&&(0===Ob[6]||1===Ob[6]))return{ext:'rar',mime:'application/x-rar-compressed'};if(Nb([31,139,8]))return{ext:'gz',mime:'application/gzip'};if(Nb([66,90,104]))return{ext:'bz2',mime:'application/x-bzip2'};if(Nb([55,122,188,175,39,28]))return{ext:'7z',mime:'application/x-7z-compressed'};if(Nb([120,1]))return{ext:'dmg',mime:'application/x-apple-diskimage'};if(Nb([0,0,0])&&(24===Ob[3]||32===Ob[3])&&Nb([102,116,121,112],{offset:4})||Nb([51,103,112,53])||Nb([0,0,0,28,102,116,121,112,109,112,52,50])&&Nb([109,112,52,49,109,112,52,50,105,115,111,109],{offset:16})||Nb([0,0,0,28,102,116,121,112,105,115,111,109])||Nb([0,0,0,28,102,116,121,112,109,112,52,50,0,0,0,0]))return{ext:'mp4',mime:'video/mp4'};if(Nb([0,0,0,28,102,116,121,112,77,52,86]))return{ext:'m4v',mime:'video/x-m4v'};if(Nb([77,84,104,100]))return{ext:'mid',mime:'audio/midi'};if(Nb([26,69,223,163])){const Gb=Ob.subarray(4,4100),Hb=Gb.findIndex((Wb,Zb,Qb)=>66===Qb[Zb]&&130===Qb[Zb+1]);if(0<=Hb){const Zb=(Qb)=>Array.from(Qb).every((Kb,Jb)=>Gb[Hb+3+Jb]===Kb.charCodeAt(0));if(Zb('matroska'))return{ext:'mkv',mime:'video/x-matroska'};if(Zb('webm'))return{ext:'webm',mime:'video/webm'}}}return Nb([0,0,0,20,102,116,121,112,113,116,32,32])||Nb([102,114,101,101],{offset:4})||Nb([102,116,121,112,113,116,32,32],{offset:4})||Nb([109,100,97,116],{offset:4})||Nb([119,105,100,101],{offset:4})?{ext:'mov',mime:'video/quicktime'}:Nb([82,73,70,70])&&Nb([65,86,73],{offset:8})?{ext:'avi',mime:'video/x-msvideo'}:Nb([48,38,178,117,142,102,207,17,166,217])?{ext:'wmv',mime:'video/x-ms-wmv'}:Nb([0,0,1,186])?{ext:'mpg',mime:'video/mpeg'}:Nb([73,68,51])||Nb([255,251])?{ext:'mp3',mime:'audio/mpeg'}:Nb([102,116,121,112,77,52,65],{offset:4})||Nb([77,52,65,32])?{ext:'m4a',mime:'audio/m4a'}:Nb([79,112,117,115,72,101,97,100],{offset:28})?{ext:'opus',mime:'audio/opus'}:Nb([79,103,103,83])?{ext:'ogg',mime:'audio/ogg'}:Nb([102,76,97,67])?{ext:'flac',mime:'audio/x-flac'}:Nb([82,73,70,70])&&Nb([87,65,86,69],{offset:8})?{ext:'wav',mime:'audio/x-wav'}:Nb([35,33,65,77,82,10])?{ext:'amr',mime:'audio/amr'}:Nb([37,80,68,70])?{ext:'pdf',mime:'application/pdf'}:Nb([77,90])?{ext:'exe',mime:'application/x-msdownload'}:(67===Ob[0]||70===Ob[0])&&Nb([87,83],{offset:1})?{ext:'swf',mime:'application/x-shockwave-flash'}:Nb([123,92,114,116,102])?{ext:'rtf',mime:'application/rtf'}:Nb([0,97,115,109])?{ext:'wasm',mime:'application/wasm'}:Nb([119,79,70,70])&&(Nb([0,1,0,0],{offset:4})||Nb([79,84,84,79],{offset:4}))?{ext:'woff',mime:'application/font-woff'}:Nb([119,79,70,50])&&(Nb([0,1,0,0],{offset:4})||Nb([79,84,84,79],{offset:4}))?{ext:'woff2',mime:'application/font-woff'}:Nb([76,80],{offset:34})&&(Nb([0,0,1],{offset:8})||Nb([1,0,2],{offset:8})||Nb([2,0,2],{offset:8}))?{ext:'eot',mime:'application/octet-stream'}:Nb([0,1,0,0,0])?{ext:'ttf',mime:'application/font-sfnt'}:Nb([79,84,84,79,0])?{ext:'otf',mime:'application/font-sfnt'}:Nb([0,0,1,0])?{ext:'ico',mime:'image/x-icon'}:Nb([70,76,86,1])?{ext:'flv',mime:'video/x-flv'}:Nb([37,33])?{ext:'ps',mime:'application/postscript'}:Nb([253,55,122,88,90,0])?{ext:'xz',mime:'application/x-xz'}:Nb([83,81,76,105])?{ext:'sqlite',mime:'application/x-sqlite3'}:Nb([78,69,83,26])?{ext:'nes',mime:'application/x-nintendo-nes-rom'}:Nb([67,114,50,52])?{ext:'crx',mime:'application/x-google-chrome-extension'}:Nb([77,83,67,70])||Nb([73,83,99,40])?{ext:'cab',mime:'application/vnd.ms-cab-compressed'}:Nb([33,60,97,114,99,104,62,10,100,101,98,105,97,110,45,98,105,110,97,114,121])?{ext:'deb',mime:'application/x-deb'}:Nb([33,60,97,114,99,104,62])?{ext:'ar',mime:'application/x-unix-archive'}:Nb([237,171,238,219])?{ext:'rpm',mime:'application/x-rpm'}:Nb([31,160])||Nb([31,157])?{ext:'Z',mime:'application/x-compress'}:Nb([76,90,73,80])?{ext:'lz',mime:'application/x-lzip'}:Nb([208,207,17,224,161,177,26,225])?{ext:'msi',mime:'application/x-msi'}:Nb([6,14,43,52,2,5,1,1,13,1,2,1,1,2])?{ext:'mxf',mime:'application/mxf'}:null};const Ff=new Set(['jpg','png','gif','webp','tif','bmp','jxr','psd']);for(var Uf=(Xb)=>{const Ob=Yf(Xb);return Ff.has(Ob&&Ob.ext)?Ob:null},qf='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/',Xf=new Uint8Array(256),Of=0;Of<qf.length;Of++)Xf[qf.charCodeAt(Of)]=Of;var Nf=/^data:[a-z]+\/([a-z]+);base64,/,Gf=al.BlobBuilder||al.WebKitBlobBuilder||al.MSBlobBuilder||al.MozBlobBuilder,Hf=function(){try{var Xb=new Blob(['hi']);return 2===Xb.size}catch(Ob){return!1}}(),Wf=Hf&&function(){try{var Xb=new Blob([new Uint8Array([1,2])]);return 2===Xb.size}catch(Ob){return!1}}(),Zf=Gf&&Gf.prototype.append&&Gf.prototype.getBlob,Qf=function(){return Hf?Wf?al.Blob:Xs:Zf?qs:void 0}(),Kf=al.MutationObserver||al.WebKitMutationObserver,Jf;if(Kf){var $f=0,eb=new Kf(Os),tb=al.document.createTextNode('');eb.observe(tb,{characterData:!0}),Jf=function(){tb.data=$f=++$f%2}}else if(!al.setImmediate&&'undefined'!=typeof al.MessageChannel){var ab=new al.MessageChannel;ab.port1.onmessage=Os,Jf=function(){ab.port2.postMessage(0)}}else Jf='document'in al&&'onreadystatechange'in al.document.createElement('script')?function(){var Xb=al.document.createElement('script');Xb.onreadystatechange=function(){Os(),Xb.onreadystatechange=null,Xb.parentNode.removeChild(Xb),Xb=null},al.document.documentElement.appendChild(Xb)}:function(){setTimeout(Os,0)};var nb=[],ob=function(Xb){1!==nb.push(Xb)||ib||Jf()},sb={},rb=['REJECTED'],lb=['FULFILLED'],db=['PENDING'],ib;Hs.prototype['catch']=function(Xb){return this.then(null,Xb)},Hs.prototype.then=function(Xb,Ob){if('function'!=typeof Xb&&this.state===lb||'function'!=typeof Ob&&this.state===rb)return this;var Nb=new this.constructor(Gs);if(this.state!==db){var Gb=this.state===lb?Xb:Ob;Zs(Nb,Gb,this.outcome)}else this.queue.push(new Ws(Nb,Xb,Ob));return Nb},Ws.prototype.callFulfilled=function(Xb){sb.resolve(this.promise,Xb)},Ws.prototype.otherCallFulfilled=function(Xb){Zs(this.promise,this.onFulfilled,Xb)},Ws.prototype.callRejected=function(Xb){sb.reject(this.promise,Xb)},Ws.prototype.otherCallRejected=function(Xb){Zs(this.promise,this.onRejected,Xb)},sb.resolve=function(Xb,Ob){var Nb=Js(Qs,Ob);if('error'===Nb.status)return sb.reject(Xb,Nb.value);var Gb=Nb.value;if(Gb)Ks(Xb,Gb);else{Xb.state=lb,Xb.outcome=Ob;for(var Hb=-1,Wb=Xb.queue.length;++Hb<Wb;)Xb.queue[Hb].callFulfilled(Ob)}return Xb},sb.reject=function(Xb,Ob){Xb.state=rb,Xb.outcome=Ob;for(var Nb=-1,Gb=Xb.queue.length;++Nb<Gb;)Xb.queue[Nb].callRejected(Ob);return Xb},Hs.resolve=function(Xb){return Xb instanceof this?Xb:sb.resolve(new this(Gs),Xb)},Hs.reject=function(Xb){var Ob=new this(Gs);return sb.reject(Ob,Xb)},Hs.all=function(Xb){function Ob(Jb,$b){Nb.resolve(Jb).then(function(t_){Wb[$b]=t_,++Zb!==Gb||Hb||(Hb=!0,sb.resolve(Kb,Wb))},function(t_){Hb||(Hb=!0,sb.reject(Kb,t_))})}var Nb=this;if('[object Array]'!==Object.prototype.toString.call(Xb))return this.reject(new TypeError('must be an array'));var Gb=Xb.length,Hb=!1;if(!Gb)return this.resolve([]);for(var Wb=Array(Gb),Zb=0,Qb=-1,Kb=new this(Gs);++Qb<Gb;)Ob(Xb[Qb],Qb);return Kb},Hs.race=function(Xb){function Ob(Qb){Nb.resolve(Qb).then(function(Kb){Hb||(Hb=!0,sb.resolve(Zb,Kb))},function(Kb){Hb||(Hb=!0,sb.reject(Zb,Kb))})}var Nb=this;if('[object Array]'!==Object.prototype.toString.call(Xb))return this.reject(new TypeError('must be an array'));var Gb=Xb.length,Hb=!1;if(!Gb)return this.resolve([]);for(var Wb=-1,Zb=new this(Gs);++Wb<Gb;)Ob(Xb[Wb]);return Zb};var mb='function'==typeof Promise?Promise:Hs,ub={createBlob:lr,createObjectURL:function(Xb){return(window.URL||window.webkitURL).createObjectURL(Xb)},revokeObjectURL:function(Xb){return(window.URL||window.webkitURL).revokeObjectURL(Xb)},imgSrcToBlob:function(Xb,Ob,Nb,Gb){return Ob=Ob||'image/png',sr(Xb,Nb).then(function(Hb){return rr(Hb)}).then(function(Hb){return br(Hb,Ob,Gb)})},imgSrcToDataURL:function(Xb,Ob,Nb,Gb){return Ob=Ob||'image/png',sr(Xb,Nb).then(function(Hb){return rr(Hb)}).then(function(Hb){return Hb.toDataURL(Ob,Gb)})},canvasToBlob:br,dataURLToBlob:pr,blobToBase64String:function(Xb){return mr(Xb).then(function(Ob){return btoa(Ob)})},base64StringToBlob:gr,binaryStringToBlob:function(Xb,Ob){return mb.resolve().then(function(){return gr(btoa(Xb),Ob)})},blobToBinaryString:mr,arrayBufferToBlob:function(Xb,Ob){return mb.resolve().then(function(){return lr([Xb],Ob)})},blobToArrayBuffer:function(Xb){return new mb(function(Ob,Nb){var Gb=new FileReader;Gb.onloadend=function(Hb){var Wb=Hb.target.result||new ArrayBuffer(0);Ob(Wb)},Gb.onerror=Nb,Gb.readAsArrayBuffer(Xb)})}}.canvasToBlob,fb=ce(function(Xb,Ob){(function(Nb){function Gb(g_){for(var c_=[],u_=0,p_=g_.length,f_,b_;u_<p_;)f_=g_.charCodeAt(u_++),55296<=f_&&56319>=f_&&u_<p_?(b_=g_.charCodeAt(u_++),56320==(64512&b_)?c_.push(((1023&f_)<<10)+(1023&b_)+65536):(c_.push(f_),u_--)):c_.push(f_);return c_}function Hb(g_){for(var c_=g_.length,u_=-1,f_='',p_;++u_<c_;)p_=g_[u_],65535<p_&&(p_-=65536,f_+=n_(55296|1023&p_>>>10),p_=56320|1023&p_),f_+=n_(p_);return f_}function Wb(g_){if(55296<=g_&&57343>=g_)throw Error('Lone surrogate U+'+g_.toString(16).toUpperCase()+' is not a scalar value')}function Zb(g_,c_){return n_(128|63&g_>>c_)}function Qb(g_){if(0==(4294967168&g_))return n_(g_);var c_='';return 0==(4294965248&g_)?c_=n_(192|31&g_>>6):0==(4294901760&g_)?(Wb(g_),c_=n_(224|15&g_>>12),c_+=Zb(g_,6)):0==(4292870144&g_)&&(c_=n_(240|7&g_>>18),c_+=Zb(g_,12),c_+=Zb(g_,6)),c_+=n_(128|63&g_),c_}function Jb(){if(r_>=s_)throw Error('Invalid byte index');var g_=255&o_[r_];if(r_++,128==(192&g_))return 63&g_;throw Error('Invalid continuation byte')}function $b(){var g_,c_,u_,p_,f_;if(r_>s_)throw Error('Invalid byte index');if(r_==s_)return!1;if(g_=255&o_[r_],r_++,0==(128&g_))return g_;if(192==(224&g_)){if(c_=Jb(),f_=(31&g_)<<6|c_,128<=f_)return f_;throw Error('Invalid continuation byte')}if(224==(240&g_)){if(c_=Jb(),u_=Jb(),f_=(15&g_)<<12|c_<<6|u_,2048<=f_)return Wb(f_),f_;throw Error('Invalid continuation byte')}if(240==(248&g_)&&(c_=Jb(),u_=Jb(),p_=Jb(),f_=(7&g_)<<18|c_<<12|u_<<6|p_,65536<=f_&&1114111>=f_))return f_;throw Error('Invalid UTF-8 detected')}var t_=Ob,a_=Xb&&Xb.exports==t_&&Xb,i_='object'==typeof al&&al;(i_.global===i_||i_.window===i_)&&(Nb=i_);var n_=_StringfromCharCode,l_={version:'2.1.2',encode:function(g_){for(var c_=Gb(g_),u_=c_.length,p_=-1,b_='',f_;++p_<u_;)f_=c_[p_],b_+=Qb(f_);return b_},decode:function(g_){o_=Gb(g_),s_=o_.length,r_=0;for(var c_=[],u_;!1!==(u_=$b());)c_.push(u_);return Hb(c_)}},o_,s_,r_;if(!t_||t_.nodeType)Nb.utf8=l_;else if(a_)a_.exports=l_;else{var h_={}.hasOwnProperty;for(var m_ in l_)h_.call(l_,m_)&&(t_[m_]=l_[m_])}})(al)});const wb=[];var yb=class{constructor(Xb,Ob){Ob=Ob||{};var Nb=!1;void 0===Xb&&(Xb=8192),'number'==typeof Xb?Xb=new ArrayBuffer(Xb):(Nb=!0,this._lastWrittenByte=Xb.byteLength);const Gb=Ob.offset?Ob.offset>>>0:0;let Hb=Xb.byteLength-Gb,Wb=Gb;Xb.buffer&&(Xb.byteLength!==Xb.buffer.byteLength&&(Wb=Xb.byteOffset+Gb),Xb=Xb.buffer),this._lastWrittenByte=Nb?Hb:0,this.buffer=Xb,this.length=Hb,this.byteLength=Hb,this.byteOffset=Wb,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,Wb,Hb),this._mark=0,this._marks=[]}available(Xb){return void 0===Xb&&(Xb=1),this.offset+Xb<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(Xb){return void 0===Xb&&(Xb=1),this.offset+=Xb,this}seek(Xb){return this.offset=Xb,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const Xb=this._marks.pop();if(void 0===Xb)throw new Error('Mark stack empty');return this.seek(Xb),this}rewind(){return this.offset=0,this}ensureAvailable(Xb){if(void 0===Xb&&(Xb=1),!this.available(Xb)){const Ob=this.offset+Xb,Nb=2*Ob,Gb=new Uint8Array(Nb);Gb.set(new Uint8Array(this.buffer)),this.buffer=Gb.buffer,this.length=this.byteLength=Nb,this._data=new DataView(this.buffer)}return this}readBoolean(){return 0!==this.readUint8()}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(Xb){void 0===Xb&&(Xb=1);for(var Ob=new Uint8Array(Xb),Nb=0;Nb<Xb;Nb++)Ob[Nb]=this.readByte();return Ob}readInt16(){var Xb=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,Xb}readUint16(){var Xb=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,Xb}readInt32(){var Xb=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,Xb}readUint32(){var Xb=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,Xb}readFloat32(){var Xb=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,Xb}readFloat64(){var Xb=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,Xb}readChar(){return _StringfromCharCode(this.readInt8())}readChars(Xb){void 0===Xb&&(Xb=1),wb.length=Xb;for(var Ob=0;Ob<Xb;Ob++)wb[Ob]=this.readChar();return wb.join('')}readUtf8(Xb){void 0===Xb&&(Xb=1);const Ob=this.readChars(Xb);return fb.decode(Ob)}writeBoolean(Xb){return this.writeUint8(Xb?255:0),this}writeInt8(Xb){return this.ensureAvailable(1),this._data.setInt8(this.offset++,Xb),this._updateLastWrittenByte(),this}writeUint8(Xb){return this.ensureAvailable(1),this._data.setUint8(this.offset++,Xb),this._updateLastWrittenByte(),this}writeByte(Xb){return this.writeUint8(Xb)}writeBytes(Xb){this.ensureAvailable(Xb.length);for(var Ob=0;Ob<Xb.length;Ob++)this._data.setUint8(this.offset++,Xb[Ob]);return this._updateLastWrittenByte(),this}writeInt16(Xb){return this.ensureAvailable(2),this._data.setInt16(this.offset,Xb,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(Xb){return this.ensureAvailable(2),this._data.setUint16(this.offset,Xb,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(Xb){return this.ensureAvailable(4),this._data.setInt32(this.offset,Xb,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(Xb){return this.ensureAvailable(4),this._data.setUint32(this.offset,Xb,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(Xb){return this.ensureAvailable(4),this._data.setFloat32(this.offset,Xb,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(Xb){return this.ensureAvailable(8),this._data.setFloat64(this.offset,Xb,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(Xb){return this.writeUint8(Xb.charCodeAt(0))}writeChars(Xb){for(var Ob=0;Ob<Xb.length;Ob++)this.writeUint8(Xb.charCodeAt(Ob));return this}writeUtf8(Xb){const Ob=fb.encode(Xb);return this.writeChars(Ob)}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this._lastWrittenByte)}getBuffer(){return'undefined'==typeof Buffer?this.toArray():Buffer.from(this.toArray())}_updateLastWrittenByte(){this.offset>this._lastWrittenByte&&(this._lastWrittenByte=this.offset)}},kb={BITMAPV5HEADER:{LogicalColorSpace:{LCS_CALIBRATED_RGB:0,LCS_sRGB:1934772034,LCS_WINDOWS_COLOR_SPACE:1466527264},Compression:{BI_RGB:0,BI_RLE8:1,BI_RLE4:2,BI_BITFIELDS:3,BI_JPEG:4,BI_PNG:5,BI_CMYK:11,BI_CMYKRLE8:12,BI_CMYKRLE4:13},GamutMappingIntent:{LCS_GM_ABS_COLORIMETRIC:8,LCS_GM_BUSINESS:1,LCS_GM_GRAPHICS:2,LCS_GM_IMAGES:4}}};const vb=[];for(var Db=0;8>=Db;Db++)vb.push(255<<Db);var Mb=function(Xb){if(1!==Xb.bitDepth)throw new Error('Only bitDepth of 1 is supported');if(!Xb.height||!Xb.width)throw new Error('ImageData width and height are required');if(1!==Xb.components)throw new Error('Only 1 component is supported');if(1!==Xb.channels)throw new Error('Only 1 channel is supported');var Ob=new yb;Ob.skip(14),Ir(Ob,Xb),Mr(Ob,Xb);const Nb=Ob.offset;return jr(Ob,Xb),Ob.rewind(),Sr(Ob,Nb),Ob.getBuffer()},Sb={configurable:!0,enumerable:!1,get:void 0},Ib=Object.prototype.toString,Pb='IJSImage';class Cb{constructor(Xb,Ob,Nb,Gb){if(void 0===Xb&&(Xb=1),void 0===Ob&&(Ob=1),'object'==typeof Xb){var Hb=Xb,Wb=!0===Ob;Xb=Hb.width,Ob=Hb.height,Nb=Wb?Hb.data.slice():Hb.data,Gb={position:Hb.position,components:Hb.components,alpha:Hb.alpha,bitDepth:Hb.bitDepth,colorModel:Hb.colorModel,parent:Hb,meta:Hb.meta}}if(Nb&&!Nb.length&&(Gb=Nb,Nb=null),void 0===Gb&&(Gb={}),this.width=Xb,this.height=Ob,0>=this.width)throw new RangeError('width must be greater than 0');if(0>=this.height)throw new RangeError('height must be greater than 0');Object.defineProperty(this,'parent',{enumerable:!1,writable:!0}),this.parent=Gb.parent,this.position=Gb.position||[0,0];var Zb;if('string'!=typeof Gb.kind)Zb=_(Yr);else if(Zb=_(Gb.kind),!Zb)throw new RangeError('invalid image kind: '+Gb.kind);var Qb=Cm({},Zb,Gb);this.components=Qb.components,this.alpha=Qb.alpha+0,this.bitDepth=Qb.bitDepth,this.colorModel=Qb.colorModel,this.meta=Gb.meta||{},this.computed=null,this.initialize(),Nb||(Nb=I(this)),this.setData(Nb)}get[Symbol.toStringTag](){return Pb}static isImage(Xb){return`[object ${Pb}]`===Ib.call(Xb)}initialize(){this.size=this.width*this.height,this.sizes=[this.width,this.height],this.channels=this.components+this.alpha,this.maxValue=32===this.bitDepth?_NumberMAX_VALUE:_Mathpow(2,this.bitDepth)-1,this.multiplierX=this.channels,this.multiplierY=this.channels*this.width,this.isClamped=32>this.bitDepth,this.borderSizes=[0,0]}setData(Xb){var Ob=S(this);if(Ob!==Xb.length)throw new RangeError(`incorrect data size. Should be ${Ob} and found ${Xb.length}`);this.data=Xb}static load(Xb,Ob){return As(Xb,Ob)}static fromCanvas(Xb){var Ob=Xb.getContext('2d'),Nb=Ob.getImageData(0,0,Xb.width,Xb.height);return new Cb(Nb.width,Nb.height,Nb.data)}static extendMethod(Xb,Ob,Nb={}){var Gb=Nb.inPlace,Wb=Nb.returnThis,Zb=void 0===Wb||Wb,Qb=Nb.partialArgs,Kb=void 0===Qb?[]:Qb,Jb=Nb.stack,$b=void 0!==Jb&&Jb;if(void 0!==Gb&&Gb){if(Cb.prototype[Xb]=function(...a_){this.computed=null;var i_=Ob.apply(this,[...Kb,...a_]);return Zb?this:i_},$b){var e_='string'==typeof $b?$b:Xb;Oh.prototype[e_]=Zb?function(...a_){for(var i_ of this)i_[Xb](...a_);return this}:function(...a_){for(var i_=new Oh(this.length),n_=0;n_<this.length;n_++)i_[n_]=this[n_][Xb](...a_);return i_}}}else if(Cb.prototype[Xb]=function(...a_){return Ob.apply(this,[...Kb,...a_])},$b){var t_='string'==typeof $b?$b:Xb;Oh.prototype[t_]=function(...a_){for(var i_=new Oh(this.length),n_=0;n_<this.length;n_++)i_[n_]=this[n_][Xb](...a_);return i_}}return Cb}static extendProperty(Xb,Ob,Nb={}){var Gb=Nb.partialArgs,Hb=void 0===Gb?[]:Gb;return Sb.get=function(){if(null===this.computed)this.computed={};else if(qh(Xb,this.computed))return this.computed[Xb];var Wb=Ob.apply(this,Hb);return this.computed[Xb]=Wb,Wb},Object.defineProperty(Cb.prototype,Xb,Sb),Cb}static createFrom(Xb,Ob){var Nb={width:Xb.width,height:Xb.height,position:[0,0],components:Xb.components,alpha:Xb.alpha,colorModel:Xb.colorModel,bitDepth:Xb.bitDepth,parent:Xb};return Cm(Nb,Ob),new Cb(Nb.width,Nb.height,Nb)}static isTypeSupported(Xb,Ob='write'){if('string'!=typeof Xb)throw new TypeError('type argument must be a string');if(Xb=Dn(Xb),'write'===Ob)return vn(Xb);throw new TypeError('unknown operation: '+Ob)}getPixelIndex(Xb){for(var Ob=0,Nb=0;Nb<Xb.length;Nb++)Ob+=this.multipliers[Nb]*Xb[Nb];return Ob}setValueXY(Xb,Ob,Nb,Gb){return this.data[(Ob*this.width+Xb)*this.channels+Nb]=Gb,this.computed=null,this}getValueXY(Xb,Ob,Nb){return this.data[(Ob*this.width+Xb)*this.channels+Nb]}setValue(Xb,Ob,Nb){return this.data[Xb*this.channels+Ob]=Nb,this.computed=null,this}getValue(Xb,Ob){return this.data[Xb*this.channels+Ob]}setPixelXY(Xb,Ob,Nb){return this.setPixel(Ob*this.width+Xb,Nb)}getPixelXY(Xb,Ob){return this.getPixel(Ob*this.width+Xb)}setPixel(Xb,Ob){for(var Nb=Xb*this.channels,Gb=0;Gb<Ob.length;Gb++)this.data[Nb+Gb]=Ob[Gb];return this.computed=null,this}getPixel(Xb){for(var Ob=Array(this.channels),Nb=Xb*this.channels,Gb=0;Gb<this.channels;Gb++)Ob[Gb]=this.data[Nb+Gb];return Ob}toDataURL(Xb='image/png',Ob=!1){function Nb(Gb){var Hb=Mb(Gb),Wb=Ps(Hb);return`data:${Xb};base64,${Wb}`}return Xb=Dn(Xb),Ob?new Promise((Gb,Hb)=>{'image/bmp'===Xb?Gb(Nb(this)):this.getCanvas().toDataURL(Xb,function(Wb,Zb){Wb?Hb(Wb):Gb(Zb)})}):'image/bmp'===Xb?Nb(this):this.getCanvas().toDataURL(Xb)}toBase64(Xb='image/png',Ob=!1){if(Ob)return this.toDataURL(Xb,!0).then(function(Gb){return Gb.substring(Gb.indexOf(',')+1)});var Nb=this.toDataURL(Xb);return Nb.substring(Nb.indexOf(',')+1)}toBlob(Xb='image/png',Ob=0.8){return ub(this.getCanvas({originalData:!0}),Xb,Ob)}getCanvas(Xb={}){var Ob=Xb.originalData,Gb;void 0!==Ob&&Ob?(this.checkProcessable('getInPlaceCanvas',{channels:[4],bitDepth:[8]}),Gb=new Qr(this.data,this.width,this.height)):Gb=new Qr(this.getRGBAData(),this.width,this.height);var Hb=new R(this.width,this.height),Wb=Hb.getContext('2d');return Wb.putImageData(Gb,0,0),Hb}getRGBAData(){this.checkProcessable('getRGBAData',{components:[1,3],bitDepth:[1,8,16]});var Xb=this.size,Ob=new Uint8ClampedArray(4*(this.width*this.height));if(1===this.bitDepth)for(var Nb=0,Gb;Nb<Xb;Nb++)Gb=this.getBit(Nb),Ob[4*Nb]=255*Gb,Ob[4*Nb+1]=255*Gb,Ob[4*Nb+2]=255*Gb;else if(1===this.components)for(var Hb=0;Hb<Xb;Hb++)Ob[4*Hb]=this.data[Hb*this.channels]>>>this.bitDepth-8,Ob[4*Hb+1]=this.data[Hb*this.channels]>>>this.bitDepth-8,Ob[4*Hb+2]=this.data[Hb*this.channels]>>>this.bitDepth-8;else if(3===this.components&&(this.checkProcessable('getRGBAData',{colorModel:[Xr]}),this.colorModel===Xr))for(var Wb=0;Wb<Xb;Wb++)Ob[4*Wb]=this.data[Wb*this.channels]>>>this.bitDepth-8,Ob[4*Wb+1]=this.data[Wb*this.channels+1]>>>this.bitDepth-8,Ob[4*Wb+2]=this.data[Wb*this.channels+2]>>>this.bitDepth-8;if(this.alpha){this.checkProcessable('getRGBAData',{bitDepth:[8,16]});for(var Zb=0;Zb<Xb;Zb++)Ob[4*Zb+3]=this.data[Zb*this.channels+this.components]>>this.bitDepth-8}else for(var Qb=0;Qb<Xb;Qb++)Ob[4*Qb+3]=255;return Ob}getRoiManager(Xb){return new Rm(this,Xb)}clone(Xb={}){var Ob=Xb.copyData;return new Cb(this,void 0===Ob||Ob)}save(Xb,Ob={}){var Nb=Ob.format,Gb=void 0===Nb?'png':Nb;return new Promise((Hb,Wb)=>{var Zb=E(Xb),Qb,Kb;switch(Gb.toLowerCase()){case'png':Qb=this.getCanvas().pngStream();break;case'jpg':case'jpeg':Qb=this.getCanvas().jpegStream();break;case'bmp':Kb=Mb(this);break;default:throw new RangeError('invalid output format: '+Gb);}Qb?(Zb.on('finish',Hb),Zb.on('error',Wb),Qb.pipe(Zb)):Kb&&T(Xb,Buffer.from(Kb),(Jb)=>{return Jb?void Wb(Jb):void Hb()})})}checkProcessable(Xb,Ob={}){var Nb=Ob.bitDepth,Gb=Ob.alpha,Hb=Ob.colorModel,Wb=Ob.components,Zb=Ob.channels;if('string'!=typeof Xb)throw new TypeError('checkProcessable requires as first parameter the processName (a string)');if(Nb&&(Array.isArray(Nb)||(Nb=[Nb]),!Nb.includes(this.bitDepth)))throw new TypeError('The process: '+Xb+' can only be applied if bit depth is in: '+Nb);if(Gb&&(Array.isArray(Gb)||(Gb=[Gb]),!Gb.includes(this.alpha)))throw new TypeError('The process: '+Xb+' can only be applied if alpha is in: '+Gb);if(Hb&&(Array.isArray(Hb)||(Hb=[Hb]),!Hb.includes(this.colorModel)))throw new TypeError('The process: '+Xb+' can only be applied if color model is in: '+Hb);if(Wb&&(Array.isArray(Wb)||(Wb=[Wb]),!Wb.includes(this.components)))throw new TypeError('The process: '+Xb+' can only be applied if the number of components is in: '+Wb);if(Zb&&(Array.isArray(Zb)||(Zb=[Zb]),!Zb.includes(this.channels)))throw new TypeError('The process: '+Xb+' can only be applied if the number of channels is in: '+Zb)}checkColumn(Xb){if(0>Xb||Xb>=this.width)throw new RangeError(`checkColumn: column should be included between 0 and ${this.width-1}. Current value: ${Xb}`)}checkRow(Xb){if(0>Xb||Xb>=this.height)throw new RangeError(`checkRow: row should be included between 0 and ${this.height-1}. Current value: ${Xb}`)}checkChannel(Xb){if(0>Xb||Xb>=this.channels)throw new RangeError(`checkChannel: channel should be included between 0 and ${this.channels-1}. Current value: ${Xb}`)}apply(Xb){for(var Ob=0;Ob<this.height;Ob++)for(var Nb=0,Gb;Nb<this.width;Nb++)Gb=(Ob*this.width+Nb)*this.channels,Xb.call(this,Gb)}}(function(Xb){var Ob={inPlace:!0},Gb={stack:!0};Xb.extendMethod('invertGetSet',O,Ob),Xb.extendMethod('invertIterator',G,Ob),Xb.extendMethod('invertPixel',Z,Ob),Xb.extendMethod('invertOneLoop',W,Ob),Xb.extendMethod('invertApply',Q,Ob),Xb.extendMethod('invert',ie,{inPlace:!0,stack:!0}),Xb.extendMethod('invertBinaryLoop',J,Ob),Xb.extendMethod('level',Ie,Ob),Xb.extendMethod('add',Be,Ob),Xb.extendMethod('subtract',Ae,Ob),Xb.extendMethod('multiply',ze,Ob),Xb.extendMethod('divide',Le,Ob),Xb.extendMethod('hypotenuse',Re),Xb.extendMethod('background',jt),Xb.extendMethod('flipX',ne),Xb.extendMethod('flipY',oe),Xb.extendMethod('blurFilter',le),Xb.extendMethod('medianFilter',he),Xb.extendMethod('gaussianFilter',ve),Xb.extendMethod('sobelFilter',Me),Xb.extendMethod('crop',Mt,Gb),Xb.extendMethod('cropAlpha',St,Gb),Xb.extendMethod('scale',Et,Gb),Xb.extendMethod('hsv',Tt),Xb.extendMethod('hsl',Vt),Xb.extendMethod('cmyk',Yt),Xb.extendMethod('rgba8',Ft),Xb.extendMethod('grey',Ut).extendMethod('gray',Ut),Xb.extendMethod('mask',ca),Xb.extendMethod('pad',fa),Xb.extendMethod('colorDepth',ba),Xb.extendMethod('setBorder',va,Ob),Xb.extendMethod('rotate',wa),Xb.extendMethod('rotateLeft',xa),Xb.extendMethod('rotateRight',ya),Xb.extendMethod('getRow',Xa),Xb.extendMethod('getColumn',Oa),Xb.extendMethod('getMatrix',Na),Xb.extendMethod('setMatrix',Ga),Xb.extendMethod('getPixelsArray',Ha),Xb.extendMethod('getIntersection',Wa),Xb.extendMethod('getClosestCommonParent',Ka),Xb.extendMethod('split',za),Xb.extendMethod('getChannel',La),Xb.extendMethod('combineChannels',Ea),Xb.extendMethod('setChannel',Va),Xb.extendMethod('getSimilarity',Ya),Xb.extendMethod('getPixelsGrid',Fa),Xb.extendMethod('getBestMatch',qa),Xb.extendMethod('paintMasks',pi,Ob),Xb.extendMethod('paintLabels',fi,Ob),Xb.extendMethod('paintPoints',ji,Ob),Xb.extendMethod('paintPolyline',Mi,Ob),Xb.extendMethod('extract',Si),Xb.extendMethod('convolution',ke),Xb.extendMethod('convolutionFft',se),Xb.extendMethod('floodFill',Ii),Xb.extendMethod('countAlphaPixels',Oi),Xb.extendMethod('monotoneChainConvexHull',Wi),Xb.extendMethod('minimalBoundingRectangle',Ji),Xb.extendMethod('getHistogram',Ci).extendProperty('histogram',Ci),Xb.extendMethod('getHistograms',Bi).extendProperty('histograms',Bi),Xb.extendMethod('getColorHistogram',Ri).extendProperty('colorHistogram',Ri),Xb.extendMethod('getMin',zi).extendProperty('min',zi),Xb.extendMethod('getMax',Li).extendProperty('max',Li),Xb.extendMethod('getSum',Ei).extendProperty('sum',Ei),Xb.extendMethod('getMoment',Ti).extendProperty('moment',Ti),Xb.extendMethod('getLocalMaxima',Vi),Xb.extendMethod('getMedian',Fi).extendProperty('median',Fi),Xb.extendMethod('getMean',Yi).extendProperty('mean',Yi),Xb.extendMethod('getPoints',Ui).extendProperty('points',Ui),Xb.extendMethod('getRelativePosition',qi),Xb.extendMethod('getSvd',Xi).extendProperty('svd',Xi)})(Cb),function(Xb){for(var Ob in gm)Xb.prototype[Ob]=gm[Ob]}(Cb);var Bb=Object.freeze({laplacianOfGaussian:function(Xb,Ob,Nb){var Gb=Array(Ob),Hb=void 0,Wb=void 0,Zb,Qb;Nb||(Nb=100),Nb*=-1;var Kb=(Ob-1)/2,Jb=2*Xb*Xb;for(Hb=0;Hb<Ob;Hb++)for(Gb[Hb]=Array(Ob),Qb=(Hb-Kb)*(Hb-Kb),Wb=0;Wb<Ob;Wb++)Zb=(Wb-Kb)*(Wb-Kb),Gb[Hb][Wb]=_Mathround(Nb*(1-(Zb+Qb)/Jb)*_Mathexp(-(Zb+Qb)/Jb));return Gb},DISCRETE_LAPLACE_4:[[0,1,0],[1,-4,1],[0,1,0]],DISCRETE_LAPLACE_8:[[1,1,1],[1,-8,1],[1,1,1]],GRADIENT_X:bl,GRADIENT_Y:_l,SECOND_DERIVATIVE:[[-1,-2,0,2,1],[-2,-4,0,4,2],[0,0,0,0,0],[1,2,0,-2,-1],[2,4,0,-4,-2]],SECOND_DERIVATIVE_INV:[[1,2,0,-2,-1],[2,4,0,-4,-2],[0,0,0,0,0],[-2,-4,0,4,2],[-1,-2,0,2,1]]}),Rb=function(){function Xb(){this._listeners={}}self.window=self;Xb.prototype.on=function(Gb,Hb){if(this._listeners[Gb])throw new RangeError('there is already a listener for '+Gb);if('function'!=typeof Hb)throw new TypeError('callback argument must be a function');this._listeners[Gb]=Hb},Xb.prototype._send=function(Gb,Hb,Wb){void 0===Wb?Wb=[]:!Array.isArray(Wb)&&(Wb=[Wb]),self.postMessage({id:Gb,data:Hb},Wb)},Xb.prototype._trigger=function(Gb,Hb){if(!this._listeners[Gb])throw new Error('event '+Gb+' is not defined');this._listeners[Gb].apply(null,Hb)};var Nb=new Xb;self.onmessage=function(Gb){switch(Gb.data.action){case'exec':Gb.data.args.unshift(function(Hb,Wb){Nb._send(Gb.data.id,Hb,Wb)}),Nb._trigger(Gb.data.event,Gb.data.args);break;case'ping':Nb._send(Gb.data.id,'pong');break;default:throw new Error('unexpected action: '+Gb.data.action);}},'CODE'}.toString().split('"CODE";'),Lb={newWorkerURL:function(Ob,Nb){var Gb=new Blob(['(',Rb[0],'importScripts.apply(self, '+JSON.stringify(Nb)+');\n','(',Ob,')();',Rb[1],')();'],{type:'application/javascript'});return URL.createObjectURL(Gb)}},Eb=navigator.hardwareConcurrency||1;Cr.prototype._init=function(Xb){for(var Ob=Lb.newWorkerURL(this._workerCode,Xb),Nb=0,Gb;Nb<this._numWorkers;Nb++)Gb=new Worker(Ob),Gb.onmessage=this._onmessage.bind(this,Gb),Gb.onerror=this._onerror.bind(this,Gb),Gb.running=!1,Gb.id=Nb,this._workers.set(Gb,null);URL.revokeObjectURL(Ob)},Cr.prototype._onerror=function(Xb,Ob){if(!this._terminated){this._working--,Xb.running=!1;var Nb=this._workers.get(Xb);Nb&&Nb[1](Ob.message),this._workers.set(Xb,null),this._terminateOnError?this.terminate():this._exec()}},Cr.prototype._onmessage=function(Xb,Ob){if(!this._terminated){this._working--,Xb.running=!1;var Nb=this._workers.get(Xb);Nb&&Nb[0](Ob.data.data),this._workers.set(Xb,null),this._exec()}},Cr.prototype._exec=function(){for(var Xb of this._workers.keys()){if(this._working===this._numWorkers||0===this._waiting.length)return;if(!Xb.running)for(var Ob=0,Nb;Ob<this._waiting.length;Ob++)if(Nb=this._waiting[Ob],'number'!=typeof Nb[4]||Nb[4]===Xb.id){this._waiting.splice(Ob,1),Xb.postMessage({action:'exec',event:Nb[0],args:Nb[1]},Nb[2]),Xb.running=!0,Xb.time=Date.now(),this._workers.set(Xb,Nb[3]),this._working++;break}}},Cr.prototype.terminate=function(){if(!this._terminated){for(var Xb of this._workers)Xb[0].terminate(),Xb[1]&&Xb[1][1](new Error('Terminated'));this._workers.clear(),this._waiting=[],this._working=0,this._terminated=!0}},Cr.prototype.postAll=function(Xb,Ob){if(this._terminated)throw new Error('Cannot post (terminated)');var Nb=[];for(var Gb of this._workers.keys())Nb.push(this.post(Xb,Ob,[],Gb.id));return Promise.all(Nb)},Cr.prototype.post=function(Xb,Ob,Nb,Gb){void 0===Ob&&(Ob=[]),void 0===Nb&&(Nb=[]),Array.isArray(Ob)||(Ob=[Ob]),Array.isArray(Nb)||(Nb=[Nb]);var Hb=this;return new Promise(function(Wb,Zb){if(Hb._terminated)throw new Error('Cannot post (terminated)');Hb._waiting.push([Xb,Ob,Nb,[Wb,Zb],Gb]),Hb._exec()})};var Tb=Cr,Vb={regression:{kernelType:'polynomial',kernelOptions:{degree:2,constant:1}},threshold:0.02,roi:{minSurface:100,positive:!1},sampling:20,include:[]},Yb={run:function(Xb,Ob,Nb){Ob=Cm({},Vb,Ob);var Gb=this.manager;return Array.isArray(Xb)?Promise.all(Xb.map(function(Hb){var Wb=Ar(Gb,Hb,Ob);return'function'==typeof Nb&&Wb.then(Nb),Wb})):Ar(Gb,Xb,Ob)},work:function(){worker.on('data',function(Xb,Ob,Nb){function Gb(i_,n_){Nb.include.includes(i_)&&(Hb[i_]=n_,Wb.push(n_.data.buffer))}Ob=new IJS(Ob);var Hb={},Wb=[],Zb=Ob.grey(),Qb=Zb.sobelFilter();Gb('sobel',Qb);var Kb=Qb.level().mask({threshold:Nb.threshold});Gb('mask',Kb);var Jb=Qb.getRoiManager();Jb.fromMask(Kb);var $b=Jb.getMask(Nb.roi);Gb('realMask',$b);var e_=Zb.getPixelsGrid({sampling:Nb.sampling,mask:$b}),t_=Ob.getBackground(e_.xyS,e_.zS,Nb.regression);Gb('background',t_);var a_=Ob.subtract(t_);Hb.result=a_,Wb.push(a_.data.buffer),Xb(Hb,Wb)})}};class Fb{constructor(){this._url=null,this._deps=[null]}checkUrl(){if(null===this._url)throw new Error('image worker must be initialized with an URL')}get url(){return this._url}set url(Xb){if('string'!=typeof Xb)throw new TypeError('worker URL must be a string');this._url=Xb,this._deps[0]=Xb}static extendMethod(Xb,Ob){function Nb(...Zb){return Gb||(this.checkUrl(),Hb=this.url,Gb=new Tb(Ob.work,{deps:Hb}),Wb.manager=Gb),Ob.run.call(Wb,...Zb)}var Wb={},Gb,Hb;Nb.reset=function(){Gb&&(Gb.terminate(),Gb=new Tb(Ob.work,{deps:Hb}),Wb.manager=Gb)},Fb.prototype[Xb]=Nb}}(function(Xb){Xb.extendMethod('background',Yb)})(Fb);var Ub=new Fb;Cb.Stack=Oh,Cb.Shape=hm,Cb.Kernel=Bb;return Cb.Static={grey:Mh,mask:Ih,maskMethods:Sh},Cb.Worker=Ub,Cb});

//# sourceMappingURL=image.min.js.map