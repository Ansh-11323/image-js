(function(e,t){'object'==typeof exports&&'undefined'!=typeof module?module.exports=t():'function'==typeof define&&define.amd?define(t):e.IJS=t()})(this,function(){'use strict';function e(e){return jo[e]}function t(e){var t=e.channels*e.size;return 1===e.bitDepth&&(t=_o(t/8)),t}function a(e){var t=e.channels*e.size,a;switch(e.bitDepth){case 1:a=new Uint8Array(_o(t/8));break;case 8:a=new Uint8ClampedArray(t);break;case 16:a=new Uint16Array(t);break;case 32:a=new Float32Array(t);break;default:throw new Error('Cannot create pixel array for bit depth '+e.bitDepth);}if(e.alpha)for(var n=e.components;n<a.length;n+=e.channels)a[n]=e.maxValue;return a}function n(e){try{var t=new URL(e);return t.origin!==Po}catch(t){return!1}}function o(e,t){var i=self.document.createElement('canvas');return i.width=e,i.height=t,i}function s(e,{withCredentials:t=!1}={}){return new Promise(function(i,a){var n=new self.XMLHttpRequest;n.open('GET',e,!0),n.responseType='arraybuffer',n.withCredentials=t,n.onload=function(t){200===this.status?i(this.response):a(t)},n.onerror=a,n.send()})}function r(){throw new Error('createWriteStream does not exist in the browser')}function l(){throw new Error('writeFile does not exist in the browser')}function d(){if(this.checkProcessable('invert',{bitDepth:[1,8,16]}),1===this.bitDepth)for(var e=this.data,t=0;t<e.length;t++)e[t]=~e[t];else for(var i=0;i<this.width;i++)for(var a=0;a<this.height;a++)for(var n=0,o;n<this.components;n++)o=this.getValueXY(i,a,n),this.setValueXY(i,a,n,this.maxValue-o)}function h(){if(this.checkProcessable('invert',{bitDepth:[1,8,16]}),1===this.bitDepth)for(var e=this.data,t=0;t<e.length;t++)e[t]=~e[t];else for(var i of this.pixels())for(var a=i.index,n=i.pixel,o=0;o<this.components;o++)this.setValue(a,o,this.maxValue-n[o])}function g(){this.checkProcessable('invertOneLoop',{bitDepth:[8,16]});for(var e=this.data,t=0;t<e.length;t+=this.channels)for(var i=0;i<this.components;i++)e[t+i]=this.maxValue-e[t+i]}function c(){this.checkProcessable('invertPixel',{bitDepth:[8,16]});for(var e=0;e<this.width;e++)for(var t=0,i;t<this.height;t++){i=this.getPixelXY(e,t);for(var a=0;a<this.components;a++)i[a]=this.maxValue-i[a];this.setPixelXY(e,t,i)}}function m(){if(1===this.bitDepth)for(var e=this.data,t=0;t<e.length;t++)e[t]=~e[t];else this.checkProcessable('invertApply',{bitDepth:[8,16]}),this.apply(function(e){for(var t=0;t<this.components;t++)this.data[e+t]=this.maxValue-this.data[e+t]})}function p(){this.checkProcessable('invertBinaryLoop',{bitDepth:[1]});for(var e=0;e<this.size;e++)this.toggleBit(e)}function u(e,t={}){var i=t.channels,a=t.allowAlpha,n=t.defaultAlpha;return'boolean'!=typeof a&&(a=!0),'undefined'==typeof i?f(e,n):_(e,i,a)}function f(e,t){for(var a=t?e.channels:e.components,n=Array(a),o=0;o<a;o++)n[o]=o;return n}function _(e,t,i){Array.isArray(t)||(t=[t]);for(var a=0;a<t.length;a++)t[a]=b(e,t[a],i);return t}function b(e,t,i=!0){if(void 0===t)throw new RangeError('validateChannel : the channel has to be >=0 and <'+e.channels);if('string'==typeof t){switch(e.colorModel){case Do:break;case xo:'rgb'.includes(t)&&('r'===t?t=0:'g'===t?t=1:'b'===t?t=2:void 0);break;case yo:'hsl'.includes(t)&&('h'===t?t=0:'s'===t?t=1:'l'===t?t=2:void 0);break;case ko:'hsv'.includes(t)&&('h'===t?t=0:'s'===t?t=1:'v'===t?t=2:void 0);break;case vo:'cmyk'.includes(t)&&('c'===t?t=0:'m'===t?t=1:'y'===t?t=2:'k'===t?t=3:void 0);break;default:throw new Error(`Unexpected color model: ${e.colorModel}`);}if('a'===t){if(!e.alpha)throw new Error('validateChannel : the image does not contain alpha channel');t=e.components}if('string'==typeof t)throw new Error('validateChannel : undefined channel: '+t)}if(t>=e.channels)throw new RangeError('validateChannel : the channel has to be >=0 and <'+e.channels);if(!i&&t>=e.components)throw new RangeError('validateChannel : alpha channel may not be selected');return t}function w(e={}){var t=e.channels;if(this.checkProcessable('invertOneLoop',{bitDepth:[1,8,16]}),1===this.bitDepth)for(var a=this.data,n=0;n<a.length;n++)a[n]=~a[n];else{t=u(this,{channels:t});for(var i=0,o;i<t.length;i++){o=t[i];for(var s=o;s<this.data.length;s+=this.channels)this.data[s]=this.maxValue-this.data[s]}}return this}function x(){this.checkProcessable('flipX',{bitDepth:[8,16]});for(var e=0,t;e<this.height;e++){t=e*this.width*this.channels;for(var i=0;i<fo(this.width/2);i++)for(var a=i*this.channels+t,n=(this.width-i-1)*this.channels+t,o=0,s;o<this.channels;o++)s=this.data[a+o],this.data[a+o]=this.data[n+o],this.data[n+o]=s}return this}function y(){this.checkProcessable('flipY',{bitDepth:[8,16]});for(var e=0;e<fo(this.height/2);e++)for(var t=0;t<this.width;t++)for(var i=t*this.channels+e*this.width*this.channels,a=t*this.channels+(this.height-1-e)*this.channels*this.width,n=0,o;n<this.channels;n++)o=this.data[i+n],this.data[i+n]=this.data[a+n],this.data[a+n]=o;return this}function k(e,t={}){return t=Object.assign({},t),t.algorithm='fft',this.convolution(e,t)}function v(e={}){var t=e.radius,a=void 0===t?1:t;if(this.checkProcessable('meanFilter',{components:[1],bitDepth:[8,16]}),1>a)throw new Error('Number of neighbors should be grater than 0');for(var o=2*a+1,n=Array(o*o),s=0;s<n.length;s++)n[s]=1;return k.call(this,n)}function D(e){if('number'!=typeof e||Io(e))throw new TypeError('Expected a number')}function j(e={}){var t=e.radius,a=void 0===t?1:t,o=e.channels,s=e.border,r=void 0===s?'copy':s;if(this.checkProcessable('median',{bitDepth:[8,16]}),1>a)throw new Error('Kernel radius should be greater than 0');o=u(this,o,!0);for(var l=a,d=a,h=mc.createFrom(this),g=(2*l+1)*(2*d+1),m=fo(g/2),p=Array(g),f=0,_;f<o.length;f++){_=o[f];for(var c=d;c<this.height-d;c++)for(var b=l,w;b<this.width-l;b++){w=0;for(var n=-d;n<=d;n++)for(var x=-l,i;x<=l;x++)i=((c+n)*this.width+b+x)*this.channels+_,p[w++]=this.data[i];var y=(c*this.width+b)*this.channels+_,k=p.sort(Bo)[m];h.data[y]=k}}if(this.alpha&&!o.includes(this.channels))for(var v=this.components;v<this.data.length;v+=this.channels)h.data[v]=this.data[v];return h.setBorder({size:[l,d],algorithm:r}),h}function M(){throw new Error('Dynamic requires are not currently supported by rollup-plugin-commonjs')}function S(e,t){return t={exports:{}},e(t,t.exports),t.exports}function P(e){var t=e,a,n;if('number'!=typeof e[0]){a=e.length,n=e[0].length,t=Array(a*n);for(var o=0;o<a;o++)for(var i=0;i<n;i++)t[o*n+i]=e[o][i]}else{var s=mo(e.length);ho(s)&&(a=s,n=s)}return{data:t,rows:a,cols:n}}function I(e){var t,a;if(!Array.isArray(e))throw new Error('validateKernel: Invalid Kernel: '+e);else if(!Array.isArray(e[0])){var n=mo(e.length);if(Vo(n))a=t=fo(mo(e.length)/2);else throw new RangeError('validateKernel: Kernel array should be a square');for(var o=Array(n),s=0;s<n;s++){o[s]=Array(n);for(var i=0;i<n;i++)o[s][i]=e[s*n+i]}e=o}else if(0==(1&e.length)||0==(1&e[0].length))throw new RangeError('validateKernel: Kernel rows and columns should be odd numbers');else t=fo(e.length/2),a=fo(e[0].length/2);return{kernel:e,kWidth:a,kHeight:t}}function B(e,t,a){if(void 0===a){const i=e.length+t.length-1;a=Array(i)}C(a);for(var n=0;n<e.length;n++)for(var i=0;i<t.length;i++)a[n+i]+=e[n]*t[i];return a}function C(e){for(var t=0;t<e.length;t++)e[t]=0}function A(e,t,i,a){var n=Array(e.length),o,s,r,l;l=t[1],r=(l.length-1)/2,s=Array(i+l.length-1),o=Array(i);for(var d=0;d<a;d++){for(var h=0;h<i;h++)o[h]=e[d*i+h];B(o,l,s);for(var g=0;g<i;g++)n[d*i+g]=s[r+g]}l=t[0],r=(l.length-1)/2,s=Array(a+l.length-1),o=Array(a);for(var c=0;c<i;c++){for(var m=0;m<a;m++)o[m]=n[m*i+c];B(o,l,s);for(var p=0;p<a;p++)n[p*i+c]=s[r+p]}return n}function R(e){if(!(this instanceof R))return new R(e);e=as.checkMatrix(e);var a=e.clone(),n=a.rows,o=a.columns,r=Array(n),l=1,d,i,h,g,c,s,t,m,p,u;for(d=0;d<n;d++)r[d]=d;for(p=Array(n),i=0;i<o;i++){for(d=0;d<n;d++)p[d]=a[d][i];for(d=0;d<n;d++){for(m=a[d],u=ro(d,i),c=0,h=0;h<u;h++)c+=m[h]*p[h];m[i]=p[d]-=c}for(g=i,d=i+1;d<n;d++)so(p[d])>so(p[g])&&(g=d);if(g!==i){for(h=0;h<o;h++)s=a[g][h],a[g][h]=a[i][h],a[i][h]=s;t=r[g],r[g]=r[i],r[i]=t,l=-l}if(i<n&&0!==a[i][i])for(d=i+1;d<n;d++)a[d][i]/=a[i][i]}this.LU=a,this.pivotVector=r,this.pivotSign=l}function z(e,t){var i;return so(e)>so(t)?(i=t/e,so(e)*mo(1+i*i)):0===t?0:(i=e/t,so(t)*mo(1+i*i))}function L(e,t,a){for(var n=Array(e),o=0;o<e;o++){n[o]=Array(t);for(var i=0;i<t;i++)n[o][i]=a}return n}function E(o,r){if(!(this instanceof E))return new E(o,r);o=as.checkMatrix(o),r=r||{};var l=o.rows,d=o.columns,n=ro(l,d),h=!0,m=!0;!1===r.computeLeftSingularVectors&&(h=!1),!1===r.computeRightSingularVectors&&(m=!1);var u=!0===r.autoTranspose,_=!1,w;if(!(l<d))w=o.clone();else if(!u)w=o.clone(),console.warn('Computing SVD on a matrix with more columns than rows. Consider enabling autoTranspose');else{w=o.transpose(),l=w.rows,d=w.columns,_=!0;var a=h;h=m,m=a}var x=Array(ro(l+1,d)),s=L(l,n,0),y=L(d,d,0),v=Array(d),e=Array(l),D=ro(l-1,d),M=oo(0,ro(d-2,l)),S,i,j,k,p,P,I,f,B,C,A,R,T,V,U,F,Y,X,b,c,q;for(j=0,C=oo(D,M);j<C;j++){if(j<D){for(x[j]=0,S=j;S<l;S++)x[j]=z(x[j],w[S][j]);if(0!==x[j]){for(0>w[j][j]&&(x[j]=-x[j]),S=j;S<l;S++)w[S][j]/=x[j];w[j][j]+=1}x[j]=-x[j]}for(i=j+1;i<d;i++){if(j<D&&0!==x[j]){for(p=0,S=j;S<l;S++)p+=w[S][j]*w[S][i];for(p=-p/w[j][j],S=j;S<l;S++)w[S][i]+=p*w[S][j]}v[i]=w[j][i]}if(h&&j<D)for(S=j;S<l;S++)s[S][j]=w[S][j];if(j<M){for(v[j]=0,S=j+1;S<d;S++)v[j]=z(v[j],v[S]);if(0!==v[j]){for(0>v[j+1]&&(v[j]=0-v[j]),S=j+1;S<d;S++)v[S]/=v[j];v[j+1]+=1}if(v[j]=-v[j],j+1<l&&0!==v[j]){for(S=j+1;S<l;S++)e[S]=0;for(i=j+1;i<d;i++)for(S=j+1;S<l;S++)e[S]+=v[i]*w[S][i];for(i=j+1;i<d;i++)for(p=-v[i]/v[j+1],S=j+1;S<l;S++)w[S][i]+=p*e[S]}if(m)for(S=j+1;S<d;S++)y[S][j]=v[S]}}if(k=ro(d,l+1),D<d&&(x[D]=w[D][D]),l<k&&(x[k-1]=0),M+1<k&&(v[M]=w[M][k-1]),v[k-1]=0,h){for(i=D;i<n;i++){for(S=0;S<l;S++)s[S][i]=0;s[i][i]=1}for(j=D-1;0<=j;j--)if(0!==x[j]){for(i=j+1;i<n;i++){for(p=0,S=j;S<l;S++)p+=s[S][j]*s[S][i];for(p=-p/s[j][j],S=j;S<l;S++)s[S][i]+=p*s[S][j]}for(S=j;S<l;S++)s[S][j]=-s[S][j];for(s[j][j]=1+s[j][j],S=0;S<j-1;S++)s[S][j]=0}else{for(S=0;S<l;S++)s[S][j]=0;s[j][j]=1}}if(m)for(j=d-1;0<=j;j--){if(j<M&&0!==v[j])for(i=j+1;i<d;i++){for(p=0,S=j+1;S<d;S++)p+=y[S][j]*y[S][i];for(p=-p/y[j+1][j],S=j+1;S<d;S++)y[S][i]+=p*y[S][j]}for(S=0;S<d;S++)y[S][j]=0;y[j][j]=1}for(var g=k-1,O=0,N=2.220446049250313e-16;0<k;){for(j=k-2;-1<=j&&-1!==j;j--)if(so(v[j])<=N*(so(x[j])+so(x[j+1]))){v[j]=0;break}if(j===k-2)A=4;else{for(P=k-1;P>=j&&P!==j;P--)if(p=(P===k?0:so(v[P]))+(P===j+1?0:so(v[P-1])),so(x[P])<=N*p){x[P]=0;break}P===j?A=3:P===k-1?A=1:(A=2,j=P)}switch(j++,A){case 1:{for(I=v[k-2],v[k-2]=0,i=k-2;i>=j;i--)if(p=z(x[i],I),f=x[i]/p,B=I/p,x[i]=p,i!==j&&(I=-B*v[i-1],v[i-1]=f*v[i-1]),m)for(S=0;S<d;S++)p=f*y[S][i]+B*y[S][k-1],y[S][k-1]=-B*y[S][i]+f*y[S][k-1],y[S][i]=p;break}case 2:{for(I=v[j-1],v[j-1]=0,i=j;i<k;i++)if(p=z(x[i],I),f=x[i]/p,B=I/p,x[i]=p,I=-B*v[i],v[i]=f*v[i],h)for(S=0;S<l;S++)p=f*s[S][i]+B*s[S][j-1],s[S][j-1]=-B*s[S][i]+f*s[S][j-1],s[S][i]=p;break}case 3:{for(R=oo(oo(oo(oo(so(x[k-1]),so(x[k-2])),so(v[k-2])),so(x[j])),so(v[j])),T=x[k-1]/R,V=x[k-2]/R,U=v[k-2]/R,F=x[j]/R,Y=v[j]/R,X=((V+T)*(V-T)+U*U)/2,b=T*U*(T*U),c=0,(0!==X||0!==b)&&(c=mo(X*X+b),0>X&&(c=-c),c=b/(X+c)),I=(F+T)*(F-T)+c,q=F*Y,i=j;i<k-1;i++){if(p=z(I,q),f=I/p,B=q/p,i!==j&&(v[i-1]=p),I=f*x[i]+B*v[i],v[i]=f*v[i]-B*x[i],q=B*x[i+1],x[i+1]=f*x[i+1],m)for(S=0;S<d;S++)p=f*y[S][i]+B*y[S][i+1],y[S][i+1]=-B*y[S][i]+f*y[S][i+1],y[S][i]=p;if(p=z(I,q),f=I/p,B=q/p,x[i]=p,I=f*v[i]+B*x[i+1],x[i+1]=-B*v[i]+f*x[i+1],q=B*v[i+1],v[i+1]=f*v[i+1],h&&i<l-1)for(S=0;S<l;S++)p=f*s[S][i]+B*s[S][i+1],s[S][i+1]=-B*s[S][i]+f*s[S][i+1],s[S][i]=p}v[k-2]=I,++O;break}case 4:{if(0>=x[j]&&(x[j]=0>x[j]?-x[j]:0,m))for(S=0;S<=g;S++)y[S][j]=-y[S][j];for(;j<g&&!(x[j]>=x[j+1]);){if(p=x[j],x[j]=x[j+1],x[j+1]=p,m&&j<d-1)for(S=0;S<d;S++)p=y[S][j+1],y[S][j+1]=y[S][j],y[S][j]=p;if(h&&j<l-1)for(S=0;S<l;S++)p=s[S][j+1],s[S][j+1]=s[S][j],s[S][j]=p;j++}O=0,k--;break}}}if(_){var G=y;y=s,s=G}this.m=l,this.n=d,this.s=x,this.U=s,this.V=y}function T(e){for(var t=Array(e[0].length),a=0;a<t.length;++a)t[a]=Array(e.length);for(a=0;a<e.length;++a)for(var i=0;i<e[0].length;++i)t[i][a]=e[a][i];return t}function V(e,t,a,n,o){function s(e,t,i,a){return(a-t)/(i-e)}var r=e.length,l=(n-a)/(o-1),d=a-l/2,h=Array(o),g=e[1]-e[0],c=e[e.length-1]-e[e.length-2],m=d,p=d+l,u=ao,f=0,_=e[0]-g,b=0,w=0,x=0,y=0,k=0,v=0,D=0,i=0;main:for(;;){for(;0<=_-p;){var j=F(0,p-u,x,f);if(v=w+j,h[i]=(v-k)/l,i++,i===o)break main;m=p,p+=l,k=v}u<=m&&m<=_&&(j=F(0,m-u,x,f),k=w+j),w+=F(u,_,x,y),u=_,f=b,D<r?(_=e[D],b=t[D],D++):D===r&&(_+=c,b=0),x=s(u,f,_,b),y=-x*u+f}return h}function U(e,t,a,n,o){var s=e.length,r=(n-a)/(o-1),l=e[e.length-1]-e[e.length-2],d=a-r/2,h=Array(o),g=d,c=d+r,m=-io,p=0,u=e[0],f=t[0],_=0,b=!0,w=0,x=0,y=1,i=0;main:for(;;){if(m>=u)throw new Error('x must be an increasing serie');for(;0<m-c;){if(b&&(x++,b=!1),h[i]=0>=x?0:w/x,i++,i===o)break main;g=c,c+=r,w=0,x=0}m>g&&(w+=p,x++),(m==-io||1<_)&&x--,m=u,p=f,y<s?(u=e[y],f=t[y],y++):(u+=l,f=0,_++)}return h}function F(e,t,i,a){return 0.5*i*t*t+a*t-(0.5*i*e*e+a*e)}function Y(e,t,i){var a=i?e.rows:e.rows-1;if(0>t||t>a)throw new RangeError('Row index out of range')}function X(e,t,i){var a=i?e.columns:e.columns-1;if(0>t||t>a)throw new RangeError('Column index out of range')}function O(e,t){if(t.to1DArray&&(t=t.to1DArray()),t.length!==e.columns)throw new RangeError('vector size must be the same as the number of columns');return t}function N(e,t){if(t.to1DArray&&(t=t.to1DArray()),t.length!==e.rows)throw new RangeError('vector size must be the same as the number of rows');return t}function G(e,t,i){var a=t.some((t)=>{return 0>t||t>=e.rows}),n=i.some((t)=>{return 0>t||t>=e.columns});if(a||n)throw new RangeError('Indices are out of range');if('object'!=typeof t||'object'!=typeof i)throw new TypeError('Unexpected type for row/column indices');return Array.isArray(t)||(t=Array.from(t)),Array.isArray(i)||(t=Array.from(i)),{row:t,column:i}}function H(e,t,i,a,n){if(5!==arguments.length)throw new TypeError('Invalid argument type');var o=Array.from(arguments).slice(1).some(function(e){return'number'!=typeof e});if(o)throw new TypeError('Invalid argument type');if(t>i||a>n||0>t||t>=e.rows||0>i||i>=e.rows||0>a||a>=e.columns||0>n||n>=e.columns)throw new RangeError('Submatrix indices are out of range')}function W(e){for(var t=as.zeros(e.rows,1),a=0;a<e.rows;++a)for(var i=0;i<e.columns;++i)t.set(a,0,t.get(a,0)+e.get(a,i));return t}function Z(e){for(var t=as.zeros(1,e.columns),a=0;a<e.rows;++a)for(var i=0;i<e.columns;++i)t.set(0,i,t.get(0,i)+e.get(a,i));return t}function Q(e){for(var t=0,a=0;a<e.rows;a++)for(var i=0;i<e.columns;i++)t+=e.get(a,i);return t}function K(e){function t(e,t){return e-t}function a(e,t){for(var i in t)e=e.replace(new RegExp('%'+i+'%','g'),t[i]);return e}void 0===e&&(e=Object);class n extends e{static get[Symbol.species](){return this}static from1DArray(e,t,i){if(e*t!==i.length)throw new RangeError('Data length does not match given dimensions');for(var a=new this(e,t),n=0;n<e;n++)for(var o=0;o<t;o++)a.set(n,o,i[n*t+o]);return a}static rowVector(e){for(var t=new this(1,e.length),a=0;a<e.length;a++)t.set(0,a,e[a]);return t}static columnVector(e){for(var t=new this(e.length,1),a=0;a<e.length;a++)t.set(a,0,e[a]);return t}static empty(e,t){return new this(e,t)}static zeros(e,t){return this.empty(e,t).fill(0)}static ones(e,t){return this.empty(e,t).fill(1)}static rand(e,t,a){void 0===a&&(a=Math.random);for(var n=this.empty(e,t),o=0;o<e;o++)for(var i=0;i<t;i++)n.set(o,i,a());return n}static randInt(e,t,a,n){void 0===a&&(a=1e3),void 0===n&&(n=Math.random);for(var o=this.empty(e,t),s=0;s<e;s++)for(var i=0,r;i<t;i++)r=fo(n()*a),o.set(s,i,r);return o}static eye(e,t,a){void 0===t&&(t=e),void 0===a&&(a=1);for(var n=ro(e,t),o=this.zeros(e,t),s=0;s<n;s++)o.set(s,s,a);return o}static diag(e,t,a){var n=e.length;void 0===t&&(t=n),void 0===a&&(a=t);for(var o=ro(n,t,a),s=this.zeros(t,a),r=0;r<o;r++)s.set(r,r,e[r]);return s}static min(e,t){e=this.checkMatrix(e),t=this.checkMatrix(t);for(var a=e.rows,n=e.columns,o=new this(a,n),s=0;s<a;s++)for(var i=0;i<n;i++)o.set(s,i,ro(e.get(s,i),t.get(s,i)));return o}static max(e,t){e=this.checkMatrix(e),t=this.checkMatrix(t);for(var a=e.rows,n=e.columns,o=new this(a,n),s=0;s<a;s++)for(var i=0;i<n;i++)o.set(s,i,oo(e.get(s,i),t.get(s,i)));return o}static checkMatrix(e){return n.isMatrix(e)?e:new this(e)}static isMatrix(e){return null!=e&&'Matrix'===e.klass}get size(){return this.rows*this.columns}apply(e){if('function'!=typeof e)throw new TypeError('callback must be a function');for(var t=this.rows,a=this.columns,n=0;n<t;n++)for(var i=0;i<a;i++)e.call(this,n,i);return this}to1DArray(){for(var e=Array(this.size),t=0;t<this.rows;t++)for(var i=0;i<this.columns;i++)e[t*this.columns+i]=this.get(t,i);return e}to2DArray(){for(var e=Array(this.rows),t=0;t<this.rows;t++){e[t]=Array(this.columns);for(var i=0;i<this.columns;i++)e[t][i]=this.get(t,i)}return e}isRowVector(){return 1===this.rows}isColumnVector(){return 1===this.columns}isVector(){return 1===this.rows||1===this.columns}isSquare(){return this.rows===this.columns}isSymmetric(){if(this.isSquare()){for(var e=0;e<this.rows;e++)for(var t=0;t<=e;t++)if(this.get(e,t)!==this.get(t,e))return!1;return!0}return!1}set(){throw new Error('set method is unimplemented')}get(){throw new Error('get method is unimplemented')}repeat(e,t){e=e||1,t=t||1;for(var a=new this.constructor[Symbol.species](this.rows*e,this.columns*t),n=0;n<e;n++)for(var i=0;i<t;i++)a.setSubMatrix(this,this.rows*n,this.columns*i);return a}fill(e){for(var t=0;t<this.rows;t++)for(var i=0;i<this.columns;i++)this.set(t,i,e);return this}neg(){return this.mulS(-1)}getRow(e){Y(this,e);for(var t=Array(this.columns),a=0;a<this.columns;a++)t[a]=this.get(e,a);return t}getRowVector(e){return this.constructor.rowVector(this.getRow(e))}setRow(e,t){Y(this,e),t=O(this,t);for(var a=0;a<this.columns;a++)this.set(e,a,t[a]);return this}swapRows(e,t){Y(this,e),Y(this,t);for(var a=0,i;a<this.columns;a++)i=this.get(e,a),this.set(e,a,this.get(t,a)),this.set(t,a,i);return this}getColumn(e){X(this,e);for(var t=Array(this.rows),a=0;a<this.rows;a++)t[a]=this.get(a,e);return t}getColumnVector(e){return this.constructor.columnVector(this.getColumn(e))}setColumn(e,t){X(this,e),t=N(this,t);for(var a=0;a<this.rows;a++)this.set(a,e,t[a]);return this}swapColumns(e,t){X(this,e),X(this,t);for(var a=0,i;a<this.rows;a++)i=this.get(a,e),this.set(a,e,this.get(a,t)),this.set(a,t,i);return this}addRowVector(e){e=O(this,e);for(var t=0;t<this.rows;t++)for(var i=0;i<this.columns;i++)this.set(t,i,this.get(t,i)+e[i]);return this}subRowVector(e){e=O(this,e);for(var t=0;t<this.rows;t++)for(var i=0;i<this.columns;i++)this.set(t,i,this.get(t,i)-e[i]);return this}mulRowVector(e){e=O(this,e);for(var t=0;t<this.rows;t++)for(var i=0;i<this.columns;i++)this.set(t,i,this.get(t,i)*e[i]);return this}divRowVector(e){e=O(this,e);for(var t=0;t<this.rows;t++)for(var i=0;i<this.columns;i++)this.set(t,i,this.get(t,i)/e[i]);return this}addColumnVector(e){e=N(this,e);for(var t=0;t<this.rows;t++)for(var i=0;i<this.columns;i++)this.set(t,i,this.get(t,i)+e[t]);return this}subColumnVector(e){e=N(this,e);for(var t=0;t<this.rows;t++)for(var i=0;i<this.columns;i++)this.set(t,i,this.get(t,i)-e[t]);return this}mulColumnVector(e){e=N(this,e);for(var t=0;t<this.rows;t++)for(var i=0;i<this.columns;i++)this.set(t,i,this.get(t,i)*e[t]);return this}divColumnVector(e){e=N(this,e);for(var t=0;t<this.rows;t++)for(var i=0;i<this.columns;i++)this.set(t,i,this.get(t,i)/e[t]);return this}mulRow(e,t){Y(this,e);for(var a=0;a<this.columns;a++)this.set(e,a,this.get(e,a)*t);return this}mulColumn(e,t){X(this,e);for(var a=0;a<this.rows;a++)this.set(a,e,this.get(a,e)*t);return this}max(){for(var e=this.get(0,0),t=0;t<this.rows;t++)for(var i=0;i<this.columns;i++)this.get(t,i)>e&&(e=this.get(t,i));return e}maxIndex(){for(var e=this.get(0,0),t=[0,0],a=0;a<this.rows;a++)for(var i=0;i<this.columns;i++)this.get(a,i)>e&&(e=this.get(a,i),t[0]=a,t[1]=i);return t}min(){for(var e=this.get(0,0),t=0;t<this.rows;t++)for(var i=0;i<this.columns;i++)this.get(t,i)<e&&(e=this.get(t,i));return e}minIndex(){for(var e=this.get(0,0),t=[0,0],a=0;a<this.rows;a++)for(var i=0;i<this.columns;i++)this.get(a,i)<e&&(e=this.get(a,i),t[0]=a,t[1]=i);return t}maxRow(e){Y(this,e);for(var t=this.get(e,0),a=1;a<this.columns;a++)this.get(e,a)>t&&(t=this.get(e,a));return t}maxRowIndex(e){Y(this,e);for(var t=this.get(e,0),a=[e,0],n=1;n<this.columns;n++)this.get(e,n)>t&&(t=this.get(e,n),a[1]=n);return a}minRow(e){Y(this,e);for(var t=this.get(e,0),a=1;a<this.columns;a++)this.get(e,a)<t&&(t=this.get(e,a));return t}minRowIndex(e){Y(this,e);for(var t=this.get(e,0),a=[e,0],n=1;n<this.columns;n++)this.get(e,n)<t&&(t=this.get(e,n),a[1]=n);return a}maxColumn(e){X(this,e);for(var t=this.get(0,e),a=1;a<this.rows;a++)this.get(a,e)>t&&(t=this.get(a,e));return t}maxColumnIndex(e){X(this,e);for(var t=this.get(0,e),a=[0,e],n=1;n<this.rows;n++)this.get(n,e)>t&&(t=this.get(n,e),a[0]=n);return a}minColumn(e){X(this,e);for(var t=this.get(0,e),a=1;a<this.rows;a++)this.get(a,e)<t&&(t=this.get(a,e));return t}minColumnIndex(e){X(this,e);for(var t=this.get(0,e),a=[0,e],n=1;n<this.rows;n++)this.get(n,e)<t&&(t=this.get(n,e),a[0]=n);return a}diag(){for(var e=ro(this.rows,this.columns),t=Array(e),a=0;a<e;a++)t[a]=this.get(a,a);return t}sum(e){return'row'===e?W(this):'column'===e?Z(this):Q(this)}mean(){return this.sum()/this.size}prod(){for(var e=1,t=0;t<this.rows;t++)for(var i=0;i<this.columns;i++)e*=this.get(t,i);return e}cumulativeSum(){for(var e=0,t=0;t<this.rows;t++)for(var i=0;i<this.columns;i++)e+=this.get(t,i),this.set(t,i,e);return this}dot(e){n.isMatrix(e)&&(e=e.to1DArray());var t=this.to1DArray();if(t.length!==e.length)throw new RangeError('vectors do not have the same size');for(var a=0,o=0;o<t.length;o++)a+=t[o]*e[o];return a}mmul(e){e=this.constructor.checkMatrix(e),this.columns!==e.rows&&console.warn('Number of columns of left matrix are not equal to number of rows of right matrix.');for(var t=this.rows,a=this.columns,n=e.columns,o=new this.constructor[Symbol.species](t,n),r=Array(a),l=0;l<n;l++){for(var d=0;d<a;d++)r[d]=e.get(d,l);for(var h=0,i;h<t;h++){for(i=0,d=0;d<a;d++)i+=this.get(h,d)*r[d];o.set(h,l,i)}}return o}strassen2x2(e){var t=new this.constructor[Symbol.species](2,2);const i=this.get(0,0),a=e.get(0,0),n=this.get(0,1),o=e.get(0,1),s=this.get(1,0),r=e.get(1,0),l=this.get(1,1),d=e.get(1,1),h=(i+l)*(a+d),g=(s+l)*a,c=i*(o-d),m=l*(r-a),p=(i+n)*d;return t.set(0,0,h+m-p+(n-l)*(r+d)),t.set(0,1,c+p),t.set(1,0,g+m),t.set(1,1,h-g+c+(s-i)*(a+o)),t}strassen3x3(e){var t=new this.constructor[Symbol.species](3,3);const i=this.get(0,0),a=this.get(0,1),n=this.get(0,2),o=this.get(1,0),s=this.get(1,1),r=this.get(1,2),l=this.get(2,0),d=this.get(2,1),h=this.get(2,2),g=e.get(0,0),c=e.get(0,1),m=e.get(0,2),p=e.get(1,0),u=e.get(1,1),f=e.get(1,2),_=e.get(2,0),b=e.get(2,1),w=e.get(2,2),x=(i-o)*(-c+u),y=(-i+o+s)*(g-c+u),k=(o+s)*(-g+c),v=i*g,D=(-i+l+d)*(g-m+f),j=(-i+l)*(m-f),M=(l+d)*(-g+m),S=(-n+d+h)*(u+_-b),P=(n-h)*(u-b),I=n*_,B=(d+h)*(-_+b),C=(-n+s+r)*(f+_-w),A=(n-r)*(f-w),R=(s+r)*(-_+w);return t.set(0,0,v+I+a*p),t.set(0,1,(i+a+n-o-s-d-h)*u+y+k+v+S+I+B),t.set(0,2,v+D+M+(i+a+n-s-r-l-d)*f+I+C+R),t.set(1,0,x+s*(-g+c+p-u-f-_+w)+y+v+I+C+A),t.set(1,1,x+y+k+v+r*b),t.set(1,2,I+C+A+R+o*m),t.set(2,0,v+D+j+d*(-g+m+p-u-f-_+b)+S+P+I),t.set(2,1,S+P+I+B+l*c),t.set(2,2,v+D+j+M+h*w),t}mmulStrassen(e){function t(e,t,i){var a=e.rows,o=e.columns;if(a===t&&o===i)return e;var s=n.zeros(t,i);return s=s.setSubMatrix(e,0,0),s}function i(e,a,o,s){if(512>=o||512>=s)return e.mmul(a);1==o%2&&1==s%2?(e=t(e,o+1,s+1),a=t(a,o+1,s+1)):1==o%2?(e=t(e,o+1,s),a=t(a,o+1,s)):1==s%2&&(e=t(e,o,s+1),a=t(a,o,s+1));var r=parseInt(e.rows/2),l=parseInt(e.columns/2),d=e.subMatrix(0,r-1,0,l-1),h=a.subMatrix(0,r-1,0,l-1),g=e.subMatrix(0,r-1,l,e.columns-1),c=a.subMatrix(0,r-1,l,a.columns-1),m=e.subMatrix(r,e.rows-1,0,l-1),p=a.subMatrix(r,a.rows-1,0,l-1),u=e.subMatrix(r,e.rows-1,l,e.columns-1),f=a.subMatrix(r,a.rows-1,l,a.columns-1),_=i(n.add(d,u),n.add(h,f),r,l),b=i(n.add(m,u),h,r,l),w=i(d,n.sub(c,f),r,l),x=i(u,n.sub(p,h),r,l),y=i(n.add(d,g),f,r,l),k=i(n.sub(m,d),n.add(h,c),r,l),v=i(n.sub(g,u),n.add(p,f),r,l),D=n.add(_,x);D.sub(y),D.add(v);var j=n.add(w,y),M=n.add(b,x),S=n.sub(_,b);S.add(w),S.add(k);var P=n.zeros(2*D.rows,2*D.columns);return P=P.setSubMatrix(D,0,0),P=P.setSubMatrix(j,D.rows,0),P=P.setSubMatrix(M,0,D.columns),P=P.setSubMatrix(S,D.rows,D.columns),P.subMatrix(0,o-1,0,s-1)}var a=this.clone(),o=a.rows,s=a.columns,l=e.rows,d=e.columns;s!==l&&console.warn(`Multiplying ${o} x ${s} and ${l} x ${d} matrix: dimensions do not match.`);var h=oo(o,l),r=oo(s,d);return a=t(a,h,r),e=t(e,h,r),i(a,e,h,r)}scaleRows(e,t){if(e=void 0===e?0:e,t=void 0===t?1:t,e>=t)throw new RangeError('min should be strictly smaller than max');for(var a=this.constructor.empty(this.rows,this.columns),n=0,i;n<this.rows;n++)i=Wo(this.getRow(n),{min:e,max:t}),a.setRow(n,i);return a}scaleColumns(e,t){if(e=void 0===e?0:e,t=void 0===t?1:t,e>=t)throw new RangeError('min should be strictly smaller than max');for(var a=this.constructor.empty(this.rows,this.columns),n=0,i;n<this.columns;n++)i=Wo(this.getColumn(n),{min:e,max:t}),a.setColumn(n,i);return a}kroneckerProduct(e){e=this.constructor.checkMatrix(e);for(var t=this.rows,a=this.columns,n=e.rows,o=e.columns,s=new this.constructor[Symbol.species](t*n,a*o),r=0;r<t;r++)for(var i=0;i<a;i++)for(var d=0;d<n;d++)for(var h=0;h<o;h++)s[n*r+d][o*i+h]=this.get(r,i)*e.get(d,h);return s}transpose(){for(var e=new this.constructor[Symbol.species](this.columns,this.rows),t=0;t<this.rows;t++)for(var i=0;i<this.columns;i++)e.set(i,t,this.get(t,i));return e}sortRows(e){void 0===e&&(e=t);for(var a=0;a<this.rows;a++)this.setRow(a,this.getRow(a).sort(e));return this}sortColumns(e){void 0===e&&(e=t);for(var a=0;a<this.columns;a++)this.setColumn(a,this.getColumn(a).sort(e));return this}subMatrix(e,t,a,n){H(this,e,t,a,n);for(var o=new this.constructor[Symbol.species](t-e+1,n-a+1),s=e;s<=t;s++)for(var i=a;i<=n;i++)o[s-e][i-a]=this.get(s,i);return o}subMatrixRow(e,t,a){if(void 0===t&&(t=0),void 0===a&&(a=this.columns-1),t>a||0>t||t>=this.columns||0>a||a>=this.columns)throw new RangeError('Argument out of range');for(var n=new this.constructor[Symbol.species](e.length,a-t+1),o=0;o<e.length;o++)for(var i=t;i<=a;i++){if(0>e[o]||e[o]>=this.rows)throw new RangeError('Row index out of range: '+e[o]);n.set(o,i-t,this.get(e[o],i))}return n}subMatrixColumn(e,t,a){if(void 0===t&&(t=0),void 0===a&&(a=this.rows-1),t>a||0>t||t>=this.rows||0>a||a>=this.rows)throw new RangeError('Argument out of range');for(var n=new this.constructor[Symbol.species](a-t+1,e.length),o=0;o<e.length;o++)for(var i=t;i<=a;i++){if(0>e[o]||e[o]>=this.columns)throw new RangeError('Column index out of range: '+e[o]);n.set(i-t,o,this.get(i,e[o]))}return n}setSubMatrix(e,t,a){e=this.constructor.checkMatrix(e);var n=t+e.rows-1,o=a+e.columns-1;H(this,t,n,a,o);for(var s=0;s<e.rows;s++)for(var i=0;i<e.columns;i++)this[t+s][a+i]=e.get(s,i);return this}selection(e,t){for(var a=G(this,e,t),n=new this.constructor[Symbol.species](e.length,t.length),o=0,i;o<a.row.length;o++){i=a.row[o];for(var s=0,r;s<a.column.length;s++)r=a.column[s],n[o][s]=this.get(i,r)}return n}trace(){for(var e=ro(this.rows,this.columns),t=0,a=0;a<e;a++)t+=this.get(a,a);return t}transposeView(){return new Qo(this)}rowView(e){return Y(this,e),new Ko(this,e)}columnView(e){return X(this,e),new es(this,e)}flipRowView(){return new ts(this)}flipColumnView(){return new is(this)}subMatrixView(e,t,i,a){return new Jo(this,e,t,i,a)}selectionView(e,t){return new $o(this,e,t)}det(){if(this.isSquare()){var e,t,i,a;if(2===this.columns)return e=this.get(0,0),t=this.get(0,1),i=this.get(1,0),a=this.get(1,1),e*a-t*i;if(3===this.columns){var n,o,s;return n=this.selectionView([1,2],[1,2]),o=this.selectionView([1,2],[0,2]),s=this.selectionView([1,2],[0,1]),e=this.get(0,0),t=this.get(0,1),i=this.get(0,2),e*n.det()-t*o.det()+i*s.det()}return new R(this).determinant}throw Error('Determinant can only be calculated for a square matrix.')}pseudoInverse(e){void 0===e&&(e=eo);for(var t=new E(this,{autoTranspose:!0}),a=t.leftSingularVectors,n=t.rightSingularVectors,o=t.diagonal,s=0;s<o.length;s++)o[s]=so(o[s])>e?1/o[s]:0;return o=this.constructor[Symbol.species].diag(o),n.mmul(o.mmul(a.transposeView()))}}n.prototype.klass='Matrix',n.random=n.rand,n.diagonal=n.diag,n.prototype.diagonal=n.prototype.diag,n.identity=n.eye,n.prototype.negate=n.prototype.neg,n.prototype.tensorProduct=n.prototype.kroneckerProduct,n.prototype.determinant=n.prototype.det;var o=`
(function %name%(value) {
    if (typeof value === 'number') return this.%name%S(value);
    return this.%name%M(value);
})
`,s=`
(function %name%S(value) {
    for (var i = 0; i < this.rows; i++) {
        for (var j = 0; j < this.columns; j++) {
            this.set(i, j, this.get(i, j) %op% value);
        }
    }
    return this;
})
`,r=`
(function %name%M(matrix) {
    matrix = this.constructor.checkMatrix(matrix);
    if (this.rows !== matrix.rows ||
        this.columns !== matrix.columns) {
        throw new RangeError('Matrices dimensions must be equal');
    }
    for (var i = 0; i < this.rows; i++) {
        for (var j = 0; j < this.columns; j++) {
            this.set(i, j, this.get(i, j) %op% matrix.get(i, j));
        }
    }
    return this;
})
`,l=`
(function %name%(matrix, value) {
    var newMatrix = new this[Symbol.species](matrix);
    return newMatrix.%name%(value);
})
`,d=`
(function %name%() {
    for (var i = 0; i < this.rows; i++) {
        for (var j = 0; j < this.columns; j++) {
            this.set(i, j, %method%(this.get(i, j)));
        }
    }
    return this;
})
`,h=`
(function %name%(matrix) {
    var newMatrix = new this[Symbol.species](matrix);
    return newMatrix.%name%();
})
`,g=`
(function %name%(%args%) {
    for (var i = 0; i < this.rows; i++) {
        for (var j = 0; j < this.columns; j++) {
            this.set(i, j, %method%(this.get(i, j), %args%));
        }
    }
    return this;
})
`,c=`
(function %name%(matrix, %args%) {
    var newMatrix = new this[Symbol.species](matrix);
    return newMatrix.%name%(%args%);
})
`,m=`
(function %name%S(value) {
    for (var i = 0; i < this.rows; i++) {
        for (var j = 0; j < this.columns; j++) {
            this.set(i, j, %method%(this.get(i, j), value));
        }
    }
    return this;
})
`,p=`
(function %name%M(matrix) {
    matrix = this.constructor.checkMatrix(matrix);
    if (this.rows !== matrix.rows ||
        this.columns !== matrix.columns) {
        throw new RangeError('Matrices dimensions must be equal');
    }
    for (var i = 0; i < this.rows; i++) {
        for (var j = 0; j < this.columns; j++) {
            this.set(i, j, %method%(this.get(i, j), matrix.get(i, j)));
        }
    }
    return this;
})
`,u=`
(function %name%(value) {
    if (typeof value === 'number') return this.%name%S(value);
    return this.%name%M(value);
})
`,f=[['+','add'],['-','sub','subtract'],['*','mul','multiply'],['/','div','divide'],['%','mod','modulus'],['&','and'],['|','or'],['^','xor'],['<<','leftShift'],['>>','signPropagatingRightShift'],['>>>','rightShift','zeroFillRightShift']],_=eval,b;for(var i of f){var w=_(a(o,{name:i[1],op:i[0]})),x=_(a(s,{name:i[1]+'S',op:i[0]})),y=_(a(r,{name:i[1]+'M',op:i[0]})),k=_(a(l,{name:i[1]}));for(b=1;b<i.length;b++)n.prototype[i[b]]=w,n.prototype[i[b]+'S']=x,n.prototype[i[b]+'M']=y,n[i[b]]=k}var v=[['~','not']];['abs','acos','acosh','asin','asinh','atan','atanh','cbrt','ceil','clz32','cos','cosh','exp','expm1','floor','fround','log','log1p','log10','log2','round','sign','sin','sinh','sqrt','tan','tanh','trunc'].forEach(function(e){v.push(['Math.'+e,e])});for(var D of v){var j=_(a(d,{name:D[1],method:D[0]})),M=_(a(h,{name:D[1]}));for(b=1;b<D.length;b++)n.prototype[D[b]]=j,n[D[b]]=M}var S=[['Math.pow',1,'pow']];for(var P of S){var I='arg0';for(b=1;b<P[1];b++)I+=`, arg${b}`;if(1!==P[1]){var B=_(a(g,{name:P[2],method:P[0],args:I})),C=_(a(c,{name:P[2],args:I}));for(b=2;b<P.length;b++)n.prototype[P[b]]=B,n[P[b]]=C}else{var A={name:P[2],args:I,method:P[0]},z=_(a(u,A)),L=_(a(m,A)),T=_(a(p,A)),V=_(a(c,A));for(b=2;b<P.length;b++)n.prototype[P[b]]=z,n.prototype[P[b]+'M']=T,n.prototype[P[b]+'S']=L,n[P[b]]=V}}return n}function J(e){if(!(this instanceof J))return new J(e);e=as.checkMatrix(e);var t=e.clone(),a=e.rows,o=e.columns,n=Array(o),r,i,l,d;for(l=0;l<o;l++){var h=0;for(r=l;r<a;r++)h=z(h,t[r][l]);if(0!==h){for(0>t[l][l]&&(h=-h),r=l;r<a;r++)t[r][l]/=h;for(t[l][l]+=1,i=l+1;i<o;i++){for(d=0,r=l;r<a;r++)d+=t[r][l]*t[r][i];for(d=-d/t[l][l],r=l;r<a;r++)t[r][i]+=d*t[r][l]}}n[l]=-h}this.QR=t,this.Rdiag=n}function $(e,t){return e=as.checkMatrix(e),t=as.checkMatrix(t),e.isSquare()?new R(e).solve(t):new J(e).solve(t)}function ee(t,a){if(a=Object.assign({},ns,a),!(this instanceof ee))return new ee(t,a);if(t=as.checkMatrix(t),!t.isSquare())throw new Error('Matrix is not a square matrix');var o=t.columns,n=L(o,o,0),s=Array(o),r=Array(o),e=t,l=!1,d,i;if(l=!!a.assumeSymmetric||t.isSymmetric(),l){for(d=0;d<o;d++)for(i=0;i<o;i++)n[d][i]=e.get(d,i);te(o,r,s,n),ie(o,r,s,n)}else{var h=L(o,o,0),g=Array(o);for(i=0;i<o;i++)for(d=0;d<o;d++)h[d][i]=e.get(d,i);ae(o,h,g,n),ne(o,r,s,n,h)}this.n=o,this.e=r,this.d=s,this.V=n}function te(t,a,e,n){var o,s,r,l,i,d,h,c;for(i=0;i<t;i++)e[i]=n[t-1][i];for(l=t-1;0<l;l--){for(c=0,r=0,d=0;d<l;d++)c+=so(e[d]);if(0===c)for(a[l]=e[l-1],i=0;i<l;i++)e[i]=n[l-1][i],n[l][i]=0,n[i][l]=0;else{for(d=0;d<l;d++)e[d]/=c,r+=e[d]*e[d];for(o=e[l-1],s=mo(r),0<o&&(s=-s),a[l]=c*s,r-=o*s,e[l-1]=o-s,i=0;i<l;i++)a[i]=0;for(i=0;i<l;i++){for(o=e[i],n[i][l]=o,s=a[i]+n[i][i]*o,d=i+1;d<=l-1;d++)s+=n[d][i]*e[d],a[d]+=n[d][i]*o;a[i]=s}for(o=0,i=0;i<l;i++)a[i]/=r,o+=a[i]*e[i];for(h=o/(r+r),i=0;i<l;i++)a[i]-=h*e[i];for(i=0;i<l;i++){for(o=e[i],s=a[i],d=i;d<=l-1;d++)n[d][i]-=o*a[d]+s*e[d];e[i]=n[l-1][i],n[l][i]=0}}e[l]=r}for(l=0;l<t-1;l++){if(n[t-1][l]=n[l][l],n[l][l]=1,r=e[l+1],0!==r){for(d=0;d<=l;d++)e[d]=n[d][l+1]/r;for(i=0;i<=l;i++){for(s=0,d=0;d<=l;d++)s+=n[d][l+1]*n[d][i];for(d=0;d<=l;d++)n[d][i]-=s*e[d]}}for(d=0;d<=l;d++)n[d][l+1]=0}for(i=0;i<t;i++)e[i]=n[t-1][i],n[t-1][i]=0;n[t-1][t-1]=1,a[0]=0}function ie(t,a,e,n){var o,d,h,i,g,u,l,m,p,_,b,c,w,x,y,k,v;for(h=1;h<t;h++)a[h-1]=a[h];a[t-1]=0;var D=0,f=0,j=2.220446049250313e-16;for(u=0;u<t;u++){for(f=oo(f,so(e[u])+so(a[u])),l=u;l<t&&!(so(a[l])<=j*f);)l++;if(l>u){v=0;do{for(++v,o=e[u],m=(e[u+1]-o)/(2*a[u]),p=z(m,1),0>m&&(p=-p),e[u]=a[u]/(m+p),e[u+1]=a[u]*(m+p),_=e[u+1],d=o-e[u],h=u+2;h<t;h++)e[h]-=d;for(D+=d,m=e[l],b=1,c=b,w=b,x=a[u+1],y=0,k=0,h=l-1;h>=u;h--)for(w=c,c=b,k=y,o=b*a[h],d=b*m,p=z(m,a[h]),a[h+1]=y*p,y=a[h]/p,b=m/p,m=b*e[h]-y*o,e[h+1]=d+y*(b*o+y*e[h]),g=0;g<t;g++)d=n[g][h+1],n[g][h+1]=y*n[g][h]+b*d,n[g][h]=b*n[g][h]-y*d;m=-y*k*w*x*a[u]/_,a[u]=y*m,e[u]=b*m}while(so(a[u])>j*f)}e[u]+=D,a[u]=0}for(h=0;h<t-1;h++){for(g=h,m=e[h],i=h+1;i<t;i++)e[i]<m&&(g=i,m=e[i]);if(g!==h)for(e[g]=e[h],e[h]=m,i=0;i<t;i++)m=n[i][h],n[i][h]=n[i][g],n[i][g]=m}}function ae(e,t,a,n){var o=0,s=e-1,r,l,d,h,i,c,m;for(c=o+1;c<=s-1;c++){for(m=0,h=c;h<=s;h++)m+=so(t[h][c-1]);if(0!==m){for(d=0,h=s;h>=c;h--)a[h]=t[h][c-1]/m,d+=a[h]*a[h];for(l=mo(d),0<a[c]&&(l=-l),d-=a[c]*l,a[c]-=l,i=c;i<e;i++){for(r=0,h=s;h>=c;h--)r+=a[h]*t[h][i];for(r/=d,h=c;h<=s;h++)t[h][i]-=r*a[h]}for(h=0;h<=s;h++){for(r=0,i=s;i>=c;i--)r+=a[i]*t[h][i];for(r/=d,i=c;i<=s;i++)t[h][i]-=r*a[i]}a[c]=m*a[c],t[c][c-1]=m*l}}for(h=0;h<e;h++)for(i=0;i<e;i++)n[h][i]=h===i?1:0;for(c=s-1;c>=o+1;c--)if(0!==t[c][c-1]){for(h=c+1;h<=s;h++)a[h]=t[h][c-1];for(i=c;i<=s;i++){for(l=0,h=c;h<=s;h++)l+=a[h]*n[h][i];for(l=l/a[c]/t[c][c-1],h=c;h<=s;h++)n[h][i]+=l*a[h]}}}function ne(a,o,e,d,h){var g=a-1,n=0,c=a-1,u=2.220446049250313e-16,f=0,_=0,b=0,p=0,v=0,D=0,M=0,S=0,P,i,j,k,l,m,t,w,x,y,I,B,C,A,R;for(P=0;P<a;P++)for((P<n||P>c)&&(e[P]=h[P][P],o[P]=0),i=oo(P-1,0);i<a;i++)_+=so(h[P][i]);for(;g>=n;){for(k=g;k>n&&(D=so(h[k-1][k-1])+so(h[k][k]),0===D&&(D=_),!(so(h[k][k-1])<u*D));)k--;if(k===g)h[g][g]+=f,e[g]=h[g][g],o[g]=0,g--,S=0;else if(k===g-1){if(t=h[g][g-1]*h[g-1][g],b=(h[g-1][g-1]-h[g][g])/2,p=b*b+t,M=mo(so(p)),h[g][g]+=f,h[g-1][g-1]=h[g-1][g-1]+f,w=h[g][g],0<=p){for(M=0<=b?b+M:b-M,e[g-1]=w+M,e[g]=e[g-1],0!==M&&(e[g]=w-t/M),o[g-1]=0,o[g]=0,w=h[g][g-1],D=so(w)+so(M),b=w/D,p=M/D,v=mo(b*b+p*p),b/=v,p/=v,i=g-1;i<a;i++)M=h[g-1][i],h[g-1][i]=p*M+b*h[g][i],h[g][i]=p*h[g][i]-b*M;for(P=0;P<=g;P++)M=h[P][g-1],h[P][g-1]=p*M+b*h[P][g],h[P][g]=p*h[P][g]-b*M;for(P=n;P<=c;P++)M=d[P][g-1],d[P][g-1]=p*M+b*d[P][g],d[P][g]=p*d[P][g]-b*M}else e[g-1]=w+b,e[g]=w+b,o[g-1]=M,o[g]=-M;g-=2,S=0}else{if(w=h[g][g],x=0,t=0,k<g&&(x=h[g-1][g-1],t=h[g][g-1]*h[g-1][g]),10==S){for(f+=w,P=n;P<=g;P++)h[P][P]-=w;D=so(h[g][g-1])+so(h[g-1][g-2]),w=x=0.75*D,t=-0.4375*D*D}if(30==S&&(D=(x-w)/2,D=D*D+t,0<D)){for(D=mo(D),x<w&&(D=-D),D=w-t/((x-w)/2+D),P=n;P<=g;P++)h[P][P]-=D;f+=D,w=x=t=0.964}for(++S,l=g-2;l>=k&&(M=h[l][l],v=w-M,D=x-M,b=(v*D-t)/h[l+1][l]+h[l][l+1],p=h[l+1][l+1]-M-v-D,v=h[l+2][l+1],D=so(b)+so(p)+so(v),b/=D,p/=D,v/=D,l!==k)&&!(so(h[l][l-1])*(so(p)+so(v))<u*(so(b)*(so(h[l-1][l-1])+so(M)+so(h[l+1][l+1]))));)l--;for(P=l+2;P<=g;P++)h[P][P-2]=0,P>l+2&&(h[P][P-3]=0);for(j=l;j<=g-1&&(A=j!==g-1,j!==l&&(b=h[j][j-1],p=h[j+1][j-1],v=A?h[j+2][j-1]:0,w=so(b)+so(p)+so(v),0!==w&&(b/=w,p/=w,v/=w)),0!==w);j++)if(D=mo(b*b+p*p+v*v),0>b&&(D=-D),0!==D){for(j===l?k!==l&&(h[j][j-1]=-h[j][j-1]):h[j][j-1]=-D*w,b+=D,w=b/D,x=p/D,M=v/D,p/=b,v/=b,i=j;i<a;i++)b=h[j][i]+p*h[j+1][i],A&&(b+=v*h[j+2][i],h[j+2][i]=h[j+2][i]-b*M),h[j][i]-=b*w,h[j+1][i]=h[j+1][i]-b*x;for(P=0;P<=ro(g,j+3);P++)b=w*h[P][j]+x*h[P][j+1],A&&(b+=M*h[P][j+2],h[P][j+2]=h[P][j+2]-b*v),h[P][j]-=b,h[P][j+1]=h[P][j+1]-b*p;for(P=n;P<=c;P++)b=w*d[P][j]+x*d[P][j+1],A&&(b+=M*d[P][j+2],d[P][j+2]=d[P][j+2]-b*v),d[P][j]-=b,d[P][j+1]=d[P][j+1]-b*p}}}if(0!==_){for(g=a-1;0<=g;g--)if(b=e[g],p=o[g],0===p)for(k=g,h[g][g]=1,P=g-1;0<=P;P--){for(t=h[P][P]-b,v=0,i=k;i<=g;i++)v+=h[P][i]*h[i][g];if(0>o[P])M=t,D=v;else if(k=P,0===o[P]?h[P][g]=0===t?-v/(u*_):-v/t:(w=h[P][P+1],x=h[P+1][P],p=(e[P]-b)*(e[P]-b)+o[P]*o[P],m=(w*D-M*v)/p,h[P][g]=m,h[P+1][g]=so(w)>so(M)?(-v-t*m)/w:(-D-x*m)/M),m=so(h[P][g]),1<u*m*m)for(i=P;i<=g;i++)h[i][g]/=m}else if(0>p)for(k=g-1,so(h[g][g-1])>so(h[g-1][g])?(h[g-1][g-1]=p/h[g][g-1],h[g-1][g]=-(h[g][g]-b)/h[g][g-1]):(R=oe(0,-h[g-1][g],h[g-1][g-1]-b,p),h[g-1][g-1]=R[0],h[g-1][g]=R[1]),h[g][g-1]=0,h[g][g]=1,P=g-2;0<=P;P--){for(y=0,I=0,i=k;i<=g;i++)y+=h[P][i]*h[i][g-1],I+=h[P][i]*h[i][g];if(t=h[P][P]-b,0>o[P])M=t,v=y,D=I;else if(k=P,0===o[P]?(R=oe(-y,-I,t,p),h[P][g-1]=R[0],h[P][g]=R[1]):(w=h[P][P+1],x=h[P+1][P],B=(e[P]-b)*(e[P]-b)+o[P]*o[P]-p*p,C=2*(e[P]-b)*p,0===B&&0===C&&(B=u*_*(so(t)+so(p)+so(w)+so(x)+so(M))),R=oe(w*v-M*y+p*I,w*D-M*I-p*y,B,C),h[P][g-1]=R[0],h[P][g]=R[1],so(w)>so(M)+so(p)?(h[P+1][g-1]=(-y-t*h[P][g-1]+p*h[P][g])/w,h[P+1][g]=(-I-t*h[P][g]-p*h[P][g-1])/w):(R=oe(-v-x*h[P][g-1],-D-x*h[P][g],M,p),h[P+1][g-1]=R[0],h[P+1][g]=R[1])),m=oo(so(h[P][g-1]),so(h[P][g])),1<u*m*m)for(i=P;i<=g;i++)h[i][g-1]=h[i][g-1]/m,h[i][g]/=m}for(P=0;P<a;P++)if(P<n||P>c)for(i=P;i<a;i++)d[P][i]=h[P][i];for(i=a-1;i>=n;i--)for(P=n;P<=c;P++){for(M=0,j=n;j<=ro(i,c);j++)M+=d[P][j]*h[j][i];d[P][i]=M}}}function oe(e,t,i,a){var n,o;return so(i)>so(a)?(n=a/i,o=i+n*a,[(e+n*t)/o,(t-n*e)/o]):(n=i/a,o=a+n*i,[(n*e+t)/o,(n*t-e)/o])}function se(e){if(!(this instanceof se))return new se(e);if(e=as.checkMatrix(e),!e.isSymmetric())throw new Error('Matrix is not symmetric');var t=e,a=t.rows,n=new as(a,a),o=!0,r,i,l;for(i=0;i<a;i++){var h=n[i],g=0;for(l=0;l<i;l++){var d=n[l],c=0;for(r=0;r<l;r++)c+=d[r]*h[r];h[l]=c=(t[i][l]-c)/n[l][l],g+=c*c}for(g=t[i][i]-g,o&=0<g,n[i][i]=mo(oo(g,0)),l=i+1;l<a;l++)n[i][l]=0}if(!o)throw new Error('Matrix is not positive definite');this.L=n}function re(e){var t=new E(e,{autoTranspose:!0});if(1!==t.rank)return null;var i=mo(t.s[0]),a=t.U.map((e)=>e[0]*i),n=t.V.map((e)=>e[0]*i);return[a,n]}function le(e,t={}){var a=t.channels,n=t.bitDepth,o=t.normalize,s=void 0!==o&&o,r=t.divisor,l=void 0===r?1:r,d=t.border,h=void 0===d?'copy':d,g=t.algorithm,m=void 0===g?'auto':g,p=mc.createFrom(this,{bitDepth:n});if(a=u(this,a,!0),'separable'!==m){var f=I(e);e=f.kernel}else if(!Array.isArray(e)||2!==e.length)throw new RangeError('separable convolution requires two arrays of numbers to represent the kernel');if('auto'===m){var _=re(e);null===_?(9<e.length||9<e[0].length)&&4096>=this.width&&4096>=this.height?m='fft':m='direct':(m='separable',e=_)}var b,w;'separable'===m?(b=fo(e[0].length/2),w=fo(e[1].length/2)):(b=fo(e.length/2),w=fo(e[0].length/2));var k=p.isClamped,v=Array(this.height*this.width),D,M,x,y,S,c;for(y=0;y<a.length;y++){for(S=a[y],x=0;x<this.height;x++)for(M=0;M<this.width;M++)D=x*this.width+M,v[D]=this.data[D*this.channels+S];if('direct'===m)c=Lo(v,e,{rows:this.height,cols:this.width,normalize:s,divisor:l});else if('separable'===m){if(c=A(v,e,this.width,this.height),s){l=0;for(var P=0;P<e[0].length;P++)for(var i=0;i<e[1].length;i++)l+=e[0][P]*e[1][i]}if(1!==l)for(var j=0;j<c.length;j++)c[j]/=l}else c=Eo(v,e,{rows:this.height,cols:this.width,normalize:s,divisor:l});for(x=0;x<this.height;x++)for(M=0;M<this.width;M++)D=x*this.width+M,p.data[D*this.channels+S]=k?ro(oo(c[D],0),p.maxValue):c[D]}if(this.alpha&&!a.includes(this.channels))for(M=this.components;M<this.data.length;M+=this.channels)p.data[M]=this.data[M];return'periodic'!==h&&p.setBorder({size:[w,b],algorithm:h}),p}function de(e={}){var t=e.radius,i=void 0===t?1:t,a=e.sigma,n=e.channels,o=e.border,s=void 0===o?'copy':o;this.checkProcessable('gaussian',{bitDepth:[8,16]});var r;return a?r=ge(a):(a=0.3*(i-1)+0.8,r=he(i,a)),le.call(this,[r,r],{border:s,channels:n,algorithm:'separable'})}function he(e,t){if(1>e)throw new RangeError('Radius should be grater than 0');for(var a=Array(2*e+1),n=0,i;n<=e;n++)i=co(n*n*(0-1/(2*t*t)))*(1/(t*ss)),a[e+n]=i,a[e-n]=i;return a}function ge(e){if(0>=e)throw new RangeError('Sigma should be grater than 0');for(var t=2*(e*e),a=uo*t,n=1/a,o=n,s=0;0.99>o;){s++,n=co(-(s*s)/t)/a,o+=4*n;for(var r=1;r<s;r++)n=co(-(r*r+s*s)/t)/a,o+=8*n;n=4*co(-(2*s*s)/t)/a,o+=n}if(1<o)throw new Error('unexpected sum over 1');return he(s,e)}function ce(e={}){var t=e.kernelX,i=void 0===t?rs:t,a=e.kernelY,n=void 0===a?ls:a,o=e.border,s=void 0===o?'copy':o,r=e.channels,l=e.bitDepth,d=void 0===l?this.bitDepth:l;this.checkProcessable('sobel',{bitDepth:[8,16]});var h=le.call(this,i,{channels:r,border:s,bitDepth:32}),g=le.call(this,n,{channels:r,border:s,bitDepth:32});return h.hypotenuse(g,{bitDepth:d,channels:r})}function me(e={}){var t=e.algorithm,i=void 0===t?'range':t,a=e.channels,n=e.min,o=void 0===n?this.min:n,s=e.max,r=void 0===s?this.max:s;switch(this.checkProcessable('level',{bitDepth:[8,16]}),a=u(this,{channels:a}),i){case'range':0>o&&(o=0),r>this.maxValue&&(r=this.maxValue),Array.isArray(o)||(o=ds(a.length,o)),Array.isArray(r)||(r=ds(a.length,r)),pe(this,o,r,a);break;default:throw new Error('level: algorithm not implement: '+i);}return this}function pe(e,t,a,n){var o=1e-5,s=Array(e.channels);for(var r of n)s[r]=0===t[r]&&a[r]===e.maxValue?0:a[r]===t[r]?0:(e.maxValue+1-o)/(a[r]-t[r]),t[r]+=(0.5-o/2)/s[r];for(var l=0,d;l<n.length;l++)if(d=n[l],0!==s[d])for(var h=0;h<e.data.length;h+=e.channels)e.data[h+d]=ro(oo(0,0|(e.data[h+d]-t[d])*s[d]+0.5),e.maxValue)}function ue(e){if(!isNaN(e)){if(0>=e)throw new Error('checkNumberArray: the value must be greater than 0');return e}if(e instanceof mc)return e.data;if(!gs(e))throw new Error('checkNumberArray: the value should be either a number, array or Image');return e}function fe(e,t={}){var a=t.channels;if(this.checkProcessable('add',{bitDepth:[8,16]}),a=u(this,{channels:a}),e=ue(e),!isNaN(e))for(var n=0,o;n<a.length;n++){o=a[n];for(var s=0;s<this.data.length;s+=this.channels)this.data[s+o]=ro(this.maxValue,this.data[s+o]+e>>0)}else{if(this.data.length!==e.length)throw new Error('add: the data size is different');for(var i=0,r;i<a.length;i++){r=a[i];for(var l=0;l<this.data.length;l+=this.channels)this.data[l+r]=oo(0,ro(this.maxValue,this.data[l+r]+e[l+r]>>0))}}return this}function _e(e,t={}){var a=t.channels;if(this.checkProcessable('subtract',{bitDepth:[8,16]}),a=u(this,{channels:a}),e=ue(e),!isNaN(e))for(var n=0,o;n<a.length;n++){o=a[n];for(var s=0;s<this.data.length;s+=this.channels)this.data[s+o]=oo(0,this.data[s+o]-e>>0)}else{if(this.data.length!==e.length)throw new Error('substract: the data size is different');for(var i=0,r;i<a.length;i++){r=a[i];for(var l=0;l<this.data.length;l+=this.channels)this.data[l+r]=oo(0,ro(this.maxValue,this.data[l+r]-e[l+r]>>0))}}return this}function be(e,t={}){var a=t.bitDepth,n=void 0===a?this.bitDepth:a,o=t.channels;if(this.checkProcessable('hypotenuse',{bitDepth:[8,16,32]}),this.width!==e.width||this.height!==e.height)throw new Error('hypotenuse: both images must have the same size');if(this.alpha!==e.alpha||this.bitDepth!==e.bitDepth)throw new Error('hypotenuse: both images must have the same alpha and bitDepth');if(this.channels!==e.channels)throw new Error('hypotenuse: both images must have the same number of channels');var s=mc.createFrom(this,{bitDepth:n});o=u(this,{channels:o});for(var r=s.isClamped,l=0,d;l<o.length;l++){d=o[l];for(var h=d,i;h<this.data.length;h+=this.channels)i=Math.hypot(this.data[h],e.data[h]),s.data[h]=r?ro(oo(go(i),0),s.maxValue):i}return s}function we(e,t={}){var a=t.channels;if(this.checkProcessable('multiply',{bitDepth:[8,16]}),0>=e)throw new Error('multiply: the value must be greater than 0');if(a=u(this,{channels:a}),e=ue(e),!isNaN(e))for(var n=0,o;n<a.length;n++){o=a[n];for(var s=0;s<this.data.length;s+=this.channels)this.data[s+o]=ro(this.maxValue,this.data[s+o]*e>>0)}else{if(this.data.length!==e.length)throw new Error('multiply: the data size is different');for(var i=0,r;i<a.length;i++){r=a[i];for(var l=0;l<this.data.length;l+=this.channels)this.data[l+r]=oo(0,ro(this.maxValue,this.data[l+r]*e[l+r]>>0))}}return this}function xe(e,t={}){var a=t.channels;if(this.checkProcessable('divide',{bitDepth:[8,16]}),a=u(this,{channels:a}),e=ue(e),!isNaN(e))for(var n=0,o;n<a.length;n++){o=a[n];for(var s=0;s<this.data.length;s+=this.channels)this.data[s+o]=ro(this.maxValue,this.data[s+o]/e>>0)}else{if(this.data.length!==e.length)throw new Error('divide: the: the data size is different');for(var i=0,r;i<a.length;i++){r=a[i];for(var l=0;l<this.data.length;l+=this.channels)this.data[l+r]=oo(0,ro(this.maxValue,this.data[l+r]/e[l+r]>>0))}}return this}function ye(e,t){for(var a=0,n=0;n<e.length;n++)a+=(e[n]-t[n])*(e[n]-t[n]);return a}function ke(e,t){return mo(ye(e,t))}function ve(e,t){for(var a=e.clone(),n=0;n<e.rows;++n)a[n][0]=no(a[n][0],t);return a}function De(e,t){this[e][t]=so(this[e][t])}function je(e,t,a){for(var n=new lr(e,t,a),o=Array(this.size),s=0;s<this.width;s++)for(var i=0;i<this.height;i++)o[i*this.width+s]=[s,i];for(var r=n.predict(o),l=mc.createFrom(this),d=0;d<this.size;d++)l.data[d]=ro(this.maxValue,oo(0,r[d][0]));return l}function Me(e={}){var t=e.x,a=void 0===t?0:t,n=e.y,o=void 0===n?0:n,s=e.width,r=void 0===s?this.width-a:s,l=e.height,d=void 0===l?this.height-o:l;if(this.checkProcessable('max',{bitDepth:[8,16]}),a=go(a),o=go(o),r=go(r),d=go(d),a>this.width-1||o>this.height-1)throw new RangeError(`crop: origin (x:${a}, y:${o}) out of range (${this.width-1}; ${this.height-1})`);if(0>=r||0>=d)throw new RangeError(`crop: width and height (width:${r}; height:${d}) must be positive numbers`);if(0>a||0>o)throw new RangeError(`crop: x and y (x:${a}, y:${o}) must be positive numbers`);if(r>this.width-a||d>this.height-o)throw new RangeError(`crop: (x: ${a}, y:${o}, width:${r}, height:${d}) size is out of range`);for(var h=mc.createFrom(this,{width:r,height:d,position:[a,o]}),g=r*this.channels,c=o+d,m=0,p=a*this.channels,u=o;u<c;u++)for(var i=u*this.width*this.channels+p,f=i+g;i<f;i++)h.data[m++]=this.data[i];return h}function Se(e={}){this.checkProcessable('cropAlpha',{alpha:1});var t=e.threshold,i=void 0===t?this.maxValue:t,a=Pe(this,i,this.components);if(-1===a)throw new Error('Could not find new dimensions. Threshold may be too high.');var n=Ie(this,i,this.components,a),o=Be(this,i,this.components,a),s=Ce(this,i,this.components,a,n,o);return this.crop({x:a,y:n,width:s-a+1,height:o-n+1})}function Pe(e,t,i){for(var a=0;a<e.width;a++)for(var n=0;n<e.height;n++)if(e.getValueXY(a,n,i)>=t)return a;return-1}function Ie(e,t,i,a){for(var n=0;n<e.height;n++)for(var o=a;o<e.width;o++)if(e.getValueXY(o,n,i)>=t)return n;return-1}function Be(e,t,i,a){for(var n=e.height-1;0<=n;n--)for(var o=a;o<e.width;o++)if(e.getValueXY(o,n,i)>=t)return n;return-1}function Ce(e,t,i,a,n,o){for(var s=e.width-1;s>=a;s--)for(var r=n;r<=o;r++)if(e.getValueXY(s,r,i)>=t)return s;return-1}function Ae(e,t,a){var n=this.width/t,o=this.height/a;if(1<this.bitDepth)for(var s=0,i;s<t;s++){i=fo((s+0.5)*n);for(var r=0,l;r<a;r++){l=fo((r+0.5)*o);for(var d=0;d<this.channels;d++)e.setValueXY(s,r,d,this.getValueXY(i,l,d))}}else for(var h=0,g;h<t;h++){g=fo((h+0.5)*n);for(var c=0,m;c<a;c++)m=fo((c+0.5)*o),this.getBitXY(g,m)&&e.setBitXY(h,c)}}function Re(e){if('string'==typeof e){var t=e[e.length-1];e=parseFloat(e),'%'===t&&(e/=100)}return e}function ze(e,t){if(!t)throw Error('getThreshold : the maxValue should be specified');if('string'==typeof e){var i=e[e.length-1];if('%'!==i)throw Error('getThreshold : if the value is a string it must finish by %');return parseFloat(e)/100*t}if('number'==typeof e)return 1>e?e*t:e;throw Error('getThreshold : the value is not valid')}function Le(e,t,i){e=Re(e);var a=go(e*t),n=go(e*i);return 0>=a&&(a=1),0>=n&&(n=1),{width:a,height:n}}function Ee(e={}){var t=e.factor,i=void 0===t?1:t,a=e.algorithm,n=void 0===a?'nearestNeighbor':a,o=e.preserveAspectRatio,s=void 0===o||o,r=e.width,l=e.height;r||(l&&s?r=go(l*(this.width/this.height)):r=this.width),l||(s?l=go(r*(this.height/this.width)):l=this.height);var d=Le(i,r,l);if(r=d.width,l=d.height,r===this.width&&l===this.height){var h=this.clone();return h.position=[0,0],h}var g=go((this.width-r)/2),c=go((this.height-l)/2),m=mc.createFrom(this,{width:r,height:l,position:[g,c]});switch(n.toLowerCase()){case'nearestneighbor':case'nearestneighbour':Ae.call(this,m,r,l);break;default:throw new Error('Unsupported scale algorithm: '+n);}return m}function Te(){this.checkProcessable('hsv',{bitDepth:[8,16],alpha:[0,1],colorModel:[xo]});for(var e=mc.createFrom(this,{colorModel:ko}),t=0,a=this.data,n=0;n<a.length;n+=this.channels){var i=a[n],o=a[n+1],s=a[n+2],r=ro(i,o,s),l=oo(i,o,s),d=l-r,h=0,g=0===l?0:d/l;if(l!==r){switch(l){case i:h=(o-s)/d+(o<s?6:0);break;case o:h=(s-i)/d+2;break;case s:h=(i-o)/d+4;break;default:throw new Error('unreachable');}h/=6}e.data[t++]=h*this.maxValue,e.data[t++]=g*this.maxValue,e.data[t++]=l,this.alpha&&(e.data[t++]=a[n+3])}return e}function Ve(){this.checkProcessable('hsl',{bitDepth:[8,16],alpha:[0,1],colorModel:[xo]});for(var e=mc.createFrom(this,{colorModel:yo}),t=fo(this.maxValue/2),a=0,n=this.data,o=0;o<n.length;o+=this.channels){var i=n[o],s=n[o+1],r=n[o+2],l=oo(i,s,r),d=ro(i,s,r),h=0,g=0,c=(l+d)/2;if(l!==d){var m=l-d;switch(g=c>t?m/(2-l-d):m/(l+d),l){case i:h=(s-r)/m+(s<r?6:0);break;case s:h=(r-i)/m+2;break;case r:h=(i-s)/m+4;break;default:throw new Error('unreachable');}h/=6}e.data[a++]=h*this.maxValue,e.data[a++]=g*this.maxValue,e.data[a++]=c,this.alpha&&(e.data[a++]=n[o+3])}return e}function Ue(){this.checkProcessable('cmyk',{bitDepth:[8,16],alpha:[0,1],colorModel:[xo]});for(var e=mc.createFrom(this,{components:4,colorModel:vo}),t=0,a=this.data,n=0;n<a.length;n+=this.channels){var i=a[n],o=a[n+1],s=a[n+2],r=ro(this.maxValue-i,this.maxValue-o,this.maxValue-s),l=(this.maxValue-i-r)/(1-r/this.maxValue),d=(this.maxValue-o-r)/(1-r/this.maxValue),h=(this.maxValue-s-r)/(1-r/this.maxValue);e.data[t++]=l,e.data[t++]=d,e.data[t++]=h,e.data[t++]=r,this.alpha&&(e.data[t++]=a[n+3])}return e}function Fe(){return new mc(this.width,this.height,this.getRGBAData(),{kind:'RGBA',parent:this})}function Ye(e={}){var t=e.algorithm,a=void 0===t?'luma709':t,n=e.keepAlpha,o=void 0!==n&&n,s=e.mergeAlpha,r=void 0===s||s,l=e.allowGrey,d={bitDepth:[8,16],alpha:[0,1]};void 0!==l&&l||(d.colorModel=[xo],d.components=[3]),this.checkProcessable('grey',d),1===this.components&&(a='red'),o&=this.alpha,r&=this.alpha,o&&(r=!1);var h=mc.createFrom(this,{components:1,alpha:o,colorModel:null}),g=dr[a.toLowerCase()];if(!g)throw new Error('Unsupported grey algorithm: '+a);for(var c=0,m=0;m<this.data.length;m+=this.channels)r?h.data[c++]=g(this.data,m,this)*this.data[m+this.components]/this.maxValue:(h.data[c++]=g(this.data,m,this),h.alpha&&(h.data[c++]=this.data[m+this.components]));return h}function Xe(e){for(var t=!1,i=0,a=1;a<e.length-1;a++)if(e[a-1]<e[a]&&e[a+1]<e[a]&&(i++,2<i))return!1;return 2==i&&(t=!0),t}function qe(e,t){for(var a=0,n=0;n<=t;n++)a+=e[n];return a}function Oe(e,t){for(var a=0,n=0;n<=t;n++)a+=n*e[n];return a}function Ne(e,t){for(var a=0,n=0;n<=t;n++)a+=n*n*e[n];return a}function Ge(e){for(var t=Array(e.length),a=1;a<e.length-1;a++)t[a]=(e[a-1]+e[a]+e[a+1])/3;return t[0]=(e[0]+e[1])/3,t[e.length-1]=(e[e.length-2]+e[e.length-1])/3,t}function He(e,t){for(var a=void 0,n=1;n<t;n++)if(e[n-1]>e[n]&&e[n+1]>=e[n]){a=n;break}return a}function We(e){for(var t=e.length,i=!1,a=0,n=1;n<t-1;n++)if(e[n-1]<e[n]&&e[n+1]<e[n]&&(a++,2<a))return!1;return 2==a&&(i=!0),i}function Ze(e,t){for(var a=0,n=0;n<=t;n++)a+=e[n];return a}function Qe(e={}){var t=e.algorithm,a=void 0===t?'threshold':t,n=e.threshold,o=void 0===n?0.5:n,s=e.useAlpha,r=e.invert,l=void 0!==r&&r;if(this.checkProcessable('mask',{components:1,bitDepth:[8,16]}),'threshold'===a)o=ze(o,this.maxValue);else{var d=gr[a.toLowerCase()];if(d){var h=this.getHistogram();o=d(h,this.size)}else throw new Error('mask transform unknown algorithm: '+a)}var g=new mc(this.width,this.height,{kind:'BINARY',parent:this}),c=0;if(this.alpha&&(void 0===s||s))for(var m=0,i;m<this.data.length;m+=this.channels)i=this.data[m]+(this.maxValue-this.data[m])*(this.maxValue-this.data[m+1])/this.maxValue,(l&&i<=o||!l&&i>=o)&&g.setBit(c),c++;else for(var p=0;p<this.data.length;p+=this.channels)(l&&this.data[p]<=o||!l&&this.data[p]>=o)&&g.setBit(c),c++;return g}function Ke(e,t,a,n){for(var o=e.width,s=e.height,r=t.width,l=e.channels,d=0;d<o;d++)for(var i=0;i<s;i++)for(var h=0;h<l;h++){var g=(i*o+d)*l+h,c=((n+i)*r+a+d)*l+h;t.data[c]=e.data[g]}}function Je(e={}){var t=e.size,a=void 0===t?0:t,n=e.algorithm,o=void 0===n?'copy':n,s=e.color;if(this.checkProcessable('pad',{bitDepth:[8,16]}),'set'===o){if(s.length!==this.channels)throw new Error('pad: the color array must have the same length as the number of channels. Here: '+this.channels);for(var r=0;r<s.length;r++)0===s[r]&&(s[r]=1e-3)}else s=ds(this.channels,null);Array.isArray(a)||(a=[a,a]);var i=this.width+2*a[0],l=this.height+2*a[1],d=this.channels,h=mc.createFrom(this,{width:i,height:l});Ke(this,h,a[0],a[1]);for(var g=a[0];g<i-a[0];g++)for(var c=0,m;c<d;c++){m=s[c]||h.data[(a[1]*i+g)*d+c];for(var p=0;p<a[1];p++)h.data[(p*i+g)*d+c]=m;m=s[c]||h.data[((l-a[1]-1)*i+g)*d+c];for(var u=l-a[1];u<l;u++)h.data[(u*i+g)*d+c]=m}for(var f=0;f<l;f++)for(var _=0,b;_<d;_++){b=s[_]||h.data[(f*i+a[0])*d+_];for(var w=0;w<a[0];w++)h.data[(f*i+w)*d+_]=b;b=s[_]||h.data[(f*i+i-a[0]-1)*d+_];for(var x=i-a[0];x<i;x++)h.data[(f*i+x)*d+_]=b}return h}function $e(e=8){if(this.checkProcessable('colorDepth',{bitDepth:[8,16]}),![8,16].includes(e))throw Error('You need to specify the new colorDepth as 8 or 16');if(this.bitDepth===e)return this.clone();var t=mc.createFrom(this,{bitDepth:e});if(8===e)for(var a=0;a<this.data.length;a++)t.data[a]=this.data[a]>>8;else for(var i=0;i<this.data.length;i++)t.data[i]=this.data[i]<<8|this.data[i];return t}function et(e,t={}){var a=t.interpolation,n=void 0===a?'none':a,o=t.width,s=void 0===o?this.width:o,r=t.height,l=void 0===r?this.height:r,d=e*uo/180,h=fo(so(s*$n(d))+so(l*po(d))),g=fo(so(l*$n(d))+so(s*po(d))),m=mc.createFrom(this,{width:h,height:g}),p=$n(-d),u=po(-d),f=h/2,_=g/2;0==h%2?(f-=0.5,0==g%2?_-=0.5:_=fo(_)):(f=fo(f),0==g%2?_-=0.5:_=fo(_));var b=fo(s/2-f),w=fo(l/2-_);if('bilinear'===n){for(var k=this.width*this.channels,v=0;v<h;v+=1)for(var i=0;i<g;i+=1)for(var j=(v-f)*p-(i-_)*u+f+b,x=(i-_)*p+(v-f)*u+_+w,y=0|j,M=0|x,S=j-y,P=x-M,I=0;I<this.channels;I++)if(0>j||j>=s||0>x||x>=l)this.alpha?m.setValueXY(v,i,I,this.alpha):m.setValueXY(v,i,I,this.maxValue);else{var c=(M*this.width+y)*this.channels+I,R=this.data[c],A=this.data[c+this.channels],B=this.data[c+k],C=this.data[c+k+this.channels];m.setValueXY(v,i,I,0|R+S*(A-R)+P*(B-R)+S*P*(R-A-B+C))}}else for(var D=0;D<h;D+=1)for(var z=0;z<g;z+=1)for(var L=0;L<this.channels;L++){var E=go((D-f)*p-(z-_)*u+f)+b,T=go((z-_)*p+(D-f)*u+_)+w;0>E||E>=s||0>T||T>=l?this.alpha?m.setValueXY(D,z,L,this.alpha):m.setValueXY(D,z,L,this.maxValue):m.setValueXY(D,z,L,this.getValueXY(E,T,L))}return m}function tt(e,t){if('number'!=typeof e)throw new TypeError('angle must be a number');switch(0>e&&(e=360*_o(-e/360)+e),e%360){case 0:return this.clone();case 90:return at.call(this);case 180:return nt.call(this);case 270:return it.call(this);default:return et.call(this,e,t);}}function it(){for(var e=mc.createFrom(this,{width:this.height,height:this.width}),t=e.height-1,a=0;a<this.height;a++)for(var i=0;i<this.width;i++)for(var n=0;n<this.channels;n++)e.setValueXY(a,t-i,n,this.getValueXY(i,a,n));return e}function at(){for(var e=mc.createFrom(this,{width:this.height,height:this.width}),t=e.width-1,a=0;a<this.height;a++)for(var i=0;i<this.width;i++)for(var n=0;n<this.channels;n++)e.setValueXY(t-a,i,n,this.getValueXY(i,a,n));return e}function nt(){for(var e=mc.createFrom(this),t=e.width-1,a=e.height-1,n=0;n<this.height;n++)for(var i=0;i<this.width;i++)for(var o=0;o<this.channels;o++)e.setValueXY(t-i,a-n,o,this.getValueXY(i,n,o));return e}function ot(e={}){var t=e.size,a=void 0===t?0:t,n=e.algorithm,o=void 0===n?'copy':n,s=e.color;if(this.checkProcessable('setBorder',{bitDepth:[8,16,32,64]}),'set'===o){if(s.length!==this.channels)throw new Error('setBorder: the color array must have the same length as the number of channels. Here: '+this.channels);for(var r=0;r<s.length;r++)0===s[r]&&(s[r]=1e-3)}else s=ds(this.channels,null);Array.isArray(a)||(a=[a,a]);for(var i=a[0],l=a[1],d=this.channels,h=i;h<this.width-i;h++)for(var g=0,c;g<d;g++){c=s[g]||this.data[(h+this.width*l)*d+g];for(var m=0;m<l;m++)this.data[(m*this.width+h)*d+g]=c;c=s[g]||this.data[(h+this.width*(this.height-l-1))*d+g];for(var p=this.height-l;p<this.height;p++)this.data[(p*this.width+h)*d+g]=c}for(var u=0;u<this.height;u++)for(var f=0,_;f<d;f++){_=s[f]||this.data[(u*this.width+i)*d+f];for(var b=0;b<i;b++)this.data[(u*this.width+b)*d+f]=_;_=s[f]||this.data[(u*this.width+this.width-i-1)*d+f];for(var w=this.width-i;w<this.width;w++)this.data[(u*this.width+w)*d+f]=_}return this}function st(e={}){var t=e.algorithm,a=void 0===t?'matchToPrevious':t,n=e.ignoreBorder,o=void 0===n?[0,0]:n;this.checkProcessable('matchAndCrop',{bitDepth:[8,16]});var s=this[0],r=[];r[0]={position:[0,0],image:this[0]};for(var l=[0,0],d=1,i;d<this.length;d++)i=s.getBestMatch(this[d],{border:o}),r[d]={position:[i[0]+l[0],i[1]+l[1]],image:this[d]},'matchToPrevious'===a&&(l[0]+=i[0],l[1]+=i[1],s=this[d]);for(var h=0,g=0,c=0,m=0,p=0,u;p<r.length;p++)u=r[p],u.position[0]>h&&(h=u.position[0]),u.position[0]<g&&(g=u.position[0]),u.position[1]>c&&(c=u.position[1]),u.position[1]<m&&(m=u.position[1]);g=0-g,m=0-m;for(var f=0,_;f<r.length;f++)_=r[f],_.crop=_.image.crop({x:h-_.position[0],y:c-_.position[1],width:s.width-g-h,height:s.height-m-c});for(var b=[],w=0;w<r.length;w++)b[w]=r[w].crop;return new Sr(b)}function rt(){this.checkProcessable('min',{bitDepth:[8,16]});for(var e=this[0].min,t=1;t<this.length;t++)for(var i=0;i<e.length;i++)e[i]=ro(e[i],this[t].min[i]);return e}function lt(){this.checkProcessable('min',{bitDepth:[8,16]});for(var e=this[0].max,t=1;t<this.length;t++)for(var i=0;i<e.length;i++)e[i]=oo(e[i],this[t].max[i]);return e}function dt(e){var t=e.reduce((e,t)=>e+t);if(0===t)throw new Error('unreachable');for(var i=0,a=0,n=t/2,o;;){if(0<e[i]){if(void 0!=o)return(o+i)/2;if(a+=e[i],a>n)return i;a===n&&(o=i)}i++}}function ht(e){for(var t=0,a=0,n=0;n<e.length;n++)t+=e[n],a+=e[n]*n;return 0===t?0:a/t}function gt(){this.checkProcessable('median',{bitDepth:[8,16]});for(var e=this.getHistograms({maxSlots:this[0].maxValue+1}),t=Array(e.length),i=0,a;i<e.length;i++)a=e[i],t[i]=dt(a);return t}function ct(e){this.checkProcessable('min',{bitDepth:[8,16]});for(var t=this[0].getHistogram(e),a=1,i;a<this.length;a++){i=this[a].getHistogram(e);for(var n=0;n<t.length;n++)t[n]+=i[n]}return t}function mt(e){this.checkProcessable('min',{bitDepth:[8,16]});for(var t=this[0].getHistograms(e),a=t[0].length,n=1,i;n<this.length;n++){i=this[n].getHistograms(e);for(var o=0;o<t.length;o++)for(var s=0;s<a;s++)t[o][s]+=i[o][s]}return t}function pt(){this.checkProcessable('average',{bitDepth:[8,16]});for(var e=new Uint32Array(this[0].data.length),t=0,i;t<this.length;t++){i=this[t];for(var a=0;a<this[0].data.length;a++)e[a]+=i.data[a]}for(var n=mc.createFrom(this[0]),o=n.data,s=0;s<this[0].data.length;s++)o[s]=e[s]/this.length;return n}function ut(e={}){var t=e.preserveAlpha;if(this.checkProcessable('split',{bitDepth:[8,16]}),1===this.components)return new Sr([this.clone()]);var a=new Sr,n=this.data;if(this.alpha&&(void 0===t||t))for(var o=0;o<this.components;o++){for(var i=mc.createFrom(this,{components:1,alpha:!0,colorModel:null}),s=0,r=0;r<n.length;r+=this.channels)i.data[s++]=n[r+o],i.data[s++]=n[r+this.components];a.push(i)}else for(var l=0;l<this.channels;l++){for(var d=mc.createFrom(this,{components:1,alpha:!1,colorModel:null}),h=0,g=0;g<n.length;g+=this.channels)d.data[h++]=n[g+l];a.push(d)}return a}function ft(e,t={}){var i=t.keepAlpha,a=void 0!==i&&i,n=t.mergeAlpha,o=void 0!==n&&n;a&=this.alpha,o&=this.alpha,this.checkProcessable('getChannel',{bitDepth:[8,16]}),e=b(this,e);for(var s=mc.createFrom(this,{components:1,alpha:a,colorModel:null}),r=0,l=0;l<this.data.length;l+=this.channels)o?s.data[r++]=this.data[l+e]*this.data[l+this.components]/this.maxValue:(s.data[r++]=this.data[l+e],a&&(s.data[r++]=this.data[l+this.components]));return s}function _t(e=bt,t={}){var a=t.mergeAlpha,n=void 0!==a&&a,o=t.keepAlpha,s=void 0!==o&&o;n&=this.alpha,s&=this.alpha,this.checkProcessable('combineChannels',{bitDepth:[8,16]});for(var r=mc.createFrom(this,{components:1,alpha:s,colorModel:null}),l=0,d=0,i;d<this.size;d++)i=e(this.getPixel(d)),n?r.data[l++]=i*this.data[d*this.channels+this.components]/this.maxValue:(r.data[l++]=i,s&&(r.data[l++]=this.data[d*this.channels+this.components]));return r}function bt(e){return(e[0]+e[1]+e[2])/3}function wt(e,t){if(this.checkProcessable('setChannel',{bitDepth:[8,16]}),t.checkProcessable('setChannel (image parameter check)',{bitDepth:[this.bitDepth],alpha:[0],components:[1]}),t.width!==this.width||t.height!==this.height)throw new Error('Images must have exactly the same width and height');e=b(this,e);for(var a=e,n=0;n<t.data.length;n++)this.data[a]=t.data[n],a+=this.channels;return this}function xt(e,t={}){var a=t.shift,n=void 0===a?[0,0]:a,o=t.average,s=t.channels,r=t.defaultAlpha,l=t.normalize,d=t.border,h=void 0===d?[0,0]:d;if(this.checkProcessable('getSimilarity',{bitDepth:[8,16]}),Array.isArray(h)||(h=[h,h]),s=u(this,{channels:s,defaultAlpha:r}),this.bitDepth!==e.bitDepth)throw new Error('Both images must have the same bitDepth');if(this.channels!==e.channels)throw new Error('Both images must have the same number of channels');if(this.colorModel!==e.colorModel)throw new Error('Both images must have the same colorModel');'undefined'==typeof o&&(o=!0);for(var g=oo(h[0],-n[0]),m=ro(this.width-h[0],this.width-n[0]),p=oo(h[1],-n[1]),f=ro(this.height-h[1],this.height-n[1]),_=ds(s.length,0),b=0;b<s.length;b++){var i=s[b],c=l?this.sum[i]:oo(this.sum[i],e.sum[i]),w=l?e.sum[i]:oo(this.sum[i],e.sum[i]);if(0!==c&&0!==w)for(var k=g;k<m;k++)for(var x=p;x<f;x++){var y=k*this.multiplierX+x*this.multiplierY+i,v=y+n[0]*this.multiplierX+n[1]*this.multiplierY;_[b]+=ro(this.data[y]/c,e.data[v]/w)}}return o?_.reduce((e,t)=>e+t)/_.length:_}function yt(e={}){var t=e.sampling,a=void 0===t?[10,10]:t,n=e.painted,o=e.mask;this.checkProcessable('getPixelsGrid',{bitDepth:[8,16],channels:1}),Array.isArray(a)||(a=[a,a]);for(var s=a[0],r=a[1],l=s*r,d=Array(l),h=Array(l),g=this.width/s,c=this.height/r,m=fo(g/2),p=0,u=0,i;u<s;u++){i=fo(c/2);for(var f=0;f<r;f++){var _=go(m),b=go(i);(!o||o.getBitXY(_,b))&&(d[p]=[_,b],h[p]=this.getPixelXY(_,b),p++),i+=c}m+=g}d.length=p,h.length=p;var w={xyS:d,zS:h};return void 0!==n&&n&&(w.painted=this.rgba8().paintPoints(d)),w}function kt(e,t,i){for(var a=Array(e),n=0;n<e;n++)a[n]=Array(t);if(i)for(var o=0;o<e;o++)for(var s=0;s<t;s++)a[o][s]=i;return a.width=e,a.height=t,a.__proto__=kt.prototype,a}function vt(e,t={}){var a=t.border;if(this.checkProcessable('getChannel',{bitDepth:[8,16]}),this.bitDepth!==e.bitDepth)throw new Error('Both images must have the same bitDepth');if(this.channels!==e.channels)throw new Error('Both images must have the same number of channels');if(this.colorModel!==e.colorModel)throw new Error('Both images must have the same colorModel');for(var n=new kt(e.width,e.height,-Infinity),o=fo(e.width/2),s=fo(e.height/2),r=o,l=s,d=!1;!d;){for(var h=n.localSearch(o,s,-Infinity),g=0;g<h.length;g++){var i=h[g],c=this.getSimilarity(e,{border:a,shift:[r-i[0],l-i[1]]});n[i[0]][i[1]]=c}var m=n.localMax(o,s);m.position[0]!==o||m.position[1]!==s?(o=m.position[0],s=m.position[1]):d=!0}return[o-r,s-l]}function Dt(e,t=0){this.checkProcessable('getRow',{bitDepth:[8,16]}),this.checkRow(e),this.checkChannel(t);for(var i=Array(this.width),a=0,n=e*this.width*this.channels+t,o=n+this.width*this.channels,s=n;s<o;s+=this.channels)i[a++]=this.data[s];return i}function jt(e,t=0){this.checkProcessable('getColumn',{bitDepth:[8,16]}),this.checkColumn(e),this.checkChannel(t);for(var i=Array(this.height),a=0,n=this.width*this.channels,o=t+e*this.channels;o<this.data.length;o+=n)i[a++]=this.data[o];return i}function Mt(e={}){var t=e.channel;if(this.checkProcessable('getMatrix',{bitDepth:[8,16]}),void 0===t){if(1<this.components)throw new RangeError('You need to define the channel for an image that contains more than one channel');t=0}for(var i=new as(this.height,this.width),a=0;a<this.height;a++)for(var n=0;n<this.width;n++)i.set(a,n,this.getValueXY(n,a,t));return i}function St(e,t={}){var i=t.channel;if(this.checkProcessable('getMatrix',{bitDepth:[8,16]}),void 0===i){if(1<this.components)throw new RangeError('You need to define the channel for an image that contains more than one channel');i=0}if(!e.length||!e[0].length||this.width!==e.columns||this.height!==e.rows)throw new RangeError('The size of the matrix must be equal to the size of the image');for(var a=0;a<this.height;a++)for(var n=0;n<this.width;n++)this.setValueXY(n,a,i,e.get(a,n))}function Pt(){this.checkProcessable('getPixelsArray',{bitDepth:[8,16,32]});for(var e=Array(this.size),t=0,a=0,i;a<this.data.length;a+=this.channels){i=Array(this.components);for(var n=0;n<this.components;n++)i[n]=this.data[a+n];e[t++]=i}return e}function It(e){for(var t=this,a=t.getClosestCommonParent(e),n=t.getRelativePosition(a,{defaultFurther:!0}),o=Bt(t,n),s=e.getRelativePosition(a,{defaultFurther:!0}),r=Bt(e,s),l=Ct(o,r),d={whitePixelsMask1:[],whitePixelsMask2:[],commonWhitePixels:[]},h=0;h<l.length;h++){var i=l[h],g=[i[0]-n[0],i[1]-n[1]],c=[i[0]-s[0],i[1]-s[1]],m=t.getBitXY(g[0],g[1]),p=e.getBitXY(c[0],c[1]);1===m&&1===p&&d.commonWhitePixels.push(i)}for(var u=0;u<o.length;u++){var f=void 0,_=void 0;0!==u&&(f=fo(u/(t.width-1)),_=u%(t.width-1)),1===t.getBitXY(f,_)&&d.whitePixelsMask1.push(o[u])}for(var b=0;b<r.length;b++){var w=0,x=0;0!==b&&(w=fo(b/(e.width-1)),x=b%(e.width-1)),1===e.getBitXY(w,x)&&d.whitePixelsMask2.push(r[b])}return d}function Bt(e,t){for(var a=[],n=0;n<e.height;n++)for(var i=0,o;i<e.width;i++)o=[n,i],a.push([o[0]+t[0],o[1]+t[1]]);return a}function Ct(e,t){for(var a=0,i=0,n=[];a<e.length&&i<t.length;)e[a][0]===t[i][0]&&e[a][1]===t[i][1]?(n.push(e[a]),a++,i++):e[a][0]<t[i][0]||e[a][0]===t[i][0]&&e[a][1]<t[i][1]?a++:i++;return n}function At(e){var t=Rt(this),i=Rt(e),a;if(a=t>=i?zt(this,t):zt(e,i),0===t||0===i)return a;for(var n=this,o=e;t!==i;)if(t>i){if(n=n.parent,void 0===n)return a;--t}else{if(o=o.parent,void 0===o)return a;--i}for(;n!==o&&void 0!==typeof n&&void 0!==typeof o;)if(n=n.parent,o=o.parent,void 0===n||void 0===o)return a;return n===o?n:a}function Rt(e){for(var t=0,i=e;null!=i.parent;)i=i.parent,t++;return t}function zt(e,t){for(var i=e;0<t;)i=i.parent,--t;return i}function Lt(e){var t=Rr[e.toLowerCase()];return t?{r:t[0],g:t[1],b:t[2],a:100}:void 0}function Et(e){if(0==e.indexOf('rgb(')){e=e.match(/rgb\(([^)]+)\)/)[1];var t=e.split(/ *, */).map(Number);return{r:t[0],g:t[1],b:t[2],a:100}}}function Tt(e){if(0===e.indexOf('rgba(')){e=e.match(/rgba\(([^)]+)\)/)[1];var t=e.split(/ *, */).map(Number);return{r:t[0],g:t[1],b:t[2],a:100*t[3]}}}function Vt(e){if('#'===e[0]&&7===e.length)return{r:parseInt(e.slice(1,3),16),g:parseInt(e.slice(3,5),16),b:parseInt(e.slice(5,7),16),a:100}}function Ut(e){if('#'===e[0]&&4===e.length)return{r:parseInt(e[1]+e[1],16),g:parseInt(e[2]+e[2],16),b:parseInt(e[3]+e[3],16),a:100}}function Ft(e){if(0===e.indexOf('hsl(')){e=e.match(/hsl\(([^)]+)\)/)[1];var t=e.split(/ *, */),i=parseInt(t[0],10),a=parseInt(t[1],10),n=parseInt(t[2],10),o=Ar(i,a,n);return o.a=100,o}}function Yt(e){if(0===e.indexOf('hsla(')){e=e.match(/hsla\(([^)]+)\)/)[1];var t=e.split(/ *, */),i=parseInt(t[0],10),n=parseInt(t[1],10),o=parseInt(t[2],10),s=parseInt(100*t[3],10),a=Ar(i,n,o);return a.a=s,a}}function Xt(e){var t=zr(e);return[t.r,t.g,t.b,go(255*t.a/100)]}function qt(e,i,a){return 0>a&&(a+=1),1<a&&(a-=1),a<1/6?e+6*(i-e)*a:a<1/2?i:a<2/3?e+6*((i-e)*(2/3-a)):e}function Ot(e,t,i){var a,n,o,s,l,d;return t/=100,i/=100,0===t?s=l=d=255*i:(n=0.5>=i?i*(t+1):i+t-i*t,a=2*i-n,o=e/360,s=qt(a,n,o+1/3),l=qt(a,n,o),d=qt(a,n,o-1/3)),{r:s,g:l,b:d}}function Nt(e){for(var t=Array(e),a=0,n=0;360>n;n+=360/e){a++;var i=Ot(n,100,30+15*(a%4));t[a-1]=[go(255*i.r),go(255*i.g),go(255*i.b)]}return t}function Gt(){return[fo(256*Math.random()),fo(256*Math.random()),fo(256*Math.random())]}function Ht(e,t={}){var a=t.color,n=void 0===a?'red':a,o=t.colors,s=t.alpha,r=void 0===s?255:s,l=t.randomColors,d=t.distinctColors,h=t.labels,g=void 0===h?[]:h,c=t.labelsPosition,m=void 0===c?[]:c,p=t.labelColor,u=void 0===p?'blue':p,f=t.labelFont,_=void 0===f?'12px Helvetica':f;this.checkProcessable('paintMasks',{channels:[3,4],bitDepth:[8,16],colorModel:xo}),n&&!Array.isArray(n)&&(n=Xt(n)),o&&(o=o.map(function(e){return Array.isArray(e)?e:Xt(e)})),Array.isArray(e)||(e=[e]),void 0!==d&&d&&(o=Nt(e.length));for(var b=0,i;b<e.length;b++){i=e[b],o?n=o[b%o.length]:void 0!==l&&l&&(n=Gt());for(var w=0;w<i.width;w++)for(var x=0;x<i.height;x++)if(i.getBitXY(w,x))for(var y=0;y<ro(this.components,n.length);y++)if(255===r)this.setValueXY(w+i.position[0],x+i.position[1],y,n[y]);else{var k=this.getValueXY(w+i.position[0],x+i.position[1],y);k=go((k*(255-r)+n[y]*r)/255),this.setValueXY(w+i.position[0],x+i.position[1],y,k)}}if(Array.isArray(g)&&0<g.length){var v=this.getCanvas({originalData:!0}),D=v.getContext('2d');D.fillStyle=u,D.font=_;for(var j=0,M;j<ro(e.length,g.length);j++)M=m[j]?m[j]:e[j].position,D.fillText(g[j],M[0],M[1]);this.setData(D.getImageData(0,0,this.width,this.height).data)}return this}function Wt(e,t,a={}){var n=a.color,o=void 0===n?'blue':n,s=a.colors,r=a.font,l=void 0===r?'12px Helvetica':r,d=a.rotate,h=void 0===d?0:d;if(this.checkProcessable('paintMasks',{channels:[3,4],bitDepth:[8,16],colorModel:xo}),!Array.isArray(e))throw Error('paintLabels: labels must be an array');if(!Array.isArray(t))throw Error('paintLabels: positions must be an array');if(o&&!Array.isArray(o)&&(o=Xt(o)),s=s?s.map(function(e){return Array.isArray(e)?e:Xt(e)}):[o],e.length!==t.length)throw Error('paintLabels: positions and labels must be arrays from the same size');Array.isArray(l)||(l=[l]),Array.isArray(h)||(h=[h]);for(var g=this.getCanvas({originalData:!0}),c=g.getContext('2d'),m=0;m<e.length;m++){c.save();var i=s[m%s.length];c.fillStyle=`rgba(${i[0]},${i[1]},${i[2]},${i[3]/this.maxValue})`,c.font=l[m%l.length];var p=t[m];c.translate(p[0],p[1]),c.rotate(h[m%h.length]/180*uo),c.fillText(e[m],0,0),c.restore()}return this.setData(c.getImageData(0,0,this.width,this.height).data),this}function Zt(e,t,i){var a=as.zeros(t,e);if(i.filled)for(var n=0;n<t;n++)for(var o=0;o<e;o++)a.set(n,o,1);else{for(var s of[0,t-1])for(var r=0;r<e;r++)a.set(s,r,1);for(var l=0;l<t;l++)for(var d of[0,e-1])a.set(l,d,1)}return a}function Qt(e,t,i){var n=as.zeros(t,e,i),o=1-t%2,s=1-e%2,r=fo((e-1)/2),a=fo((t-1)/2),l=r*r,d=a*a;if(i.filled)for(var h=0,g;h<=a;h++){g=fo(mo(l-l*h*h/d));for(var c=r-g;c<=r;c++)n.set(a-h,c,1),n.set(a+h+o,c,1),n.set(a-h,e-c-1,1),n.set(a+h+o,e-c-1,1)}else{for(var m=0;m<=a;m++){var p=fo(mo(l-l*m*m/d)),u=r-p;n.set(a-m,u,1),n.set(a+m+o,u,1),n.set(a-m,e-u-1,1),n.set(a+m+o,e-u-1,1)}for(var f=0;f<=r;f++){var _=fo(mo(d-d*f*f/l)),b=a-_;n.set(b,r-f,1),n.set(b,r+f+s,1),n.set(t-b-1,r-f,1),n.set(t-b-1,r+f+s,1)}}return n}function Kt(e,t,i){if(!i.filled)throw new Error('Non filled triangle is not implemented');for(var a=as.zeros(t,e,i),n=0,o;n<t;n++){o=fo((1-n/t)*e/2);for(var s=o;s<e-o;s++)a.set(n,s,1)}return a}function Jt(e,t={}){var a=t.color,n=void 0===a?[this.maxValue,0,0]:a,o=t.shape;this.checkProcessable('paintPoints',{bitDepth:[8,16]});for(var s=new Tr(o).getPoints(),r=ro(this.channels,n.length),l=0;l<e.length;l++)for(var i=e[l][0],d=e[l][1],h=0;h<s.length;h++){var g=s[h][0],c=s[h][1];if(0<=i+g&&0<=d+c&&i+g<this.width&&d+c<this.height)for(var m=(i+g+(d+c)*this.width)*this.channels,p=0;p<r;p++)this.data[m+p]=n[p]}return this}function $t(e,t={}){return t.closed=!0,this.paintPolyline(e,t)}function ei(e,t={}){var a=t.color,n=void 0===a?[this.maxValue,0,0]:a,o=t.closed;this.checkProcessable('paintPoints',{bitDepth:[8,16]});for(var s=ro(this.channels,n.length),r=0;r<e.length-1+(void 0!==o&&o);r++)for(var i=e[r],l=e[(r+1)%e.length],d=l[0]-i[0],h=l[1]-i[1],g=oo(so(d),so(h)),c=i[0],m=i[1],p=0;p<=g;p++){var u=go(c),f=go(m);if(0<=u&&0<=f&&u<this.width&&f<this.height)for(var _=(u+f*this.width)*this.channels,b=0;b<s;b++)this.data[_+b]=n[b];c+=d/g,m+=h/g}return this}function ti(e,t={}){var i=t.position;if(this.checkProcessable('extract',{bitDepth:[1,8,16]}),!i&&(i=e.getRelativePosition(this),!i))throw new Error('extract : can not extract an image because the relative position can not be determined, try to specify manually the position as an array of 2 elements [x,y].');if(1<this.bitDepth){for(var a=mc.createFrom(this,{width:e.width,height:e.height,alpha:1,position:i,parent:this}),n=0;n<e.width;n++)for(var o=0;o<e.height;o++){for(var s=0,r;s<this.channels;s++)r=this.getValueXY(n+i[0],o+i[1],s),a.setValueXY(n,o,s,r);e.getBitXY(n,o)||a.setValueXY(n,o,this.components,0)}return a}for(var l=mc.createFrom(this,{width:e.width,height:e.height,position:i,parent:this}),d=0;d<e.height;d++)for(var h=0;h<e.width;h++)e.getBitXY(h,d)&&this.getBitXY(h+i[0],d+i[1])&&l.setBitXY(h,d);return l}function ii(e={}){var t=e.x,a=void 0===t?0:t,n=e.y,o=void 0===n?0:n,s=e.inPlace,r=void 0===s||s?this:mc.createFrom(this);if(this.checkProcessable('floodFill',{bitDepth:1}),1===this.bitDepth){var l=this.getBitXY(a,o);if(l)return r;var d=new Vr;for(d.push(new ai(a,o));0<d.length;){var h=d.shift();r.setBitXY(h.x,h.y);for(var g=h.x+1;g<this.width&&!r.getBitXY(g,h.y)&&!this.getBitXY(g,h.y);g++)r.setBitXY(g,h.y),h.y+1<this.height&&!this.getBitXY(g,h.y+1)&&d.push(new ai(g,h.y+1)),0<=h.y-1&&!this.getBitXY(g,h.y-1)&&d.push(new ai(g,h.y-1));for(var i=h.x-1;0<=i&&!r.getBitXY(i,h.y)&&!this.getBitXY(i,h.y);i++)r.setBitXY(i,h.y),h.y+1<this.height&&!this.getBitXY(i,h.y+1)&&d.push(new ai(i,h.y+1)),0<=h.y-1&&!this.getBitXY(i,h.y-1)&&d.push(new ai(i,h.y-1))}}return r}function ai(e,t){this.x=e,this.y=t}function ni(e={}){var t=e.maxSlots,i=void 0===t?256:t,a=e.channel,n=e.useAlpha;if(this.checkProcessable('getHistogram',{bitDepth:[1,8,16]}),void 0===a){if(1<this.components)throw new RangeError('You need to define the channel for an image that contains more than one channel');a=0}return si.call(this,a,{useAlpha:void 0===n||n,maxSlots:i})}function oi(e={}){var t=e.maxSlots,a=void 0===t?256:t,n=e.useAlpha,o=void 0===n||n;this.checkProcessable('getHistograms',{bitDepth:[8,16]});for(var s=Array(o?this.components:this.channels),r=0;r<s.length;r++)s[r]=si.call(this,r,{useAlpha:o,maxSlots:a});return s}function si(e,t){var a=t.useAlpha,n=t.maxSlots;if(1===this.bitDepth){for(var o=[0,0],s=0;s<this.height;s++)for(var i=0,r;i<this.width;i++)r=this.getBitXY(s,i),0===r?o[0]+=1:1===r&&(o[1]+=1);return o}var l=Math.log2(n);if(!Vo(l))throw new RangeError('maxSlots must be a power of 2, for example: 64, 256, 1024');var d=0;this.bitDepth>l&&(d=this.bitDepth-l);var h=this.data,g=ds(no(2,ro(this.bitDepth,l)),0);if(a&&this.alpha)for(var c=this.channels-e-1,m=e;m<h.length;m+=this.channels)g[h[m]>>d]+=h[m+c]/this.maxValue;else for(var p=e;p<h.length;p+=this.channels)g[h[p]>>d]++;return g}function ri(e={}){var t=e.useAlpha,a=e.nbSlots,n=void 0===a?512:a;this.checkProcessable('getColorHistogram',{bitDepth:[8,16],components:[3]});var o=to(n)/2.0794415416798357;if(o!==fo(o))throw new RangeError('nbSlots must be a power of 8. Usually 8, 64, 512 or 4096');for(var s=this.bitDepth-o,r=this.data,l=ds(no(8,o),0),d=no(2,2*o),h=no(2,o),g=0,i;g<r.length;g+=this.channels)i=(r[g]>>s)*d+(r[g+1]>>s)*h+(r[g+2]>>s),(void 0===t||t)&&this.alpha?l[i]+=r[g+this.channels-1]/this.maxValue:l[i]++;return l}function li(){this.checkProcessable('min',{bitDepth:[8,16]});for(var e=ds(this.channels,+Infinity),t=0;t<this.data.length;t+=this.channels)for(var i=0;i<this.channels;i++)this.data[t+i]<e[i]&&(e[i]=this.data[t+i]);return e}function di(){this.checkProcessable('max',{bitDepth:[8,16]});for(var e=ds(this.channels,-Infinity),t=0;t<this.data.length;t+=this.channels)for(var i=0;i<this.channels;i++)this.data[t+i]>e[i]&&(e[i]=this.data[t+i]);return e}function hi(){this.checkProcessable('sum',{bitDepth:[8,16]});for(var e=ds(this.channels,0),t=0;t<this.data.length;t+=this.channels)for(var i=0;i<this.channels;i++)e[i]+=this.data[t+i];return e}function gi(e=0,t=0){this.checkProcessable('getMoment',{bitDepth:[1]});for(var i=0,a=0;a<this.width;a++)for(var n=0;n<this.height;n++)1===this.getBitXY(a,n)&&(i+=a**e*n**t);return i}function ci(e={}){var t=e.mask,a=e.region,n=void 0===a?3:a,o=e.removeClosePoints,s=void 0===o?0:o,r=e.invert,l=void 0!==r&&r,d=e.maxEquals,h=void 0===d?2:d,g=this;this.checkProcessable('localMaxima',{bitDepth:[8,16],components:1}),n*=4;for(var c=l?0:1,m=[1,0,-1,0,1,1,-1,-1,2,0,-2,0,2,2,-2,-2],p=[0,1,0,-1,1,-1,1,-1,0,2,0,-2,2,-2,2,-2],u=8>=n?1:2,f=[],_=u;_<g.height-u;_++)for(var b=u;b<g.width-u;b++)if(!(t&&t.getBitXY(b,_)!==c)){for(var w=0,x=0,y=g.data[b+_*g.width],k=0;k<n;k++)l?g.data[b+m[k]+(_+p[k])*g.width]>y&&w++:g.data[b+m[k]+(_+p[k])*g.width]<y&&w++,g.data[b+m[k]+(_+p[k])*g.width]===y&&x++;w+x===n&&x<=h&&f.push([b,_])}if(0<s)for(var v=0;v<f.length;v++)for(var i=v+1;i<f.length;i++)mo(no(f[v][0]-f[i][0],2)+no(f[v][1]-f[i][1],2))<s&&(f[v][0]=f[v][0]+f[i][0]>>1,f[v][1]=f[v][1]+f[i][1]>>1,f.splice(i,1),i--);return f}function mi(){for(var e=this.getHistograms({maxSlots:this.maxValue+1}),t=Array(e.length),i=0,a;i<e.length;i++)a=e[i],t[i]=ht(a);return t}function pi(){for(var e=this.getHistograms({maxSlots:this.maxValue+1}),t=Array(e.length),i=0,a;i<e.length;i++)a=e[i],t[i]=dt(a);return t}function ui(){this.checkProcessable('points',{bitDepth:[1]});for(var e=Array(this.size),t=0,i=0;i<this.width;i++)for(var a=0;a<this.height;a++)1===this.getBitXY(i,a)&&(e[t++]=[i,a]);return e.length=t,e}function fi(e,t={}){if(this===e)return[0,0];for(var i=[0,0],a=this;a;){if(a===e)return i;a.position&&(i[0]+=a.position[0],i[1]+=a.position[1]),a=a.parent}return!!t.defaultFurther&&i}function _i(){return this.checkProcessable('getSvd',{bitDepth:[1]}),E(this.points)}function bi(e={}){var t=e.alpha,a=void 0===t?1:t;this.checkProcessable('countAlphaPixels',{bitDepth:[8,16],alpha:1});var n=0;if(void 0!==a){for(var o=this.components;o<this.data.length;o+=this.channels)this.data[o]===a&&n++;return n}return this.size}function wi(e,a={}){a.sorted||e.sort(yi);const o=e.length,n=Array(2*o);for(var s=0,r=0;r<o;r++){const t=e[r];for(;2<=s&&0>=xi(n[s-2],n[s-1],t);)s--;n[s++]=t}const i=s+1;for(r=o-2;0<=r;r--){const t=e[r];for(;s>=i&&0>=xi(n[s-2],n[s-1],t);)s--;n[s++]=t}return n.slice(0,s-1)}function xi(e,t,i){return(t[1]-e[1])*(i[0]-e[0])-(t[0]-e[0])*(i[1]-e[1])}function yi(e,t){return e[0]===t[0]?e[1]-t[1]:e[0]-t[0]}function ki(){var e=this;e.checkProcessable('monotoneChainConvexHull',{bitDepth:1});var t=e.getPoints();return wi(t,{sorted:!0})}function vi(e,t){return[e[0]-t[0],e[1]-t[1]]}function Di(e){var t=mo(e[0]**2+e[1]**2);return[e[0]/t,e[1]/t]}function ji(e,t,a){void 0===a&&(a=Array(t.length));for(var n=$n(e),o=po(e),s=0;s<a.length;++s)a[s]=[n*t[s][0]-o*t[s][1],o*t[s][0]+n*t[s][1]];return a}function Mi(e={}){var a=e.originalPoints,n=void 0===a?ki.call(this):a;if(1===n.length)return[n[0],n[0],n[0],n[0]];for(var o=Array(n.length),s=+Infinity,r=0,l=void 0,d=0,i;d<o.length;d++){i=Si(n[d],n[(d+1)%o.length]),ji(-i,n,o);for(var h=o[d][0],g=o[d][1],c=o[(d+1)%o.length][0],m=o[(d+1)%o.length][1],p=!0,u=0,f=0,_=0,b=0;b<o.length;b++){var w=o[b][0],x=o[b][1],y=(w-h)/(c-h);!0==p?(p=!1,u=y,f=y):(y<u&&(u=y),y>f&&(f=y));var t=(-(c-h)*x+c*g-m*h)/(c-h);so(t)>so(_)&&(_=t)}var k=[h+u*(c-h),g],v=[h+f*(c-h),g],D=so(_*(u-f)*(c-h));D<s&&(r=i,s=D,l=[k,v,[v[0],v[1]-_],[k[0],k[1]-_]])}return ji(r,l,l),l}function Si(e,t){var i=vi(t,e),a=Di(i),n=Math.acos(a[0]);return 0>a[1]?-n:n}function Pi(e){for(var t=e.data,a=[1,0,-1,0],n=[0,1,0,-1],o=e.minMax,s=-o.min,r=o.max+s,l=[],d=0;d<=r;d++)l.push(Object.create(null));for(var i=0;i<e.width;i++)for(var h=0;h<e.height;h++){var g=i+h*e.width,c=t[g];if(0!==c){for(var m=Object.create(null),p=!1,u=0;4>u;u++){var f=i+a[u],_=h+n[u];if(0<=f&&0<=_&&f<e.width&&_<e.height){var b=t[f+_*e.width];c!==b&&(p=!0,0!==b&&void 0===m[b]&&(m[b]=!0,l[b+s][c]?l[b+s][c]++:l[b+s][c]=1))}else p=!0}p&&(l[c+s][c]?l[c+s][c]++:l[c+s][c]=1)}}for(var w={},x=0;x<l.length;x++)0<Object.keys(l[x]).length&&(w[x-s]=l[x]);return w}function Ii(e={}){var t=e.algorithm,a=void 0===t?'commonBorderLength':t,n=e.minCommonBorderLength,o=void 0===n?5:n,s=e.maxCommonBorderLength,r=void 0===s?100:s,l=e.minCommonBorderRatio,d=void 0===l?0.3:l,h=e.maxCommonBorderRatio,g=void 0===h?1:h,c=function(e,t,i){return e[i]>=o&&e[i]<=r};'function'==typeof a&&(c=a),'commonborderratio'===a.toLowerCase()&&(c=function(e,t,i){var a=ro(e[i]/e[t],1);return a>=d&&a<=g});var m=this,p=m.commonBorderLength,u={},f={};for(var _ of Object.keys(p)){var b=p[_],w=Object.keys(b);for(var x of w)if(x!==_&&c(b,_,x)){var y=x;f[x]&&(y=f[x]);var k=_;if(f[_]&&(k=f[_]),+y!==k){var v=ro(y,k),D=oo(y,k);if(u[v]||(u[v]={}),u[v][D]=!0,f[D]=v,u[D]){for(var j of Object.keys(u[D]))u[v][j]=!0,f[j]=v;delete u[D]}}}}var M=m.minMax,S=-M.min,P=M.max+S,I=Array(P+1).fill(0);for(var B of Object.keys(f))I[+B+S]=f[B];for(var C=m.data,A=0,i;A<C.length;A++)if(i=C[A],0!==i){var R=I[i+S];0!==R&&(C[A]=R)}return m.computed={},m}function Bi(e,t={}){function i(t,i){var a=0,g=0,c=e.getBitXY(t,i),m=c?++r:--l;if(32767<r||-32768>l)throw new Error('Too many regions of interest');for(d[0]=t,h[0]=i;a<=g;){var p=d[a&o],u=h[a&o];if(s[u*e.width+p]=m,0<p&&0===s[u*e.width+p-1]&&e.getBitXY(p-1,u)===c&&(g++,d[g&o]=p-1,h[g&o]=u,s[u*e.width+p-1]=-32768),0<u&&0===s[(u-1)*e.width+p]&&e.getBitXY(p,u-1)===c&&(g++,d[g&o]=p,h[g&o]=u-1,s[(u-1)*e.width+p]=-32768),p<e.width-1&&0===s[u*e.width+p+1]&&e.getBitXY(p+1,u)===c&&(g++,d[g&o]=p+1,h[g&o]=u,s[u*e.width+p+1]=-32768),u<e.height-1&&0===s[(u+1)*e.width+p]&&e.getBitXY(p,u+1)===c&&(g++,d[g&o]=p,h[g&o]=u+1,s[(u+1)*e.width+p]=-32768),n&&(0<p&&0<u&&0===s[(u-1)*e.width+p-1]&&e.getBitXY(p-1,u-1)===c&&(g++,d[g&o]=p-1,h[g&o]=u-1,s[(u-1)*e.width+p-1]=-32768),p<e.width-1&&0<u&&0===s[(u-1)*e.width+p+1]&&e.getBitXY(p+1,u-1)===c&&(g++,d[g&o]=p+1,h[g&o]=u-1,s[(u-1)*e.width+p+1]=-32768),0<p&&u<e.height-1&&0===s[(u+1)*e.width+p-1]&&e.getBitXY(p-1,u+1)===c&&(g++,d[g&o]=p-1,h[g&o]=u+1,s[(u+1)*e.width+p-1]=-32768),p<e.width-1&&u<e.height-1&&0===s[(u+1)*e.width+p+1]&&e.getBitXY(p+1,u+1)===c&&(g++,d[g&o]=p+1,h[g&o]=u+1,s[(u+1)*e.width+p+1]=-32768)),a++,g-a>o)throw new Error('analyseMask can not finish, the array to manage internal data is not big enough.You could improve mask by changing MAX_ARRAY')}}for(var a=t.allowCorners,n=void 0!==a&&a,o=65535,s=new Int16Array(e.size),r=0,l=0,d=new Uint16Array(o+1),h=new Uint16Array(o+1),g=0;g<e.width;g++)for(var c=0;c<e.height;c++)0===s[c*e.width+g]&&i(g,c);return new Fr(e,s)}function Ci(e){this.value=e,this.parent=null,this.rank=0}function Ai(e,t={}){var a=t.allowCorners,n=4;void 0!==a&&a&&(n=8);var o,s,r;if(8==n)o=Nr,s=Gr,r=Hr;else if(4==n)o=Xr,s=qr,r=Or;else throw new RangeError('unsupported neighbours count: '+n);for(var l=e.size,d=e.width,h=e.height,g=Array(l),c=new Uint32Array(l),m=new Yr,p=1,u=0;u<h;u++)for(var f=0,i;f<d;f++)if(i=f+u*d,e.getBit(i)){for(var _=null,b=0;b<r.length;b++){var w=f+o[b],x=u+s[b];if(0<=w&&0<=x&&w<d&&x<h){var y=g[w+x*d];y?(r[b]=y,(!_||r[b].value<_.value)&&(_=r[b])):r[b]=null}}if(!_)g[i]=m.add(p++);else{g[i]=_;for(var k=0;k<r.length;k++)r[k]&&r[k]!==_&&m.union(_,r[k])}}for(var v=0;v<h;v++)for(var D=0,j;D<d;D++)j=D+v*d,e.getBit(j)&&(c[j]=m.find(g[j]).value);return new Fr(e,c)}function Ri(e={}){function t({maxima:e=!0}){for(var t=1;t<d.height-1;t++)for(var a=1,n;a<d.width-1;a++)if(n=a+t*d.width,0===u[n]){var s=e?d.data[n]:-d.data[a+t*d.width];if(d.data[t*d.width+a-1]>s)continue;if(d.data[t*d.width+a+1]>s)continue;if(d.data[(t-1)*d.width+a]>s)continue;if(d.data[(t+1)*d.width+a]>s)continue;if(o){if(d.data[(t-1)*d.width+a-1]>s)continue;if(d.data[(t-1)*d.width+a+1]>s)continue;if(d.data[(t+1)*d.width+a-1]>s)continue;if(d.data[(t+1)*d.width+a+1]>s)continue}p[n]=e?++c:--m;var r=i(a,t,h);r||(e?--c:++m)}}function i(e,t){var n=k;y=0,j=1,v[0]=e,D[0]=t;for(var o=!0;y<j;){var s=v[y&_],r=D[y&_];o&=a(s,r,h),y++}if(!o){for(var l=0;l<j;l++){var i=v[l&_],g=D[l&_],c=g*d.width+i;p[c]=0}k=n}return o}function a(e,t,i){for(var a=p[t*d.width+e],n=d.data[t*d.width+e],o=t-1;o<=t+1;o++)for(var s=e-1,l;s<=e+1;s++)if(l=o*d.width+s,0===u[l])switch(u[l]=1,f[l]=d.data[l]-n,i){case h:if(0===f[l]){if(0===s||0===o||s===d.width-1||o===d.height-1)return!1;p[l]=a,v[j&_]=s,D[j&_]=o,j++}else{if(0<f[l])return!1;r||(p[l]=a,b[k&_]=s,w[k&_]=o,k++)}break;case g:0>=f[l]&&(p[l]=a,b[k&_]=s,w[k&_]=o,k++);break;default:throw new Error('unreachable');}return!0}var n=e.allowCorner,o=void 0===n||n,s=e.onlyTop,r=void 0!==s&&s,l=e.invert,d=this;d.checkProcessable('fromMaxima',{components:[1]});var h=1,g=2,c=0,m=0,p=new Int16Array(d.size),u=new Int8Array(d.size),f=new Float32Array(d.size),_=1048575,b=new Uint16Array(_+1),w=new Uint16Array(_+1),x=0,k=0,v=new Uint16Array(_+1),D=new Uint16Array(_+1),y=0,j=0;for(t(d,{maxima:!(void 0!==l&&l)});x<k;){var M=b[x&_],S=w[x&_];a(M,S,g),x++}return new Fr(d,p)}function zi(e={}){var t=e.points,a=e.mask,n=e.image,o=e.fillMaxValue,s=void 0===o?this.maxValue:o,r=e.invert,l=void 0!==r&&r,d=n||this;d.checkProcessable('fromWaterShed',{bitDepth:[8,16],components:1}),l=!l,t||(t=d.getLocalMaxima({invert:l,mask:a}));for(var h=l?0:1,g=new Int16Array(d.size),c=d.width,m=d.height,p=new Wr({comparator:(e,t)=>e[2]-t[2],strategy:Wr.BinaryHeapStrategy}),u=0,i;u<t.length;u++){i=t[u][0]+t[u][1]*c,g[i]=u+1;var f=d.data[i];(l&&f<=s||!l&&f>=s)&&p.queue([t[u][0],t[u][1],f])}for(;0<p.length;)for(var _=p.dequeue(),b=_[0]+_[1]*c,w=0;4>w;w++){var x=_[0]+Zr[w],y=_[1]+Qr[w];if(0<=x&&0<=y&&x<c&&y<m){var k=x+y*c;if(!a||a.getBit(k)===h){var v=d.data[k];(l&&v<=s||!l&&v>=s)&&0===g[k]&&(g[k]=g[b],p.queue([_[0]+Zr[w],_[1]+Qr[w],v]))}}}return new Fr(d,g)}function Li(e,t={}){for(var a=new Tr(t),n=new Int16Array(this.size),o=0,s=a.getPoints(),r=0;r<e.length;r++){o++;for(var i=e[r][0],l=e[r][1],d=0;d<s.length;d++){var h=s[d][0],g=s[d][1];0<=i+h&&0<=l+g&&i+h<this.width&&l+g<this.height&&(n[i+h+(l+g)*this.width]=o)}}return new Fr(this,n)}function Ei(e,t){var i=e+t,a=i-e,n=e-(i-a)+(t-a);return n?[n,i]:[i]}function Ti(e,t){var i=e+t,a=i-e,n=e-(i-a)+(t-a);return n?[n,i]:[i]}function Vi(e){for(var t=e.map,i=t.data,a=new Set,n=new Map,o=new Set,s=[1,0,-1,0],r=[0,1,0,-1],l=e.minX;l<=e.maxX;l++)for(var d=e.minY,h;d<=e.maxY;d++)if(h=l+d*t.width,i[h]===e.id)for(var g=0;4>g;g++){var c=l+s[g],m=d+r[g];if(0<=c&&0<=m&&c<t.width&&m<t.height){var p=c+m*t.width;if(i[p]!==e.id&&!o.has(p)){o.add(p),a.add(i[p]);var u=n.get(i[p]);u?n.set(i[p],++u):n.set(i[p],1)}}}var f=Array.from(a),_=f.map(function(e){return n.get(e)});return{ids:f,lengths:_}}function Ui(e){var t=new Set,i=e.map,a=i.data;for(var n of[0,e.height-1])for(var o=0,s;o<e.width;o++){if(s=(n+e.minY)*i.width+o+e.minX,0<o-e.minX&&a[s]===e.id&&a[s-1]!==e.id){var r=a[s-1];t.add(r)}if(1<i.width-o-e.minX&&a[s]===e.id&&a[s+1]!==e.id){var l=a[s+1];t.add(l)}}for(var d of[0,e.width-1])for(var h=0,g;h<e.height;h++){if(g=(h+e.minY)*i.width+d+e.minX,0<h-e.minY&&a[g]===e.id&&a[g-i.width]!==e.id){var c=a[g-i.width];t.add(c)}if(1<i.height-h-e.minY&&a[g]===e.id&&a[g+i.width]!==e.id){var m=a[g+i.width];t.add(m)}}return Array.from(t)}function Fi(e){var t=0,i=e.map,a=i.data,n=[0];1<e.height&&(n[1]=e.height-1);for(var o of n)for(var s=1,r;s<e.width-1;s++)r=(o+e.minY)*i.width+s+e.minX,a[r]===e.id&&t++;var l=[0];1<e.width&&(l[1]=e.width-1);for(var d of l)for(var h=0,g;h<e.height;h++)g=(h+e.minY)*i.width+d+e.minX,a[g]===e.id&&t++;return t}function Yi(e){for(var t=0,i=e.map,a=i.data,n=1;n<e.width-1;n++)for(var o=1,s;o<e.height-1;o++)s=(o+e.minY)*i.width+n+e.minX,a[s]===e.id&&(a[s-1]!==e.id||a[s+1]!==e.id||a[s-i.width]!==e.id||a[s+i.width]!==e.id)&&t++;return t+e.box}function Xi(e){for(var t=0,i=e.map,a=i.data,n=1;n<e.width-1;n++)for(var o=1,s;o<e.height-1;o++)s=(o+e.minY)*i.width+n+e.minX,a[s]===e.id&&(e.externalIDs.includes(a[s-1])||e.externalIDs.includes(a[s+1])||e.externalIDs.includes(a[s-i.width])||e.externalIDs.includes(a[s+i.width]))&&t++;return t+e.box}function qi(e){var t=[e.id],a=e.map,n=a.data;if(2<e.height)for(var o=0,s;o<e.width;o++)if(s=e.minY*a.width+o+e.minX,t.includes(n[s])){var r=n[s+a.width];t.includes(r)||e.boxIDs.includes(r)||t.push(r)}for(var l=[,,,,],d=1;d<e.width-1;d++)for(var h=1,g;h<e.height-1;h++)if(g=(h+e.minY)*a.width+d+e.minX,t.includes(n[g])){l[0]=n[g-1],l[1]=n[g+1],l[2]=n[g-a.width],l[3]=n[g+a.width];for(var c=0,i;4>c;c++)i=l[c],t.includes(i)||e.boxIDs.includes(i)||t.push(i)}return t}function Oi(e,t,a,n,o){for(var s={id:[],surface:[],roiSurfaceCovered:[],same:0,opposite:0,total:0},r=0;r<a.length;r++){var i=a[r],l=i[0],d=i[1],h=l+e+(d+t)*n.width,g=n.data[h];(0<g||0>g)&&(s.id.includes(g)?s.surface[s.id.indexOf(g)]+=1:(s.id.push(g),s.surface.push(1)))}for(var c=0,m;c<s.id.length;c++)m=Kn(s.id[c]),m===o?s.same+=s.surface[c]:s.opposite+=s.surface[c],s.roiSurfaceCovered[c]=s.surface[c]/a.length;return s.total=s.opposite+s.same,s}function Ni(e){pl||(pl=new mc(1,1));var t=ml.get(e);return t||(t=new ul(e),ml.set(e,t)),t}function Gi(e){return Ni(e).canWrite()}function Hi(e){return e.includes('/')||(e='image/'+e),e}function Wi(e){for(var t=e.length;0<=--t;)e[t]=0}function Zi(e,t,i,a,n){this.static_tree=e,this.extra_bits=t,this.extra_base=i,this.elems=a,this.max_length=n,this.has_stree=e&&e.length}function Qi(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function Ki(e){return 256>e?ql[e]:ql[256+(e>>>7)]}function Ji(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=255&t>>>8}function $i(e,t,i){e.bi_valid>Cl-i?(e.bi_buf|=65535&t<<e.bi_valid,Ji(e,e.bi_buf),e.bi_buf=t>>Cl-e.bi_valid,e.bi_valid+=i-Cl):(e.bi_buf|=65535&t<<e.bi_valid,e.bi_valid+=i)}function ea(e,t,i){$i(e,i[2*t],i[2*t+1])}function ta(e,t){var i=0;do i|=1&e,e>>>=1,i<<=1;while(0<--t);return i>>>1}function ia(e){16===e.bi_valid?(Ji(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):8<=e.bi_valid&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}function aa(e,t){var i=t.dyn_tree,a=t.max_code,o=t.stat_desc.static_tree,s=t.stat_desc.has_stree,r=t.stat_desc.extra_bits,l=t.stat_desc.extra_base,d=t.stat_desc.max_length,g=0,c,h,n,m,p,u;for(m=0;m<=Bl;m++)e.bl_count[m]=0;for(i[2*e.heap[e.heap_max]+1]=0,c=e.heap_max+1;c<Il;c++)(h=e.heap[c],m=i[2*i[2*h+1]+1]+1,m>d&&(m=d,g++),i[2*h+1]=m,!(h>a))&&(e.bl_count[m]++,p=0,h>=l&&(p=r[h-l]),u=i[2*h],e.opt_len+=u*(m+p),s&&(e.static_len+=u*(o[2*h+1]+p)));if(0!=g){do{for(m=d-1;0===e.bl_count[m];)m--;e.bl_count[m]--,e.bl_count[m+1]+=2,e.bl_count[d]--,g-=2}while(0<g);for(m=d;0!==m;m--)for(h=e.bl_count[m];0!==h;)(n=e.heap[--c],!(n>a))&&(i[2*n+1]!==m&&(e.opt_len+=(m-i[2*n+1])*i[2*n],i[2*n+1]=m),h--)}}function na(e,t,i){var a=Array(Bl+1),o=0,s,r;for(s=1;s<=Bl;s++)a[s]=o=o+i[s-1]<<1;for(r=0;r<=t;r++){var n=e[2*r+1];0!==n&&(e[2*r]=ta(a[n]++,n))}}function oa(){var e=Array(Bl+1),t,i,a,n,o;for(a=0,n=0;n<Dl-1;n++)for(Nl[n]=a,t=0;t<1<<Tl[n];t++)Ol[a++]=n;for(Ol[a-1]=n,o=0,n=0;16>n;n++)for(Gl[n]=o,t=0;t<1<<Vl[n];t++)ql[o++]=n;for(o>>=7;n<Sl;n++)for(Gl[n]=o<<7,t=0;t<1<<Vl[n]-7;t++)ql[256+o++]=n;for(i=0;i<=Bl;i++)e[i]=0;for(t=0;143>=t;)Yl[2*t+1]=8,t++,e[8]++;for(;255>=t;)Yl[2*t+1]=9,t++,e[9]++;for(;279>=t;)Yl[2*t+1]=7,t++,e[7]++;for(;287>=t;)Yl[2*t+1]=8,t++,e[8]++;for(na(Yl,Ml+1,e),t=0;t<Sl;t++)Xl[2*t+1]=5,Xl[2*t]=ta(t,5);Ad=new Zi(Yl,Tl,jl+1,Ml,Bl),Rd=new Zi(Xl,Vl,0,Sl,Bl),zd=new Zi([],Ul,0,Pl,Al)}function sa(e){var t;for(t=0;t<Ml;t++)e.dyn_ltree[2*t]=0;for(t=0;t<Sl;t++)e.dyn_dtree[2*t]=0;for(t=0;t<Pl;t++)e.bl_tree[2*t]=0;e.dyn_ltree[2*Rl]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function ra(e){8<e.bi_valid?Ji(e,e.bi_buf):0<e.bi_valid&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function la(e,t,i,a){ra(e),a&&(Ji(e,i),Ji(e,~i)),wl.arraySet(e.pending_buf,e.window,t,i,e.pending),e.pending+=i}function da(e,t,i,a){var n=2*t,o=2*i;return e[n]<e[o]||e[n]===e[o]&&a[t]<=a[i]}function ha(e,t,i){for(var a=e.heap[i],n=i<<1;n<=e.heap_len&&(n<e.heap_len&&da(t,e.heap[n+1],e.heap[n],e.depth)&&n++,!da(t,a,e.heap[n],e.depth));)e.heap[i]=e.heap[n],i=n,n<<=1;e.heap[i]=a}function ga(e,t,i){var a=0,n,o,s,r;if(0!==e.last_lit)do n=e.pending_buf[e.d_buf+2*a]<<8|e.pending_buf[e.d_buf+2*a+1],o=e.pending_buf[e.l_buf+a],a++,0===n?ea(e,o,t):(s=Ol[o],ea(e,s+jl+1,t),r=Tl[s],0!==r&&(o-=Nl[s],$i(e,o,r)),n--,s=Ki(n),ea(e,s,i),r=Vl[s],0!==r&&(n-=Gl[s],$i(e,n,r)));while(a<e.last_lit);ea(e,Rl,t)}function ca(e,t){var i=t.dyn_tree,a=t.stat_desc.static_tree,o=t.stat_desc.has_stree,s=t.stat_desc.elems,r=-1,l,n,d;for(e.heap_len=0,e.heap_max=Il,l=0;l<s;l++)0===i[2*l]?i[2*l+1]=0:(e.heap[++e.heap_len]=r=l,e.depth[l]=0);for(;2>e.heap_len;)d=e.heap[++e.heap_len]=2>r?++r:0,i[2*d]=1,e.depth[d]=0,e.opt_len--,o&&(e.static_len-=a[2*d+1]);for(t.max_code=r,l=e.heap_len>>1;1<=l;l--)ha(e,i,l);d=s;do l=e.heap[1],e.heap[1]=e.heap[e.heap_len--],ha(e,i,1),n=e.heap[1],e.heap[--e.heap_max]=l,e.heap[--e.heap_max]=n,i[2*d]=i[2*l]+i[2*n],e.depth[d]=(e.depth[l]>=e.depth[n]?e.depth[l]:e.depth[n])+1,i[2*l+1]=i[2*n+1]=d,e.heap[1]=d++,ha(e,i,1);while(2<=e.heap_len);e.heap[--e.heap_max]=e.heap[1],aa(e,t),na(i,r,e.bl_count)}function ma(e,t,i){var a=-1,o=t[1],s=0,r=7,l=4,d,n;for(0===o&&(r=138,l=3),t[2*(i+1)+1]=65535,d=0;d<=i;d++){if(n=o,o=t[2*(d+1)+1],++s<r&&n===o)continue;else s<l?e.bl_tree[2*n]+=s:0===n?10>=s?e.bl_tree[2*Ll]++:e.bl_tree[2*El]++:(n!==a&&e.bl_tree[2*n]++,e.bl_tree[2*zl]++);s=0,a=n,0===o?(r=138,l=3):n===o?(r=6,l=3):(r=7,l=4)}}function pa(e,t,i){var a=-1,o=t[1],s=0,r=7,l=4,d,n;for(0===o&&(r=138,l=3),d=0;d<=i;d++){if(n=o,o=t[2*(d+1)+1],++s<r&&n===o)continue;else if(s<l)do ea(e,n,e.bl_tree);while(0!=--s);else 0===n?10>=s?(ea(e,Ll,e.bl_tree),$i(e,s-3,3)):(ea(e,El,e.bl_tree),$i(e,s-11,7)):(n!==a&&(ea(e,n,e.bl_tree),s--),ea(e,zl,e.bl_tree),$i(e,s-3,2));s=0,a=n,0===o?(r=138,l=3):n===o?(r=6,l=3):(r=7,l=4)}}function ua(e){var t;for(ma(e,e.dyn_ltree,e.l_desc.max_code),ma(e,e.dyn_dtree,e.d_desc.max_code),ca(e,e.bl_desc),t=Pl-1;3<=t&&0===e.bl_tree[2*Fl[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}function fa(e,t,i,a){var n;for($i(e,t-257,5),$i(e,i-1,5),$i(e,a-4,4),n=0;n<a;n++)$i(e,e.bl_tree[2*Fl[n]+1],3);pa(e,e.dyn_ltree,t-1),pa(e,e.dyn_dtree,i-1)}function _a(e){var t=4093624447,i;for(i=0;31>=i;i++,t>>>=1)if(1&t&&0!==e.dyn_ltree[2*i])return xl;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return yl;for(i=32;i<jl;i++)if(0!==e.dyn_ltree[2*i])return yl;return xl}function ba(e,t,i,a){$i(e,(kl<<1)+(a?1:0),3),la(e,t,i,!0)}function wa(e,t){return e.msg=Jl[t],t}function xa(e){return(e<<1)-(4<e?9:0)}function ya(e){for(var t=e.length;0<=--t;)e[t]=0}function ka(e){var t=e.state,i=t.pending;i>e.avail_out&&(i=e.avail_out),0===i||(wl.arraySet(e.output,t.pending_buf,t.pending_out,i,e.next_out),e.next_out+=i,t.pending_out+=i,e.total_out+=i,e.avail_out-=i,t.pending-=i,0===t.pending&&(t.pending_out=0))}function va(e,t){Wl._tr_flush_block(e,0<=e.block_start?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,ka(e.strm)}function Da(e,t){e.pending_buf[e.pending++]=t}function ja(e,t){e.pending_buf[e.pending++]=255&t>>>8,e.pending_buf[e.pending++]=255&t}function Ma(e,t,i,a){var n=e.avail_in;return(n>a&&(n=a),0===n)?0:(e.avail_in-=n,wl.arraySet(t,e.input,e.next_in,n,i),1===e.state.wrap?e.adler=Zl(e.adler,t,n,i):2===e.state.wrap&&(e.adler=Kl(e.adler,t,n,i)),e.next_in+=n,e.total_in+=n,n)}function Sa(e,t){var i=e.max_chain_length,a=e.strstart,n=e.prev_length,o=e.nice_match,s=e.strstart>e.w_size-xd?e.strstart-(e.w_size-xd):0,r=e.window,l=e.w_mask,d=e.prev,h=e.strstart+wd,g=r[a+n-1],c=r[a+n],m,p;e.prev_length>=e.good_match&&(i>>=2),o>e.lookahead&&(o=e.lookahead);do{if(m=t,r[m+n]!==c||r[m+n-1]!==g||r[m]!==r[a]||r[++m]!==r[a+1])continue;a+=2,m++;do;while(r[++a]===r[++m]&&r[++a]===r[++m]&&r[++a]===r[++m]&&r[++a]===r[++m]&&r[++a]===r[++m]&&r[++a]===r[++m]&&r[++a]===r[++m]&&r[++a]===r[++m]&&a<h);if(p=wd-(h-a),a=h-wd,p>n){if(e.match_start=t,n=p,p>=o)break;g=r[a+n-1],c=r[a+n]}}while((t=d[t&l])>s&&0!=--i);return n<=e.lookahead?n:e.lookahead}function Pa(e){var t=e.w_size,i,a,n,o,s;do{if(o=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-xd)){wl.arraySet(e.window,e.window,t,t,0),e.match_start-=t,e.strstart-=t,e.block_start-=t,a=e.hash_size,i=a;do n=e.head[--i],e.head[i]=n>=t?n-t:0;while(--a);a=t,i=a;do n=e.prev[--i],e.prev[i]=n>=t?n-t:0;while(--a);o+=t}if(0===e.strm.avail_in)break;if(a=Ma(e.strm,e.window,e.strstart+e.lookahead,o),e.lookahead+=a,e.lookahead+e.insert>=bd)for(s=e.strstart-e.insert,e.ins_h=e.window[s],e.ins_h=(e.ins_h<<e.hash_shift^e.window[s+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[s+bd-1])&e.hash_mask,e.prev[s&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=s,s++,e.insert--,!(e.lookahead+e.insert<bd)););}while(e.lookahead<xd&&0!==e.strm.avail_in)}function Ia(e,t){for(var i,a;;){if(e.lookahead<xd){if(Pa(e),e.lookahead<xd&&t===$l)return Pd;if(0===e.lookahead)break}if(i=0,e.lookahead>=bd&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+bd-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==i&&e.strstart-i<=e.w_size-xd&&(e.match_length=Sa(e,i)),!(e.match_length>=bd))a=Wl._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;else if(a=Wl._tr_tally(e,e.strstart-e.match_start,e.match_length-bd),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=bd){e.match_length--;do e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+bd-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;if(a&&(va(e,!1),0===e.strm.avail_out))return Pd}return e.insert=e.strstart<bd-1?e.strstart:bd-1,t===ed?(va(e,!0),0===e.strm.avail_out?Bd:Cd):e.last_lit&&(va(e,!1),0===e.strm.avail_out)?Pd:Id}function Ba(e,t){for(var i,a,n;;){if(e.lookahead<xd){if(Pa(e),e.lookahead<xd&&t===$l)return Pd;if(0===e.lookahead)break}if(i=0,e.lookahead>=bd&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+bd-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=bd-1,0!==i&&e.prev_length<e.max_lazy_match&&e.strstart-i<=e.w_size-xd&&(e.match_length=Sa(e,i),5>=e.match_length&&(e.strategy===rd||e.match_length===bd&&4096<e.strstart-e.match_start)&&(e.match_length=bd-1)),e.prev_length>=bd&&e.match_length<=e.prev_length){n=e.strstart+e.lookahead-bd,a=Wl._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-bd),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=n&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+bd-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(0!=--e.prev_length);if(e.match_available=0,e.match_length=bd-1,e.strstart++,a&&(va(e,!1),0===e.strm.avail_out))return Pd}else if(!e.match_available)e.match_available=1,e.strstart++,e.lookahead--;else if(a=Wl._tr_tally(e,0,e.window[e.strstart-1]),a&&va(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return Pd}return e.match_available&&(a=Wl._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<bd-1?e.strstart:bd-1,t===ed?(va(e,!0),0===e.strm.avail_out?Bd:Cd):e.last_lit&&(va(e,!1),0===e.strm.avail_out)?Pd:Id}function Ca(e,t){for(var i=e.window,a,n,o,s;;){if(e.lookahead<=wd){if(Pa(e),e.lookahead<=wd&&t===$l)return Pd;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=bd&&0<e.strstart&&(o=e.strstart-1,n=i[o],n===i[++o]&&n===i[++o]&&n===i[++o])){s=e.strstart+wd;do;while(n===i[++o]&&n===i[++o]&&n===i[++o]&&n===i[++o]&&n===i[++o]&&n===i[++o]&&n===i[++o]&&n===i[++o]&&o<s);e.match_length=wd-(s-o),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=bd?(a=Wl._tr_tally(e,1,e.match_length-bd),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(a=Wl._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),a&&(va(e,!1),0===e.strm.avail_out))return Pd}return e.insert=0,t===ed?(va(e,!0),0===e.strm.avail_out?Bd:Cd):e.last_lit&&(va(e,!1),0===e.strm.avail_out)?Pd:Id}function Aa(e,t){for(var i;;){if(0===e.lookahead&&(Pa(e),0===e.lookahead)){if(t===$l)return Pd;break}if(e.match_length=0,i=Wl._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,i&&(va(e,!1),0===e.strm.avail_out))return Pd}return e.insert=0,t===ed?(va(e,!0),0===e.strm.avail_out?Bd:Cd):e.last_lit&&(va(e,!1),0===e.strm.avail_out)?Pd:Id}function Ra(e,t,i,a,n){this.good_length=e,this.max_lazy=t,this.nice_length=i,this.max_chain=a,this.func=n}function za(e){e.window_size=2*e.w_size,ya(e.head),e.max_lazy_match=Ld[e.level].max_lazy,e.good_match=Ld[e.level].good_length,e.nice_match=Ld[e.level].nice_length,e.max_chain_length=Ld[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=bd-1,e.match_available=0,e.ins_h=0}function La(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=gd,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new wl.Buf16(2*fd),this.dyn_dtree=new wl.Buf16(2*(2*pd+1)),this.bl_tree=new wl.Buf16(2*(2*ud+1)),ya(this.dyn_ltree),ya(this.dyn_dtree),ya(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new wl.Buf16(_d+1),this.heap=new wl.Buf16(2*md+1),ya(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new wl.Buf16(2*md+1),ya(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Ea(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=hd,t=e.state,t.pending=0,t.pending_out=0,0>t.wrap&&(t.wrap=-t.wrap),t.status=t.wrap?yd:Md,e.adler=2===t.wrap?0:1,t.last_flush=$l,Wl._tr_init(t),id):wa(e,nd)}function Ta(e){var t=Ea(e);return t===id&&za(e.state),t}function Va(e,t,i,a,n,o){if(!e)return nd;var r=1;if(t===sd&&(t=6),0>a?(r=0,a=-a):15<a&&(r=2,a-=16),1>n||n>cd||i!==gd||8>a||15<a||0>t||9<t||0>o||o>dd)return wa(e,nd);8===a&&(a=9);var l=new La;return e.state=l,l.strm=e,l.wrap=r,l.gzhead=null,l.w_bits=a,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=n+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+bd-1)/bd),l.window=new wl.Buf8(2*l.w_size),l.head=new wl.Buf16(l.hash_size),l.prev=new wl.Buf16(l.w_size),l.lit_bufsize=1<<n+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new wl.Buf8(l.pending_buf_size),l.d_buf=1*l.lit_bufsize,l.l_buf=3*l.lit_bufsize,l.level=t,l.strategy=o,l.method=i,Ta(e)}function Ua(e,t){if(65537>t&&(e.subarray&&Vd||!e.subarray&&Td))return Qn.apply(null,wl.shrinkBuf(e,t));for(var a='',n=0;n<t;n++)a+=Qn(e[n]);return a}function Fa(e){if(!(this instanceof Fa))return new Fa(e);this.options=wl.assign({level:Hd,method:Zd,chunkSize:16384,windowBits:15,memLevel:8,strategy:Wd,to:''},e||{});var t=this.options;t.raw&&0<t.windowBits?t.windowBits=-t.windowBits:t.gzip&&0<t.windowBits&&16>t.windowBits&&(t.windowBits+=16),this.err=0,this.msg='',this.ended=!1,this.chunks=[],this.strm=new Yd,this.strm.avail_out=0;var i=Ed.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(i!==Od)throw new Error(Jl[i]);if(t.header&&Ed.deflateSetHeader(this.strm,t.header),t.dictionary){var a;if(a='string'==typeof t.dictionary?q.string2buf(t.dictionary):'[object ArrayBuffer]'===Xd.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,i=Ed.deflateSetDictionary(this.strm,a),i!==Od)throw new Error(Jl[i]);this._dict_set=!0}}function Ya(e,t){var i=new Fa(t);if(i.push(e,!0),i.err)throw i.msg||Jl[i.err];return i.result}function Xa(e){return(255&e>>>24)+(65280&e>>>8)+((65280&e)<<8)+((255&e)<<24)}function qa(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new wl.Buf16(320),this.work=new wl.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function Oa(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg='',t.wrap&&(e.adler=1&t.wrap),t.mode=bh,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new wl.Buf32(Zh),t.distcode=t.distdyn=new wl.Buf32(Qh),t.sane=1,t.back=-1,mh):ph}function Na(e){var t;return e&&e.state?(t=e.state,t.wsize=0,t.whave=0,t.wnext=0,Oa(e)):ph}function Ga(e,t){var i,a;return e&&e.state?(a=e.state,0>t?(i=0,t=-t):(i=(t>>4)+1,48>t&&(t&=15)),t&&(8>t||15<t))?ph:(null!==a.window&&a.wbits!==t&&(a.window=null),a.wrap=i,a.wbits=t,Na(e)):ph}function Ha(e,t){var i,a;return e?(a=new qa,e.state=a,a.window=null,i=Ga(e,t),i!==mh&&(e.state=null),i):ph}function Wa(e){if(Kh){var t;for(ig=new wl.Buf32(512),ag=new wl.Buf32(32),t=0;144>t;)e.lens[t++]=8;for(;256>t;)e.lens[t++]=9;for(;280>t;)e.lens[t++]=7;for(;288>t;)e.lens[t++]=8;for(lh(dh,e.lens,0,288,ig,0,e.work,{bits:9}),t=0;32>t;)e.lens[t++]=5;lh(hh,e.lens,0,32,ag,0,e.work,{bits:5}),Kh=!1}e.lencode=ig,e.lenbits=9,e.distcode=ag,e.distbits=5}function Za(e,t,i,a){var n=e.state,o;return null===n.window&&(n.wsize=1<<n.wbits,n.wnext=0,n.whave=0,n.window=new wl.Buf8(n.wsize)),a>=n.wsize?(wl.arraySet(n.window,t,i-n.wsize,n.wsize,0),n.wnext=0,n.whave=n.wsize):(o=n.wsize-n.wnext,o>a&&(o=a),wl.arraySet(n.window,t,i-a,o,n.wnext),a-=o,a?(wl.arraySet(n.window,t,i-a,a,0),n.wnext=a,n.whave=n.wsize):(n.wnext+=o,n.wnext===n.wsize&&(n.wnext=0),n.whave<n.wsize&&(n.whave+=o))),0}function Qa(e){if(!(this instanceof Qa))return new Qa(e);this.options=wl.assign({chunkSize:16384,windowBits:0,to:''},e||{});var t=this.options;t.raw&&0<=t.windowBits&&16>t.windowBits&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),0<=t.windowBits&&16>t.windowBits&&!(e&&e.windowBits)&&(t.windowBits+=32),15<t.windowBits&&48>t.windowBits&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg='',this.ended=!1,this.chunks=[],this.strm=new Yd,this.strm.avail_out=0;var i=Jh.inflateInit2(this.strm,t.windowBits);if(i!==$h.Z_OK)throw new Error(Jl[i]);this.header=new eg,Jh.inflateGetHeader(this.strm,this.header)}function Ka(e,t){var i=new Qa(t);if(i.push(e,!0),i.err)throw i.msg||Jl[i.err];return i.result}function Ja(e,t,a){for(var n=0;n<a;n++)t[n]=e[n]}function $a(e,t,a,n){for(var o=0;o<n;o++)t[o]=e[o];for(;o<a;o++)t[o]=255&e[o]+t[o-n]}function en(e,t,a,n){var o=0;if(0===a.length)for(;o<n;o++)t[o]=e[o];else for(;o<n;o++)t[o]=255&e[o]+a[o]}function tn(e,t,a,n,o){var s=0;if(0===a.length){for(;s<o;s++)t[s]=e[s];for(;s<n;s++)t[s]=255&e[s]+(t[s-o]>>1)}else{for(;s<o;s++)t[s]=255&e[s]+(a[s]>>1);for(;s<n;s++)t[s]=255&e[s]+(t[s-o]+a[s]>>1)}}function an(e,t,a,n,o){var s=0;if(0===a.length){for(;s<o;s++)t[s]=e[s];for(;s<n;s++)t[s]=255&e[s]+t[s-o]}else{for(;s<o;s++)t[s]=255&e[s]+a[s];for(;s<n;s++)t[s]=255&e[s]+nn(t[s-o],a[s],a[s-o])}}function nn(e,t,i){var a=e+t-i,n=so(a-e),o=so(a-t),s=so(a-i);return n<=o&&n<=s?e:o<=s?t:i}function on(e){return'number'==typeof e?[e]:e}function sn(e,t){if(1===t)return e.readUint8();for(var a=new Uint8Array(t),n=0;n<t;n++)a[n]=e.readUint8();return a}function rn(e,t,i,a){return 8===i?new Uint8Array(e*t):16===i?new Uint16Array(e*t):32===i&&3===a?new Float32Array(e*t):gn('bit depth / sample format',i+' / '+a)}function ln(e,t,a,n){for(var o=0;o<n;o++)e[a++]=t.getUint8(o);return a}function dn(e,t,a,n,o){for(var s=0;s<2*n;s+=2)e[a++]=t.getUint16(s,o);return a}function hn(e,t,a,n,o){for(var s=0;s<4*n;s+=4)e[a++]=t.getFloat32(s,o);return a}function gn(e,t){throw new Error('Unsupported '+e+': '+t)}function cn(e){if(e.length){const i=e;e=i[0];for(var t=0;t<i.length;t++)i[t]!==e&&gn('bit depth',i)}return e}function mn(e){var t=e.length,a='',n;for(n=0;n<t;n+=3)a+=Rg[e[n]>>2],a+=Rg[(3&e[n])<<4|e[n+1]>>4],a+=Rg[(15&e[n+1])<<2|e[n+2]>>6],a+=Rg[63&e[n+2]];return 2==t%3?a=a.substring(0,a.length-1)+'=':1==t%3&&(a=a.substring(0,a.length-2)+'=='),a}function pn(e){var t=0.75*e.length,i=e.length,a=0,n,o,s,r;'='===e[e.length-1]&&(t--,'='===e[e.length-2]&&t--);for(var l=new Uint8Array(t),d=0;d<i;d+=4)n=zg[e.charCodeAt(d)],o=zg[e.charCodeAt(d+1)],s=zg[e.charCodeAt(d+2)],r=zg[e.charCodeAt(d+3)],l[a++]=n<<2|o>>4,l[a++]=(15&o)<<4|s>>2,l[a++]=(3&s)<<6|63&r;return l}function un(e){return(255&e)<<8|255&e>>8}function fn(e,t){if('string'==typeof e)return bn(e,t);if(e instanceof ArrayBuffer)return Promise.resolve(_n(new Uint8Array(e),t));if(e.buffer)return Promise.resolve(_n(e,t));throw new Error('argument to "load" must be a string or buffer.')}function _n(e,t,i){function a(e,t){if(!e)throw new Error(`This kind of image (${n}) can only be loaded from URL.`);return vn(e,t)}var n=Ag(e);if(n)switch(n.ext){case'png':return wn(e);case'jpg':{var o=Ig(e),s;return o.exif&&(s=yn(o.exif)),a(i,{meta:s})}case'tif':return xn(e);}return a(i)}function bn(e,t){var i=e.slice(0,64).match(Eg),a;return a=i?Promise.resolve(pn(e.slice(i[0].length))):s(e,t),a.then((i)=>{var a=new Uint8Array(i);return _n(a,t,e)})}function wn(e){var t=new dg(e),a=t.decode(),n=a.bitDepth,o=a.data.buffer,s;if(8===n)s=new Uint8ClampedArray(o);else if(16===n){s=new Uint16Array(o);for(var r=0;r<s.length;r++)s[r]=un(s[r])}var i=a.colourType,l=0,d;switch(i){case 0:d=1;break;case 2:d=3;break;case 4:d=1,l=1;break;case 6:d=3,l=1;break;default:throw new Error(`Unexpected colourType: ${i}`);}return new mc(a.width,a.height,s,{components:d,alpha:l,bitDepth:n})}function xn(e){var t=Sg(e);return 1===t.length?kn(t[0]):new Sr(t.map(kn))}function yn(e){var t={tiff:e};return e.exif&&(t.exif=e.exif),e.gps&&(t.gps=e.gps),t}function kn(e){return new mc(e.width,e.height,e.data,{components:1,alpha:0,colorModel:null,bitDepth:e.bitsPerSample.length?e.bitsPerSample[0]:e.bitsPerSample,meta:yn(e)})}function vn(e,t){return t=t||{},new Promise(function(i,a){var s=new So;n(e)&&(s.crossOrigin='Anonymous'),s.onload=function(){var e=s.width,a=s.height,n=new o(e,a),r=n.getContext('2d');r.drawImage(s,0,0,e,a);var l=r.getImageData(0,0,e,a).data;i(new mc(e,a,l,t))},s.onerror=function(){a(new Error('Could not load '+e))},s.src=e})}function Dn(e){for(var t=0,i;t<e.length;t++)if(i=e[t],i.buffer instanceof ArrayBuffer){var a=i.buffer;if(i.byteLength!==a.byteLength){var n=new Uint8Array(i.byteLength);n.set(new Uint8Array(a,i.byteOffset,i.byteLength)),a=n.buffer}e[t]=a}}function jn(e,t){t=t||{};var a=new Tg;Dn(e);for(var n=0;n<e.length;n++)a.append(e[n]);return t.type?a.getBlob(t.type):a.getBlob()}function Mn(e,t){return Dn(e),new Blob(e,t||{})}function Sn(){ec=!0;for(var e=Wg.length,t,i;e;){for(i=Wg,Wg=[],t=-1;++t<e;)i[t]();e=Wg.length}ec=!1}function Pn(){}function In(e){if('function'!=typeof e)throw new TypeError('resolver must be a function');this.state=$g,this.queue=[],this.outcome=void 0,e!==Pn&&Rn(this,e)}function Bn(e,t,i){this.promise=e,'function'==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),'function'==typeof i&&(this.onRejected=i,this.callRejected=this.otherCallRejected)}function Cn(t,e,i){Zg(function(){var a;try{a=e(i)}catch(i){return Qg.reject(t,i)}a===t?Qg.reject(t,new TypeError('Cannot resolve promise with itself')):Qg.resolve(t,a)})}function An(e){var t=e&&e.then;if(e&&('object'==typeof e||'function'==typeof e)&&'function'==typeof t)return function(){t.apply(e,arguments)}}function Rn(e,t){function i(t){n||(n=!0,Qg.reject(e,t))}function a(t){n||(n=!0,Qg.resolve(e,t))}var n=!1,o=zn(function(){t(a,i)});'error'===o.status&&i(o.value)}function zn(e,t){var i={};try{i.value=e(t),i.status='success'}catch(t){i.status='error',i.value=t}return i}function Ln(e){for(var t=e.length,a=new ArrayBuffer(t),n=new Uint8Array(a),o=-1;++o<t;)n[o]=e.charCodeAt(o);return a}function En(e){for(var t='',a=new Uint8Array(e),n=a.byteLength,o=-1;++o<n;)t+=Qn(a[o]);return t}function Tn(e,t){return new tc(function(i,a){var n=new Image;t&&(n.crossOrigin=t),n.onload=function(){i(n)},n.onerror=a,n.src=e})}function Vn(e){var t=document.createElement('canvas');t.width=e.width,t.height=e.height;var i=t.getContext('2d');return i.drawImage(e,0,0,e.width,e.height,0,0,e.width,e.height),t}function Un(e,t){return t=t||{},'string'==typeof t&&(t={type:t}),new Yg(e,t)}function Fn(e){return new tc(function(t,i){var a=new FileReader,n='function'==typeof a.readAsBinaryString;a.onloadend=function(i){var e=i.target.result||'';return n?t(e):void t(En(e))},a.onerror=i,n?a.readAsBinaryString(e):a.readAsArrayBuffer(e)})}function Yn(e,t){return tc.resolve().then(function(){var i=[Ln(atob(e))];return t?Un(i,{type:t}):Un(i)})}function Xn(e){return tc.resolve().then(function(){var t=e.match(/data:([^;]+)/)[1],i=e.replace(/^[^,]+,/,''),a=Ln(atob(i));return Un([a],{type:t})})}function qn(e,t,i){return tc.resolve().then(function(){return'function'==typeof e.toBlob?new tc(function(a){e.toBlob(a,t,i)}):Xn(e.toDataURL(t,i))})}function On(e,t){const a=4*fo((t.bitDepth*t.width+31)/32),n=_o(t.bitDepth*t.width/8),o=t.bitDepth*t.width%8,s=0==o?0:8-o,r=a*t.height;var l,d;const h=new oc(t.data);let g=0,c=0,m=8;e.mark(),d=h.readUint8();for(var p=t.height-1;0<=p;p--){const t=0===p;e.reset(),e.skip(p*a);for(var i=0;i<n;i++){const r=i===n-1;c<=s&&r?(e.writeByte(d<<c),(0==s||s==c)&&!t&&(l=d,d=h.readByte())):0==c?(l=d,d=h.readUint8(),e.writeByte(l)):(l=d,d=h.readUint8(),e.writeByte(l<<c&rc[c]|d>>m)),r?(g+=o||8,e.skip(a-n),c=g%8,m=8-c):g+=8}}a>n&&(e.reset(),e.skip(r-1),e.writeUint8(0))}function Nn(e,t){8<t.bitDepth||e.writeUint32(0).writeUint32(16777215)}function Gn(e,t){e.writeChars('BM'),e.writeInt32(e._lastWrittenByte),e.writeUint16(0),e.writeUint16(0),e.writeUint32(t)}function Hn(e,t){e.writeUint32(124).writeInt32(t.width).writeInt32(t.height).writeUint16(1).writeUint16(t.bitDepth).writeUint32(sc.BITMAPV5HEADER.Compression.BI_RGB).writeUint32(t.width*t.height*t.bitDepth).writeInt32(0).writeInt32(0).writeUint32(no(2,t.bitDepth)).writeUint32(no(2,t.bitDepth)).writeUint32(4278190080).writeUint32(16711680).writeUint32(65280).writeUint32(255).writeUint32(sc.BITMAPV5HEADER.LogicalColorSpace.LCS_sRGB).skip(36).skip(12).writeUint32(sc.BITMAPV5HEADER.GamutMappingIntent.LCS_GM_IMAGES).skip(12)}function Wn(e,t){if('string'!=typeof e&&'function'!=typeof e)throw new TypeError('func argument must be a function');if(void 0===t&&(t={}),'object'!=typeof t||null===t)throw new TypeError('options argument must be an object');this._workerCode=e.toString(),this._numWorkers=void 0===t.maxWorkers||'auto'===t.maxWorkers?ro(_c-1,1):0<t.maxWorkers?ro(t.maxWorkers,_c):_c,this._workers=new Map,this._timeout=t.timeout||0,this._terminateOnError=!!t.terminateOnError;var i=t.deps;'string'==typeof i&&(i=[i]),Array.isArray(i)||(i=void 0),this._id=0,this._terminated=!1,this._working=0,this._waiting=[],this._init(i)}function Zn(e,t,i){return e.post('data',[t,i]).then(function(e){for(var t in e)e[t]=new mc(e[t]);return e})}var Qn=String.fromCharCode,Kn=Math.sign,Jn=Number.POSITIVE_INFINITY,$n=Math.cos,eo=Number.EPSILON,io=Number.MAX_VALUE,ao=Number.MIN_VALUE,to=Math.log,no=Math.pow,oo=Math.max,so=Math.abs,ro=Math.min,lo=Number.isFinite,ho=Number.isInteger,go=Math.round,co=Math.exp,mo=Math.sqrt,po=Math.sin,uo=Math.PI,fo=Math.floor,_o=Math.ceil,bo='BINARY',wo='RGBA',xo='RGB',yo='HSL',ko='HSV',vo='CMYK',Do='GREY',jo={};jo[bo]={components:1,alpha:0,bitDepth:1,colorModel:Do},jo['GREYA']={components:1,alpha:1,bitDepth:8,colorModel:Do},jo['GREY']={components:1,alpha:0,bitDepth:8,colorModel:Do},jo[wo]={components:3,alpha:1,bitDepth:8,colorModel:xo},jo['RGB']={components:3,alpha:0,bitDepth:8,colorModel:xo},jo['CMYK']={components:4,alpha:0,bitDepth:8,colorModel:vo},jo['CMYKA']={components:4,alpha:1,bitDepth:8,colorModel:vo};var Mo=self.ImageData,So=self.Image,Po=self.location.origin,Io=Number.isNaN||function(e){return e!==e},Bo=function(e,t){return D(e),D(t),e-t},Co='undefined'==typeof window?'undefined'==typeof global?'undefined'==typeof self?{}:self:global:window,Ao=S(function(e,t){(function(){var e=t;var a={release:'0.3.0',date:'2013-03'};e.toString=function(){return'version '+a.release+', released '+a.date};for(var o=0,n=null,r=null,s={init:function(e){if(0!==e&&0==(e&e-1))o=e,s._initArray(),s._makeBitReversalTable(),s._makeCosSinTable();else throw new Error('init: radix-2 required')},fft1d:function(e,t){s.fft(e,t,1)},ifft1d:function(e,t){var a=1/o;s.fft(e,t,-1);for(var n=0;n<o;n++)e[n]*=a,t[n]*=a},bt1d:function(e,t){s.fft(e,t,-1)},fft2d:function(e,t){for(var a=[],n=[],r=0,i=0;i<o;i++){r=i*o;for(var l=0;l<o;l++)a[l]=e[l+r],n[l]=t[l+r];s.fft1d(a,n);for(var d=0;d<o;d++)e[d+r]=a[d],t[d+r]=n[d]}for(var h=0;h<o;h++){for(var g=0;g<o;g++)r=h+g*o,a[g]=e[r],n[g]=t[r];s.fft1d(a,n);for(var c=0;c<o;c++)r=h+c*o,e[r]=a[c],t[r]=n[c]}},ifft2d:function(e,t){for(var a=[],n=[],r=0,i=0;i<o;i++){r=i*o;for(var l=0;l<o;l++)a[l]=e[l+r],n[l]=t[l+r];s.ifft1d(a,n);for(var d=0;d<o;d++)e[d+r]=a[d],t[d+r]=n[d]}for(var h=0;h<o;h++){for(var g=0;g<o;g++)r=h+g*o,a[g]=e[r],n[g]=t[r];s.ifft1d(a,n);for(var c=0;c<o;c++)r=h+c*o,e[r]=a[c],t[r]=n[c]}},fft:function(e,t,a){for(var s=o>>2,g=0,l,d,h,c,m,p,u,f,_;g<o;g++)c=n[g],g<c&&(m=e[g],e[g]=e[c],e[c]=m,m=t[g],t[g]=t[c],t[c]=m);for(var b=1;b<o;b<<=1){d=0,l=o/(b<<1);for(var w=0;w<b;w++){p=r[d+s],u=a*r[d];for(var x=w;x<o;x+=b<<1)h=x+b,f=p*e[h]+u*t[h],_=p*t[h]-u*e[h],e[h]=e[x]-f,e[x]+=f,t[h]=t[x]-_,t[x]+=_;d+=l}}},_initArray:function(){n='undefined'==typeof Uint32Array?[]:new Uint32Array(o),r='undefined'==typeof Float64Array?[]:new Float64Array(1.25*o)},_paddingZero:function(){},_makeBitReversalTable:function(){var e=0,t=0,i=0;for(n[0]=0;++e<o;){for(i=o>>1;i<=t;)t-=i,i>>=1;t+=i,n[e]=t}},_makeCosSinTable:function(){var e=o>>1,a=o>>2,n=o>>3,l=po(uo/o),t=2*l*l,d=mo(t*(2-t)),h=r[a]=1,g=r[0]=0;l=2*t;for(var s=1;s<n;s++)h-=t,t+=l*h,g+=d,d-=l*g,r[s]=g,r[a-s]=h;0!=n&&(r[n]=0.7071067811865476);for(var i=0;i<a;i++)r[e-i]=r[i];for(var c=0;c<e+a;c++)r[c+e]=-r[c]}},l=['init','fft1d','ifft1d','fft2d','ifft2d'],d=0;d<l.length;d++)e[l[d]]=s[l[d]];return e.bt=s.bt1d,e.fft=s.fft1d,e.ifft=s.ifft1d,e}).call(Co)}),Ro={FFTUtils:{DEBUG:!1,ifft2DArray:function(e,t,i){var a=Array(t*i),n=t/2,o=2*(i-1);Ao.init(n);for(var s={re:Array(n),im:Array(n)},r=0;r<i;r++){for(var l=n-1;0<=l;l--)s.re[l]=e[2*l*i+r],s.im[l]=e[(2*l+1)*i+r];Ao.bt(s.re,s.im);for(var l=n-1;0<=l;l--)a[2*l*i+r]=s.re[l],a[(2*l+1)*i+r]=s.im[l]}var d=Array(n*o);Ao.init(o);for(var h={re:Array(o),im:Array(o)},l=0;l<t;l+=2){h.re[0]=a[l*i],h.im[0]=a[(l+1)*i];for(var r=1;r<i;r++)h.re[r]=a[l*i+r],h.im[r]=a[(l+1)*i+r],h.re[o-r]=a[l*i+r],h.im[o-r]=-a[(l+1)*i+r];Ao.bt(h.re,h.im);for(var g=l/2*o,r=o-1;0<=r;r--)d[g+r]=h.re[r]/(o*n)}return d},fft2DArray:function(e,t,i){var a=Object.assign({},{inplace:!0}),n=i/2+1,o=2*t,s=Array(o*n);Ao.init(i);for(var r={re:Array(i),im:Array(i)},l={re:Array(i),im:Array(i)},d={re:Array(i),im:Array(i)},h=0,g,c,m,p,u;h<t/2;h++){g=2*h*i,r.re=e.slice(g,g+i),g=(2*h+1)*i,r.im=e.slice(g,g+i),Ao.fft1d(r.re,r.im),this.reconstructTwoRealFFT(r,l,d),c=4*h*n,m=(4*h+1)*n,p=(4*h+2)*n,u=(4*h+3)*n;for(var f=n-1;0<=f;f--)s[c+f]=l.re[f],s[m+f]=l.im[f],s[p+f]=d.re[f],s[u+f]=d.im[f]}l=null,d=null;var _=Array(o*n);Ao.init(t);for(var b={re:Array(t),im:Array(t)},w=n-1;0<=w;w--){for(var h=t-1;0<=h;h--)b.re[h]=s[2*h*n+w],b.im[h]=s[(2*h+1)*n+w],isNaN(b.re[h])&&(b.re[h]=0),isNaN(b.im[h])&&(b.im[h]=0);Ao.fft1d(b.re,b.im);for(var h=t-1;0<=h;h--)_[2*h*n+w]=b.re[h],_[(2*h+1)*n+w]=b.im[h]}return _},reconstructTwoRealFFT:function(e,t,a){var n=e.re.length;t.re[0]=e.re[0],t.im[0]=0,a.re[0]=e.im[0],a.im[0]=0;for(var o=n/2,i,s,r,l,d;0<o;o--)d=n-o,i=0.5*(e.re[o]-e.re[d]),s=0.5*(e.re[o]+e.re[d]),r=0.5*(e.im[o]-e.im[d]),l=0.5*(e.im[o]+e.im[d]),t.re[o]=s,t.im[o]=r,t.re[d]=s,t.im[d]=-r,a.re[o]=l,a.im[o]=-i,a.re[d]=l,a.im[d]=i},convolute2DI:function(e,t,i,a){for(var n=0,o,s;n<i/2;n++)for(var r=0;r<a;r++)o=e[2*n*a+r]*t[2*n*a+r]-e[(2*n+1)*a+r]*t[(2*n+1)*a+r],s=e[2*n*a+r]*t[(2*n+1)*a+r]+e[(2*n+1)*a+r]*t[2*n*a+r],e[2*n*a+r]=o,e[(2*n+1)*a+r]=s},convolute:function(e,t,a,n){for(var o=Array(n*a),s=0;s<a*n;s++)o[s]=e[s];o=this.fft2DArray(o,a,n);for(var i=t.length,r=t[0].length,l=Array(n*a),s=0;s<n*a;s++)l[s]=0;for(var d=fo((i-1)/2),h=fo((r-1)/2),g=0,c,m;g<i;g++){c=(g-d+a)%a;for(var p=0;p<r;p++)m=(p-h+n)%n,l[c*n+m]=t[g][p]}l=this.fft2DArray(l,a,n);var u=2*a,f=n/2+1;return this.convolute2DI(o,l,u,f),this.ifft2DArray(o,u,f)},toRadix2:function(e,t,a){var n=a,o=t,s=0,r=0,l,i,d,h;if(0===a||0!=(a&a-1)){for(n=0;0!=a>>++n;);n=1<<n,r=n-a}if(0===t||0!=(t&t-1)){for(o=0;0!=t>>++o;);o=1<<o,s=(o-t)*n}if(o==t&&n==a)return{data:e,rows:t,cols:a};var g=Array(o*n),c=fo((o-t)/2)-t,m=fo((n-a)/2)-a;for(l=0;l<o;l++)for(d=l*n,h=(l-c)%t*a,i=0;i<n;i++)g[d+i]=e[h+(i-m)%a];return{data:g,rows:o,cols:n}},crop:function(e,t,a,n,o,s){if(t==n&&a==o)return e;var r=Object.assign({},s),l=Array(o*n),d=fo((t-n)/2),h=fo((a-o)/2),g,c,m,i;for(m=0;m<n;m++)for(g=m*o,c=(m+d)*a,i=0;i<o;i++)l[g+i]=e[c+(i+h)];return l}},FFT:Ao}.FFTUtils,zo={fft:function(e,t,a){var n=P(e),o=n.data,s=Object.assign({normalize:!1,divisor:1,rows:n.rows,cols:n.cols},a),r,l;if(s.rows&&s.cols)r=s.rows,l=s.cols;else throw new Error('Invalid number of rows or columns '+r+' '+l);var d=s.divisor,h=t.length,g=t[0].length,c,i;if(s.normalize)for(d=0,c=0;c<h;c++)for(i=0;i<g;i++)d+=t[c][i];if(0===d)throw new RangeError('convolution: The divisor is equal to zero');var m=Ro.toRadix2(o,r,l),p=Ro.convolute(m.data,t,m.rows,m.cols);if(p=Ro.crop(p,m.rows,m.cols,r,l),0!=d&&1!=d)for(c=0;c<p.length;c++)p[c]/=d;return p},direct:function(e,t,a){var n=P(e),o=n.data,s=Object.assign({normalize:!1,divisor:1,rows:n.rows,cols:n.cols},a),r,l;if(s.rows&&s.cols)r=s.rows,l=s.cols;else throw new Error('Invalid number of rows or columns '+r+' '+l);var d=s.divisor,h=t.length,g=t[0].length,c,i,m,p,u,f,_,b,w;if(s.normalize)for(d=0,c=0;c<h;c++)for(i=0;i<g;i++)d+=t[c][i];if(0===d)throw new RangeError('convolution: The divisor is equal to zero');var x=Array(r*l),y=fo(h/2),k=fo(g/2);for(p=0;p<r;p++)for(m=0;m<l;m++){for(f=0,i=0;i<h;i++)for(c=0;c<g;c++)_=t[h-i-1][g-c-1],b=(p+i-y+r)%r,w=(m+c-k+l)%l,u=b*l+w,f+=o[u]*_;u=p*l+m,x[u]=f/d}return x},kernelFactory:{LoG:function(e,t,a){var n=1e3;a&&a.factor&&(n=a.factor);var o=Array(t),s,i,r,l;n*=-1;var d=(t-1)/2;for(s=0;s<t;s++)for(o[s]=Array(t),l=(s-d)*(s-d),i=0;i<t;i++)r=-((i-d)*(i-d)+l)/(2*e*e),o[s][i]=go(n*(1+r)*co(r));return o}},matrix2Array:P},Lo=zo.direct,Eo=zo.fft,To=lo||function(e){return!('number'!=typeof e||Io(e)||e===Infinity||e===-Infinity)},Vo=ho||function(e){return'number'==typeof e&&To(e)&&fo(e)===e};Symbol.species||(Symbol.species=Symbol.for('@@species')),R.prototype={isSingular:function(){for(var e=this.LU,t=e.columns,i=0;i<t;i++)if(0===e[i][i])return!0;return!1},get determinant(){var e=this.LU;if(!e.isSquare())throw new Error('Matrix must be square');for(var t=this.pivotSign,i=e.columns,a=0;a<i;a++)t*=e[a][a];return t},get lowerTriangularMatrix(){for(var e=this.LU,t=e.rows,a=e.columns,n=new as(t,a),o=0;o<t;o++)for(var i=0;i<a;i++)n[o][i]=o>i?e[o][i]:o===i?1:0;return n},get upperTriangularMatrix(){for(var e=this.LU,t=e.rows,a=e.columns,n=new as(t,a),o=0;o<t;o++)for(var i=0;i<a;i++)n[o][i]=o<=i?e[o][i]:0;return n},get pivotPermutationVector(){return this.pivotVector.slice()},solve:function(e){e=as.checkMatrix(e);var t=this.LU,a=t.rows;if(a!==e.rows)throw new Error('Invalid matrix dimensions');if(this.isSingular())throw new Error('LU matrix is singular');var n=e.columns,o=e.subMatrixRow(this.pivotVector,0,n-1),s=t.columns,r,i,l;for(l=0;l<s;l++)for(r=l+1;r<s;r++)for(i=0;i<n;i++)o[r][i]-=o[l][i]*t[r][l];for(l=s-1;0<=l;l--){for(i=0;i<n;i++)o[l][i]/=t[l][l];for(r=0;r<l;r++)for(i=0;i<n;i++)o[r][i]-=o[l][i]*t[r][l]}return o}},E.prototype={get condition(){return this.s[0]/this.s[ro(this.m,this.n)-1]},get norm2(){return this.s[0]},get rank(){for(var e=oo(this.m,this.n)*this.s[0]*2.220446049250313e-16,t=0,a=this.s,n=0,i=a.length;n<i;n++)a[n]>e&&t++;return t},get diagonal(){return this.s},get threshold(){return 2.220446049250313e-16/2*oo(this.m,this.n)*this.s[0]},get leftSingularVectors(){return as.isMatrix(this.U)||(this.U=new as(this.U)),this.U},get rightSingularVectors(){return as.isMatrix(this.V)||(this.V=new as(this.V)),this.V},get diagonalMatrix(){return as.diag(this.s)},solve:function(t){var a=this.threshold,e=this.s.length,n=as.zeros(e,e),o;for(o=0;o<e;o++)n[o][o]=so(this.s[o])<=a?0:1/this.s[o];var i=this.U,s=this.rightSingularVectors,r=s.mmul(n),l=s.rows,d=i.length,h=as.zeros(l,d),g,c,m;for(o=0;o<l;o++)for(g=0;g<d;g++){for(m=0,c=0;c<e;c++)m+=r[o][c]*i[g][c];h[o][g]=m}return h.mmul(t)},solveForDiagonal:function(e){return this.solve(as.diag(e))},inverse:function(){var t=this.V,a=this.threshold,e=t.length,n=t[0].length,o=new as(e,this.s.length),s,i;for(s=0;s<e;s++)for(i=0;i<n;i++)o[s][i]=so(this.s[i])>a?t[s][i]/this.s[i]:0;var r=this.U,l=r.length,d=r[0].length,h=new as(e,l),g,c;for(s=0;s<e;s++)for(i=0;i<l;i++){for(c=0,g=0;g<d;g++)c+=o[s][g]*r[i][g];h[s][i]=c}return h}};var Uo=S(function(e,t){'use strict';function a(e,t){return e-t}t.sum=function(e){for(var t=0,a=0;a<e.length;a++)t+=e[a];return t},t.max=function(e){for(var t=e[0],a=e.length,n=1;n<a;n++)e[n]>t&&(t=e[n]);return t},t.min=function(e){for(var t=e[0],a=e.length,n=1;n<a;n++)e[n]<t&&(t=e[n]);return t},t.minMax=function(e){for(var t=e[0],a=e[0],n=e.length,o=1;o<n;o++)e[o]<t&&(t=e[o]),e[o]>a&&(a=e[o]);return{min:t,max:a}},t.arithmeticMean=function(e){for(var t=0,a=e.length,n=0;n<a;n++)t+=e[n];return t/a},t.mean=t.arithmeticMean,t.geometricMean=function(e){for(var t=1,a=e.length,n=0;n<a;n++)t*=e[n];return no(t,1/a)},t.logMean=function(e){for(var t=0,a=e.length,n=0;n<a;n++)t+=to(e[n]);return t/a},t.grandMean=function(e,t){for(var a=0,o=0,n=e.length,s=0;s<n;s++)a+=t[s]*e[s],o+=t[s];return a/o},t.truncatedMean=function(e,t,n){void 0===n&&(n=!1),n||(e=[].concat(e).sort(a));for(var o=e.length,s=fo(o*t),r=0,l=s;l<o-s;l++)r+=e[l];return r/(o-2*s)},t.harmonicMean=function(e){for(var t=0,a=e.length,n=0;n<a;n++){if(0===e[n])throw new RangeError('value at index '+n+'is zero');t+=1/e[n]}return a/t},t.contraHarmonicMean=function(e){for(var t=0,a=0,n=e.length,o=0;o<n;o++)t+=e[o]*e[o],a+=e[o];if(0>a)throw new RangeError('sum of values is negative');return t/a},t.median=function(e,t){void 0===t&&(t=!1),t||(e=[].concat(e).sort(a));var i=e.length,n=fo(i/2);return 0==i%2?0.5*(e[n-1]+e[n]):e[n]},t.variance=function(e,a){void 0===a&&(a=!0);for(var n=t.mean(e),o=0,s=e.length,r=0,i;r<s;r++)i=e[r]-n,o+=i*i;return a?o/(s-1):o/s},t.standardDeviation=function(e,i){return mo(t.variance(e,i))},t.standardError=function(e){return t.standardDeviation(e)/mo(e.length)},t.robustMeanAndStdev=function(e){var t=0,n=0,o=e.length,s=0;for(s=0;s<o;s++)t+=e[s];t/=o;var i=Array(o);for(s=0;s<o;s++)i[s]=so(e[s]-t);return i.sort(a),n=1==o%2?i[(o-1)/2]/0.6745:0.5*(i[o/2]+i[o/2-1])/0.6745,{mean:t,stdev:n}},t.quartiles=function(e,i){'undefined'==typeof i&&(i=!1),i||(e=[].concat(e).sort(a));var n=e.length/4,o=e[_o(n)-1],s=t.median(e,!0),r=e[_o(3*n)-1];return{q1:o,q2:s,q3:r}},t.pooledStandardDeviation=function(e,i){return mo(t.pooledVariance(e,i))},t.pooledVariance=function(e,a){'undefined'==typeof a&&(a=!0);for(var n=0,o=0,s=e.length,r=0;r<s;r++){var i=e[r],l=t.variance(i);n+=(i.length-1)*l,o+=a?i.length-1:i.length}return n/o},t.mode=function(e){var t=e.length,a=Array(t),n;for(n=0;n<t;n++)a[n]=0;var i=Array(t),o=0;for(n=0;n<t;n++){var s=i.indexOf(e[n]);0<=s?a[s]++:(i[o]=e[n],a[o]=1,o++)}var r=0,l=0;for(n=0;n<o;n++)a[n]>r&&(r=a[n],l=n);return i[l]},t.covariance=function(e,a,n){'undefined'==typeof n&&(n=!0);var o=t.mean(e),s=t.mean(a);if(e.length!==a.length)throw'Vectors do not have the same dimensions';for(var r=0,d=e.length,l=0;l<d;l++){var i=e[l]-o,h=a[l]-s;r+=i*h}return n?r/(d-1):r/d},t.skewness=function(e,n){'undefined'==typeof n&&(n=!0);for(var o=t.mean(e),s=0,r=0,d=e.length,l=0,i;l<d;l++)i=e[l]-o,s+=i*i,r+=i*i*i;var h=s/d,c=r/d,m=c/no(h,3/2);if(n){var g=mo(d*(d-1));return g/(d-2)*m}return m},t.kurtosis=function(e,a){'undefined'==typeof a&&(a=!0);for(var o=t.mean(e),s=e.length,n=0,r=0,l=0,i;l<s;l++)i=e[l]-o,n+=i*i,r+=i*i*i*i;var d=n/s,h=r/s;if(a){var g=n/(s-1),c=r/(g*g);return s*(s+1)/((s-1)*(s-2)*(s-3))*c-3*((s-1)*(s-1)/((s-2)*(s-3)))}return h/(d*d)-3},t.entropy=function(e,t){'undefined'==typeof t&&(t=0);for(var a=0,n=e.length,o=0;o<n;o++)a+=e[o]*to(e[o]+t);return-a},t.weightedMean=function(e,t){for(var a=0,n=e.length,o=0;o<n;o++)a+=e[o]*t[o];return a},t.weightedStandardDeviation=function(e,i){return mo(t.weightedVariance(e,i))},t.weightedVariance=function(e,n){for(var o=t.weightedMean(e,n),s=0,r=e.length,l=0,a=0,d=0;d<r;d++){var i=e[d]-o,h=n[d];s+=h*(i*i),a+=h,l+=h*h}return s*(a/(a*a-l))},t.center=function(e,a){'undefined'==typeof a&&(a=!1);var n=e;a||(n=[].concat(e));for(var o=t.mean(n),s=n.length,r=0;r<s;r++)n[r]-=o},t.standardize=function(e,a,n){'undefined'==typeof a&&(a=t.standardDeviation(e)),'undefined'==typeof n&&(n=!1);for(var o=e.length,s=n?e:Array(o),r=0;r<o;r++)s[r]=e[r]/a;return s},t.cumulativeSum=function(e){var t=e.length,a=Array(t);a[0]=e[0];for(var n=1;n<t;n++)a[n]=a[n-1]+e[n];return a}}),Fo=S(function(e,t){'use strict';function a(e,t){return e-t}t.max=function(e){for(var t=-Infinity,a=0;a<e.length;a++)for(var i=0;i<e[a].length;i++)e[a][i]>t&&(t=e[a][i]);return t},t.min=function(e){for(var t=Infinity,a=0;a<e.length;a++)for(var i=0;i<e[a].length;i++)e[a][i]<t&&(t=e[a][i]);return t},t.minMax=function(e){for(var t=Infinity,a=-Infinity,n=0;n<e.length;n++)for(var i=0;i<e[n].length;i++)e[n][i]<t&&(t=e[n][i]),e[n][i]>a&&(a=e[n][i]);return{min:t,max:a}},t.entropy=function(e,t){'undefined'==typeof t&&(t=0);for(var a=0,n=e.length,o=e[0].length,s=0;s<n;s++)for(var i=0;i<o;i++)a+=e[s][i]*to(e[s][i]+t);return-a},t.mean=function(e,t){'undefined'==typeof t&&(t=0);var a=e.length,n=e[0].length,o,s,r,i;if(-1===t){for(o=[0],s=a*n,r=0;r<a;r++)for(i=0;i<n;i++)o[0]+=e[r][i];o[0]/=s}else if(0===t)for(o=Array(n),s=a,i=0;i<n;i++){for(o[i]=0,r=0;r<a;r++)o[i]+=e[r][i];o[i]/=s}else if(1===t)for(o=Array(a),s=n,i=0;i<a;i++){for(o[i]=0,r=0;r<n;r++)o[i]+=e[i][r];o[i]/=s}else throw new Error('Invalid dimension');return o},t.sum=function(e,t){'undefined'==typeof t&&(t=0);var a=e.length,n=e[0].length,o,s,i;if(-1===t)for(o=[0],s=0;s<a;s++)for(i=0;i<n;i++)o[0]+=e[s][i];else if(0===t)for(o=Array(n),i=0;i<n;i++)for(o[i]=0,s=0;s<a;s++)o[i]+=e[s][i];else if(1===t)for(o=Array(a),i=0;i<a;i++)for(o[i]=0,s=0;s<n;s++)o[i]+=e[i][s];else throw new Error('Invalid dimension');return o},t.product=function(e,t){'undefined'==typeof t&&(t=0);var a=e.length,n=e[0].length,o,s,i;if(-1===t)for(o=[1],s=0;s<a;s++)for(i=0;i<n;i++)o[0]*=e[s][i];else if(0===t)for(o=Array(n),i=0;i<n;i++)for(o[i]=1,s=0;s<a;s++)o[i]*=e[s][i];else if(1===t)for(o=Array(a),i=0;i<a;i++)for(o[i]=1,s=0;s<n;s++)o[i]*=e[i][s];else throw new Error('Invalid dimension');return o},t.standardDeviation=function(e,a,n){for(var o=t.variance(e,a,n),s=o.length,r=0;r<s;r++)o[r]=mo(o[r]);return o},t.variance=function(e,a,n){'undefined'==typeof n&&(n=!0),a=a||t.mean(e);var o=e.length;if(0===o)return[];for(var s=e[0].length,r=Array(s),l=0;l<s;l++){for(var d=0,h=0,g=0,c=0;c<o;c++)g=e[c][l]-a[l],d+=g,h+=g*g;r[l]=n?(h-d*d/o)/(o-1):(h-d*d/o)/o}return r},t.median=function(e){for(var t=e.length,n=e[0].length,o=Array(n),s=0,i;s<n;s++){i=Array(t);for(var r=0;r<t;r++)i[r]=e[r][s];i.sort(a);var l=i.length;o[s]=0==l%2?0.5*(i[l/2]+i[l/2-1]):i[fo(l/2)]}return o},t.mode=function(e){var t=e.length,a=e[0].length,n=Array(a),o,i;for(o=0;o<a;o++){for(var s=Array(t),r=0;r<t;r++)s[r]=0;var l=Array(t),d=0;for(i=0;i<t;i++){var h=l.indexOf(e[i][o]);0<=h?s[h]++:(l[d]=e[i][o],s[d]=1,d++)}var g=0,c=0;for(i=0;i<d;i++)s[i]>g&&(g=s[i],c=i);n[o]=l[c]}return n},t.skewness=function(e,o){'undefined'==typeof o&&(o=!0);for(var s=t.mean(e),r=e.length,n=s.length,l=Array(n),d=0;d<n;d++){for(var h=0,c=0,m=0,i;m<r;m++)i=e[m][d]-s[d],h+=i*i,c+=i*i*i;var p=h/r,u=c/r,f=u/no(p,3/2);if(o){var g=mo(r*(r-1));l[d]=g/(r-2)*f}else l[d]=f}return l},t.kurtosis=function(e,a){'undefined'==typeof a&&(a=!0);for(var o=t.mean(e),s=e.length,n=e[0].length,r=Array(n),l=0;l<n;l++){for(var d=0,h=0,g=0,i;g<s;g++)i=e[g][l]-o[l],d+=i*i,h+=i*i*i*i;var c=d/s,m=h/s;if(a){var p=d/(s-1),u=h/(p*p);r[l]=s*(s+1)/((s-1)*(s-2)*(s-3))*u-3*((s-1)*(s-1)/((s-2)*(s-3)))}else r[l]=m/(c*c)-3}return r},t.standardError=function(e){for(var a=e.length,n=t.standardDeviation(e),o=n.length,s=Array(o),r=mo(a),l=0;l<o;l++)s[l]=n[l]/r;return s},t.covariance=function(e,i){return t.scatter(e,void 0,i)},t.scatter=function(e,a,n){'undefined'==typeof n&&(n=0),'undefined'==typeof a&&(0===n?a=e.length-1:1===n&&(a=e[0].length-1));var o=t.mean(e,n),r=e.length;if(0===r)return[[]];var l=e[0].length,d,h,i,g,s;if(0===n){for(d=Array(l),h=0;h<l;h++)d[h]=Array(l);for(h=0;h<l;h++)for(i=h;i<l;i++){for(g=0,s=0;s<r;s++)g+=(e[s][i]-o[i])*(e[s][h]-o[h]);g/=a,d[h][i]=g,d[i][h]=g}}else if(1===n){for(d=Array(r),h=0;h<r;h++)d[h]=Array(r);for(h=0;h<r;h++)for(i=h;i<r;i++){for(g=0,s=0;s<l;s++)g+=(e[i][s]-o[i])*(e[h][s]-o[h]);g/=a,d[h][i]=g,d[i][h]=g}}else throw new Error('Invalid dimension');return d},t.correlation=function(e){var a=t.mean(e),n=t.standardDeviation(e,!0,a),o=t.zScores(e,a,n),s=e.length,r=e[0].length,d=Array(r),h,i;for(h=0;h<r;h++)d[h]=Array(r);for(h=0;h<r;h++)for(i=h;i<r;i++){for(var g=0,c=0,m=o.length;c<m;c++)g+=o[c][i]*o[c][h];g/=s-1,d[h][i]=g,d[i][h]=g}return d},t.zScores=function(e,i,a){return i=i||t.mean(e),'undefined'==typeof a&&(a=t.standardDeviation(e,!0,i)),t.standardize(t.center(e,i,!1),a,!0)},t.center=function(e,a,n){a=a||t.mean(e);var o=e,s=e.length,r,i,l;if(!n)for(o=Array(s),r=0;r<s;r++)o[r]=Array(e[r].length);for(r=0;r<s;r++){var d=o[r];for(i=0,l=d.length;i<l;i++)d[i]=e[r][i]-a[i]}return o},t.standardize=function(e,a,n){'undefined'==typeof a&&(a=t.standardDeviation(e));var o=e,s=e.length,r,i,l;if(!n)for(o=Array(s),r=0;r<s;r++)o[r]=Array(e[r].length);for(r=0;r<s;r++){var d=o[r],h=e[r];for(i=0,l=d.length;i<l;i++)0===a[i]||isNaN(a[i])||(d[i]=h[i]/a[i])}return o},t.weightedVariance=function(e,n){var o=t.mean(e),s=e.length;if(0===s)return[];for(var r=e[0].length,l=Array(r),d=0;d<r;d++){for(var h=0,g=0,a=0,c=0;c<s;c++){var i=e[c][d]-o[d],m=n[c];h+=m*(i*i),a+=m,g+=m*m}l[d]=h*(a/(a*a-g))}return l},t.weightedMean=function(e,t,a){'undefined'==typeof a&&(a=0);var n=e.length;if(0===n)return[];var o=e[0].length,s,r,i,l,d,h;if(0===a){for(s=Array(o),r=0;r<o;r++)s[r]=0;for(r=0;r<n;r++)for(h=e[r],d=t[r],l=0;l<o;l++)s[l]+=h[l]*d}else if(1===a){for(s=Array(n),r=0;r<n;r++)s[r]=0;for(l=0;l<n;l++)for(h=e[l],d=t[l],r=0;r<o;r++)s[l]+=h[r]*d}else throw new Error('Invalid dimension');var g=Uo.sum(t);if(0!==g)for(r=0,i=s.length;r<i;r++)s[r]/=g;return s},t.weightedCovariance=function(e,a,n,o){o=o||0,n=n||t.weightedMean(e,a,o);for(var s=0,r=0,l=0,i=a.length;l<i;l++)s+=a[l],r+=a[l]*a[l];var d=s/(s*s-r);return t.weightedScatter(e,a,n,d,o)},t.weightedScatter=function(e,a,n,o,r){r=r||0,n=n||t.weightedMean(e,a,r),'undefined'==typeof o&&(o=1);var l=e.length;if(0===l)return[[]];var d=e[0].length,h,g,i,c,m;if(0===r){for(h=Array(d),g=0;g<d;g++)h[g]=Array(d);for(g=0;g<d;g++)for(i=g;i<d;i++){for(m=0,c=0;c<l;c++)m+=a[c]*(e[c][i]-n[i])*(e[c][g]-n[g]);h[g][i]=m*o,h[i][g]=m*o}}else if(1===r){for(h=Array(l),g=0;g<l;g++)h[g]=Array(l);for(g=0;g<l;g++)for(i=g;i<l;i++){for(m=0,c=0;c<d;c++)m+=a[c]*(e[i][c]-n[i])*(e[g][c]-n[g]);h[g][i]=m*o,h[i][g]=m*o}}else throw new Error('Invalid dimension');return h}}),Yo={array:Uo,matrix:Fo};const Xo=Yo.array;var qo={coordArrayToPoints:function(e,t){if(0!=e.length%t)throw new RangeError('Dimensions number must be accordance with the size of the array.');for(var a=e.length/t,n=Array(a),o=0,s=0,i;s<e.length;s+=t){i=Array(t);for(var r=0;r<t;++r)i[r]=e[s+r];n[o]=i,o++}return n},coordArrayToCoordMatrix:function(e,t){if(0!=e.length%t)throw new RangeError('Dimensions number must be accordance with the size of the array.');for(var a=Array(t),n=e.length/t,o=0;o<a.length;o++)a[o]=Array(n);for(o=0;o<e.length;o+=t)for(var i=0,s;i<t;++i)s=fo(o/t),a[i][s]=e[o+i];return a},coordMatrixToCoordArray:function(e){for(var t=Array(e.length*e[0].length),a=0,n=0;n<e[0].length;++n)for(var i=0;i<e.length;++i)t[a]=e[i][n],++a;return t},coordMatrixToPoints:T,pointsToCoordArray:function(e){for(var t=Array(e.length*e[0].length),a=0,n=0;n<e.length;++n)for(var i=0;i<e[0].length;++i)t[a]=e[n][i],++a;return t},pointsToCoordMatrix:T,applyDotProduct:function(e,t){var a,n;e.length<=t.length?(n=e,a=t):(n=t,a=e);for(var o=a.length-n.length+1,s=Array(o),r=0,i;r<o;++r){i=0;for(var l=0;l<n.length;++l)i+=n[l]*a[r+l];s[r]=i}return s},scale:function(e,t){var a=t.inPlace?e:Array(e.length);const n=t.max,o=t.min;if('number'==typeof n){if('number'==typeof o)for(var s=Xo.minMax(e),r=(n-o)/(s.max-s.min),l=0;l<a.length;l++)a[l]=(e[l]-s.min)*r+o;else for(var i=Xo.max(e),r=n/i,l=0;l<a.length;l++)a[l]=e[l]*r;}else if('number'==typeof o)for(var i=Xo.min(e),r=o/i,l=0;l<a.length;l++)a[l]=e[l]*r;return a}},Oo={getEquallySpacedData:function(e,t,i){1<e.length&&e[0]>e[1]&&(e=e.slice().reverse(),t=t.slice().reverse());var a=e.length;if(a!==t.length)throw new RangeError('the x and y vector doesn\'t have the same size.');void 0===i&&(i={});var n=void 0===i.from?e[0]:i.from;if(isNaN(n)||!isFinite(n))throw new RangeError('\'From\' value must be a number');var o=void 0===i.to?e[e.length-1]:i.to;if(isNaN(o)||!isFinite(o))throw new RangeError('\'To\' value must be a number');var s=n>o;if(s){var r=n;n=o,o=r}var l=void 0===i.numberOfPoints?100:i.numberOfPoints;if(isNaN(l)||!isFinite(l))throw new RangeError('\'Number of points\' value must be a number');if(1>l)throw new RangeError('the number of point must be higher than 1');var d='slot'===i.variant?'slot':'smooth',h='slot'==d?U(e,t,n,o,l):V(e,t,n,o,l);return s?h.reverse():h},integral:F},No=Yo.array,Go={SNV:function(e){for(var t=No.mean(e),a=No.standardDeviation(e),n=e.slice(),o=0;o<e.length;o++)n[o]=(n[o]-t)/a;return n}},Ho=S(function(e,t){e.exports=t=qo,t.getEquallySpacedData=Oo.getEquallySpacedData,t.SNV=Go.SNV}),Wo=Ho.scale;class Zo extends K(){constructor(e,t,i){super(),this.matrix=e,this.rows=t,this.columns=i}static get[Symbol.species](){return as}}class Qo extends Zo{constructor(e){super(e,e.columns,e.rows)}set(e,t,i){return this.matrix.set(t,e,i),this}get(e,t){return this.matrix.get(t,e)}}class Ko extends Zo{constructor(e,t){super(e,1,e.columns),this.row=t}set(e,t,i){return this.matrix.set(this.row,t,i),this}get(e,t){return this.matrix.get(this.row,t)}}class Jo extends Zo{constructor(e,t,i,a,n){H(e,t,i,a,n),super(e,i-t+1,n-a+1),this.startRow=t,this.startColumn=a}set(e,t,i){return this.matrix.set(this.startRow+e,this.startColumn+t,i),this}get(e,t){return this.matrix.get(this.startRow+e,this.startColumn+t)}}class $o extends Zo{constructor(e,t,i){var a=G(e,t,i);super(e,a.row.length,a.column.length),this.rowIndices=a.row,this.columnIndices=a.column}set(e,t,i){return this.matrix.set(this.rowIndices[e],this.columnIndices[t],i),this}get(e,t){return this.matrix.get(this.rowIndices[e],this.columnIndices[t])}}class es extends Zo{constructor(e,t){super(e,e.rows,1),this.column=t}set(e,t,i){return this.matrix.set(e,this.column,i),this}get(e){return this.matrix.get(e,this.column)}}class ts extends Zo{constructor(e){super(e,e.rows,e.columns)}set(e,t,i){return this.matrix.set(this.rows-e-1,t,i),this}get(e,t){return this.matrix.get(this.rows-e-1,t)}}class is extends Zo{constructor(e){super(e,e.rows,e.columns)}set(e,t,i){return this.matrix.set(e,this.columns-t-1,i),this}get(e,t){return this.matrix.get(e,this.columns-t-1)}}class as extends K(Array){constructor(e,t){var a;if(1===arguments.length&&'number'==typeof e)return Array(e);if(as.isMatrix(e))return e.clone();if(ho(e)&&0<e){if(super(e),ho(t)&&0<t)for(a=0;a<e;a++)this[a]=Array(t);else throw new TypeError('nColumns must be a positive integer');}else if(Array.isArray(e)){const i=e;if(e=i.length,t=i[0].length,'number'!=typeof t||0===t)throw new TypeError('Data must be a 2D array with at least one element');for(super(e),a=0;a<e;a++){if(i[a].length!==t)throw new RangeError('Inconsistent array dimensions');this[a]=[].concat(i[a])}}else throw new TypeError('First argument must be a positive number or an array');return this.rows=e,this.columns=t,this}set(e,t,i){return this[e][t]=i,this}get(e,t){return this[e][t]}clone(){for(var e=new this.constructor[Symbol.species](this.rows,this.columns),t=0;t<this.rows;t++)for(var i=0;i<this.columns;i++)e.set(t,i,this.get(t,i));return e}removeRow(e){if(Y(this,e),1===this.rows)throw new RangeError('A matrix cannot have less than one row');return this.splice(e,1),this.rows-=1,this}addRow(e,t){return void 0===t&&(t=e,e=this.rows),Y(this,e,!0),t=O(this,t,!0),this.splice(e,0,t),this.rows+=1,this}removeColumn(e){if(X(this,e),1===this.columns)throw new RangeError('A matrix cannot have less than one column');for(var t=0;t<this.rows;t++)this[t].splice(e,1);return this.columns-=1,this}addColumn(e,t){'undefined'==typeof t&&(t=e,e=this.columns),X(this,e,!0),t=N(this,t);for(var a=0;a<this.rows;a++)this[a].splice(e,0,t[a]);return this.columns+=1,this}}J.prototype={solve:function(e){e=as.checkMatrix(e);var t=this.QR,a=t.rows;if(e.rows!==a)throw new Error('Matrix row dimensions must agree');if(!this.isFullRank())throw new Error('Matrix is rank deficient');var o=e.columns,r=e.clone(),l=t.columns,n,i,d,h;for(d=0;d<l;d++)for(i=0;i<o;i++){for(h=0,n=d;n<a;n++)h+=t[n][d]*r[n][i];for(h=-h/t[d][d],n=d;n<a;n++)r[n][i]+=h*t[n][d]}for(d=l-1;0<=d;d--){for(i=0;i<o;i++)r[d][i]/=this.Rdiag[d];for(n=0;n<d;n++)for(i=0;i<o;i++)r[n][i]-=r[d][i]*t[n][d]}return r.subMatrix(0,l-1,0,o-1)},isFullRank:function(){for(var e=this.QR.columns,t=0;t<e;t++)if(0===this.Rdiag[t])return!1;return!0},get upperTriangularMatrix(){var e=this.QR,t=e.columns,a=new as(t,t),n,i;for(n=0;n<t;n++)for(i=0;i<t;i++)a[n][i]=n<i?e[n][i]:n===i?this.Rdiag[n]:0;return a},get orthogonalMatrix(){var e=this.QR,t=e.rows,a=e.columns,n=new as(t,a),o,i,r,l;for(r=a-1;0<=r;r--){for(o=0;o<t;o++)n[o][r]=0;for(n[r][r]=1,i=r;i<a;i++)if(0!==e[r][r]){for(l=0,o=r;o<t;o++)l+=e[o][r]*n[o][i];for(l=-l/e[r][r],o=r;o<t;o++)n[o][i]+=l*e[o][r]}}return n}};const ns={assumeSymmetric:!1};ee.prototype={get realEigenvalues(){return this.d},get imaginaryEigenvalues(){return this.e},get eigenvectorMatrix(){return as.isMatrix(this.V)||(this.V=new as(this.V)),this.V},get diagonalMatrix(){var t=this.n,a=this.e,e=this.d,n=new as(t,t),o,i;for(o=0;o<t;o++){for(i=0;i<t;i++)n[o][i]=0;n[o][o]=e[o],0<a[o]?n[o][o+1]=a[o]:0>a[o]&&(n[o][o-1]=a[o])}return n}},se.prototype={get lowerTriangularMatrix(){return this.L},solve:function(e){e=as.checkMatrix(e);var t=this.L,a=t.rows;if(e.rows!==a)throw new Error('Matrix dimensions do not match');var n=e.columns,o=e.clone(),s,i,r;for(r=0;r<a;r++)for(i=0;i<n;i++){for(s=0;s<r;s++)o[r][i]-=o[s][i]*t[r][s];o[r][i]/=t[r][r]}for(r=a-1;0<=r;r--)for(i=0;i<n;i++){for(s=r+1;s<a;s++)o[r][i]-=o[s][i]*t[s][r];o[r][i]/=t[r][r]}return o}};var os=Object.freeze({default:as,Matrix:as,abstractMatrix:K,solve:$,inverse:function(e){return e=as.checkMatrix(e),$(e,as.eye(e.rows))},SingularValueDecomposition:E,SVD:E,EigenvalueDecomposition:ee,EVD:ee,CholeskyDecomposition:se,CHO:se,LuDecomposition:R,LU:R,QrDecomposition:J,QR:J}),ss=mo(2*uo),rs=[[-1,0,1],[-2,0,2],[-1,0,1]],ls=[[-1,-2,-1],[0,0,0],[1,2,1]],ds=function(e,t){e=e||0;for(var a=Array(e),n=0;n<e;n++)a[n]=t;return a},hs=Object.prototype.toString,gs=function(e){return'Array'===hs.call(e).substr(-6,5)},cs={maybeToPrecision:function(e,t){return 0>e?(e=-1*e,t?'- '+e.toPrecision(t):'- '+e.toString()):t?e.toPrecision(t):e.toString()}};var ms=class{predict(e){var t;if(Array.isArray(e)){t=Array(e.length);for(var a=0;a<e.length;a++)t[a]=this._predict(e[a])}else if(lo(e))t=this._predict(e);else throw new TypeError('x must be a number or array');return t}_predict(){throw new Error('_compute not implemented')}train(){}toString(){return''}toLaTeX(){return''}modelQuality(e,t){let a=e.length;var n=Array(a);for(let t=0;t<a;t++)n[t]=this._predict(e[t]);var o=0,s=0,l=0,d=0,h=0,g=0,c=0;for(let e=0;e<a;e++)o+=n[e],s+=t[e],h+=n[e]*n[e],g+=t[e]*t[e],c+=n[e]*t[e],0!==t[e]&&(l+=(t[e]-n[e])*(t[e]-n[e])/t[e]),d=(t[e]-n[e])*(t[e]-n[e]);var i=(a*c-o*s)/mo((a*h-o*o)*(a*g-s*s));return{r:i,r2:i*i,chi2:l,rmsd:d*d/a}}},ps=cs.maybeToPrecision;class us extends ms{constructor(e,t,a){if(a=a||{},super(),!0===e)this.slope=t.slope,this.intercept=t.intercept,this.quality=t.quality||{},t.quality.r&&(this.quality.r=t.quality.r,this.quality.r2=t.quality.r2),t.quality.chi2&&(this.quality.chi2=t.quality.chi2);else{var o=e.length;if(o!==t.length)throw new RangeError('input and output array have a different length');for(var n=0,s=0,r=0,l=0,d=0;d<o;d++)n+=e[d],s+=t[d],r+=e[d]*e[d],l+=e[d]*t[d];var i=o*l-n*s;this.slope=i/(o*r-n*n),this.intercept=1/o*s-this.slope*(1/o)*n,this.coefficients=[this.intercept,this.slope],a.computeQuality&&(this.quality=this.modelQuality(e,t))}}toJSON(){var e={name:'simpleLinearRegression',slope:this.slope,intercept:this.intercept};return this.quality&&(e.quality=this.quality),e}_predict(e){return this.slope*e+this.intercept}computeX(e){return(e-this.intercept)/this.slope}toString(e){var t='f(x) = ';if(this.slope){var i=ps(this.slope,e);if(t+=(1e-5>so(i-1)?'':i+' * ')+'x',this.intercept){var a=so(this.intercept),n=a===this.intercept?'+':'-';t+=' '+n+' '+ps(a,e)}}else t+=ps(this.intercept,e);return t}toLaTeX(e){return this.toString(e)}static load(e){if('simpleLinearRegression'!==e.name)throw new TypeError('not a SLR model');return new us(!0,e)}}var fs=us,_s=os&&as||os;const bs=cs.maybeToPrecision,ws=_s.Matrix,xs=_s.solve;class ys extends ms{constructor(e,t,a,o){super();if(!0===e)this.coefficients=t.coefficients,this.powers=t.powers,this.M=t.M,t.quality&&(this.quality=t.quality);else{var s=e.length;if(s!==t.length)throw new RangeError('input and output array have a different length');let c;if(Array.isArray(a))c=a,a=c.length;else for(a++,c=Array(a),l=0;l<a;l++)c[l]=l;var n=new ws(s,a),r=new ws([t]),l,d;for(l=0;l<a;l++)for(d=0;d<s;d++)n[d][l]=0===c[l]?1:no(e[d],c[l]);var i=n.transposeView(),h=i.mmul(n),g=i.mmul(r.transposeView());this.coefficients=xs(h,g).to1DArray(),this.powers=c,this.M=a-1,(o||{}).computeQuality&&(this.quality=this.modelQuality(e,t))}}_predict(e){for(var t=0,i=0;i<this.powers.length;i++)t+=this.coefficients[i]*no(e,this.powers[i]);return t}toJSON(){var e={name:'polynomialRegression',coefficients:this.coefficients,powers:this.powers,M:this.M};return this.quality&&(e.quality=this.quality),e}toString(e){return this._toFormula(e,!1)}toLaTeX(e){return this._toFormula(e,!0)}_toFormula(e,t){var i='^',a='',n=' * ';t&&(i='^{',a='}',n='');for(var o='',s=0,r;s<this.coefficients.length;s++)r='',0!==this.coefficients[s]&&(r=0===this.powers[s]?bs(this.coefficients[s],e):1===this.powers[s]?bs(this.coefficients[s],e)+n+'x':bs(this.coefficients[s],e)+n+'x'+i+this.powers[s]+a,0<this.coefficients[s]&&s!==this.coefficients.length-1?r=' + '+r:s!==this.coefficients.length-1&&(r=' '+r)),o=r+o;return' + '===o.charAt(0)&&(o=o.slice(1)),'f(x) = '+o}static load(e){if('polynomialRegression'!==e.name)throw new TypeError('not a polynomial regression model');return new ys(!0,e)}}var ks=ys;const vs=cs.maybeToPrecision;class Ds extends ms{constructor(e,t,i,a){super();if(!0===e)this.A=t.A,this.M=t.M,t.quality&&(this.quality=t.quality);else{var o=e.length;if(o!==t.length)throw new RangeError('input and output array have a different length');var n=new ks(e,t,[i],{computeCoefficient:!0});this.A=n.coefficients[0],this.M=i,(a||{}).computeQuality&&(this.quality=this.modelQuality(e,t))}}_predict(e){return this.A*no(e,this.M)}toJSON(){var e={name:'potentialRegression',A:this.A,M:this.M};return this.quality&&(e.quality=this.quality),e}toString(e){return'f(x) = '+vs(this.A,e)+' * x^'+this.M}toLaTeX(e){return 0<=this.M?'f(x) = '+vs(this.A,e)+'x^{'+this.M+'}':'f(x) = \\frac{'+vs(this.A,e)+'}{x^{'+-this.M+'}}'}static load(e){if('potentialRegression'!==e.name)throw new TypeError('not a potential regression model');return new Ds(!0,e)}}const js=cs.maybeToPrecision;class Ms extends ms{constructor(e,t,a){super();if(!0===e)this.A=t.A,this.C=t.C,t.quality&&(this.quality=t.quality);else{var o=e.length;if(o!==t.length)throw new RangeError('input and output array have a different length');for(var n=Array(o),s=0;s<o;s++)n[s]=to(t[s]);var i=new fs(e,n,{computeCoefficient:!1});this.A=i.slope,this.C=co(i.intercept),(a||{}).computeQuality&&(this.quality=this.modelQuality(e,t))}}_predict(e){return this.C*co(e*this.A)}toJSON(){var e={name:'expRegression',A:this.A,C:this.C};return this.quality&&(e.quality=this.quality),e}toString(e){return'f(x) = '+js(this.C,e)+' * exp('+js(this.A,e)+' * x)'}toLaTeX(e){return 0<=this.A?'f(x) = '+js(this.C,e)+'e^{'+js(this.A,e)+'x}':'f(x) = \\frac{'+js(this.C,e)+'}{e^{'+js(-this.A,e)+'x}}'}static load(e){if('expRegression'!==e.name)throw new TypeError('not a exp regression model');return new Ms(!0,e)}}const Ss=cs.maybeToPrecision;class Ps extends ms{constructor(e,t,a){super();if(!0===e)this.A=t.A,this.B=t.B,this.quality=t.quality||{},t.quality.r&&(this.quality.r=t.quality.r,this.quality.r2=t.quality.r2),t.quality.chi2&&(this.quality.chi2=t.quality.chi2);else{var o=e.length;if(o!==t.length)throw new RangeError('input and output array have a different length');for(var n=Array(o),s=Array(o),r=0;r<o;r++)n[r]=to(e[r]),s[r]=to(t[r]);var i=new fs(n,s,{computeCoefficient:!1});this.A=co(i.intercept),this.B=i.slope,(a||{}).computeQuality&&(this.quality=this.modelQuality(e,t))}}_predict(e){return this.A*no(e,this.B)}toJSON(){var e={name:'powerRegression',A:this.A,B:this.B};return this.quality&&(e.quality=this.quality),e}toString(e){return'f(x) = '+Ss(this.A,e)+' * x^'+Ss(this.B,e)}toLaTeX(e){return 0<=this.B?'f(x) = '+Ss(this.A,e)+'x^{'+Ss(this.B,e)+'}':'f(x) = \\frac{'+Ss(this.A,e)+'}{x^{'+Ss(-this.B,e)+'}}'}static load(e){if('powerRegression'!==e.name)throw new TypeError('not a power regression model');return new Ps(!0,e)}}var Is=ke;ke.squared=ye;const Bs=Is.squared,Cs={sigma:1};var As=class{constructor(e){e=Object.assign({},Cs,e),this.sigma=e.sigma,this.divisor=2*e.sigma*e.sigma}compute(e,t){const i=Bs(e,t);return co(-i/this.divisor)}};const Rs={degree:1,constant:1,scale:1};var zs=class{constructor(e){e=Object.assign({},Rs,e),this.degree=e.degree,this.constant=e.constant,this.scale=e.scale}compute(e,t){for(var a=0,n=0;n<e.length;n++)a+=e[n]*t[n];return no(this.scale*a+this.constant,this.degree)}};const Ls={sigma:1,degree:1};const Es=Is.squared,Ts={sigma:1};const Vs={sigma:1};var Us=class{compute(e,t){for(var a=ro(e.length,t.length),n=0,o=0;o<a;++o)n+=ro(e[o],t[o]);return n}};const Fs={sigma:1};const Ys=Is.squared,Xs={constant:1};const qs=Is.squared,Os={constant:1};const Ns={alpha:0.01,constant:-Math.E};var Gs=class{constructor(e){e=Object.assign({},Ns,e),this.alpha=e.alpha,this.constant=e.constant}compute(e,t){for(var a=0,n=0;n<e.length;n++)a+=e[n]*t[n];return Math.tanh(this.alpha*a+this.constant)}};const Hs=_s.Matrix,Ws={gaussian:As,rbf:As,polynomial:zs,poly:zs,anova:class{constructor(e){e=Object.assign({},Ls,e),this.sigma=e.sigma,this.degree=e.degree}compute(e,t){for(var a=0,n=ro(e.length,t.length),o=1;o<=n;++o)a+=no(co(-this.sigma*no(no(e[o-1],o)-no(t[o-1],o),2)),this.degree);return a}},cauchy:class{constructor(e){e=Object.assign({},Ts,e),this.sigma=e.sigma}compute(e,t){return 1/(1+Es(e,t)/(this.sigma*this.sigma))}},exponential:class{constructor(e){e=Object.assign({},Vs,e),this.sigma=e.sigma,this.divisor=2*e.sigma*e.sigma}compute(e,t){const i=Is(e,t);return co(-i/this.divisor)}},histogram:Us,min:Us,laplacian:class{constructor(e){e=Object.assign({},Fs,e),this.sigma=e.sigma}compute(e,t){const i=Is(e,t);return co(-i/this.sigma)}},multiquadratic:class{constructor(e){e=Object.assign({},Xs,e),this.constant=e.constant}compute(e,t){return mo(Ys(e,t)+this.constant*this.constant)}},rational:class{constructor(e){e=Object.assign({},Os,e),this.constant=e.constant}compute(e,t){const i=qs(e,t);return 1-i/(i+this.constant)}},sigmoid:Gs,mlp:Gs};var Zs=class{constructor(e,t){if(this.kernelType=e,'linear'!==e)if('string'==typeof e){e=e.toLowerCase();var i=Ws[e];if(i)this.kernelFunction=new i(t);else throw new Error('unsupported kernel type: '+e)}else if('object'==typeof e&&'function'==typeof e.compute)this.kernelFunction=e;else throw new TypeError('first argument must be a valid kernel type or instance')}compute(e,t){if(void 0===t&&(t=e),'linear'===this.kernelType){var a=new Hs(e);return a.mmul(new Hs(t).transposeView())}const n=new Hs(e.length,t.length);var o,i;if(e===t)for(o=0;o<e.length;o++)for(i=o;i<e.length;i++)n[o][i]=n[i][o]=this.kernelFunction.compute(e[o],e[i]);else for(o=0;o<e.length;o++)for(i=0;i<t.length;i++)n[o][i]=this.kernelFunction.compute(e[o],t[i]);return n}};const Qs=_s.Matrix,Ks=_s.solve,Js={lambda:0.1,kernelType:'gaussian',kernelOptions:{},computeCoefficient:!1};class $s extends ms{constructor(e,t,i){if(super(),!0===e)this.alpha=t.alpha,this.inputs=t.inputs,this.kernelType=t.kernelType,this.kernelOptions=t.kernelOptions,this.kernel=new Zs(t.kernelType,t.kernelOptions),t.quality&&(this.quality=t.quality);else{i=Object.assign({},Js,i);const a=new Zs(i.kernelType,i.kernelOptions),o=a.compute(e),s=e.length;o.add(Qs.eye(s,s).mul(i.lambda)),this.alpha=Ks(o,t),this.inputs=e,this.kernelType=i.kernelType,this.kernelOptions=i.kernelOptions,this.kernel=a,i.computeQuality&&(this.quality=this.modelQuality(e,t))}}_predict(e){return this.kernel.compute([e],this.inputs).mmul(this.alpha)[0]}toJSON(){var e={name:'kernelRidgeRegression',alpha:this.alpha,inputs:this.inputs,kernelType:this.kernelType,kernelOptions:this.kernelOptions};return this.quality&&(e.quality=this.quality),e}static load(e){if('kernelRidgeRegression'!==e.name)throw new TypeError('not a KRR model');return new $s(!0,e)}}const er=_s.Matrix,tr=_s.SVD,ir={order:2};class ar extends ms{constructor(e,t,i){super(),!0===e?(this.coefficients=er.columnVector(t.coefficients),this.order=t.order,t.r&&(this.r=t.r,this.r2=t.r2),t.chi2&&(this.chi2=t.chi2)):(i=Object.assign({},ir,i),this.order=i.order,this.coefficients=[],this.X=e,this.y=t,this.train(this.X,this.y,i),i.computeQuality&&(this.quality=this.modelQuality(e,t)))}train(e,t){if(er.isMatrix(e)||(e=new er(e)),er.isMatrix(t)||(t=er.columnVector(t)),t.rows!==e.rows&&(t=t.transpose()),2!==e.columns)throw new RangeError('You give X with '+e.columns+' columns and it must be 2');if(e.rows!==t.rows)throw new RangeError('X and y must have the same rows');var a=e.rows,n=(this.order+2)*(this.order+1)/2;this.coefficients=Array(n);var o=e.getColumnVector(0),s=e.getColumnVector(1),r=1/o.clone().apply(De).max(),l=1/s.clone().apply(De).max(),d=1/t.clone().apply(De).max();o.mulColumn(0,r),s.mulColumn(0,l),t.mulColumn(0,d);for(var h=new er(a,n),g=0,c=0,i;c<=this.order;++c){i=this.order-c;for(var m=0,p;m<=i;++m)p=ve(o,c).mulColumnVector(ve(s,m)),h.setColumn(g,p),g++}var u=new tr(h.transpose(),{computeLeftSingularVectors:!0,computeRightSingularVectors:!0,autoTranspose:!1}),f=er.rowVector(u.diagonal);f=f.apply(function(e,t){this[e][t]=1e-15<=this[e][t]?1/this[e][t]:0});var _=er.zeros(a,n);for(c=0;c<n;++c)_[c][c]=f[0][c];f=_;var b=u.rightSingularVectors,w=u.leftSingularVectors;for(this.coefficients=w.mmul(f.transpose()).mmul(b.transpose()).mmul(t),g=0,c=0;c<=n;++c)for(i=this.order-c,m=0;m<=i;++m)this.coefficients[g][0]=this.coefficients[g][0]*no(r,c)*no(l,m)/d,g++}_predict(e){for(var t=e[0],a=e[1],n=0,o=0,s=0;s<=this.order;s++)for(var i=0;i<=this.order-s;i++)n+=no(t,s)*no(a,i)*this.coefficients[o][0],o++;return n}toJSON(){var e={name:'polyfit2D',order:this.order,coefficients:this.coefficients};return this.quality&&(e.quality=this.quality),e}static load(e){if('polyfit2D'!==e.name)throw new TypeError('not a polyfit2D model');return new ar(!0,e)}}const nr=cs.maybeToPrecision,or=Uo.median;class sr extends ms{constructor(e,t,i){if(i=i||{},super(),!0===e)this.slope=t.slope,this.intercept=t.intercept,this.quality=Object.assign({},t.quality,this.quality);else{let a=e.length;if(a!==t.length)throw new RangeError('Input and output array have a different length');let n=Array(a*a),o=0;for(let s=0;s<a;++s)for(let i=s+1;i<a;++i)e[s]!==e[i]&&(n[o++]=(t[i]-t[s])/(e[i]-e[s]));n.length=o;let s=or(n),r=Array(a);for(let n=0;n<a;++n)r[n]=t[n]-s*e[n];this.slope=s,this.intercept=or(r),this.coefficients=[this.intercept,this.slope],i.computeQuality&&(this.quality=this.modelQuality(e,t))}}toJSON(){var e={name:'TheilSenRegression',slope:this.slope,intercept:this.intercept};return this.quality&&(e.quality=this.quality),e}_predict(e){return this.slope*e+this.intercept}computeX(e){return(e-this.intercept)/this.slope}toString(e){var t='f(x) = ';if(this.slope){var i=nr(this.slope,e);if(t+=(1e-5>so(i-1)?'':i+' * ')+'x',this.intercept){var a=so(this.intercept),n=a===this.intercept?'+':'-';t+=' '+n+' '+nr(a,e)}}else t+=nr(this.intercept,e);return t}toLaTeX(e){return this.toString(e)}static load(e){if('TheilSenRegression'!==e.name)throw new TypeError('not a Theil-Sen model');return new sr(!0,e)}}var rr=S(function(e,t){'use strict';t.SimpleLinearRegression=t.SLR=fs,t.NonLinearRegression=t.NLR={PolynomialRegression:ks,PotentialRegression:Ds,ExpRegression:Ms,PowerRegression:Ps},t.KernelRidgeRegression=t.KRR=$s,t.PolinomialFitting2D=ar,t.TheilSenRegression=sr}),lr=rr.KernelRidgeRegression,dr={luma709(e,t){return 6966*e[t]+23436*e[t+1]+2366*e[t+2]>>15},luma601(e,t){return 9798*e[t]+19235*e[t+1]+3735*e[t+2]>>15},maximum(e,t){return oo(e[t],e[t+1],e[t+2])},minimum(e,t){return ro(e[t],e[t+1],e[t+2])},average(e,t){return(e[t]+e[t+1]+e[t+2])/3>>0},minmax(e,t){return(oo(e[t],e[t+1],e[t+2])+ro(e[t],e[t+1],e[t+2]))/2},red(e,t){return e[t]},green(e,t){return e[t+1]},blue(e,t){return e[t+2]},cyan(e,t,i){var a=dr.black(e,t,i);return(i.maxValue-e[0]-a)/(1-a/i.maxValue)>>0},magenta(e,t,i){var a=dr.black(e,t,i);return(i.maxValue-e[1]-a)/(1-a/i.maxValue)>>0},yellow(e,t,i){var a=dr.black(e,t,i);return(i.maxValue-e[2]-a)/(1-a/i.maxValue)>>0},black(e,t,i){return ro(i.maxValue-e[t],i.maxValue-e[t+1],i.maxValue-e[t+2])},hue(e,t,i){var a=dr.min(e,t),n=dr.max(e,t);if(n===a)return 0;var o=0,s=n-a;switch(n){case e[t]:o=(e[t+1]-e[t+2])/s+(e[t+1]<e[t+2]?6:0);break;case e[t+1]:o=(e[t+2]-e[t])/s+2;break;case e[t+2]:o=(e[t]-e[t+1])/s+4;break;default:throw new Error('unreachable');}return o/6*i.maxValue>>0},saturation(e,t,i){var a=dr.min(e,t),n=dr.max(e,t);return 0===n?0:(n-a)/n*i.maxValue},lightness(e,t){var i=dr.min(e,t),a=dr.max(e,t);return(a+i)/2}};Object.defineProperty(dr,'luminosity',{enumerable:!1,value:dr.lightness}),Object.defineProperty(dr,'luminance',{enumerable:!1,value:dr.lightness}),Object.defineProperty(dr,'min',{enumerable:!1,value:dr.minimum}),Object.defineProperty(dr,'max',{enumerable:!1,value:dr.maximum}),Object.defineProperty(dr,'brightness',{enumerable:!1,value:dr.maximum});var hr=Object.keys(dr),gr={huang:function(e){for(var t=0,i=0;i<e.length;i++)if(0!==e[i]){t=i;break}for(var a=e.length-1,n=e.length-1;n>=t;n--)if(0!==e[n]){a=n;break}for(var o=1/(a-t),s=Array(e.length),r=0,l=0,d=t;d<e.length;d++)r+=d*e[d],l+=e[d],s[d]=r/l;var h=Array(e.length);r=l=0;for(var g=a;0<g;g--)r+=g*e[g],l+=e[g],h[g-1]=r/l;for(var c=-1,m=io,p=0;p<e.length;p++){for(var u=0,f=void 0,_=0;_<=p;_++)f=1/(1+o*so(_-s[p])),1e-6>f||0.999999<f||(u+=e[_]*(-f*to(f)-(1-f)*to(1-f)));for(var b=p+1;b<e.length;b++)f=1/(1+o*so(b-h[p])),1e-6>f||0.999999<f||(u+=e[b]*(-f*to(f)-(1-f)*to(1-f)));u<m&&(m=u,c=p)}return c},intermodes:function(e){for(var t=e.slice(),a=0;!Xe(t);){for(var n=0,o=0,s=t[0],r=0;r<e.length-1;r++)n=o,o=s,s=t[r+1],t[r]=(n+o+s)/3;if(t[e.length-1]=(o+s)/3,a++,1e4<a)throw new Error('Intermodes Threshold not found after 10000 iterations')}for(var i=0,l=1;l<e.length-1;l++)t[l-1]<t[l]&&t[l+1]<t[l]&&(i+=l);return fo(i/2)},isodata:function(e){for(var t=0,a=1,i,n,o,s;a<e.length;a++)if(0<e[a]){t=a+1;break}for(;;){i=0,o=0;for(var r=0;r<t;r++)o+=e[r],i+=e[r]*r;s=0,n=0;for(var l=t+1;l<e.length;l++)n+=e[l],s+=e[l]*l;if(0<o&&0<n&&(i/=o,s/=n,t===go((i+s)/2)))break;if(t++,t>e.length-2)throw new Error('Threshold not found')}return t},li:function(e,t){var i,a,n,o,s,r,l,d,h,g,c,m;c=0.5,g=0;for(var p=0;p<e.length;p++)g+=p*e[p];g/=t,l=g;do{r=l,i=0|r+0.5,a=0,o=0;for(var u=0;u<=i;u++)a+=u*e[u],o+=e[u];d=0===o?0:a/o,n=0,s=0;for(var f=i+1;f<e.length;f++)n+=f*e[f],s+=e[f];h=0===s?0:n/s,m=(d-h)/(to(d)-to(h)),l=m<-eo?0|m-0.5:0|m+0.5}while(so(l-r)>c);return i},maxentropy:function(e,t){for(var i=Array(e.length),a=0;a<e.length;a++)i[a]=e[a]/t;var n=Array(e.length),o=Array(e.length);n[0]=i[0],o[0]=1-n[0];for(var s=1;s<e.length;s++)n[s]=n[s-1]+i[s],o[s]=1-n[s];for(var r=0,l=0;l<e.length;l++)if(so(n[l])>=eo){r=l;break}for(var d=e.length-1,h=e.length-1;h>=r;h--)if(so(o[h])>=eo){d=h;break}for(var g=-1,c=void 0,m=ao,p=void 0,u=void 0,f=r;f<=d;f++){p=0;for(var _=0;_<=f;_++)0!==e[_]&&(p-=i[_]/n[f]*to(i[_]/n[f]));u=0;for(var b=f+1;b<e.length;b++)0!==e[b]&&(u-=i[b]/o[f]*to(i[b]/o[f]));c=p+u,m<c&&(m=c,g=f)}return g},mean:function(e,t){for(var a=0,n=0;n<e.length;n++)a+=n*e[n];return fo(a/t)},minerror:function(e,t){for(var i=-2,a=0,n=0,o,s,r,l,d,h,g,c,m,p,u,f;n<e.length;n++)a+=n*e[n];for(a/=t,o=a;o!==i;){var _=qe(e,o),b=qe(e,e.length-1),w=Oe(e,o),x=Oe(e,e.length-1),y=Ne(e,o),k=Ne(e,e.length-1);if(s=w/_,r=(x-w)/(b-_),l=_/b,d=(b-_)/b,h=y/_-s*s,g=(k-y)/(b-_)-r*r,c=1/h-1/g,m=s/h-r/g,p=s*s/h-r*r/g+Math.log10(h*(d*d)/(g*(l*l))),u=m*m-c*p,0>u)return o;i=o,f=(m+mo(u))/c,o=isNaN(f)?i:fo(f)}return o},minimum:function(e){if(2>e.length)return 0;for(var t=0,a=-1,n=-1,o=Array(e.length),s=0;s<e.length;s++)o[s]=e[s],0<e[s]&&(n=s);for(;!We(o);)if(o=Ge(o),t++,1e4<t)return a;return a=He(o,n),a},moments:function(e,t){for(var a=1,n=0,o=0,s=0,r=0,l=-1,d=e.length,h=Array(d),g=0,i,c,m,p,u,f;g<d;g++)h[g]=e[g]/t;for(var _=0;_<d;_++)n+=_*h[_],o+=_*_*h[_],s+=_*_*_*h[_];c=a*o-n*n,m=(-o*o+n*s)/c,p=(a*-s+o*n)/c,u=0.5*(-p-mo(p*p-4*m)),f=0.5*(-p+mo(p*p-4*m)),i=(f-n)/(f-u);for(var b=0;b<d;b++)if(r+=h[b],r>i){l=b;break}return l},otsu:function(e,t){for(var a=0,n=0,o=0,s=0,r=0,l=0,d=0,h=1,i,g;h<e.length;++h)a+=h*e[h];for(var c=1;c<e.length;++c)if(o+=e[c],0!==o){if(s=t-o,0==s)break;n+=c*e[c],i=n/o,g=(a-n)/s,l=o*s*(i-g)*(i-g),l>=r&&(d=c,r=l)}return d},percentile:function(e){for(var t=-1,a=Array(e.length),n=Ze(e,e.length-1),o=1,s=0;s<e.length;s++)a[s]=so(Ze(e,s)/n-0.5),a[s]<o&&(o=a[s],t=s);return t},renyientropy:function(e,t){for(var i=Array(e.length),a=Array(e.length),n=Array(e.length),o=0,s=0,r=0,l=0,d=0,h=0,g=1/(1-0.5),c=1/(1-2),m=0,p,u,f;m<e.length;m++)i[m]=e[m]/t;a[0]=i[0],n[0]=1-a[0];for(var _=1;_<e.length;_++)a[_]=a[_-1]+i[_],n[_]=1-a[_];u=0;for(var b=0;b<e.length;b++)if(so(a[b])>=eo){u=b;break}f=e.length-1;for(var w=e.length-1;w>=u;w--)if(so(n[w])>=eo){f=w;break}for(var x=u;x<=f;x++){for(var y=0,k=0,v=0,D=0;D<=x;D++)0!==e[D]&&(y-=i[D]/a[x]*to(i[D]/a[x])),k+=mo(i[D]/a[x]),v+=i[D]*i[D]/(a[x]*a[x]);for(var j=0,M=0,S=0,P=x+1;P<e.length;P++)0!==e[P]&&(j-=i[P]/n[x]*to(i[P]/n[x])),M+=mo(i[P]/n[x]),S+=i[P]*i[P]/(n[x]*n[x]);var I=y+j,B=g*(0<k*M?to(k*M):0),C=c*(0<v*S?to(v*S):0);I>l&&(l=I,o=x),B>d&&(d=B,s=x),C>h&&(h=C,r=x)}var A=[o,s,r];A.sort(Bo);var R=5>=so(A[0]-A[1])?5>=so(A[1]-A[2])?[1,2,1]:[0,1,3]:5>=so(A[1]-A[2])?[3,1,0]:[1,2,1];var z=a[A[2]]-a[A[0]];return p=go(A[0]*(a[A[0]]+0.25*z*R[0])+0.25*A[1]*z*R[1]+A[2]*(n[A[2]]+0.25*z*R[2])),p},shanbhag:function(e,t){for(var i=Array(e.length),a=0;a<e.length;a++)i[a]=e[a]/t;var n=Array(e.length),o=Array(e.length);n[0]=i[0],o[0]=1-n[0];for(var s=1;s<e.length;s++)n[s]=n[s-1]+i[s],o[s]=1-n[s];for(var r=0,l=0;l<e.length;l++)if(so(n[l])>=eo){r=l;break}for(var d=e.length-1,h=e.length-1;h>=r;h--)if(so(o[h])>=eo){d=h;break}for(var g=-1,c=io,m=void 0,p=void 0,u=void 0,f=void 0,_=r;_<=d;_++){u=0,m=0.5/n[_];for(var b=1;b<=_;b++)u-=i[b]*to(1-m*n[b-1]);u*=m,f=0,m=0.5/o[_];for(var w=_+1;w<e.length;w++)f-=i[w]*to(1-m*o[w]);f*=m,p=so(u-f),p<c&&(c=p,g=_)}return g},triangle:function(e){for(var t=0,a=0,n=0,o=0,s=0;s<e.length;s++)if(0<e[s]){t=s;break}0<t&&t--;for(var i=e.length-1;0<i;i--)if(0<e[i]){o=i;break}o<e.length-1&&o++;for(var r=0;r<e.length;r++)e[r]>a&&(n=r,a=e[r]);var l=!1;if(n-t<o-n){l=!0;for(var h=0,g=e.length-1,c;h<g;)c=e[h],e[h]=e[g],e[g]=c,h++,g--;t=e.length-1-o,n=e.length-1-n}if(t===n)return t;var m,p,u;m=e[n],p=t-n,u=mo(m*m+p*p),m/=u,p/=u,u=m*t+p*e[t];for(var d=t,f=0,_=t+1,b;_<=n;_++)b=m*_+p*e[_]-u,b>f&&(d=_,f=b);if(d--,l){for(var w=0,x=e.length-1,y;w<x;)y=e[w],e[w]=e[x],e[x]=y,w++,x--;return e.length-1-d}return d},yen:function(e,t){for(var i=Array(e.length),a=0;a<e.length;a++)i[a]=e[a]/t;var n=Array(e.length);n[0]=i[0];for(var o=1;o<e.length;o++)n[o]=n[o-1]+i[o];var s=Array(e.length);s[0]=i[0]*i[0];for(var r=1;r<e.length;r++)s[r]=s[r-1]+i[r]*i[r];var l=Array(e.length);l[e.length-1]=0;for(var d=e.length-2;0<=d;d--)l[d]=l[d+1]+i[d+1]*i[d+1];for(var h=-1,g=ao,c=void 0,m=0;m<e.length;m++)c=-1*(0<s[m]*l[m]?to(s[m]*l[m]):0)+2*(0<n[m]*(1-n[m])?to(n[m]*(1-n[m])):0),c>g&&(g=c,h=m);return h}},cr=['threshold'].concat(Object.keys(gr)),mr='has-own',pr='1.0.0',ur='A safer .hasOwnProperty() - hasOwn(name, obj)',fr='index.js',_r={test:'make test'},br='Aaron Heckmann <aaron.heckmann+github@gmail.com>',wr='MIT',xr={type:'git',url:'git://github.com/pebble/has-own.git'},yr='https://github.com/pebble/has-own/',kr={mocha:'^1.21.0'},vr={name:mr,version:pr,description:ur,main:fr,scripts:_r,author:br,license:wr,repository:xr,homepage:yr,devDependencies:kr},Dr=Object.freeze({name:mr,version:pr,description:ur,main:fr,scripts:_r,author:br,license:wr,repository:xr,homepage:yr,devDependencies:kr,default:vr}),jr=S(function(e,t){var i=Object.prototype.hasOwnProperty;e.exports=t=function(e,t){return i.call(t,e)},t.version=(Dr&&vr||Dr).version}),Mr={configurable:!0,enumerable:!1,get:void 0};class Sr extends Array{constructor(e){if(Array.isArray(e)){super(e.length);for(var t=0;t<e.length;t++)this[t]=e[t]}else'number'==typeof e?super(e):super();this.computed=null}static load(e){return Promise.all(e.map(mc.load)).then((e)=>new Sr(e))}static extendMethod(e,t,i={}){var a=i.inPlace,n=i.returnThis,o=i.partialArgs,s=void 0===o?[]:o;return Sr.prototype[e]=void 0!==a&&a?function(...e){this.computed=null;var i=t.apply(this,[...s,...e]);return void 0===n||n?this:i}:function(...e){return t.apply(this,[...s,...e])},Sr}static extendProperty(e,t,i={}){var a=i.partialArgs,n=void 0===a?[]:a;return Mr.get=function(){if(null===this.computed)this.computed={};else if(jr(e,this.computed))return this.computed[e];var i=t.apply(this,n);return this.computed[e]=i,i},Object.defineProperty(Sr.prototype,e,Mr),Sr}checkProcessable(e,t={}){if('string'!=typeof e)throw new TypeError('checkProcessable requires as first parameter the processName (a string)');if(0===this.size)throw new TypeError('The process: '+e+' can not be applied on an empty stack');this[0].checkProcessable(e,t);for(var a=1;a<this.length;a++){if((void 0===t.sameSize||t.sameSize)&&this[0].width!==this[a].width)throw new TypeError('The process: '+e+' can not be applied if width is not identical in all images');if((void 0===t.sameSize||t.sameSize)&&this[0].height!==this[a].height)throw new TypeError('The process: '+e+' can not be applied if height is not identical in all images');if((void 0===t.sameAlpha||t.sameAlpha)&&this[0].alpha!==this[a].alpha)throw new TypeError('The process: '+e+' can not be applied if alpha is not identical in all images');if((void 0===t.sameBitDepth||t.sameBitDepth)&&this[0].bitDepth!==this[a].bitDepth)throw new TypeError('The process: '+e+' can not be applied if bitDepth is not identical in all images');if((void 0===t.sameColorModel||t.sameColorModel)&&this[0].colorModel!==this[a].colorModel)throw new TypeError('The process: '+e+' can not be applied if colorModel is not identical in all images');if((void 0===t.sameNumberChannels||t.sameNumberChannels)&&this[0].channels!==this[a].channels)throw new TypeError('The process: '+e+' can not be applied if channels is not identical in all images')}}}Array[Symbol.species]||(Sr.prototype.map=function(e,t){if('function'!=typeof e)throw new TypeError(e+' is not a function');for(var a=new Sr(this.length),n=0;n<this.length;n++)a[n]=e.call(t,this[n],n,this);return a}),function(e){e.extendMethod('matchAndCrop',st),e.extendMethod('getMin',rt),e.extendMethod('getMax',lt),e.extendMethod('getMedian',gt),e.extendMethod('getHistogram',ct),e.extendMethod('getHistograms',mt),e.extendMethod('getAverage',pt)}(Sr),kt.prototype.localMin=function(e,t){for(var a=this[e][t],n=[e,t],o=oo(0,e-1);o<ro(this.length,e+2);o++)for(var i=oo(0,t-1);i<ro(this[0].length,t+2);i++)this[o][i]<a&&(a=this[o][i],n=[o,i]);return{position:n,value:a}},kt.prototype.localMax=function(e,t){for(var a=this[e][t],n=[e,t],o=oo(0,e-1);o<ro(this.length,e+2);o++)for(var i=oo(0,t-1);i<ro(this[0].length,t+2);i++)this[o][i]>a&&(a=this[o][i],n=[o,i]);return{position:n,value:a}},kt.prototype.localSearch=function(e,t,a){for(var n=[],o=oo(0,e-1);o<ro(this.length,e+2);o++)for(var i=oo(0,t-1);i<ro(this[0].length,t+2);i++)this[o][i]===a&&n.push([o,i]);return n};var Pr=function(e,t,i){var t=t/100,i=i/100,a=[],n=i*t,o=e/60,s=n*(1-so(o%2-1)),r=i-n;switch(parseInt(o,10)){case 0:a=[n,s,0];break;case 1:a=[s,n,0];break;case 2:a=[0,n,s];break;case 3:a=[0,s,n];break;case 4:a=[s,0,n];break;case 5:a=[n,0,s];}return{r:go(255*(a[0]+r)),g:go(255*(a[1]+r)),b:go(255*(a[2]+r))}},Ir=function(e,t,i){function a(e){var t=e.toString(16);return 1===t.length?'0'+t:t}return[a(e),a(t),a(i)].join('')},Br=function(e,t,i,n){return n/=100,{r:parseInt(255*(1-n)+n*e,10),g:parseInt(255*(1-n)+n*t,10),b:parseInt(255*(1-n)+n*i,10)}},Cr=function(e,t,i){return t*=(50>i?i:100-i)/100,console.log('s',t),{h:e,s:100*(2*t/(i+t)),v:i+t}},Ar=function(e,t,i){var a=Cr(e,t,i);return Pr(a.h,a.s,a.v)},Rr={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,132,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,255,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,203],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[119,128,144],slategrey:[119,128,144],snow:[255,255,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,5]},zr={hex2rgb:function(e){return('#'===e[0]&&(e=e.substr(1)),6===e.length)?{r:parseInt(e.substr(0,2),16),g:parseInt(e.substr(2,2),16),b:parseInt(e.substr(4,2),16)}:3===e.length?{r:parseInt(e[0]+e[0],16),g:parseInt(e[1]+e[1],16),b:parseInt(e[2]+e[2],16)}:void 0},hsv2hex:function(e,t,i){var a=Pr(e,t,i);return Ir(a.r,a.g,a.b)},hsv2rgb:Pr,rgb2hex:Ir,rgb2hsv:function(e,t,i){var a=oo(e,t,i),n=ro(e,t,i),o=a-n,r,l,d;return 0==o?r=0:e===a?r=(t-i)/o%6:t===a?r=(i-e)/o+2:i===a&&(r=(e-t)/o+4),r=go(60*r),0>r&&(r+=360),l=go(100*(0===a?0:o/a)),d=go(100*(a/255)),{h:r,s:l,v:d}},rgba:function(e,t,i,n){return'rgba('+[e,t,i,n/100].join(',')+')'},rgba2rgb:Br,rgba2hex:function(e,t,i,n){var a=Br(e,t,i,n);return Ir(a.r,a.g,a.b)},hsl2hsv:Cr,hsv2hsl:function(e,t,i){var a=(200-t)*i/100;return{h:e,s:t*i/(100>a?a:200-a),l:a/2}},hsl2rgb:Ar,cssColor:function(e){return Lt(e)||Ut(e)||Vt(e)||Et(e)||Tt(e)||Ft(e)||Yt(e)}}.cssColor,Lr=[[0,0,1,0,0],[0,0,1,0,0],[1,1,1,1,1],[0,0,1,0,0],[0,0,1,0,0]],Er=[[0,1,0],[1,1,1],[0,1,0]];class Tr{constructor(e={}){var t=e.kind,i=void 0===t?'cross':t,a=e.shape,n=e.size,o=e.width,s=e.height,r=e.filled,l=void 0===r||r;if(n&&(o=n,s=n),a)switch(a.toLowerCase()){case'square':case'rectangle':this.matrix=Zt(o,s,{filled:l});break;case'circle':case'ellipse':this.matrix=Qt(o,s,{filled:l});break;case'triangle':this.matrix=Kt(o,s,{filled:l});break;default:throw new Error(`Shape: unexpected shape: ${a}`);}else if(i)switch(i.toLowerCase()){case'cross':this.matrix=Lr;break;case'smallcross':this.matrix=Er;break;default:throw new Error(`Shape: unexpected kind: ${i}`);}else throw new Error('Shape: expected a kind or a shape option');this.height=this.matrix.length,this.width=this.matrix[0].length,this.halfHeight=this.height/2>>0,this.halfWidth=this.width/2>>0}getPoints(){for(var e=this.matrix,t=[],i=0;i<e.length;i++)for(var a=0;a<e[0].length;a++)e[i][a]&&t.push([a-this.halfWidth,i-this.halfHeight]);return t}getMask(){for(var e=new mc(this.width,this.height,{kind:bo}),t=0;t<this.matrix.length;t++)for(var i=0;i<this.matrix[0].length;i++)this.matrix[t][i]&&e.setBitXY(i,t);return e}}var Vr=S(function(e){(function(){function t(e,t,i){this.next=i,i&&(i.prev=this),this.prev=t,t&&(t.next=this),this.data=e}function i(){return this instanceof i?void(this._head=null,this._tail=null,this.length=0):new i}i.prototype={push:function(e){this._tail=new t(e,this._tail,null),this._head||(this._head=this._tail),this.length++},pop:function(){if(0!==this.length){var e=this._tail;return this._tail=e.prev,e.prev&&(e.prev=this._tail.next=null),this.length--,1===this.length?this._head=this._tail:0===this.length&&(this._head=this._tail=null),e.data}},unshift:function(e){this._head=new t(e,null,this._head),this._tail||(this._tail=this._head),this.length++},shift:function(){if(0!==this.length){var e=this._head;return this._head=e.next,e.next&&(e.next=this._head.prev=null),this.length--,1===this.length?this._tail=this._head:0===this.length&&(this._head=this._tail=null),e.data}},item:function(e){0>e&&(e=this.length+e);for(var t=this._head;0<e--&&t;)t=t.next;return t?t.data:void 0},slice:function(e,t){if(e||(e=0),t||(t=this.length),0>t&&(t=this.length+t),0>e&&(e=this.length+e),t===e)return[];if(t<e)throw new Error('invalid offset: '+e+','+t+' (length='+this.length+')');for(var a=t-e,n=Array(a),o=0,i=this._head;0<e--&&i;)i=i.next;for(;o<a&&i;)n[o++]=i.data,i=i.next;return n},drop:function(){i.call(this)},forEach:function(e,t){for(var a=this._head,n=0,i=this.length;n<i&&a;)e.call(t||this,a.data,n,this),a=a.next,n++},map:function(e,t){var a=new i;return this.forEach(function(n,o,i){a.push(e.call(t||i,n,o,i))}),a},filter:function(e,t){var a=new i;return this.forEach(function(n,o,i){e.call(t||i,n,o,i)&&a.push(n)}),a},reduce:function(e,t,a){var n=0,i=this._head,o=this.length;for(t||(n=1,t=i&&i.data,i=i&&i.next);n<o&&i;)t=e.call(a||this,t,i.data,this),n++,i=i.next;return t}},e.exports=i})()}),Ur={setBitXY(e,t){var i=t*this.width+e;this.data[i>>3]|=1<<7-(7&i)},clearBitXY(e,t){var i=t*this.width+e;this.data[i>>3]&=~(1<<7-(7&i))},toggleBitXY(e,t){var i=t*this.width+e;this.data[i>>3]^=1<<7-(7&i)},getBitXY(e,t){var i=t*this.width+e;return this.data[i>>3]&1<<7-(7&i)?1:0},setBit(e){this.data[e>>3]|=1<<7-(7&e)},clearBit(e){this.data[e>>3]&=~(1<<7-(7&e))},toggleBit(e){this.data[e>>3]^=1<<7-(7&e)},getBit(e){return this.data[e>>3]&1<<7-(7&e)?1:0}};class Fr{constructor(e,t){this.parent=e,this.width=e.width,this.height=e.height,this.data=t,this.negative=0,this.positive=0,this.computed={}}get total(){return this.negative+this.positive}get minMax(){if(this.computed.minMax)return this.computed.minMax;for(var e=Number.MAX_SAFE_INTEGER,t=Number.MIN_SAFE_INTEGER,a=0;a<this.data.length;a++)this.data[a]<e&&(e=this.data[a]),this.data[a]>t&&(t=this.data[a]);return this.computed.minMax={min:e,max:t}}get commonBorderLength(){return Pi(this)}mergeRoi(e={}){return Ii.call(this,e)}rowsInfo(){for(var e=Array(this.height),t=0,a=0,i;a<this.data.length;a+=this.width){i={row:t,positivePixel:0,negativePixel:0,zeroPixel:0,positiveRoi:0,negativeRoi:0,medianChange:0},e[t++]=i;for(var n={},o={},s=[],r=this.data[a],l=0,d=a,h;d<a+this.width;d++)h=this.data[d],r!==h&&(r=h,s.push(l),l=0),l++,0<h?(i.positivePixel++,!n[h]&&(n[h]=!0)):0>h?(i.negativePixel++,!o[h]&&(o[h]=!0)):i.zeroPixel++;s.push(l),i.medianChange=s.sort((e,t)=>e-t)[fo(s.length/2)],i.positiveRoiIDs=Object.keys(n),i.negativeRoiIDs=Object.keys(o),i.positiveRoi=i.positiveRoiIDs.length,i.negativeRoi=i.negativeRoiIDs.length}return e}colsInfo(){for(var e=Array(this.width),t=0,a=0,i;a<this.width;a++){i={col:t,positivePixel:0,negativePixel:0,zeroPixel:0,positiveRoi:0,negativeRoi:0,medianChange:0},e[t++]=i;for(var n={},o={},s=[],r=this.data[a],l=0,d=a,h;d<a+this.data.length;d+=this.width)h=this.data[d],r!==h&&(r=h,s.push(l),l=0),l++,0<h?(i.positivePixel++,!n[h]&&(n[h]=!0)):0>h?(i.negativePixel++,!o[h]&&(o[h]=!0)):i.zeroPixel++;s.push(l),i.medianChange=s.sort((e,t)=>e-t)[fo(s.length/2)],i.positiveRoiIDs=Object.keys(n),i.negativeRoiIDs=Object.keys(o),i.positiveRoi=i.positiveRoiIDs.length,i.negativeRoi=i.negativeRoiIDs.length}return e}}var Yr=class{constructor(){this.nodes=new Map}add(e){var t=this.nodes.get(e);return t||(t=new Ci(e),this.nodes.set(e,t)),t}union(e,t){const i=this.find(e),a=this.find(t);i===a||(i.rank<a.rank?i.parent=a:i.rank>a.rank?a.parent=i:(a.parent=i,i.rank++))}find(e){for(var t=e;null!==t.parent;)t=t.parent;for(var i=e,a;null!==i.parent;)a=i,i=i.parent,a.parent=t;return t}connected(e,t){return this.find(e)===this.find(t)}},Xr=[-1,0],qr=[0,-1],Or=[null,null],Nr=[-1,-1,0,1],Gr=[0,-1,-1,-1],Hr=[null,null,null,null],Wr=S(function(e){(function(t){e.exports=t()})(function(){return function d(h,e,t){function a(i,o){if(!e[i]){if(!h[i]){var s='function'==typeof M&&M;if(!o&&s)return s(i,!0);if(n)return n(i,!0);var r=new Error('Cannot find module \''+i+'\'');throw r.code='MODULE_NOT_FOUND',r}var g=e[i]={exports:{}};h[i][0].call(g.exports,function(t){var e=h[i][1][t];return a(e?e:t)},g,g.exports,d,h,e,t)}return e[i].exports}for(var n='function'==typeof M&&M,i=0;i<t.length;i++)a(t[i]);return a}({1:[function(e,t){var i=function(e,t){function i(){this.constructor=e}for(var n in t)a.call(t,n)&&(e[n]=t[n]);return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e},a={}.hasOwnProperty,n,o,s,r,l;n=e('./PriorityQueue/AbstractPriorityQueue'),o=e('./PriorityQueue/ArrayStrategy'),r=e('./PriorityQueue/BinaryHeapStrategy'),s=e('./PriorityQueue/BHeapStrategy'),l=function(e){function t(e){e||(e={}),e.strategy||(e.strategy=r),e.comparator||(e.comparator=function(e,t){return(e||0)-(t||0)}),t.__super__.constructor.call(this,e)}return i(t,e),t}(n),l.ArrayStrategy=o,l.BinaryHeapStrategy=r,l.BHeapStrategy=s,t.exports=l},{'./PriorityQueue/AbstractPriorityQueue':2,'./PriorityQueue/ArrayStrategy':3,'./PriorityQueue/BHeapStrategy':4,'./PriorityQueue/BinaryHeapStrategy':5}],2:[function(e,t){var i;t.exports=i=function(){function e(e){var t;if(null==(null==e?void 0:e.strategy))throw'Must pass options.strategy, a strategy';if(null==(null==e?void 0:e.comparator))throw'Must pass options.comparator, a comparator';this.priv=new e.strategy(e),this.length=(null==e||null==(t=e.initialValues)?void 0:t.length)||0}return e.prototype.queue=function(e){return this.length++,void this.priv.queue(e)},e.prototype.dequeue=function(){if(!this.length)throw'Empty queue';return this.length--,this.priv.dequeue()},e.prototype.peek=function(){if(!this.length)throw'Empty queue';return this.priv.peek()},e.prototype.clear=function(){return this.length=0,this.priv.clear()},e}()},{}],3:[function(e,t){var i,a;a=function(e,t,i){var a,n,o;for(n=0,a=e.length;n<a;)o=n+a>>>1,0<=i(e[o],t)?n=o+1:a=o;return n},t.exports=i=function(){function e(e){var t;this.options=e,this.comparator=this.options.comparator,this.data=(null==(t=this.options.initialValues)?void 0:t.slice(0))||[],this.data.sort(this.comparator).reverse()}return e.prototype.queue=function(e){var t;return t=a(this.data,e,this.comparator),void this.data.splice(t,0,e)},e.prototype.dequeue=function(){return this.data.pop()},e.prototype.peek=function(){return this.data[this.data.length-1]},e.prototype.clear=function(){this.data.length=0},e}()},{}],4:[function(e,t){var i;t.exports=i=function(){function e(e){var t,a,i,n,o,s,r,l,d;for(this.comparator=(null==e?void 0:e.comparator)||function(e,t){return e-t},this.pageSize=(null==e?void 0:e.pageSize)||512,this.length=0,l=0;1<<l<this.pageSize;)l+=1;if(1<<l!==this.pageSize)throw'pageSize must be a power of two';for(this._shift=l,this._emptyMemoryPageTemplate=t=[],(a=i=0,s=this.pageSize);0<=s?i<s:i>s;a=0<=s?++i:--i)t.push(null);if(this._memory=[],this._mask=this.pageSize-1,e.initialValues)for(r=e.initialValues,n=0,o=r.length;n<o;n++)d=r[n],this.queue(d)}return e.prototype.queue=function(e){return this.length+=1,this._write(this.length,e),void this._bubbleUp(this.length,e)},e.prototype.dequeue=function(){var e,t;return e=this._read(1),t=this._read(this.length),this.length-=1,0<this.length&&(this._write(1,t),this._bubbleDown(1,t)),e},e.prototype.peek=function(){return this._read(1)},e.prototype.clear=function(){return this.length=0,void(this._memory.length=0)},e.prototype._write=function(e,t){var i;for(i=e>>this._shift;i>=this._memory.length;)this._memory.push(this._emptyMemoryPageTemplate.slice(0));return this._memory[i][e&this._mask]=t},e.prototype._read=function(e){return this._memory[e>>this._shift][e&this._mask]},e.prototype._bubbleUp=function(e,t){var i,a,n,o;for(i=this.comparator;1<e&&(a=e&this._mask,e<this.pageSize||3<a?n=e&~this._mask|a>>1:2>a?(n=e-this.pageSize>>this._shift,n+=n&~(this._mask>>1),n|=this.pageSize>>1):n=e-2,o=this._read(n),!(0>i(o,t)));)this._write(n,t),this._write(e,o),e=n},e.prototype._bubbleDown=function(e,t){var i,a,n,o,s;for(s=this.comparator;e<this.length;)if(e>this._mask&&!(e&this._mask-1)?i=a=e+2:e&this.pageSize>>1?(i=(e&~this._mask)>>1,i|=e&this._mask>>1,i=i+1<<this._shift,a=i+1):(i=e+(e&this._mask),a=i+1),i!==a&&a<=this.length){if(n=this._read(i),o=this._read(a),0>s(n,t)&&0>=s(n,o))this._write(i,t),this._write(e,n),e=i;else if(0>s(o,t))this._write(a,t),this._write(e,o),e=a;else break;}else if(!(i<=this.length))break;else if(n=this._read(i),0>s(n,t))this._write(i,t),this._write(e,n),e=i;else break},e}()},{}],5:[function(e,t){var i;t.exports=i=function(){function e(e){var t;this.comparator=(null==e?void 0:e.comparator)||function(e,t){return e-t},this.length=0,this.data=(null==(t=e.initialValues)?void 0:t.slice(0))||[],this._heapify()}return e.prototype._heapify=function(){var e,t,i;if(0<this.data.length)for(e=t=1,i=this.data.length;1<=i?t<i:t>i;e=1<=i?++t:--t)this._bubbleUp(e)},e.prototype.queue=function(e){return this.data.push(e),void this._bubbleUp(this.data.length-1)},e.prototype.dequeue=function(){var e,t;return t=this.data[0],e=this.data.pop(),0<this.data.length&&(this.data[0]=e,this._bubbleDown(0)),t},e.prototype.peek=function(){return this.data[0]},e.prototype.clear=function(){return this.length=0,void(this.data.length=0)},e.prototype._bubbleUp=function(e){for(var t,i;0<e&&(t=e-1>>>1,0>this.comparator(this.data[e],this.data[t]));)i=this.data[t],this.data[t]=this.data[e],this.data[e]=i,e=t},e.prototype._bubbleDown=function(e){var t,i,a,n,o;for(t=this.data.length-1;i=(e<<1)+1,n=i+1,a=e,i<=t&&0>this.comparator(this.data[i],this.data[a])&&(a=i),n<=t&&0>this.comparator(this.data[n],this.data[a])&&(a=n),a!==e;)o=this.data[a],this.data[a]=this.data[e],this.data[e]=o,e=a},e}()},{}]},{},[1])(1)})}),Zr=[1,0,-1,0,1,1,-1,-1],Qr=[0,1,0,-1,1,-1,1,-1],Kr=Object.prototype.hasOwnProperty,Jr=Object.prototype.toString,$r=function(e){return'function'==typeof Array.isArray?Array.isArray(e):'[object Array]'===Jr.call(e)},el=function(e){if(!e||'[object Object]'!==Jr.call(e))return!1;var t=Kr.call(e,'constructor'),i=e.constructor&&e.constructor.prototype&&Kr.call(e.constructor.prototype,'isPrototypeOf');if(e.constructor&&!t&&!i)return!1;for(var a in e);return'undefined'==typeof a||Kr.call(e,a)},tl=function e(){var t=arguments[0],a=1,i=arguments.length,n=!1,o,s,r,l,d,h;for('boolean'==typeof t&&(n=t,t=arguments[1]||{},a=2),(null==t||'object'!=typeof t&&'function'!=typeof t)&&(t={});a<i;++a)if(o=arguments[a],null!=o)for(s in o)r=t[s],l=o[s],t!==l&&(n&&l&&(el(l)||(d=$r(l)))?(d?(d=!1,h=r&&$r(r)?r:[]):h=r&&el(r)?r:{},t[s]=e(n,h,l)):'undefined'!=typeof l&&(t[s]=l));return t},il=function(e,t,i){var a=e*t,n=al*e,o=n-(n-e),s=e-o,r=al*t,l=r-(r-t),d=t-l,h=s*d-(a-o*l-s*l-o*d);return i?(i[0]=h,i[1]=a,i):[h,a]},al=134217729,nl=function(t,e){var i=0|t.length,n=0|e.length;if(1==i&&1==n)return Ei(t[0],e[0]);var o=Array(i+n),s=0,r=0,l=0,d=so,h=t[r],g=d(h),c=e[l],m=d(c),p,a;g<m?(a=h,r+=1,r<i&&(h=t[r],g=d(h))):(a=c,l+=1,l<n&&(c=e[l],m=d(c))),r<i&&g<m||l>=n?(p=h,r+=1,r<i&&(h=t[r],g=d(h))):(p=c,l+=1,l<n&&(c=e[l],m=d(c)));for(var u=p+a,f=u-p,_=a-f,b=_,w=u,x,y,k,v,D;r<i&&l<n;)g<m?(p=h,r+=1,r<i&&(h=t[r],g=d(h))):(p=c,l+=1,l<n&&(c=e[l],m=d(c))),a=b,u=p+a,f=u-p,_=a-f,_&&(o[s++]=_),x=w+u,y=x-w,k=x-y,v=u-y,D=w-k,b=D+v,w=x;for(;r<i;)p=h,a=b,u=p+a,f=u-p,_=a-f,_&&(o[s++]=_),x=w+u,y=x-w,k=x-y,v=u-y,D=w-k,b=D+v,w=x,r+=1,r<i&&(h=t[r]);for(;l<n;)p=c,a=b,u=p+a,f=u-p,_=a-f,_&&(o[s++]=_),x=w+u,y=x-w,k=x-y,v=u-y,D=w-k,b=D+v,w=x,l+=1,l<n&&(c=e[l]);return b&&(o[s++]=b),w&&(o[s++]=w),s||(o[s++]=0),o.length=s,o},ol=function(e,t,i){var a=e+t,n=a-e,o=t-n,s=e-(a-n);return i?(i[0]=s+o,i[1]=a,i):[s+o,a]},sl=function(o,e){var s=o.length;if(1===s){var n=il(o[0],e);return n[0]?n:[n[1]]}var r=Array(2*s),l=[0.1,0.1],d=[0.1,0.1],t=0;il(o[0],e,l),l[0]&&(r[t++]=l[0]);for(var h=1;h<s;++h){il(o[h],e,d);var i=l[1];ol(i,d[0],l),l[0]&&(r[t++]=l[0]);var g=d[1],a=l[1],c=g+a,m=a-(c-g);l[1]=c,m&&(r[t++]=m)}return l[1]&&(r[t++]=l[1]),0==t&&(r[t++]=0),r.length=t,r},rl=function(t,e){var i=0|t.length,n=0|e.length;if(1==i&&1==n)return Ti(t[0],-e[0]);var o=Array(i+n),s=0,r=0,l=0,d=so,h=t[r],g=d(h),c=-e[l],m=d(c),p,a;g<m?(a=h,r+=1,r<i&&(h=t[r],g=d(h))):(a=c,l+=1,l<n&&(c=-e[l],m=d(c))),r<i&&g<m||l>=n?(p=h,r+=1,r<i&&(h=t[r],g=d(h))):(p=c,l+=1,l<n&&(c=-e[l],m=d(c)));for(var u=p+a,f=u-p,_=a-f,b=_,w=u,x,y,k,v,D;r<i&&l<n;)g<m?(p=h,r+=1,r<i&&(h=t[r],g=d(h))):(p=c,l+=1,l<n&&(c=-e[l],m=d(c))),a=b,u=p+a,f=u-p,_=a-f,_&&(o[s++]=_),x=w+u,y=x-w,k=x-y,v=u-y,D=w-k,b=D+v,w=x;for(;r<i;)p=h,a=b,u=p+a,f=u-p,_=a-f,_&&(o[s++]=_),x=w+u,y=x-w,k=x-y,v=u-y,D=w-k,b=D+v,w=x,r+=1,r<i&&(h=t[r]);for(;l<n;)p=c,a=b,u=p+a,f=u-p,_=a-f,_&&(o[s++]=_),x=w+u,y=x-w,k=x-y,v=u-y,D=w-k,b=D+v,w=x,l+=1,l<n&&(c=-e[l]);return b&&(o[s++]=b),w&&(o[s++]=w),s||(o[s++]=0),o.length=s,o},ll=S(function(e){'use strict';function t(e,t){for(var a=Array(e.length-1),n=1,i;n<e.length;++n){i=a[n-1]=Array(e.length-1);for(var o=0,s=0;o<e.length;++o)o!==t&&(i[s++]=e[n][o])}return a}function a(e){for(var t=Array(e),a=0;a<e;++a){t[a]=Array(e);for(var i=0;i<e;++i)t[a][i]=['m',i,'[',e-a-1,']'].join('')}return t}function n(e){return 1&e?'-':''}function o(e){if(1===e.length)return e[0];if(2===e.length)return['sum(',e[0],',',e[1],')'].join('');var t=e.length>>1;return['sum(',o(e.slice(0,t)),',',o(e.slice(t)),')'].join('')}function s(e){if(2===e.length)return[['sum(prod(',e[0][0],',',e[1][1],'),prod(-',e[0][1],',',e[1][0],'))'].join('')];for(var a=[],r=0;r<e.length;++r)a.push(['scale(',o(s(t(e,r))),',',n(r),e[0][r],')'].join(''));return a}function i(e){for(var n=[],r=[],l=a(e),d=[],h=0;h<e;++h)0==(1&h)?n.push.apply(n,s(t(l,h))):r.push.apply(r,s(t(l,h))),d.push('m'+h);var i=o(n),g=o(r),c='orientation'+e+'Exact',m=['function ',c,'(',d.join(),'){var p=',i,',n=',g,',d=sub(p,n);return d[d.length-1];};return ',c].join(''),p=new Function('sum','prod','scale','sub',m);return p(nl,il,sl,rl)}function r(e){var t=c[e.length];return t||(t=c[e.length]=i(e.length)),t.apply(void 0,e)}var l=5,h=1.1102230246251565e-16,d=i(3),g=i(4),c=[function(){return 0},function(){return 0},function(e,t){return t[0]-e[0]},function(e,t,i){var a=(e[1]-i[1])*(t[0]-i[0]),n=(e[0]-i[0])*(t[1]-i[1]),o=a-n,r;if(0<a){if(0>=n)return o;r=a+n}else if(0>a){if(0<=n)return o;r=-(a+n)}else return o;var s=(3+16*h)*h*r;return o>=s||o<=-s?o:d(e,t,i)},function(e,t,i,a){var n=e[0]-a[0],o=t[0]-a[0],s=i[0]-a[0],r=e[1]-a[1],l=t[1]-a[1],d=i[1]-a[1],c=e[2]-a[2],m=t[2]-a[2],p=i[2]-a[2],u=o*d,f=s*l,_=s*r,b=n*d,w=n*l,x=o*r,y=c*(u-f)+m*(_-b)+p*(w-x),k=(so(u)+so(f))*so(c)+(so(_)+so(b))*so(m)+(so(w)+so(x))*so(p),v=(7+56*h)*h*k;return y>v||-y>v?y:g(e,t,i,a)}];(function(){for(;c.length<=l;)c.push(i(c.length));for(var t=[],a=['slow'],n=0;n<=l;++n)t.push('a'+n),a.push('o'+n);for(var o=['function getOrientation(',t.join(),'){switch(arguments.length){case 0:case 1:return 0;'],n=2;n<=l;++n)o.push('case ',n,':return o',n,'(',t.slice(0,n).join(),');');o.push('}var s=new Array(arguments.length);for(var i=0;i<arguments.length;++i){s[i]=arguments[i]};return slow(s);}return getOrientation'),a.push(o.join(''));var s=Function.apply(void 0,a);e.exports=s.apply(void 0,[r].concat(c));for(var n=0;n<=l;++n)e.exports[n]=c[n]})()}),dl=function(e,t){for(var o=t[0],r=t[1],l=e.length,n=1,d=l,h=0,i=l-1;h<d;i=h++){var g=e[h],a=e[i],m=g[1],u=a[1];if(u<m){if(u<r&&r<m){var f=ll(g,a,t);if(0===f)return 0;n^=0|0<f}else if(r===m){var s=e[(h+1)%l],c=s[1];if(m<c){var f=ll(g,a,t);if(0===f)return 0;n^=0|0<f}}}else if(m<u){if(m<r&&r<u){var f=ll(g,a,t);if(0===f)return 0;n^=0|0>f}else if(r===m){var s=e[(h+1)%l],c=s[1];if(c<m){var f=ll(g,a,t);if(0===f)return 0;n^=0|0>f}}}else if(r===m){var _=ro(g[0],a[0]),b=oo(g[0],a[0]);if(0===h){for(;0<i;){var w=(i+l-1)%l,x=e[w];if(x[1]!==r)break;var p=x[0];_=ro(_,p),b=oo(b,p),i=w}if(0==i)return _<=o&&o<=b?0:1;d=i+1}for(var y=e[(i+l-1)%l][1],x,p;h+1<d&&(x=e[h+1],x[1]===r);)p=x[0],_=ro(_,p),b=oo(b,p),h+=1;if(_<=o&&o<=b)return 0;var k=e[(h+1)%l][1];o<_&&y<r!=k<r&&(n^=1)}}return 2*n-1};class hl{constructor(e,t){var i=Number.NEGATIVE_INFINITY;this.map=e,this.id=t,this.minX=Jn,this.maxX=i,this.minY=Jn,this.maxY=i,this.meanX=0,this.meanY=0,this.surface=0,this.computed={}}getMask(e={}){var t=e.scale,i=void 0===t?1:t,a=e.kind,n=void 0===a?'':a,o;return o='contour'===n?this.contourMask:'box'===n?this.boxMask:'filled'===n?this.filledMask:'center'===n?this.centerMask:'hull'===n?this.hullMask:this.mask,1>i&&(o=o.scale({factor:i}),o.parent=this.mask.parent,o.position[0]+=this.minX,o.position[1]+=this.minY),o}get mean(){throw new Error('Roi mean not implemented yet')}get center(){return this.computed.center?this.computed.center:this.computed.center=[this.width/2>>0,this.height/2>>0]}get ratio(){return this.width/this.height}get width(){return this.maxX-this.minX+1}get height(){return this.maxY-this.minY+1}_computExternalIDs(){var e=this.borderIDs,t=this.borderLengths;this.computed.externalIDs=[],this.computed.externalLengths=[];for(var a=this.internalIDs,n=0;n<e.length;n++)a.includes(e[n])||(this.computed.externalIDs.push(e[n]),this.computed.externalLengths.push(t[n]))}get externalIDs(){return this.computed.externalIDs?this.computed.externalIDs:(this._computExternalIDs(),this.computed.externalIDs)}get externalLengths(){return this.computed.externalLengths?this.computed.externalLengths:(this._computExternalIDs(),this.computed.externalLengths)}_computeBorderIDs(){var e=Vi(this);this.computed.borderIDs=e.ids,this.computed.borderLengths=e.lengths}get borderIDs(){return this.computed.borderIDs?this.computed.borderIDs:(this._computeBorderIDs(),this.computed.borderIDs)}get borderLengths(){return this.computed.borderLengths?this.computed.borderLengths:(this._computeBorderIDs(),this.computed.borderLengths)}get boxIDs(){return this.computed.boxIDs?this.computed.boxIDs:this.computed.boxIDs=Ui(this)}get internalIDs(){return this.computed.internalIDs?this.computed.internalIDs:this.computed.internalIDs=qi(this)}get box(){return this.computed.box?this.computed.box:this.computed.box=Fi(this)}get external(){return this.computed.external?this.computed.external:this.computed.external=Xi(this)}get border(){return this.computed.border?this.computed.border:this.computed.border=Yi(this)}get contourMask(){if(this.computed.contourMask)return this.computed.contourMask;for(var e=new mc(this.width,this.height,{kind:bo,position:[this.minX,this.minY],parent:this.map.parent}),t=0;t<this.width;t++)for(var i=0;i<this.height;i++)this.map.data[t+this.minX+(i+this.minY)*this.map.width]===this.id&&(0<t&&t<this.width-1&&0<i&&i<this.height-1?(this.map.data[t-1+this.minX+(i+this.minY)*this.map.width]!==this.id||this.map.data[t+1+this.minX+(i+this.minY)*this.map.width]!==this.id||this.map.data[t+this.minX+(i-1+this.minY)*this.map.width]!==this.id||this.map.data[t+this.minX+(i+1+this.minY)*this.map.width]!==this.id)&&e.setBitXY(t,i):e.setBitXY(t,i));return this.computed.contour=e}get boxMask(){if(this.computed.boxMask)return this.computed.boxMask;for(var e=new mc(this.width,this.height,{kind:bo,position:[this.minX,this.minY],parent:this.map.parent}),t=0;t<this.width;t++)e.setBitXY(t,0),e.setBitXY(t,this.height-1);for(var i=0;i<this.height;i++)e.setBitXY(0,i),e.setBitXY(this.width-1,i);return this.computed.boxMask=e}get mask(){if(this.computed.mask)return this.computed.mask;for(var e=new mc(this.width,this.height,{kind:bo,position:[this.minX,this.minY],parent:this.map.parent}),t=0;t<this.width;t++)for(var i=0;i<this.height;i++)this.map.data[t+this.minX+(i+this.minY)*this.map.width]===this.id&&e.setBitXY(t,i);return this.computed.mask=e}get filledMask(){if(this.computed.filledMask)return this.computed.filledMask;for(var e=new mc(this.width,this.height,{kind:bo,position:[this.minX,this.minY],parent:this.map.parent}),t=0;t<this.width;t++)for(var i=0,a;i<this.height;i++)a=t+this.minX+(i+this.minY)*this.map.width,this.internalIDs.includes(this.map.data[a])&&e.setBitXY(t,i);return this.computed.filledMask=e}get centerMask(){if(this.computed.centerMask)return this.computed.centerMask;var e=new Tr({kind:'smallCross'}).getMask();return e.parent=this.map.parent,e.position=[this.minX+this.center[0]-1,this.minY+this.center[1]-1],this.computed.centerMask=e}get hullMask(){if(this.computed.hullMask)return this.computed.hullMask;for(var e=new mc(this.width,this.height,{kind:bo,position:[this.minX,this.minY],parent:this.map.parent}),t=this.mask.monotoneChainConvexHull(),i=0;i<this.width;i++)for(var a=0;a<this.height;a++)1!==dl(t,[i,a])&&e.setBitXY(i,a);return this.computed.hullMask=e}get points(){if(this.computed.points)return this.computed.points;for(var e=[],t=0;t<this.height;t++)for(var i=0,a;i<this.width;i++)a=(t+this.minY)*this.map.width+i+this.minX,this.map.data[a]===this.id&&e.push([i,t]);return this.computed.points=e}get maxLengthPoints(){if(this.computed.maxLengthPoints)return this.computed.maxLengthPoints;for(var e=0,t=void 0,a=this.points,n=0;n<a.length;n++)for(var i=n+1,o;i<a.length;i++)o=no(a[n][0]-a[i][0],2)+no(a[n][1]-a[i][1],2),o>=e&&(e=o,t=[a[n],a[i]]);return this.computed.maxLengthPoints=t}get maxLength(){if(this.computed.maxLength)return this.computed.maxLength;var e=mo(no(this.maxLengthPoints[0][0]-this.maxLengthPoints[1][0],2)+no(this.maxLengthPoints[0][1]-this.maxLengthPoints[1][1],2));return this.computed.maxLength=e}get angle(){if(this.computed.angle)return this.computed.angle;var e=this.maxLengthPoints,t=180*-Math.atan2(e[0][1]-e[1][1],e[0][0]-e[1][0])/uo;return this.computed.angle=t}toJSON(){return{id:this.id,minX:this.minX,maxX:this.maxX,minY:this.minY,maxY:this.maxY,meanX:this.meanX,meanY:this.meanY,height:this.height,width:this.width,surface:this.surface}}}class gl{constructor(e,t){this.roiMap=e,this.options=t,this.roi=this.createRoi()}createRoi(){var e=this.roiMap.data,t={};this.roiMap.positive=0,this.roiMap.negative=0;for(var a=0;a<e.length;a++)e[a]&&!t[e[a]]&&(t[e[a]]=!0,0<e[a]?this.roiMap.positive++:this.roiMap.negative++);var i={};for(var n in t)i[n]=new hl(this.roiMap,1*n);for(var o=this.roiMap.width,s=this.roiMap.height,r=0;r<s;r++)for(var l=0,d;l<o;l++)if(d=r*o+l,0!==e[d]){var h=e[d],g=i[h];l<g.minX&&(g.minX=l),l>g.maxX&&(g.maxX=l),r<g.minY&&(g.minY=r),r>g.maxY&&(g.maxY=r),g.meanX+=l,g.meanY+=r,g.surface++}var c=[];for(var m in t)i[m].meanX/=i[m].surface,i[m].meanY/=i[m].surface,c.push(i[m]);return c}}class cl{constructor(e,t={}){this._image=e,this._options=t,this._options.label||(this._options.label='default'),this._layers={},this._painted=null}fromMaxima(e={}){var t=tl({},this._options,e),i=Ri.call(this._image,e);this._layers[t.label]=new gl(i,t)}fromPoints(e,t={}){var i=tl({},this._options,t),a=Li.call(this._image,e,t);return this._layers[i.label]=new gl(a,i),this}putMap(e,t={}){var i=new Fr(this._image,e),a=tl({},this._options,t);return this._layers[a.label]=new gl(i,a),this}fromWaterShed(e={}){var t=tl({},this._options,e),i=zi.call(this._image,e);this._layers[t.label]=new gl(i,t)}fromMask(e,t={}){var i=tl({},this._options,t),a=Bi.call(this._image,e,t);return this._layers[i.label]=new gl(a,i),this}fromMaskConnectedComponentLabelingAlgorithm(e,t={}){var i=tl({},this._options,t),a=Ai.call(this._image,e,t);return this._layers[i.label]=new gl(a,i),this}getMap(e={}){var t=tl({},this._options,e);return this._assertLayerWithLabel(t.label),this._layers[t.label].roiMap}rowsInfo(e={}){return this.getMap(e).rowsInfo()}colsInfo(e={}){return this.getMap(e).rowsInfo()}getRoiIds(e={}){var t=this.getRois(e);if(t){for(var a=Array(t.length),n=0;n<t.length;n++)a[n]=t[n].id;return a}throw new Error('ROIs not found')}getRois(e={}){var t=e.label,a=void 0===t?this._options.label:t,n=e.positive,o=e.negative,s=e.minSurface,r=void 0===s?0:s,l=e.maxSurface,d=void 0===l?Jn:l,h=e.minWidth,g=void 0===h?0:h,c=e.maxWidth,m=void 0===c?Jn:c,p=e.minHeight,u=void 0===p?0:p,f=e.maxHeight,_=void 0===f?Jn:f,b=e.minRatio,w=void 0===b?0:b,x=e.maxRatio,y=void 0===x?Jn:x;if(!this._layers[a])throw new Error('getRoi: This Roi layer ('+a+') does not exists.');for(var k=this._layers[a].roi,v=Array(k.length),D=0,j=0,i;j<k.length;j++)i=k[j],(0>i.id&&(void 0===o||o)||0<i.id&&(void 0===n||n))&&i.surface>=r&&i.surface<=d&&i.width>=g&&i.width<=m&&i.height>=u&&i.height<=_&&i.ratio>=w&&i.ratio<=y&&(v[D++]=i);return v.length=D,v}getMasks(e={}){for(var t=this.getRois(e),a=Array(t.length),n=0;n<t.length;n++)a[n]=t[n].getMask(e);return a}getData(e={}){var t=tl({},this._options,e);return this._assertLayerWithLabel(t.label),this._layers[t.label].roiMap.data}paint(e={}){var t=e.labelProperty;this._painted||(this._painted=this._image.rgba8());var i=this.getMasks(e);if(t){var a=this.getRois(e);e.labels=a.map((e)=>e[t]),e.labelsPosition=a.map((e)=>[e.meanX,e.meanY])}return this._painted.paintMasks(i,e),this._painted}getMask(e={}){for(var t=new mc(this._image.width,this._image.height,{kind:'BINARY'}),a=this.getMasks(e),n=0,i;n<a.length;n++){i=a[n];for(var o=0;o<i.width;o++)for(var s=0;s<i.height;s++)i.getBitXY(o,s)&&t.setBitXY(o+i.position[0],s+i.position[1])}return t}resetPainted(e={}){var t=e.image;this._painted=t?this.image.rgba8():this._image.rgba8()}mergeRoi(e={}){var t=this.getMap(e);return t.mergeRoi(e),this.putMap(t.data,e),this}findCorrespondingRoi(e,t={}){for(var a=this.getRois(t),n=[],o=0;o<a.length;o++){var i=a[o],s=i.minX,r=i.minY,l=i.points,d=Kn(i.id),h=Oi(s,r,l,e,d);n.push(h)}return n}_assertLayerWithLabel(e){if(!this._layers[e])throw new Error(`no layer with label ${e}`)}}var ml=new Map,pl;class ul{constructor(e){this.type=e,this._canWrite=null}canWrite(){return null===this._canWrite&&(this._canWrite=pl.toDataURL(this.type).startsWith('data:'+this.type)),this._canWrite}}const fl=8192,_l=[];var bl=class{constructor(e,t){t=t||{},void 0===e&&(e=fl),'number'==typeof e&&(e=new ArrayBuffer(e));let i=e.byteLength;const a=t.offset?t.offset>>>0:0;e.buffer&&(i=e.byteLength-a,e=e.byteLength===e.buffer.byteLength?a?e.buffer.slice(a):e.buffer:e.buffer.slice(e.byteOffset+a,e.byteOffset+e.byteLength)),this.buffer=e,this.length=i,this.byteLength=i,this.byteOffset=0,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer),this._increment=i||fl,this._mark=0}available(e){return void 0===e&&(e=1),this.offset+e<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){this.littleEndian=!0}isBigEndian(){return!this.littleEndian}setBigEndian(){this.littleEndian=!1}skip(e){void 0===e&&(e=1),this.offset+=e}seek(e){this.offset=e}mark(){this._mark=this.offset}reset(){this.offset=this._mark}rewind(){this.offset=0}ensureAvailable(e){if(void 0===e&&(e=1),!this.available(e)){const e=this._increment+this._increment;this._increment=e;const t=this.length+e,i=new Uint8Array(t);i.set(new Uint8Array(this.buffer)),this.buffer=i.buffer,this.length=t,this._data=new DataView(this.buffer)}}readBoolean(){return 0!==this.readUint8()}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(e){void 0===e&&(e=1);for(var t=new Uint8Array(e),a=0;a<e;a++)t[a]=this.readByte();return t}readInt16(){var e=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}readUint16(){var e=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,e}readInt32(){var e=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}readUint32(){var e=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat32(){var e=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat64(){var e=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}readChar(){return Qn(this.readInt8())}readChars(e){void 0===e&&(e=1),_l.length=e;for(var t=0;t<e;t++)_l[t]=this.readChar();return _l.join('')}writeBoolean(e){this.writeUint8(e?255:0)}writeInt8(e){this.ensureAvailable(1),this._data.setInt8(this.offset++,e)}writeUint8(e){this.ensureAvailable(1),this._data.setUint8(this.offset++,e)}writeByte(e){this.writeUint8(e)}writeBytes(e){this.ensureAvailable(e.length);for(var t=0;t<e.length;t++)this._data.setUint8(this.offset++,e[t])}writeInt16(e){this.ensureAvailable(2),this._data.setInt16(this.offset,e,this.littleEndian),this.offset+=2}writeUint16(e){this.ensureAvailable(2),this._data.setUint16(this.offset,e,this.littleEndian),this.offset+=2}writeInt32(e){this.ensureAvailable(4),this._data.setInt32(this.offset,e,this.littleEndian),this.offset+=4}writeUint32(e){this.ensureAvailable(4),this._data.setUint32(this.offset,e,this.littleEndian),this.offset+=4}writeFloat32(e){this.ensureAvailable(4),this._data.setFloat32(this.offset,e,this.littleEndian),this.offset+=4}writeFloat64(e){this.ensureAvailable(8),this._data.setFloat64(this.offset,e,this.littleEndian),this.offset+=8}writeChar(e){this.writeUint8(e.charCodeAt(0))}writeChars(e){for(var t=0;t<e.length;t++)this.writeUint8(e.charCodeAt(t))}toArray(){return new Uint8Array(this.buffer,0,this.offset)}},wl=S(function(e,t){'use strict';var i='undefined'!=typeof Uint8Array&&'undefined'!=typeof Uint16Array&&'undefined'!=typeof Int32Array;t.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1),i;t.length;)if(i=t.shift(),i){if('object'!=typeof i)throw new TypeError(i+'must be non-object');for(var a in i)i.hasOwnProperty(a)&&(e[a]=i[a])}return e},t.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var a={arraySet:function(e,t,a,n,o){if(t.subarray&&e.subarray)return void e.set(t.subarray(a,a+n),o);for(var s=0;s<n;s++)e[o+s]=t[a+s]},flattenChunks:function(e){var t,i,a,n,o,s;for(a=0,t=0,i=e.length;t<i;t++)a+=e[t].length;for(s=new Uint8Array(a),n=0,(t=0,i=e.length);t<i;t++)o=e[t],s.set(o,n),n+=o.length;return s}},n={arraySet:function(e,t,a,n,o){for(var s=0;s<n;s++)e[o+s]=t[a+s]},flattenChunks:function(e){return[].concat.apply([],e)}};t.setTyped=function(e){e?(t.Buf8=Uint8Array,t.Buf16=Uint16Array,t.Buf32=Int32Array,t.assign(t,a)):(t.Buf8=Array,t.Buf16=Array,t.Buf32=Array,t.assign(t,n))},t.setTyped(i)}),xl=0,yl=1,kl=0,vl=1,Dl=29,jl=256,Ml=jl+1+Dl,Sl=30,Pl=19,Il=2*Ml+1,Bl=15,Cl=16,Al=7,Rl=256,zl=16,Ll=17,El=18,Tl=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],Vl=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],Ul=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],Fl=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Yl=Array(2*(Ml+2));Wi(Yl);var Xl=Array(2*Sl);Wi(Xl);var ql=Array(512);Wi(ql);var Ol=Array(258-3+1);Wi(Ol);var Nl=Array(Dl);Wi(Nl);var Gl=Array(Sl);Wi(Gl);var Hl=!1,Wl={_tr_init:function(e){Hl||(oa(),Hl=!0),e.l_desc=new Qi(e.dyn_ltree,Ad),e.d_desc=new Qi(e.dyn_dtree,Rd),e.bl_desc=new Qi(e.bl_tree,zd),e.bi_buf=0,e.bi_valid=0,sa(e)},_tr_stored_block:ba,_tr_flush_block:function(e,t,i,a){var n=0,o,s;0<e.level?(e.strm.data_type===2&&(e.strm.data_type=_a(e)),ca(e,e.l_desc),ca(e,e.d_desc),n=ua(e),o=e.opt_len+3+7>>>3,s=e.static_len+3+7>>>3,s<=o&&(o=s)):o=s=i+5,i+4<=o&&-1!==t?ba(e,t,i,a):e.strategy===4||s===o?($i(e,(vl<<1)+(a?1:0),3),ga(e,Yl,Xl)):($i(e,(2<<1)+(a?1:0),3),fa(e,e.l_desc.max_code+1,e.d_desc.max_code+1,n+1),ga(e,e.dyn_ltree,e.dyn_dtree)),sa(e),a&&ra(e)},_tr_tally:function(e,t,i){return e.pending_buf[e.d_buf+2*e.last_lit]=255&t>>>8,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&i,e.last_lit++,0===t?e.dyn_ltree[2*i]++:(e.matches++,t--,e.dyn_ltree[2*(Ol[i]+jl+1)]++,e.dyn_dtree[2*Ki(t)]++),e.last_lit===e.lit_bufsize-1},_tr_align:function(e){$i(e,vl<<1,3),ea(e,Rl,Yl),ia(e)}},Zl=function(e,t,i,a){for(var o=0|65535&e,s=0|65535&e>>>16,r=0;0!==i;){r=2e3<i?2e3:i,i-=r;do o=0|o+t[a++],s=0|s+o;while(--r);o%=65521,s%=65521}return 0|(o|s<<16)},Ql=function(){for(var e=[],t=0,i;256>t;t++){i=t;for(var a=0;8>a;a++)i=1&i?3988292384^i>>>1:i>>>1;e[t]=i}return e}(),Kl=function(e,t,a,n){e^=-1;for(var o=n;o<n+a;o++)e=e>>>8^Ql[255&(e^t[o])];return-1^e},Jl={0:'',1:'stream end',2:'need dictionary','-1':'file error','-2':'stream error','-3':'data error','-4':'insufficient memory','-5':'buffer error','-6':'incompatible version'},$l=0,ed=4,td=5,id=0,ad=1,nd=-2,od=-5,sd=-1,rd=1,ld=2,dd=4,hd=2,gd=8,cd=9,md=256+1+29,pd=30,ud=19,fd=2*md+1,_d=15,bd=3,wd=258,xd=wd+bd+1,yd=42,kd=69,vd=73,Dd=91,jd=103,Md=113,Sd=666,Pd=1,Id=2,Bd=3,Cd=4,Ad,Rd,zd,Ld;Ld=[new Ra(0,0,0,0,function(e,t){var i=65535;for(i>e.pending_buf_size-5&&(i=e.pending_buf_size-5);;){if(1>=e.lookahead){if(Pa(e),0===e.lookahead&&t===$l)return Pd;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var a=e.block_start+i;if((0===e.strstart||e.strstart>=a)&&(e.lookahead=e.strstart-a,e.strstart=a,va(e,!1),0===e.strm.avail_out))return Pd;if(e.strstart-e.block_start>=e.w_size-xd&&(va(e,!1),0===e.strm.avail_out))return Pd}return e.insert=0,t===ed?(va(e,!0),0===e.strm.avail_out?Bd:Cd):e.strstart>e.block_start&&(va(e,!1),0===e.strm.avail_out)?Pd:Pd}),new Ra(4,4,8,4,Ia),new Ra(4,5,16,8,Ia),new Ra(4,6,32,32,Ia),new Ra(4,4,16,16,Ba),new Ra(8,16,32,32,Ba),new Ra(8,16,128,128,Ba),new Ra(8,32,128,256,Ba),new Ra(32,128,258,1024,Ba),new Ra(32,258,258,4096,Ba)];var Ed={deflateInit:function(e,t){return Va(e,t,gd,15,8,0)},deflateInit2:Va,deflateReset:Ta,deflateResetKeep:Ea,deflateSetHeader:function(e,t){return e&&e.state?2===e.state.wrap?(e.state.gzhead=t,id):nd:nd},deflate:function(e,t){var i,a,n,o;if(!e||!e.state||t>td||0>t)return e?wa(e,nd):nd;if(a=e.state,!e.output||!e.input&&0!==e.avail_in||a.status===Sd&&t!==ed)return wa(e,0===e.avail_out?od:nd);if(a.strm=e,i=a.last_flush,a.last_flush=t,a.status===yd)if(2===a.wrap)e.adler=0,Da(a,31),Da(a,139),Da(a,8),a.gzhead?(Da(a,(a.gzhead.text?1:0)+(a.gzhead.hcrc?2:0)+(a.gzhead.extra?4:0)+(a.gzhead.name?8:0)+(a.gzhead.comment?16:0)),Da(a,255&a.gzhead.time),Da(a,255&a.gzhead.time>>8),Da(a,255&a.gzhead.time>>16),Da(a,255&a.gzhead.time>>24),Da(a,9===a.level?2:a.strategy>=ld||2>a.level?4:0),Da(a,255&a.gzhead.os),a.gzhead.extra&&a.gzhead.extra.length&&(Da(a,255&a.gzhead.extra.length),Da(a,255&a.gzhead.extra.length>>8)),a.gzhead.hcrc&&(e.adler=Kl(e.adler,a.pending_buf,a.pending,0)),a.gzindex=0,a.status=kd):(Da(a,0),Da(a,0),Da(a,0),Da(a,0),Da(a,0),Da(a,9===a.level?2:a.strategy>=ld||2>a.level?4:0),Da(a,3),a.status=Md);else{var s=gd+(a.w_bits-8<<4)<<8,r=-1;r=a.strategy>=ld||2>a.level?0:6>a.level?1:6===a.level?2:3,s|=r<<6,0!==a.strstart&&(s|=32),s+=31-s%31,a.status=Md,ja(a,s),0!==a.strstart&&(ja(a,e.adler>>>16),ja(a,65535&e.adler)),e.adler=1}if(a.status===kd)if(a.gzhead.extra){for(n=a.pending;a.gzindex<(65535&a.gzhead.extra.length)&&!(a.pending===a.pending_buf_size&&(a.gzhead.hcrc&&a.pending>n&&(e.adler=Kl(e.adler,a.pending_buf,a.pending-n,n)),ka(e),n=a.pending,a.pending===a.pending_buf_size));)Da(a,255&a.gzhead.extra[a.gzindex]),a.gzindex++;a.gzhead.hcrc&&a.pending>n&&(e.adler=Kl(e.adler,a.pending_buf,a.pending-n,n)),a.gzindex===a.gzhead.extra.length&&(a.gzindex=0,a.status=vd)}else a.status=vd;if(a.status===vd)if(a.gzhead.name){n=a.pending;do{if(a.pending===a.pending_buf_size&&(a.gzhead.hcrc&&a.pending>n&&(e.adler=Kl(e.adler,a.pending_buf,a.pending-n,n)),ka(e),n=a.pending,a.pending===a.pending_buf_size)){o=1;break}o=a.gzindex<a.gzhead.name.length?255&a.gzhead.name.charCodeAt(a.gzindex++):0,Da(a,o)}while(0!==o);a.gzhead.hcrc&&a.pending>n&&(e.adler=Kl(e.adler,a.pending_buf,a.pending-n,n)),0===o&&(a.gzindex=0,a.status=Dd)}else a.status=Dd;if(a.status===Dd)if(a.gzhead.comment){n=a.pending;do{if(a.pending===a.pending_buf_size&&(a.gzhead.hcrc&&a.pending>n&&(e.adler=Kl(e.adler,a.pending_buf,a.pending-n,n)),ka(e),n=a.pending,a.pending===a.pending_buf_size)){o=1;break}o=a.gzindex<a.gzhead.comment.length?255&a.gzhead.comment.charCodeAt(a.gzindex++):0,Da(a,o)}while(0!==o);a.gzhead.hcrc&&a.pending>n&&(e.adler=Kl(e.adler,a.pending_buf,a.pending-n,n)),0===o&&(a.status=jd)}else a.status=jd;if(a.status===jd&&(a.gzhead.hcrc?(a.pending+2>a.pending_buf_size&&ka(e),a.pending+2<=a.pending_buf_size&&(Da(a,255&e.adler),Da(a,255&e.adler>>8),e.adler=0,a.status=Md)):a.status=Md),0!==a.pending){if(ka(e),0===e.avail_out)return a.last_flush=-1,id;}else if(0===e.avail_in&&xa(t)<=xa(i)&&t!==ed)return wa(e,od);if(a.status===Sd&&0!==e.avail_in)return wa(e,od);if(0!==e.avail_in||0!==a.lookahead||t!==$l&&a.status!==Sd){var l=a.strategy===ld?Aa(a,t):a.strategy===3?Ca(a,t):Ld[a.level].func(a,t);if((l===Bd||l===Cd)&&(a.status=Sd),l===Pd||l===Bd)return 0===e.avail_out&&(a.last_flush=-1),id;if(l===Id&&(t===1?Wl._tr_align(a):t!==td&&(Wl._tr_stored_block(a,0,0,!1),t===3&&(ya(a.head),0===a.lookahead&&(a.strstart=0,a.block_start=0,a.insert=0))),ka(e),0===e.avail_out))return a.last_flush=-1,id}return t===ed?0>=a.wrap?ad:(2===a.wrap?(Da(a,255&e.adler),Da(a,255&e.adler>>8),Da(a,255&e.adler>>16),Da(a,255&e.adler>>24),Da(a,255&e.total_in),Da(a,255&e.total_in>>8),Da(a,255&e.total_in>>16),Da(a,255&e.total_in>>24)):(ja(a,e.adler>>>16),ja(a,65535&e.adler)),ka(e),0<a.wrap&&(a.wrap=-a.wrap),0===a.pending?ad:id):id},deflateEnd:function(e){var t;return e&&e.state?(t=e.state.status,t!==yd&&t!==kd&&t!==vd&&t!==Dd&&t!==jd&&t!==Md&&t!==Sd)?wa(e,nd):(e.state=null,t===Md?wa(e,-3):id):nd},deflateSetDictionary:function(e,t){var i=t.length,a,o,s,n,r,l,d,h;if(!e||!e.state)return nd;if(a=e.state,n=a.wrap,2===n||1===n&&a.status!==yd||a.lookahead)return nd;for(1===n&&(e.adler=Zl(e.adler,t,i,0)),a.wrap=0,i>=a.w_size&&(0===n&&(ya(a.head),a.strstart=0,a.block_start=0,a.insert=0),h=new wl.Buf8(a.w_size),wl.arraySet(h,t,i-a.w_size,a.w_size,0),t=h,i=a.w_size),r=e.avail_in,l=e.next_in,d=e.input,e.avail_in=i,e.next_in=0,e.input=t,Pa(a);a.lookahead>=bd;){o=a.strstart,s=a.lookahead-(bd-1);do a.ins_h=(a.ins_h<<a.hash_shift^a.window[o+bd-1])&a.hash_mask,a.prev[o&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=o,o++;while(--s);a.strstart=o,a.lookahead=bd-1,Pa(a)}return a.strstart+=a.lookahead,a.block_start=a.strstart,a.insert=a.lookahead,a.lookahead=0,a.match_length=a.prev_length=bd-1,a.match_available=0,e.next_in=l,e.input=d,e.avail_in=r,a.wrap=n,id},deflateInfo:'pako deflate (from Nodeca project)'},Td=!0,Vd=!0;try{Qn.apply(null,[0])}catch(e){Td=!1}try{Qn.apply(null,new Uint8Array(1))}catch(e){Vd=!1}for(var Ud=new wl.Buf8(256),Fd=0;256>Fd;Fd++)Ud[Fd]=252<=Fd?6:248<=Fd?5:240<=Fd?4:224<=Fd?3:192<=Fd?2:1;Ud[254]=Ud[254]=1;var q={string2buf:function(e){var t=e.length,a=0,n,o,s,r,l;for(r=0;r<t;r++)o=e.charCodeAt(r),55296==(64512&o)&&r+1<t&&(s=e.charCodeAt(r+1),56320==(64512&s)&&(o=65536+(o-55296<<10)+(s-56320),r++)),a+=128>o?1:2048>o?2:65536>o?3:4;for(n=new wl.Buf8(a),l=0,r=0;l<a;r++)o=e.charCodeAt(r),55296==(64512&o)&&r+1<t&&(s=e.charCodeAt(r+1),56320==(64512&s)&&(o=65536+(o-55296<<10)+(s-56320),r++)),128>o?n[l++]=o:2048>o?(n[l++]=192|o>>>6,n[l++]=128|63&o):65536>o?(n[l++]=224|o>>>12,n[l++]=128|63&o>>>6,n[l++]=128|63&o):(n[l++]=240|o>>>18,n[l++]=128|63&o>>>12,n[l++]=128|63&o>>>6,n[l++]=128|63&o);return n},buf2binstring:function(e){return Ua(e,e.length)},binstring2buf:function(e){for(var t=new wl.Buf8(e.length),a=0,i=t.length;a<i;a++)t[a]=e.charCodeAt(a);return t},buf2string:function(e,t){var a=t||e.length,n=Array(2*a),o,i,s,r;for(i=0,o=0;o<a;){if(s=e[o++],128>s){n[i++]=s;continue}if(r=Ud[s],4<r){n[i++]=65533,o+=r-1;continue}for(s&=2===r?31:3===r?15:7;1<r&&o<a;)s=s<<6|63&e[o++],r--;if(1<r){n[i++]=65533;continue}65536>s?n[i++]=s:(s-=65536,n[i++]=55296|1023&s>>10,n[i++]=56320|1023&s)}return Ua(n,i)},utf8border:function(e,t){var i;for(t=t||e.length,t>e.length&&(t=e.length),i=t-1;0<=i&&128==(192&e[i]);)i--;return 0>i?t:0===i?t:i+Ud[e[i]]>t?i:t}},Yd=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg='',this.state=null,this.data_type=2,this.adler=0},Xd=Object.prototype.toString,qd=4,Od=0,Nd=1,Gd=2,Hd=-1,Wd=0,Zd=8;Fa.prototype.push=function(e,t){var i=this.strm,a=this.options.chunkSize,n,o;if(this.ended)return!1;o=t===~~t?t:!0===t?qd:0,i.input='string'==typeof e?q.string2buf(e):'[object ArrayBuffer]'===Xd.call(e)?new Uint8Array(e):e,i.next_in=0,i.avail_in=i.input.length;do{if(0===i.avail_out&&(i.output=new wl.Buf8(a),i.next_out=0,i.avail_out=a),n=Ed.deflate(i,o),n!==Nd&&n!==Od)return this.onEnd(n),this.ended=!0,!1;(0===i.avail_out||0===i.avail_in&&(o===qd||o===Gd))&&('string'===this.options.to?this.onData(q.buf2binstring(wl.shrinkBuf(i.output,i.next_out))):this.onData(wl.shrinkBuf(i.output,i.next_out)))}while((0<i.avail_in||0===i.avail_out)&&n!==Nd);return o===qd?(n=Ed.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===Od):o!==Gd||(this.onEnd(Od),i.avail_out=0,!0)},Fa.prototype.onData=function(e){this.chunks.push(e)},Fa.prototype.onEnd=function(e){e===Od&&('string'===this.options.to?this.result=this.chunks.join(''):this.result=wl.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Qd=30,Kd=function(e,t){var i,a,n,o,s,r,l,d,h,g,c,m,p,u,f,_,b,w,x,y,k,v,D,j,M;i=e.state,a=e.next_in,j=e.input,n=a+(e.avail_in-5),o=e.next_out,M=e.output,s=o-(t-e.avail_out),r=o+(e.avail_out-257),l=i.dmax,d=i.wsize,h=i.whave,g=i.wnext,c=i.window,m=i.hold,p=i.bits,u=i.lencode,f=i.distcode,_=(1<<i.lenbits)-1,b=(1<<i.distbits)-1;top:do{15>p&&(m+=j[a++]<<p,p+=8,m+=j[a++]<<p,p+=8),w=u[m&_];dolen:for(;;){if(x=w>>>24,m>>>=x,p-=x,x=255&w>>>16,0===x)M[o++]=65535&w;else if(16&x){y=65535&w,x&=15,x&&(p<x&&(m+=j[a++]<<p,p+=8),y+=m&(1<<x)-1,m>>>=x,p-=x),15>p&&(m+=j[a++]<<p,p+=8,m+=j[a++]<<p,p+=8),w=f[m&b];dodist:for(;;){if(x=w>>>24,m>>>=x,p-=x,x=255&w>>>16,16&x){if(k=65535&w,x&=15,p<x&&(m+=j[a++]<<p,p+=8,p<x&&(m+=j[a++]<<p,p+=8)),k+=m&(1<<x)-1,k>l){e.msg='invalid distance too far back',i.mode=Qd;break top}if(m>>>=x,p-=x,x=o-s,k>x){if(x=k-x,x>h&&i.sane){e.msg='invalid distance too far back',i.mode=Qd;break top}if(v=0,D=c,0===g){if(v+=d-x,x<y){y-=x;do M[o++]=c[v++];while(--x);v=o-k,D=M}}else if(g<x){if(v+=d+g-x,x-=g,x<y){y-=x;do M[o++]=c[v++];while(--x);if(v=0,g<y){x=g,y-=x;do M[o++]=c[v++];while(--x);v=o-k,D=M}}}else if(v+=g-x,x<y){y-=x;do M[o++]=c[v++];while(--x);v=o-k,D=M}for(;2<y;)M[o++]=D[v++],M[o++]=D[v++],M[o++]=D[v++],y-=3;y&&(M[o++]=D[v++],1<y&&(M[o++]=D[v++]))}else{v=o-k;do M[o++]=M[v++],M[o++]=M[v++],M[o++]=M[v++],y-=3;while(2<y);y&&(M[o++]=M[v++],1<y&&(M[o++]=M[v++]))}}else if(0==(64&x)){w=f[(65535&w)+(m&(1<<x)-1)];continue dodist}else{e.msg='invalid distance code',i.mode=Qd;break top}break}}else if(0==(64&x)){w=u[(65535&w)+(m&(1<<x)-1)];continue dolen}else if(32&x){i.mode=12;break top}else{e.msg='invalid literal/length code',i.mode=Qd;break top}break}}while(a<n&&o<r);return y=p>>3,a-=y,p-=y<<3,m&=(1<<p)-1,e.next_in=a,e.next_out=o,e.avail_in=a<n?5+(n-a):5-(a-n),e.avail_out=o<r?257+(r-o):257-(o-r),i.hold=m,void(i.bits=p)},Jd=15,$d=852,eh=592,th=0,ih=1,ah=2,nh=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],oh=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],sh=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],rh=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64],lh=function(e,t,i,a,n,o,s,r){var l=r.bits,d=0,h=0,g=0,c=0,m=0,p=0,u=0,f=0,_=0,b=0,w=null,x=0,y=new wl.Buf16(Jd+1),k=new wl.Buf16(Jd+1),v=null,D=0,j,M,S,P,I,B,C,A,R;for(d=0;d<=Jd;d++)y[d]=0;for(h=0;h<a;h++)y[t[i+h]]++;for(m=l,c=Jd;1<=c&&0===y[c];c--);if(m>c&&(m=c),0==c)return n[o++]=20971520,n[o++]=20971520,r.bits=1,0;for(g=1;g<c&&0===y[g];g++);for(m<g&&(m=g),f=1,d=1;d<=Jd;d++)if(f<<=1,f-=y[d],0>f)return-1;if(0<f&&(e===th||1!=c))return-1;for(k[1]=0,d=1;d<Jd;d++)k[d+1]=k[d]+y[d];for(h=0;h<a;h++)0!==t[i+h]&&(s[k[t[i+h]]++]=h);if(e===th?(w=v=s,B=19):e===ih?(w=nh,x-=257,v=oh,D-=257,B=256):(w=sh,v=rh,B=-1),b=0,h=0,d=g,I=o,p=m,u=0,S=-1,_=1<<m,P=_-1,e===ih&&_>$d||e===ah&&_>eh)return 1;for(;;){C=d-u,s[h]<B?(A=0,R=s[h]):s[h]>B?(A=v[D+s[h]],R=w[x+s[h]]):(A=96,R=0),j=1<<d-u,M=1<<p,g=M;do M-=j,n[I+(b>>u)+M]=0|(C<<24|A<<16|R);while(0!==M);for(j=1<<d-1;b&j;)j>>=1;if(0===j?b=0:(b&=j-1,b+=j),h++,0==--y[d]){if(d==c)break;d=t[i+s[h]]}if(d>m&&(b&P)!==S){for(0==u&&(u=m),I+=g,p=d-u,f=1<<p;p+u<c&&(f-=y[p+u],!(0>=f));)p++,f<<=1;if(_+=1<<p,e===ih&&_>$d||e===ah&&_>eh)return 1;S=b&P,n[S]=0|(m<<24|p<<16|I-o)}}return 0!==b&&(n[I+b]=0|(4194304|d-u<<24)),r.bits=m,0},dh=1,hh=2,gh=4,ch=6,mh=0,ph=-2,uh=-3,fh=-4,_h=8,bh=1,wh=2,xh=3,yh=4,kh=5,vh=6,Dh=7,jh=8,Mh=9,Sh=10,Ph=11,Ih=12,Bh=13,Ch=14,Ah=15,Rh=16,zh=17,Lh=18,Eh=19,Th=20,Vh=21,Uh=22,Fh=23,Yh=24,Xh=25,qh=26,Oh=27,Nh=28,Gh=29,Hh=30,Wh=31,Zh=852,Qh=592,Kh=!0,Jh={inflateReset:Na,inflateReset2:Ga,inflateResetKeep:Oa,inflateInit:function(e){return Ha(e,15)},inflateInit2:Ha,inflate:function(e,t){var i=0,a=new wl.Buf8(4),o=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],s,r,l,d,h,g,c,m,p,u,f,_,b,w,x,y,k,v,D,j,M,S,P,I;if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return ph;s=e.state,s.mode===Ih&&(s.mode=Bh),h=e.next_out,l=e.output,c=e.avail_out,d=e.next_in,r=e.input,g=e.avail_in,m=s.hold,p=s.bits,u=g,f=c,S=mh;inf_leave:for(;;)switch(s.mode){case bh:if(0===s.wrap){s.mode=Bh;break}for(;16>p;){if(0===g)break inf_leave;g--,m+=r[d++]<<p,p+=8}if(2&s.wrap&&35615===m){s.check=0,a[0]=255&m,a[1]=255&m>>>8,s.check=Kl(s.check,a,2,0),m=0,p=0,s.mode=wh;break}if(s.flags=0,s.head&&(s.head.done=!1),!(1&s.wrap)||(((255&m)<<8)+(m>>8))%31){e.msg='incorrect header check',s.mode=Hh;break}if((15&m)!=_h){e.msg='unknown compression method',s.mode=Hh;break}if(m>>>=4,p-=4,M=(15&m)+8,0===s.wbits)s.wbits=M;else if(M>s.wbits){e.msg='invalid window size',s.mode=Hh;break}s.dmax=1<<M,e.adler=s.check=1,s.mode=512&m?Sh:Ih,m=0,p=0;break;case wh:for(;16>p;){if(0===g)break inf_leave;g--,m+=r[d++]<<p,p+=8}if(s.flags=m,(255&s.flags)!=_h){e.msg='unknown compression method',s.mode=Hh;break}if(57344&s.flags){e.msg='unknown header flags set',s.mode=Hh;break}s.head&&(s.head.text=1&m>>8),512&s.flags&&(a[0]=255&m,a[1]=255&m>>>8,s.check=Kl(s.check,a,2,0)),m=0,p=0,s.mode=xh;case xh:for(;32>p;){if(0===g)break inf_leave;g--,m+=r[d++]<<p,p+=8}s.head&&(s.head.time=m),512&s.flags&&(a[0]=255&m,a[1]=255&m>>>8,a[2]=255&m>>>16,a[3]=255&m>>>24,s.check=Kl(s.check,a,4,0)),m=0,p=0,s.mode=yh;case yh:for(;16>p;){if(0===g)break inf_leave;g--,m+=r[d++]<<p,p+=8}s.head&&(s.head.xflags=255&m,s.head.os=m>>8),512&s.flags&&(a[0]=255&m,a[1]=255&m>>>8,s.check=Kl(s.check,a,2,0)),m=0,p=0,s.mode=kh;case kh:if(1024&s.flags){for(;16>p;){if(0===g)break inf_leave;g--,m+=r[d++]<<p,p+=8}s.length=m,s.head&&(s.head.extra_len=m),512&s.flags&&(a[0]=255&m,a[1]=255&m>>>8,s.check=Kl(s.check,a,2,0)),m=0,p=0}else s.head&&(s.head.extra=null);s.mode=vh;case vh:if(1024&s.flags&&(_=s.length,_>g&&(_=g),_&&(s.head&&(M=s.head.extra_len-s.length,!s.head.extra&&(s.head.extra=Array(s.head.extra_len)),wl.arraySet(s.head.extra,r,d,_,M)),512&s.flags&&(s.check=Kl(s.check,r,_,d)),g-=_,d+=_,s.length-=_),s.length))break inf_leave;s.length=0,s.mode=Dh;case Dh:if(2048&s.flags){if(0===g)break inf_leave;_=0;do M=r[d+_++],s.head&&M&&65536>s.length&&(s.head.name+=Qn(M));while(M&&_<g);if(512&s.flags&&(s.check=Kl(s.check,r,_,d)),g-=_,d+=_,M)break inf_leave}else s.head&&(s.head.name=null);s.length=0,s.mode=jh;case jh:if(4096&s.flags){if(0===g)break inf_leave;_=0;do M=r[d+_++],s.head&&M&&65536>s.length&&(s.head.comment+=Qn(M));while(M&&_<g);if(512&s.flags&&(s.check=Kl(s.check,r,_,d)),g-=_,d+=_,M)break inf_leave}else s.head&&(s.head.comment=null);s.mode=Mh;case Mh:if(512&s.flags){for(;16>p;){if(0===g)break inf_leave;g--,m+=r[d++]<<p,p+=8}if(m!==(65535&s.check)){e.msg='header crc mismatch',s.mode=Hh;break}m=0,p=0}s.head&&(s.head.hcrc=1&s.flags>>9,s.head.done=!0),e.adler=s.check=0,s.mode=Ih;break;case Sh:for(;32>p;){if(0===g)break inf_leave;g--,m+=r[d++]<<p,p+=8}e.adler=s.check=Xa(m),m=0,p=0,s.mode=Ph;case Ph:if(0===s.havedict)return e.next_out=h,e.avail_out=c,e.next_in=d,e.avail_in=g,s.hold=m,s.bits=p,2;e.adler=s.check=1,s.mode=Ih;case Ih:if(t===5||t===ch)break inf_leave;case Bh:if(s.last){m>>>=7&p,p-=7&p,s.mode=Oh;break}for(;3>p;){if(0===g)break inf_leave;g--,m+=r[d++]<<p,p+=8}switch(s.last=1&m,m>>>=1,p-=1,3&m){case 0:s.mode=Ch;break;case 1:if(Wa(s),s.mode=Th,t===ch){m>>>=2,p-=2;break inf_leave}break;case 2:s.mode=zh;break;case 3:e.msg='invalid block type',s.mode=Hh;}m>>>=2,p-=2;break;case Ch:for(m>>>=7&p,p-=7&p;32>p;){if(0===g)break inf_leave;g--,m+=r[d++]<<p,p+=8}if((65535&m)!=(65535^m>>>16)){e.msg='invalid stored block lengths',s.mode=Hh;break}if(s.length=65535&m,m=0,p=0,s.mode=Ah,t===ch)break inf_leave;case Ah:s.mode=Rh;case Rh:if(_=s.length,_){if(_>g&&(_=g),_>c&&(_=c),0===_)break inf_leave;wl.arraySet(l,r,d,_,h),g-=_,d+=_,c-=_,h+=_,s.length-=_;break}s.mode=Ih;break;case zh:for(;14>p;){if(0===g)break inf_leave;g--,m+=r[d++]<<p,p+=8}if(s.nlen=(31&m)+257,m>>>=5,p-=5,s.ndist=(31&m)+1,m>>>=5,p-=5,s.ncode=(15&m)+4,m>>>=4,p-=4,286<s.nlen||30<s.ndist){e.msg='too many length or distance symbols',s.mode=Hh;break}s.have=0,s.mode=Lh;case Lh:for(;s.have<s.ncode;){for(;3>p;){if(0===g)break inf_leave;g--,m+=r[d++]<<p,p+=8}s.lens[o[s.have++]]=7&m,m>>>=3,p-=3}for(;19>s.have;)s.lens[o[s.have++]]=0;if(s.lencode=s.lendyn,s.lenbits=7,P={bits:s.lenbits},S=lh(0,s.lens,0,19,s.lencode,0,s.work,P),s.lenbits=P.bits,S){e.msg='invalid code lengths set',s.mode=Hh;break}s.have=0,s.mode=Eh;case Eh:for(;s.have<s.nlen+s.ndist;){for(;;){if(i=s.lencode[m&(1<<s.lenbits)-1],x=i>>>24,y=255&i>>>16,k=65535&i,x<=p)break;if(0===g)break inf_leave;g--,m+=r[d++]<<p,p+=8}if(16>k)m>>>=x,p-=x,s.lens[s.have++]=k;else{if(16===k){for(I=x+2;p<I;){if(0===g)break inf_leave;g--,m+=r[d++]<<p,p+=8}if(m>>>=x,p-=x,0===s.have){e.msg='invalid bit length repeat',s.mode=Hh;break}M=s.lens[s.have-1],_=3+(3&m),m>>>=2,p-=2}else if(17===k){for(I=x+3;p<I;){if(0===g)break inf_leave;g--,m+=r[d++]<<p,p+=8}m>>>=x,p-=x,M=0,_=3+(7&m),m>>>=3,p-=3}else{for(I=x+7;p<I;){if(0===g)break inf_leave;g--,m+=r[d++]<<p,p+=8}m>>>=x,p-=x,M=0,_=11+(127&m),m>>>=7,p-=7}if(s.have+_>s.nlen+s.ndist){e.msg='invalid bit length repeat',s.mode=Hh;break}for(;_--;)s.lens[s.have++]=M}}if(s.mode===Hh)break;if(0===s.lens[256]){e.msg='invalid code -- missing end-of-block',s.mode=Hh;break}if(s.lenbits=9,P={bits:s.lenbits},S=lh(dh,s.lens,0,s.nlen,s.lencode,0,s.work,P),s.lenbits=P.bits,S){e.msg='invalid literal/lengths set',s.mode=Hh;break}if(s.distbits=6,s.distcode=s.distdyn,P={bits:s.distbits},S=lh(hh,s.lens,s.nlen,s.ndist,s.distcode,0,s.work,P),s.distbits=P.bits,S){e.msg='invalid distances set',s.mode=Hh;break}if(s.mode=Th,t===ch)break inf_leave;case Th:s.mode=Vh;case Vh:if(6<=g&&258<=c){e.next_out=h,e.avail_out=c,e.next_in=d,e.avail_in=g,s.hold=m,s.bits=p,Kd(e,f),h=e.next_out,l=e.output,c=e.avail_out,d=e.next_in,r=e.input,g=e.avail_in,m=s.hold,p=s.bits,s.mode===Ih&&(s.back=-1);break}for(s.back=0;;){if(i=s.lencode[m&(1<<s.lenbits)-1],x=i>>>24,y=255&i>>>16,k=65535&i,x<=p)break;if(0===g)break inf_leave;g--,m+=r[d++]<<p,p+=8}if(y&&0==(240&y)){for(v=x,D=y,j=k;;){if(i=s.lencode[j+((m&(1<<v+D)-1)>>v)],x=i>>>24,y=255&i>>>16,k=65535&i,v+x<=p)break;if(0===g)break inf_leave;g--,m+=r[d++]<<p,p+=8}m>>>=v,p-=v,s.back+=v}if(m>>>=x,p-=x,s.back+=x,s.length=k,0===y){s.mode=qh;break}if(32&y){s.back=-1,s.mode=Ih;break}if(64&y){e.msg='invalid literal/length code',s.mode=Hh;break}s.extra=15&y,s.mode=Uh;case Uh:if(s.extra){for(I=s.extra;p<I;){if(0===g)break inf_leave;g--,m+=r[d++]<<p,p+=8}s.length+=m&(1<<s.extra)-1,m>>>=s.extra,p-=s.extra,s.back+=s.extra}s.was=s.length,s.mode=Fh;case Fh:for(;;){if(i=s.distcode[m&(1<<s.distbits)-1],x=i>>>24,y=255&i>>>16,k=65535&i,x<=p)break;if(0===g)break inf_leave;g--,m+=r[d++]<<p,p+=8}if(0==(240&y)){for(v=x,D=y,j=k;;){if(i=s.distcode[j+((m&(1<<v+D)-1)>>v)],x=i>>>24,y=255&i>>>16,k=65535&i,v+x<=p)break;if(0===g)break inf_leave;g--,m+=r[d++]<<p,p+=8}m>>>=v,p-=v,s.back+=v}if(m>>>=x,p-=x,s.back+=x,64&y){e.msg='invalid distance code',s.mode=Hh;break}s.offset=k,s.extra=15&y,s.mode=Yh;case Yh:if(s.extra){for(I=s.extra;p<I;){if(0===g)break inf_leave;g--,m+=r[d++]<<p,p+=8}s.offset+=m&(1<<s.extra)-1,m>>>=s.extra,p-=s.extra,s.back+=s.extra}if(s.offset>s.dmax){e.msg='invalid distance too far back',s.mode=Hh;break}s.mode=Xh;case Xh:if(0===c)break inf_leave;if(_=f-c,s.offset>_){if(_=s.offset-_,_>s.whave&&s.sane){e.msg='invalid distance too far back',s.mode=Hh;break}_>s.wnext?(_-=s.wnext,b=s.wsize-_):b=s.wnext-_,_>s.length&&(_=s.length),w=s.window}else w=l,b=h-s.offset,_=s.length;_>c&&(_=c),c-=_,s.length-=_;do l[h++]=w[b++];while(--_);0===s.length&&(s.mode=Vh);break;case qh:if(0===c)break inf_leave;l[h++]=s.length,c--,s.mode=Vh;break;case Oh:if(s.wrap){for(;32>p;){if(0===g)break inf_leave;g--,m|=r[d++]<<p,p+=8}if(f-=c,e.total_out+=f,s.total+=f,f&&(e.adler=s.check=s.flags?Kl(s.check,l,f,h-f):Zl(s.check,l,f,h-f)),f=c,(s.flags?m:Xa(m))!==s.check){e.msg='incorrect data check',s.mode=Hh;break}m=0,p=0}s.mode=Nh;case Nh:if(s.wrap&&s.flags){for(;32>p;){if(0===g)break inf_leave;g--,m+=r[d++]<<p,p+=8}if(m!==(4294967295&s.total)){e.msg='incorrect length check',s.mode=Hh;break}m=0,p=0}s.mode=Gh;case Gh:S=1;break inf_leave;case Hh:S=uh;break inf_leave;case Wh:return fh;case 32:default:return ph;}return(e.next_out=h,e.avail_out=c,e.next_in=d,e.avail_in=g,s.hold=m,s.bits=p,(s.wsize||f!==e.avail_out&&s.mode<Hh&&(s.mode<Oh||t!==gh))&&Za(e,e.output,e.next_out,f-e.avail_out))?(s.mode=Wh,fh):(u-=e.avail_in,f-=e.avail_out,e.total_in+=u,e.total_out+=f,s.total+=f,s.wrap&&f&&(e.adler=s.check=s.flags?Kl(s.check,l,f,e.next_out-f):Zl(s.check,l,f,e.next_out-f)),e.data_type=s.bits+(s.last?64:0)+(s.mode===Ih?128:0)+(s.mode===Th||s.mode===Ah?256:0),(0===u&&0===f||t===gh)&&S===mh&&(S=-5),S)},inflateEnd:function(e){if(!e||!e.state)return ph;var t=e.state;return t.window&&(t.window=null),e.state=null,mh},inflateGetHeader:function(e,t){var i;return e&&e.state?(i=e.state,0==(2&i.wrap))?ph:(i.head=t,t.done=!1,mh):ph},inflateSetDictionary:function(e,t){var i=t.length,a,n,o;return e&&e.state?(a=e.state,0!==a.wrap&&a.mode!==Ph)?ph:a.mode===Ph&&(n=1,n=Zl(n,t,i,0),n!==a.check)?uh:(o=Za(e,t,i,i),o)?(a.mode=Wh,fh):(a.havedict=1,mh):ph},inflateInfo:'pako inflate (from Nodeca project)'},$h={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},eg=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name='',this.comment='',this.hcrc=0,this.done=!1},tg=Object.prototype.toString,ig,ag;Qa.prototype.push=function(e,t){var i=this.strm,a=this.options.chunkSize,n=this.options.dictionary,o=!1,s,r,l,d,h,g;if(this.ended)return!1;r=t===~~t?t:!0===t?$h.Z_FINISH:$h.Z_NO_FLUSH,i.input='string'==typeof e?q.binstring2buf(e):'[object ArrayBuffer]'===tg.call(e)?new Uint8Array(e):e,i.next_in=0,i.avail_in=i.input.length;do{if(0===i.avail_out&&(i.output=new wl.Buf8(a),i.next_out=0,i.avail_out=a),s=Jh.inflate(i,$h.Z_NO_FLUSH),s===$h.Z_NEED_DICT&&n&&(g='string'==typeof n?q.string2buf(n):'[object ArrayBuffer]'===tg.call(n)?new Uint8Array(n):n,s=Jh.inflateSetDictionary(this.strm,g)),s===$h.Z_BUF_ERROR&&!0==o&&(s=$h.Z_OK,o=!1),s!==$h.Z_STREAM_END&&s!==$h.Z_OK)return this.onEnd(s),this.ended=!0,!1;i.next_out&&(0===i.avail_out||s===$h.Z_STREAM_END||0===i.avail_in&&(r===$h.Z_FINISH||r===$h.Z_SYNC_FLUSH))&&('string'===this.options.to?(l=q.utf8border(i.output,i.next_out),d=i.next_out-l,h=q.buf2string(i.output,l),i.next_out=d,i.avail_out=a-d,d&&wl.arraySet(i.output,i.output,l,d,0),this.onData(h)):this.onData(wl.shrinkBuf(i.output,i.next_out))),0===i.avail_in&&0===i.avail_out&&(o=!0)}while((0<i.avail_in||0===i.avail_out)&&s!==$h.Z_STREAM_END);return s===$h.Z_STREAM_END&&(r=$h.Z_FINISH),r===$h.Z_FINISH?(s=Jh.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,s===$h.Z_OK):r!==$h.Z_SYNC_FLUSH||(this.onEnd($h.Z_OK),i.avail_out=0,!0)},Qa.prototype.onData=function(e){this.chunks.push(e)},Qa.prototype.onEnd=function(e){e===$h.Z_OK&&('string'===this.options.to?this.result=this.chunks.join(''):this.result=wl.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var ng=wl.assign,og={};ng(og,{Deflate:Fa,deflate:Ya,deflateRaw:function(e,t){return t=t||{},t.raw=!0,Ya(e,t)},gzip:function(e,t){return t=t||{},t.gzip=!0,Ya(e,t)}},{Inflate:Qa,inflate:Ka,inflateRaw:function(e,t){return t=t||{},t.raw=!0,Ka(e,t)},ungzip:Ka},$h);const sg=og.Inflate,rg=new Uint8Array(0),lg=[137,80,78,71,13,10,26,10];var dg=class extends bl{constructor(e){super(e),this._decoded=!1,this._inflator=new sg,this._png=null,this._end=!1,this.setBigEndian()}decode(){if(this._decoded)return this._png;for(this._png={tEXt:{}},this.decodeSignature();!this._end;)this.decodeChunk();return this.decodeImage(),this._png}decodeSignature(){for(var e=0;8>e;e++)if(this.readUint8()!==lg[e])throw new Error(`Wrong PNG signature. Byte at ${e} should be ${lg[e]}.`)}decodeChunk(){var e=this.readUint32(),t=this.readChars(4),i=this.offset;if('IHDR'===t?this.decodeIHDR():'PLTE'===t?this.decodePLTE(e):'IDAT'===t?this.decodeIDAT(e):'tEXt'===t?this.decodetEXt(e):'IEND'===t?this._end=!0:this.skip(e),this.offset-i!==e)throw new Error('Length mismatch while decoding chunk '+t);this.readUint32()}decodeIHDR(){var e=this._png;if(e.width=this.readUint32(),e.height=this.readUint32(),e.bitDepth=this.readUint8(),e.colourType=this.readUint8(),e.compressionMethod=this.readUint8(),e.filterMethod=this.readUint8(),e.interlaceMethod=this.readUint8(),0!==this._png.compressionMethod)throw new Error('Unsupported compression method: '+e.compressionMethod)}decodePLTE(e){if(0!=e%3)throw new RangeError('PLTE field length must be a multiple of 3. Got '+e);var t=e/3;this._hasPalette=!0;for(var a=this._palette=Array(t),n=0;n<t;n++)a[n]=[this.readUint8(),this.readUint8(),this.readUint8()]}decodeIDAT(e){this._inflator.push(new Uint8Array(this.buffer,this.offset,e)),this.skip(e)}decodetEXt(e){for(var t='',i;(i=this.readChar())!=='\0';)t+=i;this._png.tEXt[t]=this.readChars(e-t.length-1)}decodeImage(){if(this._inflator.push(rg,!0),this._inflator.err)throw new Error('Error while decompressing the data');var e=this._inflator.result;if(this._inflator=null,0!==this._png.filterMethod)throw new Error('Filter method '+this._png.filterMethod+' not supported');if(0===this._png.interlaceMethod)this.decodeInterlaceNull(e);else throw new Error('Interlace method '+this._png.interlaceMethod+' not supported')}decodeInterlaceNull(e){var t;switch(this._png.colourType){case 0:t=1;break;case 2:t=3;break;case 3:if(!this._hasPalette)throw new Error('Missing palette');t=1;break;case 4:t=2;break;case 6:t=4;break;default:throw new Error('Unknown colour type: '+this._png.colourType);}const a=this._png.height,n=t*this._png.bitDepth/8,o=this._png.width*n,s=new Uint8Array(this._png.height*o);for(var r=rg,l=0,d=0,i,h;d<a;d++){switch(i=e.subarray(l+1,l+1+o),h=s.subarray(d*o,(d+1)*o),e[l]){case 0:Ja(i,h,o);break;case 1:$a(i,h,o,n);break;case 2:en(i,h,r,o);break;case 3:tn(i,h,r,o,n);break;case 4:an(i,h,r,o,n);break;default:throw new Error('Unsupported filter: '+e[l]);}r=h,l+=o+1}this._hasPalette&&(this._png.palette=this._palette),this._png.data=s}};const hg={254:'NewSubfileType',255:'SubfileType',256:'ImageWidth',257:'ImageLength',258:'BitsPerSample',259:'Compression',262:'PhotometricInterpretation',263:'Threshholding',264:'CellWidth',265:'CellLength',266:'FillOrder',269:'DocumentName',270:'ImageDescription',271:'Make',272:'Model',273:'StripOffsets',274:'Orientation',277:'SamplesPerPixel',278:'RowsPerStrip',279:'StripByteCounts',280:'MinSampleValue',281:'MaxSampleValue',282:'XResolution',283:'YResolution',284:'PlanarConfiguration',285:'PageName',286:'XPosition',287:'YPosition',288:'FreeOffsets',289:'FreeByteCounts',290:'GrayResponseUnit',291:'GrayResponseCurve',292:'T4Options',293:'T6Options',296:'ResolutionUnit',297:'PageNumber',301:'TransferFunction',305:'Software',306:'DateTime',315:'Artist',316:'HostComputer',317:'Predictor',318:'WhitePoint',319:'PrimaryChromaticities',320:'ColorMap',321:'HalftoneHints',322:'TileWidth',323:'TileLength',324:'TileOffsets',325:'TileByteCounts',326:'BadFaxLines',327:'CleanFaxData',328:'ConsecutiveBadFaxLines',330:'SubIFDs',332:'InkSet',333:'InkNames',334:'NumberOfInks',336:'DotRange',337:'TargetPrinter',338:'ExtraSamples',339:'SampleFormat',340:'SMinSampleValue',341:'SMaxSampleValue',342:'TransferRange',343:'ClipPath',344:'XClipPathUnits',345:'YClipPathUnits',346:'Indexed',347:'JPEGTables',351:'OPIProxy',400:'GlobalParametersIFD',401:'ProfileType',402:'FaxProfile',403:'CodingMethods',404:'VersionYear',405:'ModeNumber',433:'Decode',434:'DefaultImageColor',512:'JPEGProc',513:'JPEGInterchangeFormat',514:'JPEGInterchangeFormatLength',515:'JPEGRestartInterval',517:'JPEGLosslessPredictors',518:'JPEGPointTransforms',519:'JPEGQTables',520:'JPEGDCTables',521:'JPEGACTables',529:'YCbCrCoefficients',530:'YCbCrSubSampling',531:'YCbCrPositioning',532:'ReferenceBlackWhite',559:'StripRowCounts',700:'XMP',32781:'ImageID',32932:'WangAnnotatio',33432:'Copyright',33445:'MDFileTag',33446:'MDScalePixel',33447:'MDColorTable',33448:'MDLabName',33449:'MDSampleInfo',33450:'MDPrepDate',33451:'MDPrepTime',33452:'MDFileUnits',33550:'ModelPixelScaleTag',33723:'IPTC',33918:'INGRPacketDataTag',33919:'INGRFlagRegisters',33920:'IrasBTransformationMatrix',33922:'ModelTiepointTag',34264:'ModelTransformationTag',34377:'Photoshop',34665:'ExifIFD',34675:'ICCProfile',34732:'ImageLayer',34735:'GeoKeyDirectoryTag',34736:'GeoDoubleParamsTag',34737:'GeoAsciiParamsTag',34853:'GPSIFD',34908:'HylaFAXFaxRecvParams',34909:'HylaFAXFaxSubAddress',34910:'HylaFAXFaxRecvTime',37724:'ImageSourceData',40965:'InteroperabilityIFD',42112:'GDAL_METADATA',42113:'GDAL_NODATA',50215:'OceScanjobDescription',50216:'OceApplicationSelector',50217:'OceIdentificationNumber',50218:'OceImageLogicCharacteristics',50706:'DNGVersion',50707:'DNGBackwardVersion',50708:'UniqueCameraModel',50709:'LocalizedCameraModel',50710:'CFAPlaneColor',50711:'CFALayout',50712:'LinearizationTable',50713:'BlackLevelRepeatDim',50714:'BlackLevel',50715:'BlackLevelDeltaH',50716:'BlackLevelDeltaV',50717:'WhiteLevel',50718:'DefaultScale',50719:'DefaultCropOrigin',50720:'DefaultCropSize',50721:'ColorMatrix1',50722:'ColorMatrix2',50723:'CameraCalibration1',50724:'CameraCalibration2',50725:'ReductionMatrix1',50726:'ReductionMatrix2',50727:'AnalogBalance',50728:'AsShotNeutral',50729:'AsShotWhiteXY',50730:'BaselineExposure',50731:'BaselineNoise',50732:'BaselineSharpness',50733:'BayerGreenSplit',50734:'LinearResponseLimit',50735:'CameraSerialNumber',50736:'LensInfo',50737:'ChromaBlurRadius',50738:'AntiAliasStrength',50740:'DNGPrivateData',50741:'MakerNoteSafety',50778:'CalibrationIlluminant1',50779:'CalibrationIlluminant2',50780:'BestQualityScale',50784:'AliasLayerMetadata'},gg={};for(var cg in hg)gg[hg[cg]]=cg;const i={33434:'ExposureTime',33437:'FNumber',34850:'ExposureProgram',34852:'SpectralSensitivity',34855:'ISOSpeedRatings',34856:'OECF',34864:'SensitivityType',34865:'StandardOutputSensitivity',34866:'RecommendedExposureIndex',34867:'ISOSpeed',34868:'ISOSpeedLatitudeyyy',34869:'ISOSpeedLatitudezzz',36864:'ExifVersion',36867:'DateTimeOriginal',36868:'DateTimeDigitized',37121:'ComponentsConfiguration',37122:'CompressedBitsPerPixel',37377:'ShutterSpeedValue',37378:'ApertureValue',37379:'BrightnessValue',37380:'ExposureBiasValue',37381:'MaxApertureValue',37382:'SubjectDistance',37383:'MeteringMode',37384:'LightSource',37385:'Flash',37386:'FocalLength',37396:'SubjectArea',37500:'MakerNote',37510:'UserComment',37520:'SubsecTime',37521:'SubsecTimeOriginal',37522:'SubsecTimeDigitized',40960:'FlashpixVersion',40961:'ColorSpace',40962:'PixelXDimension',40963:'PixelYDimension',40964:'RelatedSoundFile',41483:'FlashEnergy',41484:'SpatialFrequencyResponse',41486:'FocalPlaneXResolution',41487:'FocalPlaneYResolution',41488:'FocalPlaneResolutionUnit',41492:'SubjectLocation',41493:'ExposureIndex',41495:'SensingMethod',41728:'FileSource',41729:'SceneType',41730:'CFAPattern',41985:'CustomRendered',41986:'ExposureMode',41987:'WhiteBalance',41988:'DigitalZoomRatio',41989:'FocalLengthIn35mmFilm',41990:'SceneCaptureType',41991:'GainControl',41992:'Contrast',41993:'Saturation',41994:'Sharpness',41995:'DeviceSettingDescription',41996:'SubjectDistanceRange',42016:'ImageUniqueID',42032:'CameraOwnerName',42033:'BodySerialNumber',42034:'LensSpecification',42035:'LensMake',42036:'LensModel',42037:'LensSerialNumber',42240:'Gamma'},mg={};for(var pg in i)mg[i[pg]]=pg;const ug={0:'GPSVersionID',1:'GPSLatitudeRef',2:'GPSLatitude',3:'GPSLongitudeRef',4:'GPSLongitude',5:'GPSAltitudeRef',6:'GPSAltitude',7:'GPSTimeStamp',8:'GPSSatellites',9:'GPSStatus',10:'GPSMeasureMode',11:'GPSDOP',12:'GPSSpeedRef',13:'GPSSpeed',14:'GPSTrackRef',15:'GPSTrack',16:'GPSImgDirectionRef',17:'GPSImgDirection',18:'GPSMapDatum',19:'GPSDestLatitudeRef',20:'GPSDestLatitude',21:'GPSDestLongitudeRef',22:'GPSDestLongitude',23:'GPSDestBearingRef',24:'GPSDestBearing',25:'GPSDestDistanceRef',26:'GPSDestDistance',27:'GPSProcessingMethod',28:'GPSAreaInformation',29:'GPSDateStamp',30:'GPSDifferential',31:'GPSHPositioningError'},fg={};for(var _g in ug)fg[ug[_g]]=_g;const bg={standard:{tagsById:hg,tagsByName:gg},exif:{tagsById:i,tagsByName:mg},gps:{tagsById:ug,tagsByName:fg}};class wg{constructor(e){if(!e)throw new Error('missing kind');this.data=null,this.fields=new Map,this.kind=e,this._map=null}get(e){if('number'==typeof e)return this.fields.get(e);if('string'==typeof e)return this.fields.get(bg[this.kind].tagsByName[e]);throw new Error('expected a number or string')}get map(){if(!this._map){this._map={};const t=bg[this.kind].tagsById;for(var e of this.fields.keys())t[e]&&(this._map[t[e]]=this.fields.get(e))}return this._map}}var xg=wg;const yg=/^(\d{4}):(\d{2}):(\d{2}) (\d{2}):(\d{2}):(\d{2})$/;class kg extends xg{constructor(){super('standard')}get size(){return this.width*this.height}get width(){return this.imageWidth}get height(){return this.imageLength}get components(){return this.samplesPerPixel}get date(){var e=new Date,t=yg.exec(this.dateTime);return e.setFullYear(t[1],t[2]-1,t[3]),e.setHours(t[4],t[5],t[6]),e}get newSubfileType(){return this.get(254)}get imageWidth(){return this.get(256)}get imageLength(){return this.get(257)}get bitsPerSample(){return this.get(258)}get compression(){return this.get(259)||1}get type(){return this.get(262)}get fillOrder(){return this.get(266)||1}get documentName(){return this.get(269)}get imageDescription(){return this.get(270)}get stripOffsets(){return on(this.get(273))}get orientation(){return this.get(274)}get samplesPerPixel(){return this.get(277)}get rowsPerStrip(){return this.get(278)}get stripByteCounts(){return on(this.get(279))}get minSampleValue(){return this.get(280)||0}get maxSampleValue(){return this.get(281)||no(2,this.bitsPerSample)-1}get xResolution(){return this.get(282)}get yResolution(){return this.get(283)}get planarConfiguration(){return this.get(284)||1}get resolutionUnit(){return this.get(296)||2}get dateTime(){return this.get(306)}get predictor(){return this.get(317)||1}get sampleFormat(){return this.get(339)||1}get sMinSampleValue(){return this.get(340)||this.minSampleValue}get sMaxSampleValue(){return this.get(341)||this.maxSampleValue}}var vg=new Map([[1,[1,sn]],[2,[1,function(e,t){for(var a=[],n='',o=0,i;o<t;o++)i=Qn(e.readUint8()),'\0'===i?(a.push(n),n=''):n+=i;return 1===a.length?a[0]:a}]],[3,[2,function(e,t){if(1===t)return e.readUint16();for(var a=new Uint16Array(t),n=0;n<t;n++)a[n]=e.readUint16();return a}]],[4,[4,function(e,t){if(1===t)return e.readUint32();for(var a=new Uint32Array(t),n=0;n<t;n++)a[n]=e.readUint32();return a}]],[5,[8,function(e,t){if(1===t)return e.readUint32()/e.readUint32();for(var a=Array(t),n=0;n<t;n++)a[n]=e.readUint32()/e.readUint32();return a}]],[6,[1,function(e,t){if(1===t)return e.readInt8();for(var a=new Int8Array(t),n=0;n<t;n++)a[n]=e.readInt8();return a}]],[7,[1,sn]],[8,[2,function(e,t){if(1===t)return e.readInt16();for(var a=new Int16Array(t),n=0;n<t;n++)a[n]=e.readInt16();return a}]],[9,[4,function(e,t){if(1===t)return e.readInt32();for(var a=new Int32Array(t),n=0;n<t;n++)a[n]=e.readInt32();return a}]],[10,[8,function(e,t){if(1===t)return e.readInt32()/e.readInt32();for(var a=Array(t),n=0;n<t;n++)a[n]=e.readInt32()/e.readInt32();return a}]],[11,[4,function(e,t){if(1===t)return e.readFloat32();for(var a=new Float32Array(t),n=0;n<t;n++)a[n]=e.readFloat32();return a}]],[12,[8,function(e,t){if(1===t)return e.readFloat64();for(var a=new Float64Array(t),n=0;n<t;n++)a[n]=e.readFloat64();return a}]]]),Dg={getByteLength:function(e,t){return vg.get(e)[0]*t},readData:function(e,t,i){return vg.get(t)[1](e,i)}};const jg={ignoreImageData:!1,onlyFirst:!1};var Mg=class extends bl{constructor(e,t){super(e,t),this._nextIFD=0}decode(e){e=Object.assign({},jg,e);const t=[];for(this.decodeHeader();this._nextIFD;)if(t.push(this.decodeIFD(e)),e.onlyFirst)return t[0];return t}decodeHeader(){let e=this.readUint16();if(18761===e)this.setLittleEndian();else if(19789===e)this.setBigEndian();else throw new Error('invalid byte order: 0x'+e.toString(16));if(e=this.readUint16(),42!==e)throw new Error('not a TIFF file');this._nextIFD=this.readUint32()}decodeIFD(e){this.seek(this._nextIFD);var t=e.kind?new xg(e.kind):new kg;const a=this.readUint16();for(var n=0;n<a;n++)this.decodeIFDEntry(t);return e.ignoreImageData||this.decodeImageData(t),this._nextIFD=this.readUint32(),t}decodeIFDEntry(e){const t=this.offset,i=this.readUint16(),a=this.readUint16(),n=this.readUint32();if(1>a||12<a)return void this.skip(4);const o=Dg.getByteLength(a,n);4<o&&this.seek(this.readUint32());const s=Dg.readData(this,a,n);if(e.fields.set(i,s),34665===i||34853===i){let t=this.offset,a;34665===i?a='exif':34853===i&&(a='gps'),this._nextIFD=s,e[a]=this.decodeIFD({kind:a,ignoreImageData:!0}),this.offset=t}this.seek(t),this.skip(12)}decodeImageData(e){const t=e.orientation;switch(t&&1!==t&&gn('orientation',t),e.type){case 1:case 2:this.readStripData(e);break;default:gn('image type',e.type);}}readStripData(e){const t=e.width,a=e.height,n=cn(e.bitsPerSample),o=e.sampleFormat;let s=t*a;const r=rn(s,1,n,o),l=e.compression,d=e.rowsPerStrip,h=d*t,g=e.stripOffsets,c=e.stripByteCounts;for(var m=0,p=0;p<g.length;p++){var i=this.getStripData(l,g[p],c[p]),u=s>h?h:s;s-=u,8===n?m=ln(r,i,m,u):16===n?m=dn(r,i,m,u,this.isLittleEndian()):32===n&&3===o?m=hn(r,i,m,u,this.isLittleEndian()):gn('bitDepth',n)}e.data=r}getStripData(e,t,i){switch(e){case 1:return new DataView(this.buffer,t,i);case 2:case 32773:return gn('Compression',e);default:throw new Error('invalid compression: '+e);}}},Sg=function(e,t){const i=new Mg(e,t);return i.decode(t)},Pg={decode:Sg},Ig=function(e){const t=new bl(e),i={};t.setBigEndian();const a=t.readUint16();if(65496!==a)throw new Error('SOI marker not found. Not a valid JPEG file');const n=t.readUint16();if(65505===n){const e=t.readUint16(),a=t.readBytes(6);if(69===a[0]&&120===a[1]&&105===a[2]&&102===a[3]&&0===a[4]&&0===a[5]){const e=Pg.decode(t,{onlyFirst:!0,ignoreImageData:!0,offset:t.offset});i.exif=e}}return i},Bg=(e)=>{const t=new Uint8Array(e);if(!(t&&1<t.length))return null;const i=(e,a)=>{a=Object.assign({offset:0},a);for(let n=0;n<e.length;n++)if(e[n]!==t[n+a.offset])return!1;return!0};if(i([255,216,255]))return{ext:'jpg',mime:'image/jpeg'};if(i([137,80,78,71,13,10,26,10]))return{ext:'png',mime:'image/png'};if(i([71,73,70]))return{ext:'gif',mime:'image/gif'};if(i([87,69,66,80],{offset:8}))return{ext:'webp',mime:'image/webp'};if(i([70,76,73,70]))return{ext:'flif',mime:'image/flif'};if((i([73,73,42,0])||i([77,77,0,42]))&&i([67,82],{offset:8}))return{ext:'cr2',mime:'image/x-canon-cr2'};if(i([73,73,42,0])||i([77,77,0,42]))return{ext:'tif',mime:'image/tiff'};if(i([66,77]))return{ext:'bmp',mime:'image/bmp'};if(i([73,73,188]))return{ext:'jxr',mime:'image/vnd.ms-photo'};if(i([56,66,80,83]))return{ext:'psd',mime:'image/vnd.adobe.photoshop'};if(i([80,75,3,4])&&i([109,105,109,101,116,121,112,101,97,112,112,108,105,99,97,116,105,111,110,47,101,112,117,98,43,122,105,112],{offset:30}))return{ext:'epub',mime:'application/epub+zip'};if(i([80,75,3,4])&&i([77,69,84,65,45,73,78,70,47,109,111,122,105,108,108,97,46,114,115,97],{offset:30}))return{ext:'xpi',mime:'application/x-xpinstall'};if(i([80,75])&&(3===t[2]||5===t[2]||7===t[2])&&(4===t[3]||6===t[3]||8===t[3]))return{ext:'zip',mime:'application/zip'};if(i([117,115,116,97,114],{offset:257}))return{ext:'tar',mime:'application/x-tar'};if(i([82,97,114,33,26,7])&&(0===t[6]||1===t[6]))return{ext:'rar',mime:'application/x-rar-compressed'};if(i([31,139,8]))return{ext:'gz',mime:'application/gzip'};if(i([66,90,104]))return{ext:'bz2',mime:'application/x-bzip2'};if(i([55,122,188,175,39,28]))return{ext:'7z',mime:'application/x-7z-compressed'};if(i([120,1]))return{ext:'dmg',mime:'application/x-apple-diskimage'};if(i([0,0,0])&&(24===t[3]||32===t[3])&&i([102,116,121,112],{offset:4})||i([51,103,112,53])||i([0,0,0,28,102,116,121,112,109,112,52,50])&&i([109,112,52,49,109,112,52,50,105,115,111,109],{offset:16})||i([0,0,0,28,102,116,121,112,105,115,111,109])||i([0,0,0,28,102,116,121,112,109,112,52,50,0,0,0,0]))return{ext:'mp4',mime:'video/mp4'};if(i([0,0,0,28,102,116,121,112,77,52,86]))return{ext:'m4v',mime:'video/x-m4v'};if(i([77,84,104,100]))return{ext:'mid',mime:'audio/midi'};if(i([26,69,223,163])){const e=t.subarray(4,4100),a=e.findIndex((e,t,i)=>66===i[t]&&130===i[t+1]);if(0<=a){const t=(t)=>Array.from(t).every((t,n)=>e[a+3+n]===t.charCodeAt(0));if(t('matroska'))return{ext:'mkv',mime:'video/x-matroska'};if(t('webm'))return{ext:'webm',mime:'video/webm'}}}return i([0,0,0,20,102,116,121,112,113,116,32,32])||i([102,114,101,101],{offset:4})||i([102,116,121,112,113,116,32,32],{offset:4})||i([109,100,97,116],{offset:4})||i([119,105,100,101],{offset:4})?{ext:'mov',mime:'video/quicktime'}:i([82,73,70,70])&&i([65,86,73],{offset:8})?{ext:'avi',mime:'video/x-msvideo'}:i([48,38,178,117,142,102,207,17,166,217])?{ext:'wmv',mime:'video/x-ms-wmv'}:i([0,0,1,186])?{ext:'mpg',mime:'video/mpeg'}:i([73,68,51])||i([255,251])?{ext:'mp3',mime:'audio/mpeg'}:i([102,116,121,112,77,52,65],{offset:4})||i([77,52,65,32])?{ext:'m4a',mime:'audio/m4a'}:i([79,112,117,115,72,101,97,100],{offset:28})?{ext:'opus',mime:'audio/opus'}:i([79,103,103,83])?{ext:'ogg',mime:'audio/ogg'}:i([102,76,97,67])?{ext:'flac',mime:'audio/x-flac'}:i([82,73,70,70])&&i([87,65,86,69],{offset:8})?{ext:'wav',mime:'audio/x-wav'}:i([35,33,65,77,82,10])?{ext:'amr',mime:'audio/amr'}:i([37,80,68,70])?{ext:'pdf',mime:'application/pdf'}:i([77,90])?{ext:'exe',mime:'application/x-msdownload'}:(67===t[0]||70===t[0])&&i([87,83],{offset:1})?{ext:'swf',mime:'application/x-shockwave-flash'}:i([123,92,114,116,102])?{ext:'rtf',mime:'application/rtf'}:i([0,97,115,109])?{ext:'wasm',mime:'application/wasm'}:i([119,79,70,70])&&(i([0,1,0,0],{offset:4})||i([79,84,84,79],{offset:4}))?{ext:'woff',mime:'application/font-woff'}:i([119,79,70,50])&&(i([0,1,0,0],{offset:4})||i([79,84,84,79],{offset:4}))?{ext:'woff2',mime:'application/font-woff'}:i([76,80],{offset:34})&&(i([0,0,1],{offset:8})||i([1,0,2],{offset:8})||i([2,0,2],{offset:8}))?{ext:'eot',mime:'application/octet-stream'}:i([0,1,0,0,0])?{ext:'ttf',mime:'application/font-sfnt'}:i([79,84,84,79,0])?{ext:'otf',mime:'application/font-sfnt'}:i([0,0,1,0])?{ext:'ico',mime:'image/x-icon'}:i([70,76,86,1])?{ext:'flv',mime:'video/x-flv'}:i([37,33])?{ext:'ps',mime:'application/postscript'}:i([253,55,122,88,90,0])?{ext:'xz',mime:'application/x-xz'}:i([83,81,76,105])?{ext:'sqlite',mime:'application/x-sqlite3'}:i([78,69,83,26])?{ext:'nes',mime:'application/x-nintendo-nes-rom'}:i([67,114,50,52])?{ext:'crx',mime:'application/x-google-chrome-extension'}:i([77,83,67,70])||i([73,83,99,40])?{ext:'cab',mime:'application/vnd.ms-cab-compressed'}:i([33,60,97,114,99,104,62,10,100,101,98,105,97,110,45,98,105,110,97,114,121])?{ext:'deb',mime:'application/x-deb'}:i([33,60,97,114,99,104,62])?{ext:'ar',mime:'application/x-unix-archive'}:i([237,171,238,219])?{ext:'rpm',mime:'application/x-rpm'}:i([31,160])||i([31,157])?{ext:'Z',mime:'application/x-compress'}:i([76,90,73,80])?{ext:'lz',mime:'application/x-lzip'}:i([208,207,17,224,161,177,26,225])?{ext:'msi',mime:'application/x-msi'}:i([6,14,43,52,2,5,1,1,13,1,2,1,1,2])?{ext:'mxf',mime:'application/mxf'}:i([66,76,69,78,68,69,82])?{ext:'blend',mime:'application/x-blender'}:null};const Cg=new Set(['jpg','png','gif','webp','tif','bmp','jxr','psd']);for(var Ag=(e)=>{const t=Bg(e);return Cg.has(t&&t.ext)?t:null},Rg='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/',zg=new Uint8Array(256),Lg=0;Lg<Rg.length;Lg++)zg[Rg.charCodeAt(Lg)]=Lg;var Eg=/^data:[a-z]+\/([a-z]+);base64,/,Tg=Co.BlobBuilder||Co.WebKitBlobBuilder||Co.MSBlobBuilder||Co.MozBlobBuilder,Vg=function(){try{var e=new Blob(['hi']);return 2===e.size}catch(t){return!1}}(),Ug=Vg&&function(){try{var e=new Blob([new Uint8Array([1,2])]);return 2===e.size}catch(t){return!1}}(),Fg=Tg&&Tg.prototype.append&&Tg.prototype.getBlob,Yg=function(){return Vg?Ug?Co.Blob:Mn:Fg?jn:void 0}(),Xg=Co.MutationObserver||Co.WebKitMutationObserver,qg;if(Xg){var Og=0,Ng=new Xg(Sn),Gg=Co.document.createTextNode('');Ng.observe(Gg,{characterData:!0}),qg=function(){Gg.data=Og=++Og%2}}else if(!Co.setImmediate&&'undefined'!=typeof Co.MessageChannel){var Hg=new Co.MessageChannel;Hg.port1.onmessage=Sn,qg=function(){Hg.port2.postMessage(0)}}else qg='document'in Co&&'onreadystatechange'in Co.document.createElement('script')?function(){var e=Co.document.createElement('script');e.onreadystatechange=function(){Sn(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},Co.document.documentElement.appendChild(e)}:function(){setTimeout(Sn,0)};var Wg=[],Zg=function(e){1!==Wg.push(e)||ec||qg()},Qg={},Kg=['REJECTED'],Jg=['FULFILLED'],$g=['PENDING'],ec;In.prototype['catch']=function(e){return this.then(null,e)},In.prototype.then=function(e,t){if('function'!=typeof e&&this.state===Jg||'function'!=typeof t&&this.state===Kg)return this;var i=new this.constructor(Pn);if(this.state!==$g){var a=this.state===Jg?e:t;Cn(i,a,this.outcome)}else this.queue.push(new Bn(i,e,t));return i},Bn.prototype.callFulfilled=function(e){Qg.resolve(this.promise,e)},Bn.prototype.otherCallFulfilled=function(e){Cn(this.promise,this.onFulfilled,e)},Bn.prototype.callRejected=function(e){Qg.reject(this.promise,e)},Bn.prototype.otherCallRejected=function(e){Cn(this.promise,this.onRejected,e)},Qg.resolve=function(e,t){var a=zn(An,t);if('error'===a.status)return Qg.reject(e,a.value);var n=a.value;if(n)Rn(e,n);else{e.state=Jg,e.outcome=t;for(var o=-1,i=e.queue.length;++o<i;)e.queue[o].callFulfilled(t)}return e},Qg.reject=function(e,t){e.state=Kg,e.outcome=t;for(var a=-1,i=e.queue.length;++a<i;)e.queue[a].callRejected(t);return e},In.resolve=function(e){return e instanceof this?e:Qg.resolve(new this(Pn),e)},In.reject=function(e){var t=new this(Pn);return Qg.reject(t,e)},In.all=function(e){function t(e,t){a.resolve(e).then(function(e){s[t]=e,++r!==n||o||(o=!0,Qg.resolve(d,s))},function(e){o||(o=!0,Qg.reject(d,e))})}var a=this;if('[object Array]'!==Object.prototype.toString.call(e))return this.reject(new TypeError('must be an array'));var n=e.length,o=!1;if(!n)return this.resolve([]);for(var s=Array(n),r=0,l=-1,d=new this(Pn);++l<n;)t(e[l],l);return d},In.race=function(e){function t(e){a.resolve(e).then(function(e){o||(o=!0,Qg.resolve(i,e))},function(e){o||(o=!0,Qg.reject(i,e))})}var a=this;if('[object Array]'!==Object.prototype.toString.call(e))return this.reject(new TypeError('must be an array'));var n=e.length,o=!1;if(!n)return this.resolve([]);for(var s=-1,i=new this(Pn);++s<n;)t(e[s]);return i};var tc='function'==typeof Promise?Promise:In,ic={createBlob:Un,createObjectURL:function(e){return(window.URL||window.webkitURL).createObjectURL(e)},revokeObjectURL:function(e){return(window.URL||window.webkitURL).revokeObjectURL(e)},imgSrcToBlob:function(e,t,i,a){return t=t||'image/png',Tn(e,i).then(function(e){return Vn(e)}).then(function(e){return qn(e,t,a)})},imgSrcToDataURL:function(e,t,i,a){return t=t||'image/png',Tn(e,i).then(function(e){return Vn(e)}).then(function(e){return e.toDataURL(t,a)})},canvasToBlob:qn,dataURLToBlob:Xn,blobToBase64String:function(e){return Fn(e).then(function(e){return btoa(e)})},base64StringToBlob:Yn,binaryStringToBlob:function(e,t){return tc.resolve().then(function(){return Yn(btoa(e),t)})},blobToBinaryString:Fn,arrayBufferToBlob:function(e,t){return tc.resolve().then(function(){return Un([e],t)})},blobToArrayBuffer:function(e){return new tc(function(t,i){var a=new FileReader;a.onloadend=function(i){var e=i.target.result||new ArrayBuffer(0);t(e)},a.onerror=i,a.readAsArrayBuffer(e)})}}.canvasToBlob,ac=S(function(e,t){(function(i){function a(e){for(var t=[],i=0,a=e.length,n,o;i<a;)n=e.charCodeAt(i++),55296<=n&&56319>=n&&i<a?(o=e.charCodeAt(i++),56320==(64512&o)?t.push(((1023&n)<<10)+(1023&o)+65536):(t.push(n),i--)):t.push(n);return t}function n(e){for(var t=e.length,i=-1,a='',n;++i<t;)n=e[i],65535<n&&(n-=65536,a+=m(55296|1023&n>>>10),n=56320|1023&n),a+=m(n);return a}function o(e){if(55296<=e&&57343>=e)throw Error('Lone surrogate U+'+e.toString(16).toUpperCase()+' is not a scalar value')}function s(e,t){return m(128|63&e>>t)}function r(e){if(0==(4294967168&e))return m(e);var t='';return 0==(4294965248&e)?t=m(192|31&e>>6):0==(4294901760&e)?(o(e),t=m(224|15&e>>12),t+=s(e,6)):0==(4292870144&e)&&(t=m(240|7&e>>18),t+=s(e,12),t+=s(e,6)),t+=m(128|63&e),t}function l(){if(_>=f)throw Error('Invalid byte index');var e=255&u[_];if(_++,128==(192&e))return 63&e;throw Error('Invalid continuation byte')}function d(){var e,t,i,a,n;if(_>f)throw Error('Invalid byte index');if(_==f)return!1;if(e=255&u[_],_++,0==(128&e))return e;if(192==(224&e)){if(t=l(),n=(31&e)<<6|t,128<=n)return n;throw Error('Invalid continuation byte')}if(224==(240&e)){if(t=l(),i=l(),n=(15&e)<<12|t<<6|i,2048<=n)return o(n),n;throw Error('Invalid continuation byte')}if(240==(248&e)&&(t=l(),i=l(),a=l(),n=(7&e)<<18|t<<12|i<<6|a,65536<=n&&1114111>=n))return n;throw Error('Invalid UTF-8 detected')}var h=t,g=e&&e.exports==h&&e,c='object'==typeof Co&&Co;(c.global===c||c.window===c)&&(i=c);var m=Qn,p={version:'2.1.2',encode:function(e){for(var t=a(e),i=t.length,n=-1,o='',s;++n<i;)s=t[n],o+=r(s);return o},decode:function(e){u=a(e),f=u.length,_=0;for(var t=[],i;!1!==(i=d());)t.push(i);return n(t)}},u,f,_;if(!h||h.nodeType)i.utf8=p;else if(g)g.exports=p;else{var b={}.hasOwnProperty;for(var w in p)b.call(p,w)&&(h[w]=p[w])}})(Co)});const nc=[];var oc=class{constructor(e,t){t=t||{};var i=!1;void 0===e&&(e=8192),'number'==typeof e?e=new ArrayBuffer(e):(i=!0,this._lastWrittenByte=e.byteLength);const a=t.offset?t.offset>>>0:0;let n=e.byteLength-a,o=a;e.buffer&&(e.byteLength!==e.buffer.byteLength&&(o=e.byteOffset+a),e=e.buffer),this._lastWrittenByte=i?n:0,this.buffer=e,this.length=n,this.byteLength=n,this.byteOffset=o,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,o,n),this._mark=0,this._marks=[]}available(e){return void 0===e&&(e=1),this.offset+e<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(e){return void 0===e&&(e=1),this.offset+=e,this}seek(e){return this.offset=e,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const e=this._marks.pop();if(void 0===e)throw new Error('Mark stack empty');return this.seek(e),this}rewind(){return this.offset=0,this}ensureAvailable(e){if(void 0===e&&(e=1),!this.available(e)){const t=this.offset+e,i=2*t,a=new Uint8Array(i);a.set(new Uint8Array(this.buffer)),this.buffer=a.buffer,this.length=this.byteLength=i,this._data=new DataView(this.buffer)}return this}readBoolean(){return 0!==this.readUint8()}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(e){void 0===e&&(e=1);for(var t=new Uint8Array(e),a=0;a<e;a++)t[a]=this.readByte();return t}readInt16(){var e=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}readUint16(){var e=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,e}readInt32(){var e=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}readUint32(){var e=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat32(){var e=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat64(){var e=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}readChar(){return Qn(this.readInt8())}readChars(e){void 0===e&&(e=1),nc.length=e;for(var t=0;t<e;t++)nc[t]=this.readChar();return nc.join('')}readUtf8(e){void 0===e&&(e=1);const t=this.readChars(e);return ac.decode(t)}writeBoolean(e){return this.writeUint8(e?255:0),this}writeInt8(e){return this.ensureAvailable(1),this._data.setInt8(this.offset++,e),this._updateLastWrittenByte(),this}writeUint8(e){return this.ensureAvailable(1),this._data.setUint8(this.offset++,e),this._updateLastWrittenByte(),this}writeByte(e){return this.writeUint8(e)}writeBytes(e){this.ensureAvailable(e.length);for(var t=0;t<e.length;t++)this._data.setUint8(this.offset++,e[t]);return this._updateLastWrittenByte(),this}writeInt16(e){return this.ensureAvailable(2),this._data.setInt16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(e){return this.ensureAvailable(2),this._data.setUint16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(e){return this.ensureAvailable(4),this._data.setInt32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(e){return this.ensureAvailable(4),this._data.setUint32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(e){return this.ensureAvailable(4),this._data.setFloat32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(e){return this.ensureAvailable(8),this._data.setFloat64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(e){return this.writeUint8(e.charCodeAt(0))}writeChars(e){for(var t=0;t<e.length;t++)this.writeUint8(e.charCodeAt(t));return this}writeUtf8(e){const t=ac.encode(e);return this.writeChars(t)}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this._lastWrittenByte)}getBuffer(){return'undefined'==typeof Buffer?this.toArray():Buffer.from(this.toArray())}_updateLastWrittenByte(){this.offset>this._lastWrittenByte&&(this._lastWrittenByte=this.offset)}},sc={BITMAPV5HEADER:{LogicalColorSpace:{LCS_CALIBRATED_RGB:0,LCS_sRGB:1934772034,LCS_WINDOWS_COLOR_SPACE:1466527264},Compression:{BI_RGB:0,BI_RLE8:1,BI_RLE4:2,BI_BITFIELDS:3,BI_JPEG:4,BI_PNG:5,BI_CMYK:11,BI_CMYKRLE8:12,BI_CMYKRLE4:13},GamutMappingIntent:{LCS_GM_ABS_COLORIMETRIC:8,LCS_GM_BUSINESS:1,LCS_GM_GRAPHICS:2,LCS_GM_IMAGES:4}}};const rc=[];for(var lc=0;8>=lc;lc++)rc.push(255<<lc);var dc=function(e){if(1!==e.bitDepth)throw new Error('Only bitDepth of 1 is supported');if(!e.height||!e.width)throw new Error('ImageData width and height are required');if(1!==e.components)throw new Error('Only 1 component is supported');if(1!==e.channels)throw new Error('Only 1 channel is supported');var t=new oc;t.skip(14),Hn(t,e),Nn(t,e);const i=t.offset;return On(t,e),t.rewind(),Gn(t,i),t.getBuffer()},hc={configurable:!0,enumerable:!1,get:void 0},gc=Object.prototype.toString,cc='IJSImage';class mc{constructor(t,i,n,o){if(void 0===t&&(t=1),void 0===i&&(i=1),'object'==typeof t){var s=t,r=!0===i;t=s.width,i=s.height,n=r?s.data.slice():s.data,o={position:s.position,components:s.components,alpha:s.alpha,bitDepth:s.bitDepth,colorModel:s.colorModel,parent:s,meta:s.meta}}if(n&&!n.length&&(o=n,n=null),void 0===o&&(o={}),this.width=t,this.height=i,0>=this.width)throw new RangeError('width must be greater than 0');if(0>=this.height)throw new RangeError('height must be greater than 0');Object.defineProperty(this,'parent',{enumerable:!1,writable:!0}),this.parent=o.parent,this.position=o.position||[0,0];var l;if('string'!=typeof o.kind)l=e(wo);else if(l=e(o.kind),!l)throw new RangeError('invalid image kind: '+o.kind);var d=tl({},l,o);this.components=d.components,this.alpha=d.alpha+0,this.bitDepth=d.bitDepth,this.colorModel=d.colorModel,this.meta=o.meta||{},this.computed=null,this.initialize(),n||(n=a(this)),this.setData(n)}get[Symbol.toStringTag](){return cc}static isImage(e){return`[object ${cc}]`===gc.call(e)}initialize(){this.size=this.width*this.height,this.sizes=[this.width,this.height],this.channels=this.components+this.alpha,this.maxValue=32===this.bitDepth?io:no(2,this.bitDepth)-1,this.multiplierX=this.channels,this.multiplierY=this.channels*this.width,this.isClamped=32>this.bitDepth,this.borderSizes=[0,0]}setData(e){var i=t(this);if(i!==e.length)throw new RangeError(`incorrect data size. Should be ${i} and found ${e.length}`);this.data=e}static load(e,t){return fn(e,t)}static fromCanvas(e){var t=e.getContext('2d'),i=t.getImageData(0,0,e.width,e.height);return new mc(i.width,i.height,i.data)}static extendMethod(e,t,i={}){var a=i.inPlace,n=i.returnThis,o=void 0===n||n,s=i.partialArgs,r=void 0===s?[]:s,l=i.stack,d=void 0!==l&&l;if(void 0!==a&&a){if(mc.prototype[e]=function(...e){this.computed=null;var i=t.apply(this,[...r,...e]);return o?this:i},d){var h='string'==typeof d?d:e;Sr.prototype[h]=o?function(...t){for(var i of this)i[e](...t);return this}:function(...t){for(var a=new Sr(this.length),n=0;n<this.length;n++)a[n]=this[n][e](...t);return a}}}else if(mc.prototype[e]=function(...e){return t.apply(this,[...r,...e])},d){var g='string'==typeof d?d:e;Sr.prototype[g]=function(...t){for(var a=new Sr(this.length),n=0;n<this.length;n++)a[n]=this[n][e](...t);return a}}return mc}static extendProperty(e,t,i={}){var a=i.partialArgs,n=void 0===a?[]:a;return hc.get=function(){if(null===this.computed)this.computed={};else if(jr(e,this.computed))return this.computed[e];var i=t.apply(this,n);return this.computed[e]=i,i},Object.defineProperty(mc.prototype,e,hc),mc}static createFrom(e,t){var i={width:e.width,height:e.height,position:[0,0],components:e.components,alpha:e.alpha,colorModel:e.colorModel,bitDepth:e.bitDepth,parent:e};return tl(i,t),new mc(i.width,i.height,i)}static isTypeSupported(e,t='write'){if('string'!=typeof e)throw new TypeError('type argument must be a string');if(e=Hi(e),'write'===t)return Gi(e);throw new TypeError('unknown operation: '+t)}getPixelIndex(e){for(var t=0,a=0;a<e.length;a++)t+=this.multipliers[a]*e[a];return t}setValueXY(e,t,i,a){return this.data[(t*this.width+e)*this.channels+i]=a,this.computed=null,this}getValueXY(e,t,i){return this.data[(t*this.width+e)*this.channels+i]}setValue(e,t,i){return this.data[e*this.channels+t]=i,this.computed=null,this}getValue(e,t){return this.data[e*this.channels+t]}setPixelXY(e,t,i){return this.setPixel(t*this.width+e,i)}getPixelXY(e,t){return this.getPixel(t*this.width+e)}setPixel(e,t){for(var a=e*this.channels,n=0;n<t.length;n++)this.data[a+n]=t[n];return this.computed=null,this}getPixel(e){for(var t=Array(this.channels),a=e*this.channels,n=0;n<this.channels;n++)t[n]=this.data[a+n];return t}toDataURL(e='image/png',t=!1){function i(t){var i=dc(t),a=mn(i);return`data:${e};base64,${a}`}return e=Hi(e),t?new Promise((t,a)=>{'image/bmp'===e?t(i(this)):this.getCanvas().toDataURL(e,function(e,i){e?a(e):t(i)})}):'image/bmp'===e?i(this):this.getCanvas().toDataURL(e)}toBase64(e='image/png',t=!1){if(t)return this.toDataURL(e,!0).then(function(e){return e.substring(e.indexOf(',')+1)});var i=this.toDataURL(e);return i.substring(i.indexOf(',')+1)}toBlob(e='image/png',t=0.8){return ic(this.getCanvas({originalData:!0}),e,t)}getCanvas(e={}){var t=e.originalData,i;void 0!==t&&t?(this.checkProcessable('getInPlaceCanvas',{channels:[4],bitDepth:[8]}),i=new Mo(this.data,this.width,this.height)):i=new Mo(this.getRGBAData(),this.width,this.height);var a=new o(this.width,this.height),n=a.getContext('2d');return n.putImageData(i,0,0),a}getRGBAData(){this.checkProcessable('getRGBAData',{components:[1,3],bitDepth:[1,8,16]});var e=this.size,t=new Uint8ClampedArray(4*(this.width*this.height));if(1===this.bitDepth)for(var a=0,i;a<e;a++)i=this.getBit(a),t[4*a]=255*i,t[4*a+1]=255*i,t[4*a+2]=255*i;else if(1===this.components)for(var n=0;n<e;n++)t[4*n]=this.data[n*this.channels]>>>this.bitDepth-8,t[4*n+1]=this.data[n*this.channels]>>>this.bitDepth-8,t[4*n+2]=this.data[n*this.channels]>>>this.bitDepth-8;else if(3===this.components&&(this.checkProcessable('getRGBAData',{colorModel:[xo]}),this.colorModel===xo))for(var o=0;o<e;o++)t[4*o]=this.data[o*this.channels]>>>this.bitDepth-8,t[4*o+1]=this.data[o*this.channels+1]>>>this.bitDepth-8,t[4*o+2]=this.data[o*this.channels+2]>>>this.bitDepth-8;if(this.alpha){this.checkProcessable('getRGBAData',{bitDepth:[8,16]});for(var s=0;s<e;s++)t[4*s+3]=this.data[s*this.channels+this.components]>>this.bitDepth-8}else for(var r=0;r<e;r++)t[4*r+3]=255;return t}getRoiManager(e){return new cl(this,e)}clone(e={}){var t=e.copyData;return new mc(this,void 0===t||t)}save(e,t={}){var i=t.format,a=void 0===i?'png':i;return new Promise((t,i)=>{var n=r(e),o,s;switch(a.toLowerCase()){case'png':o=this.getCanvas().pngStream();break;case'jpg':case'jpeg':o=this.getCanvas().jpegStream();break;case'bmp':s=dc(this);break;default:throw new RangeError('invalid output format: '+a);}o?(n.on('finish',t),n.on('error',i),o.pipe(n)):s&&l(e,Buffer.from(s),(e)=>{return e?void i(e):void t()})})}checkProcessable(e,t={}){var i=t.bitDepth,a=t.alpha,n=t.colorModel,o=t.components,s=t.channels;if('string'!=typeof e)throw new TypeError('checkProcessable requires as first parameter the processName (a string)');if(i&&(Array.isArray(i)||(i=[i]),!i.includes(this.bitDepth)))throw new TypeError('The process: '+e+' can only be applied if bit depth is in: '+i);if(a&&(Array.isArray(a)||(a=[a]),!a.includes(this.alpha)))throw new TypeError('The process: '+e+' can only be applied if alpha is in: '+a);if(n&&(Array.isArray(n)||(n=[n]),!n.includes(this.colorModel)))throw new TypeError('The process: '+e+' can only be applied if color model is in: '+n);if(o&&(Array.isArray(o)||(o=[o]),!o.includes(this.components)))throw new TypeError('The process: '+e+' can only be applied if the number of components is in: '+o);if(s&&(Array.isArray(s)||(s=[s]),!s.includes(this.channels)))throw new TypeError('The process: '+e+' can only be applied if the number of channels is in: '+s)}checkColumn(e){if(0>e||e>=this.width)throw new RangeError(`checkColumn: column should be included between 0 and ${this.width-1}. Current value: ${e}`)}checkRow(e){if(0>e||e>=this.height)throw new RangeError(`checkRow: row should be included between 0 and ${this.height-1}. Current value: ${e}`)}checkChannel(e){if(0>e||e>=this.channels)throw new RangeError(`checkChannel: channel should be included between 0 and ${this.channels-1}. Current value: ${e}`)}apply(e){for(var t=0;t<this.height;t++)for(var i=0,a;i<this.width;i++)a=(t*this.width+i)*this.channels,e.call(this,a)}}(function(e){var t={inPlace:!0},i={stack:!0};e.extendMethod('invertGetSet',d,t),e.extendMethod('invertIterator',h,t),e.extendMethod('invertPixel',c,t),e.extendMethod('invertOneLoop',g,t),e.extendMethod('invertApply',m,t),e.extendMethod('invert',w,{inPlace:!0,stack:!0}),e.extendMethod('invertBinaryLoop',p,t),e.extendMethod('level',me,t),e.extendMethod('add',fe,t),e.extendMethod('subtract',_e,t),e.extendMethod('multiply',we,t),e.extendMethod('divide',xe,t),e.extendMethod('hypotenuse',be),e.extendMethod('background',je),e.extendMethod('flipX',x),e.extendMethod('flipY',y),e.extendMethod('blurFilter',v),e.extendMethod('medianFilter',j),e.extendMethod('gaussianFilter',de),e.extendMethod('sobelFilter',ce),e.extendMethod('crop',Me,i),e.extendMethod('cropAlpha',Se,i),e.extendMethod('scale',Ee,i),e.extendMethod('hsv',Te),e.extendMethod('hsl',Ve),e.extendMethod('cmyk',Ue),e.extendMethod('rgba8',Fe),e.extendMethod('grey',Ye).extendMethod('gray',Ye),e.extendMethod('mask',Qe),e.extendMethod('pad',Je),e.extendMethod('colorDepth',$e),e.extendMethod('setBorder',ot,t),e.extendMethod('rotate',tt),e.extendMethod('rotateLeft',it),e.extendMethod('rotateRight',at),e.extendMethod('getRow',Dt),e.extendMethod('getColumn',jt),e.extendMethod('getMatrix',Mt),e.extendMethod('setMatrix',St),e.extendMethod('getPixelsArray',Pt),e.extendMethod('getIntersection',It),e.extendMethod('getClosestCommonParent',At),e.extendMethod('split',ut),e.extendMethod('getChannel',ft),e.extendMethod('combineChannels',_t),e.extendMethod('setChannel',wt),e.extendMethod('getSimilarity',xt),e.extendMethod('getPixelsGrid',yt),e.extendMethod('getBestMatch',vt),e.extendMethod('paintMasks',Ht,t),e.extendMethod('paintLabels',Wt,t),e.extendMethod('paintPoints',Jt,t),e.extendMethod('paintPolyline',ei,t),e.extendMethod('paintPolygon',$t,t),e.extendMethod('extract',ti),e.extendMethod('convolution',le),e.extendMethod('convolutionFft',k),e.extendMethod('floodFill',ii),e.extendMethod('countAlphaPixels',bi),e.extendMethod('monotoneChainConvexHull',ki),e.extendMethod('minimalBoundingRectangle',Mi),e.extendMethod('getHistogram',ni).extendProperty('histogram',ni),e.extendMethod('getHistograms',oi).extendProperty('histograms',oi),e.extendMethod('getColorHistogram',ri).extendProperty('colorHistogram',ri),e.extendMethod('getMin',li).extendProperty('min',li),e.extendMethod('getMax',di).extendProperty('max',di),e.extendMethod('getSum',hi).extendProperty('sum',hi),e.extendMethod('getMoment',gi).extendProperty('moment',gi),e.extendMethod('getLocalMaxima',ci),e.extendMethod('getMedian',pi).extendProperty('median',pi),e.extendMethod('getMean',mi).extendProperty('mean',mi),e.extendMethod('getPoints',ui).extendProperty('points',ui),e.extendMethod('getRelativePosition',fi),e.extendMethod('getSvd',_i).extendProperty('svd',_i)})(mc),function(e){for(var t in Ur)e.prototype[t]=Ur[t]}(mc);var pc=Object.freeze({laplacianOfGaussian:function(e,t,a){var n=Array(t),o,i,s,r;a||(a=100),a*=-1;var l=(t-1)/2,d=2*e*e;for(o=0;o<t;o++)for(n[o]=Array(t),r=(o-l)*(o-l),i=0;i<t;i++)s=(i-l)*(i-l),n[o][i]=go(a*(1-(s+r)/d)*co(-(s+r)/d));return n},DISCRETE_LAPLACE_4:[[0,1,0],[1,-4,1],[0,1,0]],DISCRETE_LAPLACE_8:[[1,1,1],[1,-8,1],[1,1,1]],GRADIENT_X:rs,GRADIENT_Y:ls,SECOND_DERIVATIVE:[[-1,-2,0,2,1],[-2,-4,0,4,2],[0,0,0,0,0],[1,2,0,-2,-1],[2,4,0,-4,-2]],SECOND_DERIVATIVE_INV:[[1,2,0,-2,-1],[2,4,0,-4,-2],[0,0,0,0,0],[-2,-4,0,4,2],[-1,-2,0,2,1]]}),uc=function(){function e(){this._listeners={}}self.window=self;e.prototype.on=function(e,t){if(this._listeners[e])throw new RangeError('there is already a listener for '+e);if('function'!=typeof t)throw new TypeError('callback argument must be a function');this._listeners[e]=t},e.prototype._send=function(e,t,i){void 0===i?i=[]:!Array.isArray(i)&&(i=[i]),self.postMessage({id:e,data:t},i)},e.prototype._trigger=function(e,t){if(!this._listeners[e])throw new Error('event '+e+' is not defined');this._listeners[e].apply(null,t)};var t=new e;self.onmessage=function(e){switch(e.data.action){case'exec':e.data.args.unshift(function(i,a){t._send(e.data.id,i,a)}),t._trigger(e.data.event,e.data.args);break;case'ping':t._send(e.data.id,'pong');break;default:throw new Error('unexpected action: '+e.data.action);}},'CODE'}.toString().split('"CODE";'),fc={newWorkerURL:function(e,t){var i=new Blob(['(',uc[0],'importScripts.apply(self, '+JSON.stringify(t)+');\n','(',e,')();',uc[1],')();'],{type:'application/javascript'});return URL.createObjectURL(i)}},_c=navigator.hardwareConcurrency||1;Wn.prototype._init=function(e){for(var t=fc.newWorkerURL(this._workerCode,e),a=0,i;a<this._numWorkers;a++)i=new Worker(t),i.onmessage=this._onmessage.bind(this,i),i.onerror=this._onerror.bind(this,i),i.running=!1,i.id=a,this._workers.set(i,null);URL.revokeObjectURL(t)},Wn.prototype._onerror=function(e,t){if(!this._terminated){this._working--,e.running=!1;var i=this._workers.get(e);i&&i[1](t.message),this._workers.set(e,null),this._terminateOnError?this.terminate():this._exec()}},Wn.prototype._onmessage=function(e,t){if(!this._terminated){this._working--,e.running=!1;var i=this._workers.get(e);i&&i[0](t.data.data),this._workers.set(e,null),this._exec()}},Wn.prototype._exec=function(){for(var e of this._workers.keys()){if(this._working===this._numWorkers||0===this._waiting.length)return;if(!e.running)for(var t=0,i;t<this._waiting.length;t++)if(i=this._waiting[t],'number'!=typeof i[4]||i[4]===e.id){this._waiting.splice(t,1),e.postMessage({action:'exec',event:i[0],args:i[1]},i[2]),e.running=!0,e.time=Date.now(),this._workers.set(e,i[3]),this._working++;break}}},Wn.prototype.terminate=function(){if(!this._terminated){for(var e of this._workers)e[0].terminate(),e[1]&&e[1][1](new Error('Terminated'));this._workers.clear(),this._waiting=[],this._working=0,this._terminated=!0}},Wn.prototype.postAll=function(e,t){if(this._terminated)throw new Error('Cannot post (terminated)');var i=[];for(var a of this._workers.keys())i.push(this.post(e,t,[],a.id));return Promise.all(i)},Wn.prototype.post=function(e,t,i,a){void 0===t&&(t=[]),void 0===i&&(i=[]),Array.isArray(t)||(t=[t]),Array.isArray(i)||(i=[i]);var n=this;return new Promise(function(o,s){if(n._terminated)throw new Error('Cannot post (terminated)');n._waiting.push([e,t,i,[o,s],a]),n._exec()})};var bc=Wn,wc={regression:{kernelType:'polynomial',kernelOptions:{degree:2,constant:1}},threshold:0.02,roi:{minSurface:100,positive:!1},sampling:20,include:[]},xc={run:function(e,t,i){t=tl({},wc,t);var a=this.manager;return Array.isArray(e)?Promise.all(e.map(function(e){var n=Zn(a,e,t);return'function'==typeof i&&n.then(i),n})):Zn(a,e,t)},work:function(){worker.on('data',function(e,t,i){function a(e,t){i.include.includes(e)&&(n[e]=t,o.push(t.data.buffer))}t=new IJS(t);var n={},o=[],s=t.grey(),r=s.sobelFilter();a('sobel',r);var l=r.level().mask({threshold:i.threshold});a('mask',l);var d=r.getRoiManager();d.fromMask(l);var h=d.getMask(i.roi);a('realMask',h);var g=s.getPixelsGrid({sampling:i.sampling,mask:h}),c=t.getBackground(g.xyS,g.zS,i.regression);a('background',c);var m=t.subtract(c);n.result=m,o.push(m.data.buffer),e(n,o)})}};class yc{constructor(){this._url=null,this._deps=[null]}checkUrl(){if(null===this._url)throw new Error('image worker must be initialized with an URL')}get url(){return this._url}set url(e){if('string'!=typeof e)throw new TypeError('worker URL must be a string');this._url=e,this._deps[0]=e}static extendMethod(e,t){function i(...e){return n||(this.checkUrl(),o=this.url,n=new bc(t.work,{deps:o}),a.manager=n),t.run.call(a,...e)}var a={},n,o;i.reset=function(){n&&(n.terminate(),n=new bc(t.work,{deps:o}),a.manager=n)},yc.prototype[e]=i}}(function(e){e.extendMethod('background',xc)})(yc);var kc=new yc;mc.Stack=Sr,mc.Shape=Tr,mc.Kernel=pc;return mc.Static={grey:hr,mask:cr,maskMethods:gr},mc.Worker=kc,mc});

//# sourceMappingURL=image.min.js.map